
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Kubernetes · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../深入剖析k8s/k8s.html" />
    
    
    <link rel="prev" href="../消息队列/mq-7.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../操作系统/readme.html">
            
                <a href="../操作系统/readme.html">
            
                    
                    操作系统
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../操作系统/虚拟内存.html">
            
                <a href="../操作系统/虚拟内存.html">
            
                    
                    虚拟内存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../操作系统/进程和线程.html">
            
                <a href="../操作系统/进程和线程.html">
            
                    
                    进程和线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../操作系统/协程和IO多路复用.html">
            
                <a href="../操作系统/协程和IO多路复用.html">
            
                    
                    协程和IO多路复用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../操作系统/同步.html">
            
                <a href="../操作系统/同步.html">
            
                    
                    同步与锁
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Go/">
            
                <a href="../Go/">
            
                    
                    GO学习
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Go/1-字符集.html">
            
                <a href="../Go/1-字符集.html">
            
                    
                    字符集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../Go/2-slice.html">
            
                <a href="../Go/2-slice.html">
            
                    
                    slice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../Go/3-结构体和内存对齐.html">
            
                <a href="../Go/3-结构体和内存对齐.html">
            
                    
                    结构体和内存对齐
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../Go/4-map.html">
            
                <a href="../Go/4-map.html">
            
                    
                    map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../Go/5-函数调用栈.html">
            
                <a href="../Go/5-函数调用栈.html">
            
                    
                    函数调用栈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../Go/6-defer与painc.html">
            
                <a href="../Go/6-defer与painc.html">
            
                    
                    defer与painc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../Go/7-类型系统.html">
            
                <a href="../Go/7-类型系统.html">
            
                    
                    类型系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../Go/8-GPM.html">
            
                <a href="../Go/8-GPM.html">
            
                    
                    GPM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../消息队列/">
            
                <a href="../消息队列/">
            
                    
                    消息队列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../消息队列/mq-1.html">
            
                <a href="../消息队列/mq-1.html">
            
                    
                    为什么需要消息队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../消息队列/mq-2.html">
            
                <a href="../消息队列/mq-2.html">
            
                    
                    该如何选择消息队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../消息队列/mq-3.html">
            
                <a href="../消息队列/mq-3.html">
            
                    
                    消息模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../消息队列/mq-4.html">
            
                <a href="../消息队列/mq-4.html">
            
                    
                    如何利用事务消息实现分布式事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../消息队列/mq-5.html">
            
                <a href="../消息队列/mq-5.html">
            
                    
                    如何确保消息不丢失
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../消息队列/mq-6.html">
            
                <a href="../消息队列/mq-6.html">
            
                    
                    如何处理消费过程中消息重复消费
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../消息队列/mq-7.html">
            
                <a href="../消息队列/mq-7.html">
            
                    
                    消息积压该如何处理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="k8s.html">
            
                <a href="k8s.html">
            
                    
                    Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../深入剖析k8s/k8s.html">
            
                <a href="../深入剖析k8s/k8s.html">
            
                    
                    深入剖析K8S
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../深入剖析k8s/k8s调度.html">
            
                <a href="../深入剖析k8s/k8s调度.html">
            
                    
                    k8s调度器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../深入剖析k8s/k8s网络插件.html">
            
                <a href="../深入剖析k8s/k8s网络插件.html">
            
                    
                    k8s网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../高并发系统设计/">
            
                <a href="../高并发系统设计/">
            
                    
                    高并发系统设计
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../高并发系统设计/缓存/缓存.html">
            
                <a href="../高并发系统设计/缓存/缓存.html">
            
                    
                    缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../高并发系统设计/缓存/redis.html">
            
                <a href="../高并发系统设计/缓存/redis.html">
            
                    
                    redis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../系统性能调优/1.html">
            
                <a href="../系统性能调优/1.html">
            
                    
                    系统性能调优
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../DDD/1.html">
            
                <a href="../DDD/1.html">
            
                    
                    DDD
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Kubernetes</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>Kubernetes</p>
<h1 id="1-kubernetes&#x4ECB;&#x7ECD;">1. Kubernetes&#x4ECB;&#x7ECD;</h1>
<h2 id="11-&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#x6F14;&#x53D8;">1.1 &#x5E94;&#x7528;&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#x6F14;&#x53D8;</h2>
<p>&#x5728;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x65B9;&#x5F0F;&#x4E0A;&#xFF0C;&#x4E3B;&#x8981;&#x7ECF;&#x5386;&#x4E86;&#x4E09;&#x4E2A;&#x65F6;&#x4EE3;&#xFF1A;</p>
<ul>
<li><p><strong>&#x4F20;&#x7EDF;&#x90E8;&#x7F72;</strong>&#xFF1A;&#x4E92;&#x8054;&#x7F51;&#x65E9;&#x671F;&#xFF0C;&#x4F1A;&#x76F4;&#x63A5;&#x5C06;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90E8;&#x7F72;&#x5728;&#x7269;&#x7406;&#x673A;&#x4E0A;</p>
<blockquote>
<p>&#x4F18;&#x70B9;&#xFF1A;&#x7B80;&#x5355;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5176;&#x5B83;&#x6280;&#x672F;&#x7684;&#x53C2;&#x4E0E;</p>
<p>&#x7F3A;&#x70B9;&#xFF1A;&#x4E0D;&#x80FD;&#x4E3A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5B9A;&#x4E49;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x8FB9;&#x754C;&#xFF0C;&#x5F88;&#x96BE;&#x5408;&#x7406;&#x5730;&#x5206;&#x914D;&#x8BA1;&#x7B97;&#x8D44;&#x6E90;&#xFF0C;&#x800C;&#x4E14;&#x7A0B;&#x5E8F;&#x4E4B;&#x95F4;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x5F71;&#x54CD;</p>
</blockquote>
</li>
<li><p><strong>&#x865A;&#x62DF;&#x5316;&#x90E8;&#x7F72;</strong>&#xFF1A;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x53F0;&#x7269;&#x7406;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6BCF;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x90FD;&#x662F;&#x72EC;&#x7ACB;&#x7684;&#x4E00;&#x4E2A;&#x73AF;&#x5883;</p>
<blockquote>
<p>&#x4F18;&#x70B9;&#xFF1A;&#x7A0B;&#x5E8F;&#x73AF;&#x5883;&#x4E0D;&#x4F1A;&#x76F8;&#x4E92;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x7684;&#x5B89;&#x5168;&#x6027;</p>
<p>&#x7F3A;&#x70B9;&#xFF1A;&#x589E;&#x52A0;&#x4E86;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x6D6A;&#x8D39;&#x4E86;&#x90E8;&#x5206;&#x8D44;&#x6E90;</p>
</blockquote>
</li>
<li><p><strong>&#x5BB9;&#x5668;&#x5316;&#x90E8;&#x7F72;</strong>&#xFF1A;&#x4E0E;&#x865A;&#x62DF;&#x5316;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x5171;&#x4EAB;&#x4E86;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</p>
<blockquote>
<p>&#x4F18;&#x70B9;&#xFF1A;</p>
<p>&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3001;CPU&#x3001;&#x5185;&#x5B58;&#x3001;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#x7B49;</p>
<p>&#x8FD0;&#x884C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6240;&#x9700;&#x8981;&#x7684;&#x8D44;&#x6E90;&#x90FD;&#x88AB;&#x5BB9;&#x5668;&#x5305;&#x88C5;&#xFF0C;&#x5E76;&#x548C;&#x5E95;&#x5C42;&#x57FA;&#x7840;&#x67B6;&#x6784;&#x89E3;&#x8026;</p>
<p>&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x8DE8;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x3001;&#x8DE8;Linux&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x53D1;&#x884C;&#x7248;&#x8FDB;&#x884C;&#x90E8;&#x7F72;</p>
</blockquote>
</li>
</ul>
<p><img src="Kubenetes.assets/image-20200505183738289.png" alt="image-20200505183738289"></p>
<p>&#x5BB9;&#x5668;&#x5316;&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#x7ED9;&#x5E26;&#x6765;&#x5F88;&#x591A;&#x7684;&#x4FBF;&#x5229;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x4F1A;&#x51FA;&#x73B0;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x6545;&#x969C;&#x505C;&#x673A;&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x6837;&#x8BA9;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x7ACB;&#x523B;&#x542F;&#x52A8;&#x53BB;&#x66FF;&#x8865;&#x505C;&#x673A;&#x7684;&#x5BB9;&#x5668;</li>
<li>&#x5F53;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x91CF;&#x53D8;&#x5927;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x600E;&#x4E48;&#x6837;&#x505A;&#x5230;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x5BB9;&#x5668;&#x6570;&#x91CF;</li>
</ul>
<p>&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x7BA1;&#x7406;&#x7684;&#x95EE;&#x9898;&#x7EDF;&#x79F0;&#x4E3A;<strong>&#x5BB9;&#x5668;&#x7F16;&#x6392;</strong>&#x95EE;&#x9898;&#xFF0C;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E9B;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7684;&#x8F6F;&#x4EF6;&#xFF1A;</p>
<ul>
<li><strong>Swarm</strong>&#xFF1A;Docker&#x81EA;&#x5DF1;&#x7684;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x5DE5;&#x5177;</li>
<li><strong>Mesos</strong>&#xFF1A;Apache&#x7684;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x7EDF;&#x4E00;&#x7BA1;&#x63A7;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x9700;&#x8981;&#x548C;Marathon&#x7ED3;&#x5408;&#x4F7F;&#x7528;</li>
<li><strong>Kubernetes</strong>&#xFF1A;Google&#x5F00;&#x6E90;&#x7684;&#x7684;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x5DE5;&#x5177;</li>
</ul>
<p><img src="Kubenetes.assets/image-20200524150339551.png" alt="image-20200524150339551"></p>
<h2 id="12-kubernetes&#x7B80;&#x4ECB;">1.2 kubernetes&#x7B80;&#x4ECB;</h2>
<p><img src="Kubenetes.assets/image-20200406232838722.png" alt="image-20200406232838722"></p>
<p>kubernetes&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5168;&#x65B0;&#x7684;&#x57FA;&#x4E8E;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x67B6;&#x6784;&#x9886;&#x5148;&#x65B9;&#x6848;&#xFF0C;&#x662F;&#x8C37;&#x6B4C;&#x4E25;&#x683C;&#x4FDD;&#x5BC6;&#x5341;&#x51E0;&#x5E74;&#x7684;&#x79D8;&#x5BC6;&#x6B66;&#x5668;----Borg&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7248;&#x672C;&#xFF0C;&#x4E8E;2014&#x5E74;9&#x6708;&#x53D1;&#x5E03;&#x7B2C;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;2015&#x5E74;7&#x6708;&#x53D1;&#x5E03;&#x7B2C;&#x4E00;&#x4E2A;&#x6B63;&#x5F0F;&#x7248;&#x672C;&#x3002;</p>
<p>kubernetes&#x7684;&#x672C;&#x8D28;&#x662F;<strong>&#x4E00;&#x7EC4;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;</strong>&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x96C6;&#x7FA4;&#x7684;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x7279;&#x5B9A;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x6765;&#x5BF9;&#x8282;&#x70B9;&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;&#x76EE;&#x7684;&#x662F;&#x5B9E;&#x73B0;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7684;&#x81EA;&#x52A8;&#x5316;&#xFF0C;&#x4E3B;&#x8981;&#x63D0;&#x4F9B;&#x4E86;&#x5982;&#x4E0B;&#x7684;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li><strong>&#x81EA;&#x6211;&#x4FEE;&#x590D;</strong>&#xFF1A;&#x4E00;&#x65E6;&#x67D0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5D29;&#x6E83;&#xFF0C;&#x80FD;&#x591F;&#x5728;1&#x79D2;&#x4E2D;&#x5DE6;&#x53F3;&#x8FC5;&#x901F;&#x542F;&#x52A8;&#x65B0;&#x7684;&#x5BB9;&#x5668;</li>
<li><strong>&#x5F39;&#x6027;&#x4F38;&#x7F29;</strong>&#xFF1A;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#xFF0C;&#x81EA;&#x52A8;&#x5BF9;&#x96C6;&#x7FA4;&#x4E2D;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x6570;&#x91CF;&#x8FDB;&#x884C;&#x8C03;&#x6574;</li>
<li><strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#xFF1A;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x81EA;&#x52A8;&#x53D1;&#x73B0;&#x7684;&#x5F62;&#x5F0F;&#x627E;&#x5230;&#x5B83;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x670D;&#x52A1;</li>
<li><strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#xFF1A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x8D77;&#x52A8;&#x4E86;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x5B9E;&#x73B0;&#x8BF7;&#x6C42;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</li>
<li><strong>&#x7248;&#x672C;&#x56DE;&#x9000;</strong>&#xFF1A;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x65B0;&#x53D1;&#x5E03;&#x7684;&#x7A0B;&#x5E8F;&#x7248;&#x672C;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x56DE;&#x9000;&#x5230;&#x539F;&#x6765;&#x7684;&#x7248;&#x672C;</li>
<li><strong>&#x5B58;&#x50A8;&#x7F16;&#x6392;</strong>&#xFF1A;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5BB9;&#x5668;&#x81EA;&#x8EAB;&#x7684;&#x9700;&#x6C42;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x5377;</li>
</ul>
<p><img src="Kubenetes.assets/image-20200526203726071-1626780706899.png" alt="image-20200526203726071"></p>
<h2 id="13-kubernetes&#x7EC4;&#x4EF6;">1.3 kubernetes&#x7EC4;&#x4EF6;</h2>
<p>&#x4E00;&#x4E2A;kubernetes&#x96C6;&#x7FA4;&#x4E3B;&#x8981;&#x662F;&#x7531;<strong>&#x63A7;&#x5236;&#x8282;&#x70B9;(master)</strong>&#x3001;<strong>&#x5DE5;&#x4F5C;&#x8282;&#x70B9;(node)</strong>&#x6784;&#x6210;&#xFF0C;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x90FD;&#x4F1A;&#x5B89;&#x88C5;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;&#x3002;</p>
<p><strong>master&#xFF1A;&#x96C6;&#x7FA4;&#x7684;&#x63A7;&#x5236;&#x5E73;&#x9762;&#xFF0C;&#x8D1F;&#x8D23;&#x96C6;&#x7FA4;&#x7684;&#x51B3;&#x7B56; ( &#x7BA1;&#x7406; )</strong></p>
<blockquote>
<p><strong>ApiServer</strong> : &#x8D44;&#x6E90;&#x64CD;&#x4F5C;&#x7684;&#x552F;&#x4E00;&#x5165;&#x53E3;&#xFF0C;&#x63A5;&#x6536;&#x7528;&#x6237;&#x8F93;&#x5165;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x63D0;&#x4F9B;&#x8BA4;&#x8BC1;&#x3001;&#x6388;&#x6743;&#x3001;API&#x6CE8;&#x518C;&#x548C;&#x53D1;&#x73B0;&#x7B49;&#x673A;&#x5236;</p>
<p><strong>Scheduler</strong> : &#x8D1F;&#x8D23;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#xFF0C;&#x6309;&#x7167;&#x9884;&#x5B9A;&#x7684;&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x5C06;Pod&#x8C03;&#x5EA6;&#x5230;&#x76F8;&#x5E94;&#x7684;node&#x8282;&#x70B9;&#x4E0A;</p>
<p><strong>ControllerManager</strong> : &#x8D1F;&#x8D23;&#x7EF4;&#x62A4;&#x96C6;&#x7FA4;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x6BD4;&#x5982;&#x7A0B;&#x5E8F;&#x90E8;&#x7F72;&#x5B89;&#x6392;&#x3001;&#x6545;&#x969C;&#x68C0;&#x6D4B;&#x3001;&#x81EA;&#x52A8;&#x6269;&#x5C55;&#x3001;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x7B49;</p>
<p><strong>Etcd</strong> &#xFF1A;&#x8D1F;&#x8D23;&#x5B58;&#x50A8;&#x96C6;&#x7FA4;&#x4E2D;&#x5404;&#x79CD;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x7684;&#x4FE1;&#x606F;</p>
</blockquote>
<p><strong>node&#xFF1A;&#x96C6;&#x7FA4;&#x7684;&#x6570;&#x636E;&#x5E73;&#x9762;&#xFF0C;&#x8D1F;&#x8D23;&#x4E3A;&#x5BB9;&#x5668;&#x63D0;&#x4F9B;&#x8FD0;&#x884C;&#x73AF;&#x5883; ( &#x5E72;&#x6D3B; )</strong></p>
<blockquote>
<p><strong>Kubelet</strong> : &#x8D1F;&#x8D23;&#x7EF4;&#x62A4;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x5373;&#x901A;&#x8FC7;&#x63A7;&#x5236;docker&#xFF0C;&#x6765;&#x521B;&#x5EFA;&#x3001;&#x66F4;&#x65B0;&#x3001;&#x9500;&#x6BC1;&#x5BB9;&#x5668;</p>
<p><strong>KubeProxy</strong> : &#x8D1F;&#x8D23;&#x63D0;&#x4F9B;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x548C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</p>
<p><strong>Docker</strong> : &#x8D1F;&#x8D23;&#x8282;&#x70B9;&#x4E0A;&#x5BB9;&#x5668;&#x7684;&#x5404;&#x79CD;&#x64CD;&#x4F5C;</p>
</blockquote>
<p><img src="Kubenetes.assets/image-20200406184656917.png" alt="image-20200406184656917"></p>
<p>&#x4E0B;&#x9762;&#xFF0C;&#x4EE5;&#x90E8;&#x7F72;&#x4E00;&#x4E2A;nginx&#x670D;&#x52A1;&#x6765;&#x8BF4;&#x660E;kubernetes&#x7CFB;&#x7EDF;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x8C03;&#x7528;&#x5173;&#x7CFB;&#xFF1A;</p>
<ol>
<li><p>&#x9996;&#x5148;&#x8981;&#x660E;&#x786E;&#xFF0C;&#x4E00;&#x65E6;kubernetes&#x73AF;&#x5883;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#xFF0C;master&#x548C;node&#x90FD;&#x4F1A;&#x5C06;&#x81EA;&#x8EAB;&#x7684;&#x4FE1;&#x606F;&#x5B58;&#x50A8;&#x5230;etcd&#x6570;&#x636E;&#x5E93;&#x4E2D;</p>
</li>
<li><p>&#x4E00;&#x4E2A;nginx&#x670D;&#x52A1;&#x7684;&#x5B89;&#x88C5;&#x8BF7;&#x6C42;&#x4F1A;&#x9996;&#x5148;&#x88AB;&#x53D1;&#x9001;&#x5230;master&#x8282;&#x70B9;&#x7684;apiServer&#x7EC4;&#x4EF6;</p>
</li>
<li><p>apiServer&#x7EC4;&#x4EF6;&#x4F1A;&#x8C03;&#x7528;scheduler&#x7EC4;&#x4EF6;&#x6765;&#x51B3;&#x5B9A;&#x5230;&#x5E95;&#x5E94;&#x8BE5;&#x628A;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5B89;&#x88C5;&#x5230;&#x54EA;&#x4E2A;node&#x8282;&#x70B9;&#x4E0A;</p>
<p>&#x5728;&#x6B64;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x4ECE;etcd&#x4E2D;&#x8BFB;&#x53D6;&#x5404;&#x4E2A;node&#x8282;&#x70B9;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x7136;&#x540E;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x7684;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x9009;&#x62E9;&#xFF0C;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x544A;&#x77E5;apiServer</p>
</li>
<li><p>apiServer&#x8C03;&#x7528;controller-manager&#x53BB;&#x8C03;&#x5EA6;Node&#x8282;&#x70B9;&#x5B89;&#x88C5;nginx&#x670D;&#x52A1;</p>
</li>
<li><p>kubelet&#x63A5;&#x6536;&#x5230;&#x6307;&#x4EE4;&#x540E;&#xFF0C;&#x4F1A;&#x901A;&#x77E5;docker&#xFF0C;&#x7136;&#x540E;&#x7531;docker&#x6765;&#x542F;&#x52A8;&#x4E00;&#x4E2A;nginx&#x7684;pod</p>
<p>pod&#x662F;kubernetes&#x7684;&#x6700;&#x5C0F;&#x64CD;&#x4F5C;&#x5355;&#x5143;&#xFF0C;&#x5BB9;&#x5668;&#x5FC5;&#x987B;&#x8DD1;&#x5728;pod&#x4E2D;&#x81F3;&#x6B64;&#xFF0C;</p>
</li>
<li><p>&#x4E00;&#x4E2A;nginx&#x670D;&#x52A1;&#x5C31;&#x8FD0;&#x884C;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x8BBF;&#x95EE;nginx&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x901A;&#x8FC7;kube-proxy&#x6765;&#x5BF9;pod&#x4EA7;&#x751F;&#x8BBF;&#x95EE;&#x7684;&#x4EE3;&#x7406;</p>
</li>
</ol>
<p>&#x8FD9;&#x6837;&#xFF0C;&#x5916;&#x754C;&#x7528;&#x6237;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;nginx&#x670D;&#x52A1;&#x4E86;</p>
<h2 id="14-kubernetes&#x6982;&#x5FF5;">1.4 kubernetes&#x6982;&#x5FF5;</h2>
<p><strong>Master</strong>&#xFF1A;&#x96C6;&#x7FA4;&#x63A7;&#x5236;&#x8282;&#x70B9;&#xFF0C;&#x6BCF;&#x4E2A;&#x96C6;&#x7FA4;&#x9700;&#x8981;&#x81F3;&#x5C11;&#x4E00;&#x4E2A;master&#x8282;&#x70B9;&#x8D1F;&#x8D23;&#x96C6;&#x7FA4;&#x7684;&#x7BA1;&#x63A7;</p>
<p><strong>Node</strong>&#xFF1A;&#x5DE5;&#x4F5C;&#x8D1F;&#x8F7D;&#x8282;&#x70B9;&#xFF0C;&#x7531;master&#x5206;&#x914D;&#x5BB9;&#x5668;&#x5230;&#x8FD9;&#x4E9B;node&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x7136;&#x540E;node&#x8282;&#x70B9;&#x4E0A;&#x7684;docker&#x8D1F;&#x8D23;&#x5BB9;&#x5668;&#x7684;&#x8FD0;&#x884C;</p>
<p><strong>Pod</strong>&#xFF1A;kubernetes&#x7684;&#x6700;&#x5C0F;&#x63A7;&#x5236;&#x5355;&#x5143;&#xFF0C;&#x5BB9;&#x5668;&#x90FD;&#x662F;&#x8FD0;&#x884C;&#x5728;pod&#x4E2D;&#x7684;&#xFF0C;&#x4E00;&#x4E2A;pod&#x4E2D;&#x53EF;&#x4EE5;&#x6709;1&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x5BB9;&#x5668;</p>
<p><strong>Controller</strong>&#xFF1A;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6765;&#x5B9E;&#x73B0;&#x5BF9;pod&#x7684;&#x7BA1;&#x7406;&#xFF0C;&#x6BD4;&#x5982;&#x542F;&#x52A8;pod&#x3001;&#x505C;&#x6B62;pod&#x3001;&#x4F38;&#x7F29;pod&#x7684;&#x6570;&#x91CF;&#x7B49;&#x7B49;</p>
<p><strong>Service</strong>&#xFF1A;pod&#x5BF9;&#x5916;&#x670D;&#x52A1;&#x7684;&#x7EDF;&#x4E00;&#x5165;&#x53E3;&#xFF0C;&#x4E0B;&#x9762;&#x53EF;&#x4EE5;&#x7EF4;&#x62A4;&#x8005;&#x540C;&#x4E00;&#x7C7B;&#x7684;&#x591A;&#x4E2A;pod</p>
<p><strong>Label</strong>&#xFF1A;&#x6807;&#x7B7E;&#xFF0C;&#x7528;&#x4E8E;&#x5BF9;pod&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#xFF0C;&#x540C;&#x4E00;&#x7C7B;pod&#x4F1A;&#x62E5;&#x6709;&#x76F8;&#x540C;&#x7684;&#x6807;&#x7B7E;</p>
<p><strong>NameSpace</strong>&#xFF1A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x7528;&#x6765;&#x9694;&#x79BB;pod&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;</p>
<h1 id="2-kubernetes&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x642D;&#x5EFA;">2. kubernetes&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x642D;&#x5EFA;</h1>
<h2 id="21-&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#x70B9;">2.1 &#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#x70B9;</h2>
<p>&#x76EE;&#x524D;&#x751F;&#x4EA7;&#x90E8;&#x7F72;Kubernetes &#x96C6;&#x7FA4;&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;</p>
<p><strong>kubeadm</strong></p>
<p>Kubeadm &#x662F;&#x4E00;&#x4E2A;K8s &#x90E8;&#x7F72;&#x5DE5;&#x5177;&#xFF0C;&#x63D0;&#x4F9B;kubeadm init &#x548C;kubeadm join&#xFF0C;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x90E8;&#x7F72;Kubernetes &#x96C6;&#x7FA4;&#x3002;</p>
<p>&#x5B98;&#x65B9;&#x5730;&#x5740;&#xFF1A;<a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/" target="_blank">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/</a></p>
<p><strong>&#x4E8C;&#x8FDB;&#x5236;&#x5305;</strong></p>
<p>&#x4ECE;github &#x4E0B;&#x8F7D;&#x53D1;&#x884C;&#x7248;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#xFF0C;&#x624B;&#x52A8;&#x90E8;&#x7F72;&#x6BCF;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x7EC4;&#x6210;Kubernetes &#x96C6;&#x7FA4;&#x3002;</p>
<p>Kubeadm &#x964D;&#x4F4E;&#x90E8;&#x7F72;&#x95E8;&#x69DB;&#xFF0C;&#x4F46;&#x5C4F;&#x853D;&#x4E86;&#x5F88;&#x591A;&#x7EC6;&#x8282;&#xFF0C;&#x9047;&#x5230;&#x95EE;&#x9898;&#x5F88;&#x96BE;&#x6392;&#x67E5;&#x3002;&#x5982;&#x679C;&#x60F3;&#x66F4;&#x5BB9;&#x6613;&#x53EF;&#x63A7;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x90E8;&#x7F72;Kubernetes &#x96C6;&#x7FA4;&#xFF0C;&#x867D;&#x7136;&#x624B;&#x52A8;&#x90E8;&#x7F72;&#x9EBB;&#x70E6;&#x70B9;&#xFF0C;&#x671F;&#x95F4;&#x53EF;&#x4EE5;&#x5B66;&#x4E60;&#x5F88;&#x591A;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x4E5F;&#x5229;&#x4E8E;&#x540E;&#x671F;&#x7EF4;&#x62A4;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200404094800622.png" alt="image-20200404094800622"></p>
<h2 id="22-kubeadm-&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#x4ECB;&#x7ECD;">2.2 kubeadm &#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#x4ECB;&#x7ECD;</h2>
<p>kubeadm &#x662F;&#x5B98;&#x65B9;&#x793E;&#x533A;&#x63A8;&#x51FA;&#x7684;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x90E8;&#x7F72;kubernetes &#x96C6;&#x7FA4;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x80FD;&#x901A;&#x8FC7;&#x4E24;&#x6761;&#x6307;&#x4EE4;&#x5B8C;&#x6210;&#x4E00;&#x4E2A;kubernetes &#x96C6;&#x7FA4;&#x7684;&#x90E8;&#x7F72;&#xFF1A;</p>
<ul>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Master &#x8282;&#x70B9;kubeadm init</li>
<li>&#x5C06;Node &#x8282;&#x70B9;&#x52A0;&#x5165;&#x5230;&#x5F53;&#x524D;&#x96C6;&#x7FA4;&#x4E2D;$ kubeadm join <master 节点的ip="" 和端口=""></master></li>
</ul>
<h2 id="23-&#x5B89;&#x88C5;&#x8981;&#x6C42;">2.3 &#x5B89;&#x88C5;&#x8981;&#x6C42;</h2>
<p>&#x5728;&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#xFF0C;&#x90E8;&#x7F72;Kubernetes &#x96C6;&#x7FA4;&#x673A;&#x5668;&#x9700;&#x8981;&#x6EE1;&#x8DB3;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x6761;&#x4EF6;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x53F0;&#x6216;&#x591A;&#x53F0;&#x673A;&#x5668;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;CentOS7.x-86_x64</li>
<li>&#x786C;&#x4EF6;&#x914D;&#x7F6E;&#xFF1A;2GB &#x6216;&#x66F4;&#x591A;RAM&#xFF0C;2 &#x4E2A;CPU &#x6216;&#x66F4;&#x591A;CPU&#xFF0C;&#x786C;&#x76D8;30GB &#x6216;&#x66F4;&#x591A;</li>
<li>&#x96C6;&#x7FA4;&#x4E2D;&#x6240;&#x6709;&#x673A;&#x5668;&#x4E4B;&#x95F4;&#x7F51;&#x7EDC;&#x4E92;&#x901A;</li>
<li>&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5916;&#x7F51;&#xFF0C;&#x9700;&#x8981;&#x62C9;&#x53D6;&#x955C;&#x50CF;</li>
<li>&#x7981;&#x6B62;swap &#x5206;&#x533A;</li>
</ul>
<h2 id="24-&#x6700;&#x7EC8;&#x76EE;&#x6807;">2.4 &#x6700;&#x7EC8;&#x76EE;&#x6807;</h2>
<ul>
<li>&#x5728;&#x6240;&#x6709;&#x8282;&#x70B9;&#x4E0A;&#x5B89;&#x88C5;Docker &#x548C;kubeadm</li>
<li>&#x90E8;&#x7F72;Kubernetes Master</li>
<li>&#x90E8;&#x7F72;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x63D2;&#x4EF6;</li>
<li>&#x90E8;&#x7F72;Kubernetes Node&#xFF0C;&#x5C06;&#x8282;&#x70B9;&#x52A0;&#x5165;Kubernetes &#x96C6;&#x7FA4;&#x4E2D;</li>
<li>&#x90E8;&#x7F72;Dashboard Web &#x9875;&#x9762;&#xFF0C;&#x53EF;&#x89C6;&#x5316;&#x67E5;&#x770B;Kubernetes &#x8D44;&#x6E90;</li>
</ul>
<h2 id="25-&#x51C6;&#x5907;&#x73AF;&#x5883;">2.5 &#x51C6;&#x5907;&#x73AF;&#x5883;</h2>
<p><img src="Kubenetes.assets/image-20210609000002940.png" alt="image-20210609000002940"></p>
<table>
<thead>
<tr>
<th style="text-align:left">&#x89D2;&#x8272;</th>
<th style="text-align:left">IP&#x5730;&#x5740;</th>
<th style="text-align:left">&#x7EC4;&#x4EF6;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">k8s-master01</td>
<td style="text-align:left">192.168.5.3</td>
<td style="text-align:left">docker&#xFF0C;kubectl&#xFF0C;kubeadm&#xFF0C;kubelet</td>
</tr>
<tr>
<td style="text-align:left">k8s-node01</td>
<td style="text-align:left">192.168.5.4</td>
<td style="text-align:left">docker&#xFF0C;kubectl&#xFF0C;kubeadm&#xFF0C;kubelet</td>
</tr>
<tr>
<td style="text-align:left">k8s-node02</td>
<td style="text-align:left">192.168.5.5</td>
<td style="text-align:left">docker&#xFF0C;kubectl&#xFF0C;kubeadm&#xFF0C;kubelet</td>
</tr>
</tbody>
</table>
<h2 id="26-&#x7CFB;&#x7EDF;&#x521D;&#x59CB;&#x5316;">2.6 &#x7CFB;&#x7EDF;&#x521D;&#x59CB;&#x5316;</h2>
<h3 id="261-&#x8BBE;&#x7F6E;&#x7CFB;&#x7EDF;&#x4E3B;&#x673A;&#x540D;&#x4EE5;&#x53CA;-host-&#x6587;&#x4EF6;&#x7684;&#x76F8;&#x4E92;&#x89E3;&#x6790;">2.6.1 &#x8BBE;&#x7F6E;&#x7CFB;&#x7EDF;&#x4E3B;&#x673A;&#x540D;&#x4EE5;&#x53CA; Host &#x6587;&#x4EF6;&#x7684;&#x76F8;&#x4E92;&#x89E3;&#x6790;</h3>
<pre><code class="lang-shell">hostnamectl set-hostname k8s-master01 &amp;&amp; bash
hostnamectl set-hostname k8s-node01 &amp;&amp; bash
hostnamectl set-hostname k8s-node02 &amp;&amp; bash
</code></pre>
<pre><code class="lang-shell">cat &lt;&lt;EOF&gt;&gt; /etc/hosts
192.168.5.3     k8s-master01
192.168.5.4     k8s-node01
192.168.5.5     k8s-node02
EOF
</code></pre>
<pre><code class="lang-shell">scp /etc/hosts root@192.168.5.4:/etc/hosts 
scp /etc/hosts root@192.168.5.5:/etc/hosts
</code></pre>
<h3 id="262-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x6587;&#x4EF6;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.2 &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x6587;&#x4EF6;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell">yum install -y conntrack ntpdate ntp ipvsadm ipset jq iptables curl sysstat libseccomp wget vim net-tools git
</code></pre>
<h3 id="263-&#x8BBE;&#x7F6E;&#x9632;&#x706B;&#x5899;&#x4E3A;-iptables-&#x5E76;&#x8BBE;&#x7F6E;&#x7A7A;&#x89C4;&#x5219;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.3 &#x8BBE;&#x7F6E;&#x9632;&#x706B;&#x5899;&#x4E3A; Iptables &#x5E76;&#x8BBE;&#x7F6E;&#x7A7A;&#x89C4;&#x5219;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell">systemctl stop firewalld &amp;&amp; systemctl disable firewalld

yum -y install iptables-services &amp;&amp; systemctl start iptables &amp;&amp; systemctl enable iptables &amp;&amp; iptables -F &amp;&amp; service iptables save
</code></pre>
<h3 id="264-&#x5173;&#x95ED;-selinux&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.4 &#x5173;&#x95ED; SELINUX&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell">swapoff -a &amp;&amp; sed -i &apos;/ swap / s/^\(.*\)$/#\1/g&apos; /etc/fstab

setenforce 0 &amp;&amp; sed -i &apos;s/^SELINUX=.*/SELINUX=disabled/&apos; /etc/selinux/config
</code></pre>
<h3 id="265-&#x8C03;&#x6574;&#x5185;&#x6838;&#x53C2;&#x6570;&#xFF0C;&#x5BF9;&#x4E8E;-k8s&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.5 &#x8C03;&#x6574;&#x5185;&#x6838;&#x53C2;&#x6570;&#xFF0C;&#x5BF9;&#x4E8E; K8S&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell">modprobe br_netfilter

cat &lt;&lt;EOF&gt; kubernetes.conf 
net.bridge.bridge-nf-call-iptables=1
net.bridge.bridge-nf-call-ip6tables=1
net.ipv4.ip_forward=1
net.ipv4.tcp_tw_recycle=0
vm.swappiness=0 # &#x7981;&#x6B62;&#x4F7F;&#x7528; swap &#x7A7A;&#x95F4;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x7CFB;&#x7EDF; OOM &#x65F6;&#x624D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x5B83;
vm.overcommit_memory=1 # &#x4E0D;&#x68C0;&#x67E5;&#x7269;&#x7406;&#x5185;&#x5B58;&#x662F;&#x5426;&#x591F;&#x7528;
vm.panic_on_oom=0 # &#x5F00;&#x542F; OOM
fs.inotify.max_user_instances=8192
fs.inotify.max_user_watches=1048576
fs.file-max=52706963
fs.nr_open=52706963
net.ipv6.conf.all.disable_ipv6=1
net.netfilter.nf_conntrack_max=2310720
EOF

cp kubernetes.conf /etc/sysctl.d/kubernetes.conf

sysctl -p /etc/sysctl.d/kubernetes.conf
</code></pre>
<h3 id="266-&#x8C03;&#x6574;&#x7CFB;&#x7EDF;&#x65F6;&#x533A;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.6 &#x8C03;&#x6574;&#x7CFB;&#x7EDF;&#x65F6;&#x533A;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell"># &#x8BBE;&#x7F6E;&#x7CFB;&#x7EDF;&#x65F6;&#x533A;&#x4E3A; &#x4E2D;&#x56FD;/&#x4E0A;&#x6D77;
timedatectl set-timezone Asia/Shanghai
# &#x5C06;&#x5F53;&#x524D;&#x7684; UTC &#x65F6;&#x95F4;&#x5199;&#x5165;&#x786C;&#x4EF6;&#x65F6;&#x949F;
timedatectl set-local-rtc 0
# &#x91CD;&#x542F;&#x4F9D;&#x8D56;&#x4E8E;&#x7CFB;&#x7EDF;&#x65F6;&#x95F4;&#x7684;&#x670D;&#x52A1;
systemctl restart rsyslog
systemctl restart crond
</code></pre>
<h3 id="267-&#x8BBE;&#x7F6E;-rsyslogd-&#x548C;-systemd-journald&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.7 &#x8BBE;&#x7F6E; rsyslogd &#x548C; systemd journald&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell"># &#x6301;&#x4E45;&#x5316;&#x4FDD;&#x5B58;&#x65E5;&#x5FD7;&#x7684;&#x76EE;&#x5F55;
mkdir /var/log/journal 
mkdir /etc/systemd/journald.conf.d
cat &gt; /etc/systemd/journald.conf.d/99-prophet.conf &lt;&lt;EOF
[Journal]
# &#x6301;&#x4E45;&#x5316;&#x4FDD;&#x5B58;&#x5230;&#x78C1;&#x76D8;
Storage=persistent

# &#x538B;&#x7F29;&#x5386;&#x53F2;&#x65E5;&#x5FD7;
Compress=yes

SyncIntervalSec=5m
RateLimitInterval=30s
RateLimitBurst=1000

# &#x6700;&#x5927;&#x5360;&#x7528;&#x7A7A;&#x95F4; 10G
SystemMaxUse=10G

# &#x5355;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x6700;&#x5927; 200M
SystemMaxFileSize=200M

# &#x65E5;&#x5FD7;&#x4FDD;&#x5B58;&#x65F6;&#x95F4; 2 &#x5468;
MaxRetentionSec=2week

# &#x4E0D;&#x5C06;&#x65E5;&#x5FD7;&#x8F6C;&#x53D1;&#x5230; syslog
ForwardToSyslog=no
EOF

systemctl restart systemd-journald
</code></pre>
<h3 id="268-kube-proxy&#x5F00;&#x542F;ipvs&#x7684;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.8 kube-proxy&#x5F00;&#x542F;ipvs&#x7684;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell">cat &lt;&lt;EOF&gt; /etc/sysconfig/modules/ipvs.modules 
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF

chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4
</code></pre>
<h3 id="269-&#x5B89;&#x88C5;-docker-&#x8F6F;&#x4EF6;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.9 &#x5B89;&#x88C5; Docker &#x8F6F;&#x4EF6;&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell">yum install -y yum-utils device-mapper-persistent-data lvm2

yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

yum install -y docker-ce

## &#x521B;&#x5EFA; /etc/docker &#x76EE;&#x5F55;
mkdir /etc/docker

cat &gt; /etc/docker/daemon.json &lt;&lt;EOF
{
&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],
&quot;log-driver&quot;: &quot;json-file&quot;,
&quot;log-opts&quot;: {
&quot;max-size&quot;: &quot;100m&quot;
}
}
EOF
mkdir -p /etc/systemd/system/docker.service.d
# &#x91CD;&#x542F;docker&#x670D;&#x52A1;
systemctl daemon-reload &amp;&amp; systemctl restart docker &amp;&amp; systemctl enable docker
</code></pre>
<p>&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x5230;<code>/etc/yum.repos.d/</code>&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5; &#x4EE3;&#x66FF; <code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code> &#x547D;&#x4EE4;</p>
<p>docker-ce.repo</p>
<pre><code class="lang-shell">[docker-ce-stable]
name=Docker CE Stable - $basearch
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/stable
enabled=1
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg

[docker-ce-stable-debuginfo]
name=Docker CE Stable - Debuginfo $basearch
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/debug-$basearch/stable
enabled=0
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg

[docker-ce-stable-source]
name=Docker CE Stable - Sources
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/source/stable
enabled=0
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg

[docker-ce-test]
name=Docker CE Test - $basearch
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/test
enabled=0
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg

[docker-ce-test-debuginfo]
name=Docker CE Test - Debuginfo $basearch
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/debug-$basearch/test
enabled=0
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg

[docker-ce-test-source]
name=Docker CE Test - Sources
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/source/test
enabled=0
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg

[docker-ce-nightly]
name=Docker CE Nightly - $basearch
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/nightly
enabled=0
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg

[docker-ce-nightly-debuginfo]
name=Docker CE Nightly - Debuginfo $basearch
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/debug-$basearch/nightly
enabled=0
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg

[docker-ce-nightly-source]
name=Docker CE Nightly - Sources
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/source/nightly
enabled=0
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg
</code></pre>
<h3 id="2610-&#x5B89;&#x88C5;-kubeadm-&#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;">2.6.10 &#x5B89;&#x88C5; Kubeadm &#xFF08;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF

yum install -y kubelet kubeadm kubectl &amp;&amp; systemctl enable kubelet
</code></pre>
<h2 id="27-&#x90E8;&#x7F72;kubernetes-master">2.7 &#x90E8;&#x7F72;Kubernetes Master</h2>
<h3 id="271-&#x521D;&#x59CB;&#x5316;&#x4E3B;&#x8282;&#x70B9;&#xFF08;&#x4E3B;&#x8282;&#x70B9;&#x64CD;&#x4F5C;&#xFF09;">2.7.1 &#x521D;&#x59CB;&#x5316;&#x4E3B;&#x8282;&#x70B9;&#xFF08;&#x4E3B;&#x8282;&#x70B9;&#x64CD;&#x4F5C;&#xFF09;</h3>
<pre><code class="lang-shell">kubeadm init --apiserver-advertise-address=192.168.5.3 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.21.1 --service-cidr=10.96.0.0/12 --pod-network-cidr=10.244.0.0/16

mkdir -p $HOME/.kube

sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config

sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<h3 id="272-&#x52A0;&#x5165;&#x4E3B;&#x8282;&#x70B9;&#x4EE5;&#x53CA;&#x5176;&#x4F59;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;">2.7.2 &#x52A0;&#x5165;&#x4E3B;&#x8282;&#x70B9;&#x4EE5;&#x53CA;&#x5176;&#x4F59;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;</h3>
<pre><code class="lang-shell">kubeadm join 192.168.5.3:6443 --token h0uelc.l46qp29nxscke7f7 \
        --discovery-token-ca-cert-hash sha256:abc807778e24bff73362ceeb783cc7f6feec96f20b4fd707c3f8e8312294e28f
</code></pre>
<h3 id="273-&#x90E8;&#x7F72;&#x7F51;&#x7EDC;">2.7.3 &#x90E8;&#x7F72;&#x7F51;&#x7EDC;</h3>
<pre><code class="lang-shell">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</code></pre>
<p>&#x4E0B;&#x8FB9;&#x662F;&#x6587;&#x4EF6;</p>
<pre><code class="lang-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> policy/v1beta1
<span class="hljs-attr">kind:</span> PodSecurityPolicy
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> psp.flannel.unprivileged
<span class="hljs-attr">  annotations:</span>
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default
    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default
    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  privileged:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">  volumes:</span>
<span class="hljs-bullet">  -</span> configMap
<span class="hljs-bullet">  -</span> secret
<span class="hljs-bullet">  -</span> emptyDir
<span class="hljs-bullet">  -</span> hostPath
<span class="hljs-attr">  allowedHostPaths:</span>
<span class="hljs-attr">  - pathPrefix:</span> <span class="hljs-string">&quot;/etc/cni/net.d&quot;</span>
<span class="hljs-attr">  - pathPrefix:</span> <span class="hljs-string">&quot;/etc/kube-flannel&quot;</span>
<span class="hljs-attr">  - pathPrefix:</span> <span class="hljs-string">&quot;/run/flannel&quot;</span>
<span class="hljs-attr">  readOnlyRootFilesystem:</span> <span class="hljs-literal">false</span>
  <span class="hljs-comment"># Users and groups</span>
<span class="hljs-attr">  runAsUser:</span>
<span class="hljs-attr">    rule:</span> RunAsAny
<span class="hljs-attr">  supplementalGroups:</span>
<span class="hljs-attr">    rule:</span> RunAsAny
<span class="hljs-attr">  fsGroup:</span>
<span class="hljs-attr">    rule:</span> RunAsAny
  <span class="hljs-comment"># Privilege Escalation</span>
<span class="hljs-attr">  allowPrivilegeEscalation:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">  defaultAllowPrivilegeEscalation:</span> <span class="hljs-literal">false</span>
  <span class="hljs-comment"># Capabilities</span>
<span class="hljs-attr">  allowedCapabilities:</span> [<span class="hljs-string">&apos;NET_ADMIN&apos;</span>, <span class="hljs-string">&apos;NET_RAW&apos;</span>]
<span class="hljs-attr">  defaultAddCapabilities:</span> []
<span class="hljs-attr">  requiredDropCapabilities:</span> []
  <span class="hljs-comment"># Host namespaces</span>
<span class="hljs-attr">  hostPID:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">  hostIPC:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">  hostNetwork:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  hostPorts:</span>
<span class="hljs-attr">  - min:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">    max:</span> <span class="hljs-number">65535</span>
  <span class="hljs-comment"># SELinux</span>
<span class="hljs-attr">  seLinux:</span>
    <span class="hljs-comment"># SELinux is unused in CaaSP</span>
<span class="hljs-attr">    rule:</span> <span class="hljs-string">&apos;RunAsAny&apos;</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> ClusterRole
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> flannel
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span> [<span class="hljs-string">&apos;extensions&apos;</span>]
<span class="hljs-attr">  resources:</span> [<span class="hljs-string">&apos;podsecuritypolicies&apos;</span>]
<span class="hljs-attr">  verbs:</span> [<span class="hljs-string">&apos;use&apos;</span>]
<span class="hljs-attr">  resourceNames:</span> [<span class="hljs-string">&apos;psp.flannel.unprivileged&apos;</span>]
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> pods
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> nodes
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> nodes/status
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> patch
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> ClusterRoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> flannel
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">  kind:</span> ClusterRole
<span class="hljs-attr">  name:</span> flannel
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> ServiceAccount
<span class="hljs-attr">  name:</span> flannel
<span class="hljs-attr">  namespace:</span> kube-system
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> ServiceAccount
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> flannel
<span class="hljs-attr">  namespace:</span> kube-system
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> ConfigMap
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> kube-flannel-cfg
<span class="hljs-attr">  namespace:</span> kube-system
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    tier:</span> node
<span class="hljs-attr">    app:</span> flannel
<span class="hljs-attr">data:</span>
  cni-conf.json: <span class="hljs-string">|
    {
      &quot;name&quot;: &quot;cbr0&quot;,
      &quot;cniVersion&quot;: &quot;0.3.1&quot;,
      &quot;plugins&quot;: [
        {
          &quot;type&quot;: &quot;flannel&quot;,
          &quot;delegate&quot;: {
            &quot;hairpinMode&quot;: true,
            &quot;isDefaultGateway&quot;: true
          }
        },
        {
          &quot;type&quot;: &quot;portmap&quot;,
          &quot;capabilities&quot;: {
            &quot;portMappings&quot;: true
          }
        }
      ]
    }
  net-conf.json: |
    {
      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,
      &quot;Backend&quot;: {
        &quot;Type&quot;: &quot;vxlan&quot;
      }
    }
---
</span><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> DaemonSet
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> kube-flannel-ds
<span class="hljs-attr">  namespace:</span> kube-system
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    tier:</span> node
<span class="hljs-attr">    app:</span> flannel
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> flannel
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        tier:</span> node
<span class="hljs-attr">        app:</span> flannel
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      affinity:</span>
<span class="hljs-attr">        nodeAffinity:</span>
<span class="hljs-attr">          requiredDuringSchedulingIgnoredDuringExecution:</span>
<span class="hljs-attr">            nodeSelectorTerms:</span>
<span class="hljs-attr">            - matchExpressions:</span>
<span class="hljs-attr">              - key:</span> kubernetes.io/os
<span class="hljs-attr">                operator:</span> In
<span class="hljs-attr">                values:</span>
<span class="hljs-bullet">                -</span> linux
<span class="hljs-attr">      hostNetwork:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">      priorityClassName:</span> system-node-critical
<span class="hljs-attr">      tolerations:</span>
<span class="hljs-attr">      - operator:</span> Exists
<span class="hljs-attr">        effect:</span> NoSchedule
<span class="hljs-attr">      serviceAccountName:</span> flannel
<span class="hljs-attr">      initContainers:</span>
<span class="hljs-attr">      - name:</span> install-cni
<span class="hljs-attr">        image:</span> quay.io/coreos/flannel:v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>
<span class="hljs-attr">        command:</span>
<span class="hljs-bullet">        -</span> cp
<span class="hljs-attr">        args:</span>
<span class="hljs-bullet">        -</span> -f
<span class="hljs-bullet">        -</span> /etc/kube-flannel/cni-conf.json
<span class="hljs-bullet">        -</span> /etc/cni/net.d/<span class="hljs-number">10</span>-flannel.conflist
<span class="hljs-attr">        volumeMounts:</span>
<span class="hljs-attr">        - name:</span> cni
<span class="hljs-attr">          mountPath:</span> /etc/cni/net.d
<span class="hljs-attr">        - name:</span> flannel-cfg
<span class="hljs-attr">          mountPath:</span> /etc/kube-flannel/
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> kube-flannel
<span class="hljs-attr">        image:</span> quay.io/coreos/flannel:v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>
<span class="hljs-attr">        command:</span>
<span class="hljs-bullet">        -</span> /opt/bin/flanneld
<span class="hljs-attr">        args:</span>
<span class="hljs-bullet">        -</span> --ip-masq
<span class="hljs-bullet">        -</span> --kube-subnet-mgr
<span class="hljs-attr">        resources:</span>
<span class="hljs-attr">          requests:</span>
<span class="hljs-attr">            cpu:</span> <span class="hljs-string">&quot;100m&quot;</span>
<span class="hljs-attr">            memory:</span> <span class="hljs-string">&quot;50Mi&quot;</span>
<span class="hljs-attr">          limits:</span>
<span class="hljs-attr">            cpu:</span> <span class="hljs-string">&quot;100m&quot;</span>
<span class="hljs-attr">            memory:</span> <span class="hljs-string">&quot;50Mi&quot;</span>
<span class="hljs-attr">        securityContext:</span>
<span class="hljs-attr">          privileged:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">          capabilities:</span>
<span class="hljs-attr">            add:</span> [<span class="hljs-string">&quot;NET_ADMIN&quot;</span>, <span class="hljs-string">&quot;NET_RAW&quot;</span>]
<span class="hljs-attr">        env:</span>
<span class="hljs-attr">        - name:</span> POD_NAME
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> metadata.name
<span class="hljs-attr">        - name:</span> POD_NAMESPACE
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> metadata.namespace
<span class="hljs-attr">        volumeMounts:</span>
<span class="hljs-attr">        - name:</span> run
<span class="hljs-attr">          mountPath:</span> /run/flannel
<span class="hljs-attr">        - name:</span> flannel-cfg
<span class="hljs-attr">          mountPath:</span> /etc/kube-flannel/
<span class="hljs-attr">      volumes:</span>
<span class="hljs-attr">      - name:</span> run
<span class="hljs-attr">        hostPath:</span>
<span class="hljs-attr">          path:</span> /run/flannel
<span class="hljs-attr">      - name:</span> cni
<span class="hljs-attr">        hostPath:</span>
<span class="hljs-attr">          path:</span> /etc/cni/net.d
<span class="hljs-attr">      - name:</span> flannel-cfg
<span class="hljs-attr">        configMap:</span>
<span class="hljs-attr">          name:</span> kube-flannel-cfg
</code></pre>
<h2 id="28-&#x6D4B;&#x8BD5;kubernetes-&#x96C6;&#x7FA4;">2.8 &#x6D4B;&#x8BD5;kubernetes &#x96C6;&#x7FA4;</h2>
<h3 id="281-&#x90E8;&#x7F72;nginx-&#x6D4B;&#x8BD5;">2.8.1 &#x90E8;&#x7F72;nginx &#x6D4B;&#x8BD5;</h3>
<pre><code class="lang-shell">kubectl create deployment nginx --image=nginx

kubectl expose deployment nginx --port=80 --type=NodePort

kubectl get pod,svc
</code></pre>
<h1 id="3-&#x8D44;&#x6E90;&#x7BA1;&#x7406;">3. &#x8D44;&#x6E90;&#x7BA1;&#x7406;</h1>
<h2 id="31-&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x4ECB;&#x7ECD;">3.1 &#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x4ECB;&#x7ECD;</h2>
<p>&#x5728;kubernetes&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x62BD;&#x8C61;&#x4E3A;&#x8D44;&#x6E90;&#xFF0C;&#x7528;&#x6237;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x64CD;&#x4F5C;&#x8D44;&#x6E90;&#x6765;&#x7BA1;&#x7406;kubernetes&#x3002;</p>
<blockquote>
<p>kubernetes&#x7684;&#x672C;&#x8D28;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;&#x5404;&#x79CD;&#x670D;&#x52A1;&#xFF0C;&#x6240;&#x8C13;&#x7684;&#x90E8;&#x7F72;&#x670D;&#x52A1;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5728;kubernetes&#x96C6;&#x7FA4;&#x4E2D;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x5C06;&#x6307;&#x5B9A;&#x7684;&#x7A0B;&#x5E8F;&#x8DD1;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>
<p>kubernetes&#x7684;&#x6700;&#x5C0F;&#x7BA1;&#x7406;&#x5355;&#x5143;&#x662F;pod&#x800C;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x5C06;&#x5BB9;&#x5668;&#x653E;&#x5728;<code>Pod</code>&#x4E2D;&#xFF0C;&#x800C;kubernetes&#x4E00;&#x822C;&#x4E5F;&#x4E0D;&#x4F1A;&#x76F4;&#x63A5;&#x7BA1;&#x7406;Pod&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;<code>Pod&#x63A7;&#x5236;&#x5668;</code>&#x6765;&#x7BA1;&#x7406;Pod&#x7684;&#x3002;</p>
<p>Pod&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x8981;&#x8003;&#x8651;&#x5982;&#x4F55;&#x8BBF;&#x95EE;Pod&#x4E2D;&#x670D;&#x52A1;&#xFF0C;kubernetes&#x63D0;&#x4F9B;&#x4E86;<code>Service</code>&#x8D44;&#x6E90;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;Pod&#x4E2D;&#x7A0B;&#x5E8F;&#x7684;&#x6570;&#x636E;&#x9700;&#x8981;&#x6301;&#x4E45;&#x5316;&#xFF0C;kubernetes&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x5404;&#x79CD;<code>&#x5B58;&#x50A8;</code>&#x7CFB;&#x7EDF;&#x3002;</p>
</blockquote>
<p><img src="Kubenetes.assets/image-20200406225334627.png" alt="image-20200406225334627"></p>
<blockquote>
<p>&#x5B66;&#x4E60;kubernetes&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x5C31;&#x662F;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x5BF9;&#x96C6;&#x7FA4;&#x4E0A;&#x7684;<code>Pod&#x3001;Pod&#x63A7;&#x5236;&#x5668;&#x3001;Service&#x3001;&#x5B58;&#x50A8;</code>&#x7B49;&#x5404;&#x79CD;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</p>
</blockquote>
<h2 id="32-yaml&#x8BED;&#x8A00;&#x4ECB;&#x7ECD;">3.2 YAML&#x8BED;&#x8A00;&#x4ECB;&#x7ECD;</h2>
<p>YAML&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C; XML&#x3001;JSON &#x7684;&#x6807;&#x8BB0;&#x6027;&#x8BED;&#x8A00;&#x3002;&#x5B83;&#x5F3A;&#x8C03;&#x4EE5;<strong>&#x6570;&#x636E;</strong>&#x4E3A;&#x4E2D;&#x5FC3;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x4EE5;&#x6807;&#x8BC6;&#x8BED;&#x8A00;&#x4E3A;&#x91CD;&#x70B9;&#x3002;&#x56E0;&#x800C;YAML&#x672C;&#x8EAB;&#x7684;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x53F7;&#x79F0;&quot;&#x4E00;&#x79CD;&#x4EBA;&#x6027;&#x5316;&#x7684;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x8BED;&#x8A00;&quot;&#x3002;</p>
<pre><code>&lt;heima&gt;
    &lt;age&gt;15&lt;/age&gt;
    &lt;address&gt;Beijing&lt;/address&gt;
&lt;/heima&gt;
</code></pre><pre><code>heima:
  age: 15
  address: Beijing
</code></pre><p>YAML&#x7684;&#x8BED;&#x6CD5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#xFF1A;</p>
<ul>
<li>&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;</li>
<li>&#x4F7F;&#x7528;&#x7F29;&#x8FDB;&#x8868;&#x793A;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;</li>
<li>&#x7F29;&#x8FDB;&#x4E0D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;tab&#xFF0C;&#x53EA;&#x5141;&#x8BB8;&#x7A7A;&#x683C;( &#x4F4E;&#x7248;&#x672C;&#x9650;&#x5236; )</li>
<li>&#x7F29;&#x8FDB;&#x7684;&#x7A7A;&#x683C;&#x6570;&#x4E0D;&#x91CD;&#x8981;&#xFF0C;&#x53EA;&#x8981;&#x76F8;&#x540C;&#x5C42;&#x7EA7;&#x7684;&#x5143;&#x7D20;&#x5DE6;&#x5BF9;&#x9F50;&#x5373;&#x53EF;</li>
<li>&apos;#&apos;&#x8868;&#x793A;&#x6CE8;&#x91CA;</li>
</ul>
<p>YAML&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF1A;</p>
<ul>
<li>&#x7EAF;&#x91CF;&#xFF1A;&#x5355;&#x4E2A;&#x7684;&#x3001;&#x4E0D;&#x53EF;&#x518D;&#x5206;&#x7684;&#x503C;</li>
<li>&#x5BF9;&#x8C61;&#xFF1A;&#x952E;&#x503C;&#x5BF9;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x53C8;&#x79F0;&#x4E3A;&#x6620;&#x5C04;&#xFF08;mapping&#xFF09;/ &#x54C8;&#x5E0C;&#xFF08;hash&#xFF09; / &#x5B57;&#x5178;&#xFF08;dictionary&#xFF09;</li>
<li>&#x6570;&#x7EC4;&#xFF1A;&#x4E00;&#x7EC4;&#x6309;&#x6B21;&#x5E8F;&#x6392;&#x5217;&#x7684;&#x503C;&#xFF0C;&#x53C8;&#x79F0;&#x4E3A;&#x5E8F;&#x5217;&#xFF08;sequence&#xFF09; / &#x5217;&#x8868;&#xFF08;list&#xFF09;</li>
</ul>
<pre><code># &#x7EAF;&#x91CF;, &#x5C31;&#x662F;&#x6307;&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x503C;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x3001;&#x5E03;&#x5C14;&#x503C;&#x3001;&#x6574;&#x6570;&#x3001;&#x6D6E;&#x70B9;&#x6570;&#x3001;Null&#x3001;&#x65F6;&#x95F4;&#x3001;&#x65E5;&#x671F;
# 1 &#x5E03;&#x5C14;&#x7C7B;&#x578B;
c1: true (&#x6216;&#x8005;True)
# 2 &#x6574;&#x578B;
c2: 234
# 3 &#x6D6E;&#x70B9;&#x578B;
c3: 3.14
# 4 null&#x7C7B;&#x578B; 
c4: ~  # &#x4F7F;&#x7528;~&#x8868;&#x793A;null
# 5 &#x65E5;&#x671F;&#x7C7B;&#x578B;
c5: 2018-02-17    # &#x65E5;&#x671F;&#x5FC5;&#x987B;&#x4F7F;&#x7528;ISO 8601&#x683C;&#x5F0F;&#xFF0C;&#x5373;yyyy-MM-dd
# 6 &#x65F6;&#x95F4;&#x7C7B;&#x578B;
c6: 2018-02-17T15:02:31+08:00  # &#x65F6;&#x95F4;&#x4F7F;&#x7528;ISO 8601&#x683C;&#x5F0F;&#xFF0C;&#x65F6;&#x95F4;&#x548C;&#x65E5;&#x671F;&#x4E4B;&#x95F4;&#x4F7F;&#x7528;T&#x8FDE;&#x63A5;&#xFF0C;&#x6700;&#x540E;&#x4F7F;&#x7528;+&#x4EE3;&#x8868;&#x65F6;&#x533A;
# 7 &#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;
c7: heima     # &#x7B80;&#x5355;&#x5199;&#x6CD5;&#xFF0C;&#x76F4;&#x63A5;&#x5199;&#x503C; , &#x5982;&#x679C;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x95F4;&#x6709;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x53CC;&#x5F15;&#x53F7;&#x6216;&#x8005;&#x5355;&#x5F15;&#x53F7;&#x5305;&#x88F9; 
c8: line1
    line2     # &#x5B57;&#x7B26;&#x4E32;&#x8FC7;&#x591A;&#x7684;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x62C6;&#x6210;&#x591A;&#x884C;&#xFF0C;&#x6BCF;&#x4E00;&#x884C;&#x4F1A;&#x88AB;&#x8F6C;&#x5316;&#x6210;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;
</code></pre><pre><code># &#x5BF9;&#x8C61;
# &#x5F62;&#x5F0F;&#x4E00;(&#x63A8;&#x8350;):
heima:
  age: 15
  address: Beijing
# &#x5F62;&#x5F0F;&#x4E8C;(&#x4E86;&#x89E3;):
heima: {age: 15,address: Beijing}
</code></pre><pre><code># &#x6570;&#x7EC4;
# &#x5F62;&#x5F0F;&#x4E00;(&#x63A8;&#x8350;):
address:
  - &#x987A;&#x4E49;
  - &#x660C;&#x5E73;  
# &#x5F62;&#x5F0F;&#x4E8C;(&#x4E86;&#x89E3;):
address: [&#x987A;&#x4E49;,&#x660C;&#x5E73;]
</code></pre><blockquote>
<p>&#x5C0F;&#x63D0;&#x793A;&#xFF1A;</p>
<p>1 &#x4E66;&#x5199;yaml&#x5207;&#x8BB0;<code>:</code> &#x540E;&#x9762;&#x8981;&#x52A0;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;</p>
<p>2 &#x5982;&#x679C;&#x9700;&#x8981;&#x5C06;&#x591A;&#x6BB5;yaml&#x914D;&#x7F6E;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4E2D;&#x95F4;&#x8981;&#x4F7F;&#x7528;<code>---</code>&#x5206;&#x9694;</p>
<p>3 &#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;yaml&#x8F6C;json&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B83;&#x9A8C;&#x8BC1;yaml&#x662F;&#x5426;&#x4E66;&#x5199;&#x6B63;&#x786E;</p>
<p><a href="https://www.json2yaml.com/convert-yaml-to-json" target="_blank">https://www.json2yaml.com/convert-yaml-to-json</a></p>
</blockquote>
<h2 id="33-&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x65B9;&#x5F0F;">3.3 &#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x65B9;&#x5F0F;</h2>
<ul>
<li><p>&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x7BA1;&#x7406;&#xFF1A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x53BB;&#x64CD;&#x4F5C;kubernetes&#x8D44;&#x6E90;</p>
<p><code>kubectl run nginx-pod --image=nginx:1.17.1 --port=80</code></p>
</li>
<li><p>&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#xFF1A;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x914D;&#x7F6E;&#x548C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53BB;&#x64CD;&#x4F5C;kubernetes&#x8D44;&#x6E90;</p>
<p><code>kubectl create/patch -f nginx-pod.yaml</code></p>
</li>
<li><p>&#x58F0;&#x660E;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#xFF1A;&#x901A;&#x8FC7;apply&#x547D;&#x4EE4;&#x548C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53BB;&#x64CD;&#x4F5C;kubernetes&#x8D44;&#x6E90;</p>
<p><code>kubectl apply -f nginx-pod.yaml</code></p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">&#x7C7B;&#x578B;</th>
<th style="text-align:left">&#x64CD;&#x4F5C;&#x5BF9;&#x8C61;</th>
<th style="text-align:left">&#x9002;&#x7528;&#x73AF;&#x5883;</th>
<th style="text-align:left">&#x4F18;&#x70B9;</th>
<th style="text-align:left">&#x7F3A;&#x70B9;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x7BA1;&#x7406;</td>
<td style="text-align:left">&#x5BF9;&#x8C61;</td>
<td style="text-align:left">&#x6D4B;&#x8BD5;</td>
<td style="text-align:left">&#x7B80;&#x5355;</td>
<td style="text-align:left">&#x53EA;&#x80FD;&#x64CD;&#x4F5C;&#x6D3B;&#x52A8;&#x5BF9;&#x8C61;&#xFF0C;&#x65E0;&#x6CD5;&#x5BA1;&#x8BA1;&#x3001;&#x8DDF;&#x8E2A;</td>
</tr>
<tr>
<td style="text-align:left">&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;</td>
<td style="text-align:left">&#x6587;&#x4EF6;</td>
<td style="text-align:left">&#x5F00;&#x53D1;</td>
<td style="text-align:left">&#x53EF;&#x4EE5;&#x5BA1;&#x8BA1;&#x3001;&#x8DDF;&#x8E2A;</td>
<td style="text-align:left">&#x9879;&#x76EE;&#x5927;&#x65F6;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x591A;&#xFF0C;&#x64CD;&#x4F5C;&#x9EBB;&#x70E6;</td>
</tr>
<tr>
<td style="text-align:left">&#x58F0;&#x660E;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;</td>
<td style="text-align:left">&#x76EE;&#x5F55;</td>
<td style="text-align:left">&#x5F00;&#x53D1;</td>
<td style="text-align:left">&#x652F;&#x6301;&#x76EE;&#x5F55;&#x64CD;&#x4F5C;</td>
<td style="text-align:left">&#x610F;&#x5916;&#x60C5;&#x51B5;&#x4E0B;&#x96BE;&#x4EE5;&#x8C03;&#x8BD5;</td>
</tr>
</tbody>
</table>
<h3 id="331-&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x7BA1;&#x7406;">3.3.1 &#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x7BA1;&#x7406;</h3>
<p><strong>kubectl&#x547D;&#x4EE4;</strong></p>
<p>kubectl&#x662F;kubernetes&#x96C6;&#x7FA4;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x80FD;&#x591F;&#x5BF9;&#x96C6;&#x7FA4;&#x672C;&#x8EAB;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#xFF0C;&#x5E76;&#x80FD;&#x591F;&#x5728;&#x96C6;&#x7FA4;&#x4E0A;&#x8FDB;&#x884C;&#x5BB9;&#x5668;&#x5316;&#x5E94;&#x7528;&#x7684;&#x5B89;&#x88C5;&#x90E8;&#x7F72;&#x3002;kubectl&#x547D;&#x4EE4;&#x7684;&#x8BED;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>kubectl [command] [type] [name] [flags]
</code></pre><p><strong>comand</strong>&#xFF1A;&#x6307;&#x5B9A;&#x8981;&#x5BF9;&#x8D44;&#x6E90;&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;create&#x3001;get&#x3001;delete</p>
<p><strong>type</strong>&#xFF1A;&#x6307;&#x5B9A;&#x8D44;&#x6E90;&#x7C7B;&#x578B;&#xFF0C;&#x6BD4;&#x5982;deployment&#x3001;pod&#x3001;service</p>
<p><strong>name</strong>&#xFF1A;&#x6307;&#x5B9A;&#x8D44;&#x6E90;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x540D;&#x79F0;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;</p>
<p><strong>flags</strong>&#xFF1A;&#x6307;&#x5B9A;&#x989D;&#x5916;&#x7684;&#x53EF;&#x9009;&#x53C2;&#x6570;</p>
<pre><code class="lang-shell"># &#x67E5;&#x770B;&#x6240;&#x6709;pod
kubectl get pod 

# &#x67E5;&#x770B;&#x67D0;&#x4E2A;pod
kubectl get pod pod_name

# &#x67E5;&#x770B;&#x67D0;&#x4E2A;pod,&#x4EE5;yaml&#x683C;&#x5F0F;&#x5C55;&#x793A;&#x7ED3;&#x679C;
kubectl get pod pod_name -o yaml
</code></pre>
<p><strong>&#x8D44;&#x6E90;&#x7C7B;&#x578B;</strong></p>
<p>kubernetes&#x4E2D;&#x6240;&#x6709;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x62BD;&#x8C61;&#x4E3A;&#x8D44;&#x6E90;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x67E5;&#x770B;:</p>
<pre><code>kubectl api-resources
</code></pre><p>&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x8D44;&#x6E90;&#x6709;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:left">&#x8D44;&#x6E90;&#x5206;&#x7C7B;</th>
<th style="text-align:left">&#x8D44;&#x6E90;&#x540D;&#x79F0;</th>
<th style="text-align:left">&#x7F29;&#x5199;</th>
<th style="text-align:left">&#x8D44;&#x6E90;&#x4F5C;&#x7528;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&#x96C6;&#x7FA4;&#x7EA7;&#x522B;&#x8D44;&#x6E90;</td>
<td style="text-align:left">nodes</td>
<td style="text-align:left">no</td>
<td style="text-align:left">&#x96C6;&#x7FA4;&#x7EC4;&#x6210;&#x90E8;&#x5206;</td>
</tr>
<tr>
<td style="text-align:left">namespaces</td>
<td style="text-align:left">ns</td>
<td style="text-align:left">&#x9694;&#x79BB;Pod</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">pod&#x8D44;&#x6E90;</td>
<td style="text-align:left">pods</td>
<td style="text-align:left">po</td>
<td style="text-align:left">&#x88C5;&#x8F7D;&#x5BB9;&#x5668;</td>
</tr>
<tr>
<td style="text-align:left">pod&#x8D44;&#x6E90;&#x63A7;&#x5236;&#x5668;</td>
<td style="text-align:left">replicationcontrollers</td>
<td style="text-align:left">rc</td>
<td style="text-align:left">&#x63A7;&#x5236;pod&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">replicasets</td>
<td style="text-align:left">rs</td>
<td style="text-align:left">&#x63A7;&#x5236;pod&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">deployments</td>
<td style="text-align:left">deploy</td>
<td style="text-align:left">&#x63A7;&#x5236;pod&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">daemonsets</td>
<td style="text-align:left">ds</td>
<td style="text-align:left">&#x63A7;&#x5236;pod&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">jobs</td>
<td style="text-align:left"></td>
<td style="text-align:left">&#x63A7;&#x5236;pod&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">cronjobs</td>
<td style="text-align:left">cj</td>
<td style="text-align:left">&#x63A7;&#x5236;pod&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">horizontalpodautoscalers</td>
<td style="text-align:left">hpa</td>
<td style="text-align:left">&#x63A7;&#x5236;pod&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">statefulsets</td>
<td style="text-align:left">sts</td>
<td style="text-align:left">&#x63A7;&#x5236;pod&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left">&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x8D44;&#x6E90;</td>
<td style="text-align:left">services</td>
<td style="text-align:left">svc</td>
<td style="text-align:left">&#x7EDF;&#x4E00;pod&#x5BF9;&#x5916;&#x63A5;&#x53E3;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">ingress</td>
<td style="text-align:left">ing</td>
<td style="text-align:left">&#x7EDF;&#x4E00;pod&#x5BF9;&#x5916;&#x63A5;&#x53E3;</td>
</tr>
<tr>
<td style="text-align:left">&#x5B58;&#x50A8;&#x8D44;&#x6E90;</td>
<td style="text-align:left">volumeattachments</td>
<td style="text-align:left"></td>
<td style="text-align:left">&#x5B58;&#x50A8;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">persistentvolumes</td>
<td style="text-align:left">pv</td>
<td style="text-align:left">&#x5B58;&#x50A8;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">persistentvolumeclaims</td>
<td style="text-align:left">pvc</td>
<td style="text-align:left">&#x5B58;&#x50A8;</td>
</tr>
<tr>
<td style="text-align:left">&#x914D;&#x7F6E;&#x8D44;&#x6E90;</td>
<td style="text-align:left">configmaps</td>
<td style="text-align:left">cm</td>
<td style="text-align:left">&#x914D;&#x7F6E;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">secrets</td>
<td style="text-align:left"></td>
<td style="text-align:left">&#x914D;&#x7F6E;</td>
</tr>
</tbody>
</table>
<p><strong>&#x64CD;&#x4F5C;</strong></p>
<p>kubernetes&#x5141;&#x8BB8;&#x5BF9;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x591A;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;--help&#x67E5;&#x770B;&#x8BE6;&#x7EC6;&#x7684;&#x64CD;&#x4F5C;&#x547D;&#x4EE4;</p>
<pre><code>kubectl --help
</code></pre><p>&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x64CD;&#x4F5C;&#x6709;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:left">&#x547D;&#x4EE4;&#x5206;&#x7C7B;</th>
<th style="text-align:left">&#x547D;&#x4EE4;</th>
<th style="text-align:left">&#x7FFB;&#x8BD1;</th>
<th style="text-align:left">&#x547D;&#x4EE4;&#x4F5C;&#x7528;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&#x57FA;&#x672C;&#x547D;&#x4EE4;</td>
<td style="text-align:left">create</td>
<td style="text-align:left">&#x521B;&#x5EFA;</td>
<td style="text-align:left">&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">edit</td>
<td style="text-align:left">&#x7F16;&#x8F91;</td>
<td style="text-align:left">&#x7F16;&#x8F91;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">get</td>
<td style="text-align:left">&#x83B7;&#x53D6;</td>
<td style="text-align:left">&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">patch</td>
<td style="text-align:left">&#x66F4;&#x65B0;</td>
<td style="text-align:left">&#x66F4;&#x65B0;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">delete</td>
<td style="text-align:left">&#x5220;&#x9664;</td>
<td style="text-align:left">&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">explain</td>
<td style="text-align:left">&#x89E3;&#x91CA;</td>
<td style="text-align:left">&#x5C55;&#x793A;&#x8D44;&#x6E90;&#x6587;&#x6863;</td>
</tr>
<tr>
<td style="text-align:left">&#x8FD0;&#x884C;&#x548C;&#x8C03;&#x8BD5;</td>
<td style="text-align:left">run</td>
<td style="text-align:left">&#x8FD0;&#x884C;</td>
<td style="text-align:left">&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7684;&#x955C;&#x50CF;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">expose</td>
<td style="text-align:left">&#x66B4;&#x9732;</td>
<td style="text-align:left">&#x66B4;&#x9732;&#x8D44;&#x6E90;&#x4E3A;Service</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">describe</td>
<td style="text-align:left">&#x63CF;&#x8FF0;</td>
<td style="text-align:left">&#x663E;&#x793A;&#x8D44;&#x6E90;&#x5185;&#x90E8;&#x4FE1;&#x606F;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">logs</td>
<td style="text-align:left">&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x5BB9;&#x5668;&#x5728; pod &#x4E2D;&#x7684;&#x65E5;&#x5FD7;</td>
<td style="text-align:left">&#x8F93;&#x51FA;&#x5BB9;&#x5668;&#x5728; pod &#x4E2D;&#x7684;&#x65E5;&#x5FD7;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">attach</td>
<td style="text-align:left">&#x7F20;&#x7ED5;&#x8FDB;&#x5165;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x5BB9;&#x5668;</td>
<td style="text-align:left">&#x8FDB;&#x5165;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x5BB9;&#x5668;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">exec</td>
<td style="text-align:left">&#x6267;&#x884C;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;</td>
<td style="text-align:left">&#x6267;&#x884C;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">cp</td>
<td style="text-align:left">&#x590D;&#x5236;</td>
<td style="text-align:left">&#x5728;Pod&#x5185;&#x5916;&#x590D;&#x5236;&#x6587;&#x4EF6;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">rollout</td>
<td style="text-align:left">&#x9996;&#x6B21;&#x5C55;&#x793A;</td>
<td style="text-align:left">&#x7BA1;&#x7406;&#x8D44;&#x6E90;&#x7684;&#x53D1;&#x5E03;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">scale</td>
<td style="text-align:left">&#x89C4;&#x6A21;</td>
<td style="text-align:left">&#x6269;(&#x7F29;)&#x5BB9;Pod&#x7684;&#x6570;&#x91CF;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">autoscale</td>
<td style="text-align:left">&#x81EA;&#x52A8;&#x8C03;&#x6574;</td>
<td style="text-align:left">&#x81EA;&#x52A8;&#x8C03;&#x6574;Pod&#x7684;&#x6570;&#x91CF;</td>
</tr>
<tr>
<td style="text-align:left">&#x9AD8;&#x7EA7;&#x547D;&#x4EE4;</td>
<td style="text-align:left">apply</td>
<td style="text-align:left">rc</td>
<td style="text-align:left">&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x5BF9;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x914D;&#x7F6E;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">label</td>
<td style="text-align:left">&#x6807;&#x7B7E;</td>
<td style="text-align:left">&#x66F4;&#x65B0;&#x8D44;&#x6E90;&#x4E0A;&#x7684;&#x6807;&#x7B7E;</td>
</tr>
<tr>
<td style="text-align:left">&#x5176;&#x4ED6;&#x547D;&#x4EE4;</td>
<td style="text-align:left">cluster-info</td>
<td style="text-align:left">&#x96C6;&#x7FA4;&#x4FE1;&#x606F;</td>
<td style="text-align:left">&#x663E;&#x793A;&#x96C6;&#x7FA4;&#x4FE1;&#x606F;</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">version</td>
<td style="text-align:left">&#x7248;&#x672C;</td>
<td style="text-align:left">&#x663E;&#x793A;&#x5F53;&#x524D;Server&#x548C;Client&#x7684;&#x7248;&#x672C;</td>
</tr>
</tbody>
</table>
<p>&#x4E0B;&#x9762;&#x4EE5;&#x4E00;&#x4E2A;namespace / pod&#x7684;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664;&#x7B80;&#x5355;&#x6F14;&#x793A;&#x4E0B;&#x547D;&#x4EE4;&#x7684;&#x4F7F;&#x7528;&#xFF1A;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;&#x4E00;&#x4E2A;namespace
[root@master ~]# kubectl create namespace dev
namespace/dev created

# &#x83B7;&#x53D6;namespace
[root@master ~]# kubectl get ns
NAME              STATUS   AGE
default           Active   21h
dev               Active   21s
kube-node-lease   Active   21h
kube-public       Active   21h
kube-system       Active   21h

# &#x5728;&#x6B64;namespace&#x4E0B;&#x521B;&#x5EFA;&#x5E76;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;nginx&#x7684;Pod
[root@master ~]# kubectl run pod --image=nginx:latest -n dev
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/pod created

# &#x67E5;&#x770B;&#x65B0;&#x521B;&#x5EFA;&#x7684;pod
[root@master ~]# kubectl get pod -n dev
NAME  READY   STATUS    RESTARTS   AGE
pod   1/1     Running   0          21s

# &#x5220;&#x9664;&#x6307;&#x5B9A;&#x7684;pod
[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x
pod &quot;pod&quot; deleted

# &#x5220;&#x9664;&#x6307;&#x5B9A;&#x7684;namespace
[root@master ~]# kubectl delete ns dev
namespace &quot;dev&quot; deleted
</code></pre>
<h3 id="332-&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;">3.3.2 &#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;</h3>
<p>&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x914D;&#x5408;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E00;&#x8D77;&#x6765;&#x64CD;&#x4F5C;kubernetes&#x8D44;&#x6E90;&#x3002;</p>
<p>1&#xFF09; &#x521B;&#x5EFA;&#x4E00;&#x4E2A;nginxpod.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Namespace
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> dev

<span class="hljs-meta">---</span>

<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginxpod
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx-containers
<span class="hljs-attr">    image:</span> nginx:latest
</code></pre>
<p>2&#xFF09;&#x6267;&#x884C;create&#x547D;&#x4EE4;&#xFF0C;&#x521B;&#x5EFA;&#x8D44;&#x6E90;&#xFF1A;</p>
<pre><code class="lang-yaml">[root@master ~]<span class="hljs-comment"># kubectl create -f nginxpod.yaml</span>
namespace/dev created
pod/nginxpod created
</code></pre>
<p>&#x6B64;&#x65F6;&#x53D1;&#x73B0;&#x521B;&#x5EFA;&#x4E86;&#x4E24;&#x4E2A;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#xFF0C;&#x5206;&#x522B;&#x662F;namespace&#x548C;pod</p>
<p>3&#xFF09;&#x6267;&#x884C;get&#x547D;&#x4EE4;&#xFF0C;&#x67E5;&#x770B;&#x8D44;&#x6E90;&#xFF1A;</p>
<pre><code class="lang-shell">[root@master ~]#  kubectl get -f nginxpod.yaml
NAME            STATUS   AGE
namespace/dev   Active   18s

NAME            READY   STATUS    RESTARTS   AGE
pod/nginxpod    1/1     Running   0          17s
</code></pre>
<p>&#x8FD9;&#x6837;&#x5C31;&#x663E;&#x793A;&#x4E86;&#x4E24;&#x4E2A;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x7684;&#x4FE1;&#x606F;</p>
<p>4&#xFF09;&#x6267;&#x884C;delete&#x547D;&#x4EE4;&#xFF0C;&#x5220;&#x9664;&#x8D44;&#x6E90;&#xFF1A;</p>
<pre><code class="lang-shell">[root@master ~]# kubectl delete -f nginxpod.yaml
namespace &quot;dev&quot; deleted
pod &quot;nginxpod&quot; deleted
</code></pre>
<p>&#x6B64;&#x65F6;&#x53D1;&#x73B0;&#x4E24;&#x4E2A;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x88AB;&#x5220;&#x9664;&#x4E86;</p>
<pre><code>&#x603B;&#x7ED3;:
    &#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x5F0F;&#x64CD;&#x4F5C;&#x8D44;&#x6E90;&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x8BA4;&#x4E3A;&#xFF1A;&#x547D;&#x4EE4;  +  yaml&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;&#x91CC;&#x9762;&#x662F;&#x547D;&#x4EE4;&#x9700;&#x8981;&#x7684;&#x5404;&#x79CD;&#x53C2;&#x6570;&#xFF09;
</code></pre><h3 id="333-&#x58F0;&#x660E;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;">3.3.3 &#x58F0;&#x660E;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;</h3>
<p>&#x58F0;&#x660E;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#x8DDF;&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#x5F88;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;apply&#x3002;</p>
<pre><code class="lang-shell"># &#x9996;&#x5148;&#x6267;&#x884C;&#x4E00;&#x6B21;kubectl apply -f yaml&#x6587;&#x4EF6;&#xFF0C;&#x53D1;&#x73B0;&#x521B;&#x5EFA;&#x4E86;&#x8D44;&#x6E90;
[root@master ~]#  kubectl apply -f nginxpod.yaml
namespace/dev created
pod/nginxpod created

# &#x518D;&#x6B21;&#x6267;&#x884C;&#x4E00;&#x6B21;kubectl apply -f yaml&#x6587;&#x4EF6;&#xFF0C;&#x53D1;&#x73B0;&#x8BF4;&#x8D44;&#x6E90;&#x6CA1;&#x6709;&#x53D8;&#x52A8;
[root@master ~]#  kubectl apply -f nginxpod.yaml
namespace/dev unchanged
pod/nginxpod unchanged
</code></pre>
<pre><code>&#x603B;&#x7ED3;:
    &#x5176;&#x5B9E;&#x58F0;&#x660E;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#x5C31;&#x662F;&#x4F7F;&#x7528;apply&#x63CF;&#x8FF0;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x6700;&#x7EC8;&#x7684;&#x72B6;&#x6001;&#xFF08;&#x5728;yaml&#x4E2D;&#x5B9A;&#x4E49;&#x72B6;&#x6001;&#xFF09;
    &#x4F7F;&#x7528;apply&#x64CD;&#x4F5C;&#x8D44;&#x6E90;&#xFF1A;
        &#x5982;&#x679C;&#x8D44;&#x6E90;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5C31;&#x521B;&#x5EFA;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E; kubectl create
        &#x5982;&#x679C;&#x8D44;&#x6E90;&#x5DF2;&#x5B58;&#x5728;&#xFF0C;&#x5C31;&#x66F4;&#x65B0;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E; kubectl patch
</code></pre><blockquote>
<p>&#x6269;&#x5C55;&#xFF1A;kubectl&#x53EF;&#x4EE5;&#x5728;node&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x5417; ?</p>
</blockquote>
<p>kubectl&#x7684;&#x8FD0;&#x884C;&#x662F;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x7684;&#xFF0C;&#x5B83;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x662F;$HOME/.kube&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x5728;node&#x8282;&#x70B9;&#x8FD0;&#x884C;&#x6B64;&#x547D;&#x4EE4;&#xFF0C;&#x9700;&#x8981;&#x5C06;master&#x4E0A;&#x7684;.kube&#x6587;&#x4EF6;&#x590D;&#x5236;&#x5230;node&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x5373;&#x5728;master&#x8282;&#x70B9;&#x4E0A;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x64CD;&#x4F5C;&#xFF1A;</p>
<pre><code class="lang-shell">scp  -r  HOME/.kube   node1: HOME/
</code></pre>
<blockquote>
<p>&#x4F7F;&#x7528;&#x63A8;&#x8350;: &#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x7528; ?</p>
</blockquote>
<p>&#x521B;&#x5EFA;/&#x66F4;&#x65B0;&#x8D44;&#x6E90; &#x4F7F;&#x7528;&#x58F0;&#x660E;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E; kubectl apply -f XXX.yaml</p>
<p>&#x5220;&#x9664;&#x8D44;&#x6E90; &#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x914D;&#x7F6E; kubectl delete -f XXX.yaml</p>
<p>&#x67E5;&#x8BE2;&#x8D44;&#x6E90; &#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x5F0F;&#x5BF9;&#x8C61;&#x7BA1;&#x7406; kubectl get(describe) &#x8D44;&#x6E90;&#x540D;&#x79F0;</p>
<h1 id="4-&#x5B9E;&#x6218;&#x5165;&#x95E8;">4. &#x5B9E;&#x6218;&#x5165;&#x95E8;</h1>
<p>&#x672C;&#x7AE0;&#x8282;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x5728;kubernetes&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;&#x4E00;&#x4E2A;nginx&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x80FD;&#x591F;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#x3002;</p>
<h2 id="41-namespace">4.1 Namespace</h2>
<p>Namespace&#x662F;kubernetes&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x8D44;&#x6E90;&#xFF0C;&#x5B83;&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x7528;&#x6765;&#x5B9E;&#x73B0;<strong>&#x591A;&#x5957;&#x73AF;&#x5883;&#x7684;&#x8D44;&#x6E90;&#x9694;&#x79BB;</strong>&#x6216;&#x8005;<strong>&#x591A;&#x79DF;&#x6237;&#x7684;&#x8D44;&#x6E90;&#x9694;&#x79BB;</strong>&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;kubernetes&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x7684;Pod&#x90FD;&#x662F;&#x53EF;&#x4EE5;&#x76F8;&#x4E92;&#x8BBF;&#x95EE;&#x7684;&#x3002;&#x4F46;&#x662F;&#x5728;&#x5B9E;&#x9645;&#x4E2D;&#xFF0C;&#x53EF;&#x80FD;&#x4E0D;&#x60F3;&#x8BA9;&#x4E24;&#x4E2A;Pod&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x4E92;&#x76F8;&#x7684;&#x8BBF;&#x95EE;&#xFF0C;&#x90A3;&#x6B64;&#x65F6;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x4E24;&#x4E2A;Pod&#x5212;&#x5206;&#x5230;&#x4E0D;&#x540C;&#x7684;namespace&#x4E0B;&#x3002;kubernetes&#x901A;&#x8FC7;&#x5C06;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x7684;&#x8D44;&#x6E90;&#x5206;&#x914D;&#x5230;&#x4E0D;&#x540C;&#x7684;Namespace&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5F62;&#x6210;&#x903B;&#x8F91;&#x4E0A;&#x7684;&quot;&#x7EC4;&quot;&#xFF0C;&#x4EE5;&#x65B9;&#x4FBF;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x7684;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x9694;&#x79BB;&#x4F7F;&#x7528;&#x548C;&#x7BA1;&#x7406;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;kubernetes&#x7684;&#x6388;&#x6743;&#x673A;&#x5236;&#xFF0C;&#x5C06;&#x4E0D;&#x540C;&#x7684;namespace&#x4EA4;&#x7ED9;&#x4E0D;&#x540C;&#x79DF;&#x6237;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x591A;&#x79DF;&#x6237;&#x7684;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#x3002;&#x6B64;&#x65F6;&#x8FD8;&#x80FD;&#x7ED3;&#x5408;kubernetes&#x7684;&#x8D44;&#x6E90;&#x914D;&#x989D;&#x673A;&#x5236;&#xFF0C;&#x9650;&#x5B9A;&#x4E0D;&#x540C;&#x79DF;&#x6237;&#x80FD;&#x5360;&#x7528;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x4F8B;&#x5982;CPU&#x4F7F;&#x7528;&#x91CF;&#x3001;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x91CF;&#x7B49;&#x7B49;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x79DF;&#x6237;&#x53EF;&#x7528;&#x8D44;&#x6E90;&#x7684;&#x7BA1;&#x7406;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200407100850484.png" alt="image-20200407100850484"></p>
<p>kubernetes&#x5728;&#x96C6;&#x7FA4;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x9ED8;&#x8BA4;&#x521B;&#x5EFA;&#x51E0;&#x4E2A;namespace</p>
<pre><code class="lang-shell">[root@master ~]# kubectl  get namespace
NAME              STATUS   AGE
default           Active   45h     #  &#x6240;&#x6709;&#x672A;&#x6307;&#x5B9A;Namespace&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x5728;default&#x547D;&#x540D;&#x7A7A;&#x95F4;
kube-node-lease   Active   45h     #  &#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x4E4B;&#x95F4;&#x7684;&#x5FC3;&#x8DF3;&#x7EF4;&#x62A4;&#xFF0C;v1.13&#x5F00;&#x59CB;&#x5F15;&#x5165;
kube-public       Active   45h     #  &#x6B64;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E0B;&#x7684;&#x8D44;&#x6E90;&#x53EF;&#x4EE5;&#x88AB;&#x6240;&#x6709;&#x4EBA;&#x8BBF;&#x95EE;&#xFF08;&#x5305;&#x62EC;&#x672A;&#x8BA4;&#x8BC1;&#x7528;&#x6237;&#xFF09;
kube-system       Active   45h     #  &#x6240;&#x6709;&#x7531;Kubernetes&#x7CFB;&#x7EDF;&#x521B;&#x5EFA;&#x7684;&#x8D44;&#x6E90;&#x90FD;&#x5904;&#x4E8E;&#x8FD9;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;
</code></pre>
<p>&#x4E0B;&#x9762;&#x6765;&#x770B;namespace&#x8D44;&#x6E90;&#x7684;&#x5177;&#x4F53;&#x64CD;&#x4F5C;&#xFF1A;</p>
<p><strong>&#x67E5;&#x770B;</strong></p>
<pre><code class="lang-shell"># 1 &#x67E5;&#x770B;&#x6240;&#x6709;&#x7684;ns  &#x547D;&#x4EE4;&#xFF1A;kubectl get ns
[root@master ~]# kubectl get ns
NAME              STATUS   AGE
default           Active   45h
kube-node-lease   Active   45h
kube-public       Active   45h     
kube-system       Active   45h     

# 2 &#x67E5;&#x770B;&#x6307;&#x5B9A;&#x7684;ns   &#x547D;&#x4EE4;&#xFF1A;kubectl get ns ns&#x540D;&#x79F0;
[root@master ~]# kubectl get ns default
NAME      STATUS   AGE
default   Active   45h

# 3 &#x6307;&#x5B9A;&#x8F93;&#x51FA;&#x683C;&#x5F0F;  &#x547D;&#x4EE4;&#xFF1A;kubectl get ns ns&#x540D;&#x79F0;  -o &#x683C;&#x5F0F;&#x53C2;&#x6570;
# kubernetes&#x652F;&#x6301;&#x7684;&#x683C;&#x5F0F;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x7684;&#x662F;wide&#x3001;json&#x3001;yaml
[root@master ~]# kubectl get ns default -o yaml
apiVersion: v1
kind: Namespace
metadata:
  creationTimestamp: &quot;2021-05-08T04:44:16Z&quot;
  name: default
  resourceVersion: &quot;151&quot;
  selfLink: /api/v1/namespaces/default
  uid: 7405f73a-e486-43d4-9db6-145f1409f090
spec:
  finalizers:
  - kubernetes
status:
  phase: Active

# 4 &#x67E5;&#x770B;ns&#x8BE6;&#x60C5;  &#x547D;&#x4EE4;&#xFF1A;kubectl describe ns ns&#x540D;&#x79F0;
[root@master ~]# kubectl describe ns default
Name:         default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active  # Active &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x4E2D;  Terminating &#x6B63;&#x5728;&#x5220;&#x9664;&#x547D;&#x540D;&#x7A7A;&#x95F4;

# ResourceQuota &#x9488;&#x5BF9;namespace&#x505A;&#x7684;&#x8D44;&#x6E90;&#x9650;&#x5236;
# LimitRange&#x9488;&#x5BF9;namespace&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x7EC4;&#x4EF6;&#x505A;&#x7684;&#x8D44;&#x6E90;&#x9650;&#x5236;
No resource quota.
No LimitRange resource.
</code></pre>
<p><strong>&#x521B;&#x5EFA;</strong></p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;namespace
[root@master ~]# kubectl create ns dev
namespace/dev created
</code></pre>
<p><strong>&#x5220;&#x9664;</strong></p>
<pre><code class="lang-shell"># &#x5220;&#x9664;namespace
[root@master ~]# kubectl delete ns dev
namespace &quot;dev&quot; deleted
</code></pre>
<p><strong>&#x914D;&#x7F6E;&#x65B9;&#x5F0F;</strong></p>
<p>&#x9996;&#x5148;&#x51C6;&#x5907;&#x4E00;&#x4E2A;yaml&#x6587;&#x4EF6;&#xFF1A;ns-dev.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Namespace
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> dev
</code></pre>
<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664;&#x547D;&#x4EE4;&#x4E86;&#xFF1A;</p>
<p>&#x521B;&#x5EFA;&#xFF1A;kubectl create -f ns-dev.yaml</p>
<p>&#x5220;&#x9664;&#xFF1A;kubectl delete -f ns-dev.yaml</p>
<h2 id="42-pod">4.2 Pod</h2>
<p>Pod&#x662F;kubernetes&#x96C6;&#x7FA4;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x7684;&#x6700;&#x5C0F;&#x5355;&#x5143;&#xFF0C;&#x7A0B;&#x5E8F;&#x8981;&#x8FD0;&#x884C;&#x5FC5;&#x987B;&#x90E8;&#x7F72;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x800C;&#x5BB9;&#x5668;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x4E8E;Pod&#x4E2D;&#x3002;</p>
<p>Pod&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x5BB9;&#x5668;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x4E00;&#x4E2A;Pod&#x4E2D;&#x53EF;&#x4EE5;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200407121501907.png" alt="image-20200407121501907"></p>
<p>kubernetes&#x5728;&#x96C6;&#x7FA4;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#xFF0C;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x4E5F;&#x90FD;&#x662F;&#x4EE5;Pod&#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#x7684;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#xFF1A;</p>
<pre><code class="lang-shell">[root@master ~]# kubectl get pod -n kube-system
NAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE
kube-system   coredns-6955765f44-68g6v         1/1     Running   0          2d1h
kube-system   coredns-6955765f44-cs5r8         1/1     Running   0          2d1h
kube-system   etcd-master                      1/1     Running   0          2d1h
kube-system   kube-apiserver-master            1/1     Running   0          2d1h
kube-system   kube-controller-manager-master   1/1     Running   0          2d1h
kube-system   kube-flannel-ds-amd64-47r25      1/1     Running   0          2d1h
kube-system   kube-flannel-ds-amd64-ls5lh      1/1     Running   0          2d1h
kube-system   kube-proxy-685tk                 1/1     Running   0          2d1h
kube-system   kube-proxy-87spt                 1/1     Running   0          2d1h
kube-system   kube-scheduler-master            1/1     Running   0          2d1h
</code></pre>
<p><strong>&#x521B;&#x5EFA;&#x5E76;&#x8FD0;&#x884C;</strong></p>
<p>kubernetes&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x5355;&#x72EC;&#x8FD0;&#x884C;Pod&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;Pod&#x63A7;&#x5236;&#x5668;&#x6765;&#x5B9E;&#x73B0;&#x7684;</p>
<pre><code class="lang-shell"># &#x547D;&#x4EE4;&#x683C;&#x5F0F;&#xFF1A; kubectl run (pod&#x63A7;&#x5236;&#x5668;&#x540D;&#x79F0;) [&#x53C2;&#x6570;] 
# --image  &#x6307;&#x5B9A;Pod&#x7684;&#x955C;&#x50CF;
# --port   &#x6307;&#x5B9A;&#x7AEF;&#x53E3;
# --namespace  &#x6307;&#x5B9A;namespace
[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev 
deployment.apps/nginx created
</code></pre>
<p><strong>&#x67E5;&#x770B;pod&#x4FE1;&#x606F;</strong></p>
<pre><code class="lang-shell"># &#x67E5;&#x770B;Pod&#x57FA;&#x672C;&#x4FE1;&#x606F;
[root@master ~]# kubectl get pods -n dev
NAME    READY   STATUS    RESTARTS   AGE
nginx   1/1     Running   0          43s

# &#x67E5;&#x770B;Pod&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;
[root@master ~]# kubectl describe pod nginx -n dev
Name:         nginx
Namespace:    dev
Priority:     0
Node:         node1/192.168.5.4
Start Time:   Wed, 08 May 2021 09:29:24 +0800
Labels:       pod-template-hash=5ff7956ff6
              run=nginx
Annotations:  &lt;none&gt;
Status:       Running
IP:           10.244.1.23
IPs:
  IP:           10.244.1.23
Controlled By:  ReplicaSet/nginx
Containers:
  nginx:
    Container ID:   docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c
    Image:          nginx:latest
    Image ID:       docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Wed, 08 May 2021 09:30:01 +0800
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-hwvvw:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-hwvvw
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type    Reason     Age        From               Message
  ----    ------     ----       ----               -------
  Normal  Scheduled  &lt;unknown&gt;  default-scheduler  Successfully assigned dev/nginx-5ff7956ff6-fg2db to node1
  Normal  Pulling    4m11s      kubelet, node1     Pulling image &quot;nginx:latest&quot;
  Normal  Pulled     3m36s      kubelet, node1     Successfully pulled image &quot;nginx:latest&quot;
  Normal  Created    3m36s      kubelet, node1     Created container nginx
  Normal  Started    3m36s      kubelet, node1     Started container nginx
</code></pre>
<p><strong>&#x8BBF;&#x95EE;Pod</strong></p>
<pre><code class="lang-shell"># &#x83B7;&#x53D6;podIP
[root@master ~]# kubectl get pods -n dev -o wide
NAME    READY   STATUS    RESTARTS   AGE    IP             NODE    ... 
nginx   1/1     Running   0          190s   10.244.1.23   node1   ...

#&#x8BBF;&#x95EE;POD
[root@master ~]# curl http://10.244.1.23:80
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><strong>&#x5220;&#x9664;&#x6307;&#x5B9A;Pod</strong></p>
<pre><code class="lang-shell"># &#x5220;&#x9664;&#x6307;&#x5B9A;Pod
[root@master ~]# kubectl delete pod nginx -n dev
pod &quot;nginx&quot; deleted

# &#x6B64;&#x65F6;&#xFF0C;&#x663E;&#x793A;&#x5220;&#x9664;Pod&#x6210;&#x529F;&#xFF0C;&#x4F46;&#x662F;&#x518D;&#x67E5;&#x8BE2;&#xFF0C;&#x53D1;&#x73B0;&#x53C8;&#x65B0;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A; 
[root@master ~]# kubectl get pods -n dev
NAME    READY   STATUS    RESTARTS   AGE
nginx   1/1     Running   0          21s

# &#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x5F53;&#x524D;Pod&#x662F;&#x7531;Pod&#x63A7;&#x5236;&#x5668;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x63A7;&#x5236;&#x5668;&#x4F1A;&#x76D1;&#x63A7;Pod&#x72B6;&#x51B5;&#xFF0C;&#x4E00;&#x65E6;&#x53D1;&#x73B0;Pod&#x6B7B;&#x4EA1;&#xFF0C;&#x4F1A;&#x7ACB;&#x5373;&#x91CD;&#x5EFA;
# &#x6B64;&#x65F6;&#x8981;&#x60F3;&#x5220;&#x9664;Pod&#xFF0C;&#x5FC5;&#x987B;&#x5220;&#x9664;Pod&#x63A7;&#x5236;&#x5668;

# &#x5148;&#x6765;&#x67E5;&#x8BE2;&#x4E00;&#x4E0B;&#x5F53;&#x524D;namespace&#x4E0B;&#x7684;Pod&#x63A7;&#x5236;&#x5668;
[root@master ~]# kubectl get deploy -n  dev
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   1/1     1            1           9m7s

# &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5220;&#x9664;&#x6B64;PodPod&#x63A7;&#x5236;&#x5668;
[root@master ~]# kubectl delete deploy nginx -n dev
deployment.apps &quot;nginx&quot; deleted

# &#x7A0D;&#x7B49;&#x7247;&#x523B;&#xFF0C;&#x518D;&#x67E5;&#x8BE2;Pod&#xFF0C;&#x53D1;&#x73B0;Pod&#x88AB;&#x5220;&#x9664;&#x4E86;
[root@master ~]# kubectl get pods -n dev
No resources found in dev namespace.
</code></pre>
<p><strong>&#x914D;&#x7F6E;&#x64CD;&#x4F5C;</strong></p>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;pod-nginx.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> nginx:latest
<span class="hljs-attr">    name:</span> pod
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">      protocol:</span> TCP
</code></pre>
<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664;&#x547D;&#x4EE4;&#x4E86;&#xFF1A;</p>
<p>&#x521B;&#x5EFA;&#xFF1A;kubectl create -f pod-nginx.yaml</p>
<p>&#x5220;&#x9664;&#xFF1A;kubectl delete -f pod-nginx.yaml</p>
<h2 id="43-label">4.3 Label</h2>
<p>Label&#x662F;kubernetes&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x6982;&#x5FF5;&#x3002;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5728;&#x8D44;&#x6E90;&#x4E0A;&#x6DFB;&#x52A0;&#x6807;&#x8BC6;&#xFF0C;&#x7528;&#x6765;&#x5BF9;&#x5B83;&#x4EEC;&#x8FDB;&#x884C;&#x533A;&#x5206;&#x548C;&#x9009;&#x62E9;&#x3002;</p>
<p>Label&#x7684;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x4E2A;Label&#x4F1A;&#x4EE5;key/value&#x952E;&#x503C;&#x5BF9;&#x7684;&#x5F62;&#x5F0F;&#x9644;&#x52A0;&#x5230;&#x5404;&#x79CD;&#x5BF9;&#x8C61;&#x4E0A;&#xFF0C;&#x5982;Node&#x3001;Pod&#x3001;Service&#x7B49;&#x7B49;</li>
<li>&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4EFB;&#x610F;&#x6570;&#x91CF;&#x7684;Label &#xFF0C;&#x540C;&#x4E00;&#x4E2A;Label&#x4E5F;&#x53EF;&#x4EE5;&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x4EFB;&#x610F;&#x6570;&#x91CF;&#x7684;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x4E0A;&#x53BB;</li>
<li>Label&#x901A;&#x5E38;&#x5728;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x5B9A;&#x4E49;&#x65F6;&#x786E;&#x5B9A;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x5BF9;&#x8C61;&#x521B;&#x5EFA;&#x540E;&#x52A8;&#x6001;&#x6DFB;&#x52A0;&#x6216;&#x8005;&#x5220;&#x9664;</li>
</ul>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Label&#x5B9E;&#x73B0;&#x8D44;&#x6E90;&#x7684;&#x591A;&#x7EF4;&#x5EA6;&#x5206;&#x7EC4;&#xFF0C;&#x4EE5;&#x4FBF;&#x7075;&#x6D3B;&#x3001;&#x65B9;&#x4FBF;&#x5730;&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x5206;&#x914D;&#x3001;&#x8C03;&#x5EA6;&#x3001;&#x914D;&#x7F6E;&#x3001;&#x90E8;&#x7F72;&#x7B49;&#x7BA1;&#x7406;&#x5DE5;&#x4F5C;&#x3002;</p>
<blockquote>
<p>&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;Label &#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x7248;&#x672C;&#x6807;&#x7B7E;&#xFF1A;&quot;version&quot;:&quot;release&quot;, &quot;version&quot;:&quot;stable&quot;......</li>
<li>&#x73AF;&#x5883;&#x6807;&#x7B7E;&#xFF1A;&quot;environment&quot;:&quot;dev&quot;&#xFF0C;&quot;environment&quot;:&quot;test&quot;&#xFF0C;&quot;environment&quot;:&quot;pro&quot;</li>
<li>&#x67B6;&#x6784;&#x6807;&#x7B7E;&#xFF1A;&quot;tier&quot;:&quot;frontend&quot;&#xFF0C;&quot;tier&quot;:&quot;backend&quot;</li>
</ul>
</blockquote>
<p>&#x6807;&#x7B7E;&#x5B9A;&#x4E49;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x8FD8;&#x8981;&#x8003;&#x8651;&#x5230;&#x6807;&#x7B7E;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x8FD9;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#x5230;Label Selector&#xFF0C;&#x5373;&#xFF1A;</p>
<p>Label&#x7528;&#x4E8E;&#x7ED9;&#x67D0;&#x4E2A;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x5B9A;&#x4E49;&#x6807;&#x8BC6;</p>
<p>Label Selector&#x7528;&#x4E8E;&#x67E5;&#x8BE2;&#x548C;&#x7B5B;&#x9009;&#x62E5;&#x6709;&#x67D0;&#x4E9B;&#x6807;&#x7B7E;&#x7684;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;</p>
<p>&#x5F53;&#x524D;&#x6709;&#x4E24;&#x79CD;Label Selector&#xFF1A;</p>
<ul>
<li><p>&#x57FA;&#x4E8E;&#x7B49;&#x5F0F;&#x7684;Label Selector</p>
<p>name = slave: &#x9009;&#x62E9;&#x6240;&#x6709;&#x5305;&#x542B;Label&#x4E2D;key=&quot;name&quot;&#x4E14;value=&quot;slave&quot;&#x7684;&#x5BF9;&#x8C61;</p>
<p>env != production: &#x9009;&#x62E9;&#x6240;&#x6709;&#x5305;&#x62EC;Label&#x4E2D;&#x7684;key=&quot;env&quot;&#x4E14;value&#x4E0D;&#x7B49;&#x4E8E;&quot;production&quot;&#x7684;&#x5BF9;&#x8C61;</p>
</li>
<li><p>&#x57FA;&#x4E8E;&#x96C6;&#x5408;&#x7684;Label Selector</p>
<p>name in (master, slave): &#x9009;&#x62E9;&#x6240;&#x6709;&#x5305;&#x542B;Label&#x4E2D;&#x7684;key=&quot;name&quot;&#x4E14;value=&quot;master&quot;&#x6216;&quot;slave&quot;&#x7684;&#x5BF9;&#x8C61;</p>
<p>name not in (frontend): &#x9009;&#x62E9;&#x6240;&#x6709;&#x5305;&#x542B;Label&#x4E2D;&#x7684;key=&quot;name&quot;&#x4E14;value&#x4E0D;&#x7B49;&#x4E8E;&quot;frontend&quot;&#x7684;&#x5BF9;&#x8C61;</p>
</li>
</ul>
<p>&#x6807;&#x7B7E;&#x7684;&#x9009;&#x62E9;&#x6761;&#x4EF6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#xFF0C;&#x6B64;&#x65F6;&#x5C06;&#x591A;&#x4E2A;Label Selector&#x8FDB;&#x884C;&#x7EC4;&#x5408;&#xFF0C;&#x4F7F;&#x7528;&#x9017;&#x53F7;&quot;,&quot;&#x8FDB;&#x884C;&#x5206;&#x9694;&#x5373;&#x53EF;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<p>name=slave&#xFF0C;env!=production</p>
<p>name not in (frontend)&#xFF0C;env!=production</p>
<p><strong>&#x547D;&#x4EE4;&#x65B9;&#x5F0F;</strong></p>
<pre><code class="lang-shell"># &#x4E3A;pod&#x8D44;&#x6E90;&#x6253;&#x6807;&#x7B7E;
[root@master ~]# kubectl label pod nginx-pod version=1.0 -n dev
pod/nginx-pod labeled

# &#x4E3A;pod&#x8D44;&#x6E90;&#x66F4;&#x65B0;&#x6807;&#x7B7E;
[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite
pod/nginx-pod labeled

# &#x67E5;&#x770B;&#x6807;&#x7B7E;
[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels
NAME        READY   STATUS    RESTARTS   AGE   LABELS
nginx-pod   1/1     Running   0          10m   version=2.0

# &#x7B5B;&#x9009;&#x6807;&#x7B7E;
[root@master ~]# kubectl get pod -n dev -l version=2.0  --show-labels
NAME        READY   STATUS    RESTARTS   AGE   LABELS
nginx-pod   1/1     Running   0          17m   version=2.0
[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labels
No resources found in dev namespace.

#&#x5220;&#x9664;&#x6807;&#x7B7E;
[root@master ~]# kubectl label pod nginx-pod version- -n dev
pod/nginx-pod labeled
</code></pre>
<p><strong>&#x914D;&#x7F6E;&#x65B9;&#x5F0F;</strong></p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    version:</span> <span class="hljs-string">&quot;3.0&quot;</span> 
<span class="hljs-attr">    env:</span> <span class="hljs-string">&quot;test&quot;</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> nginx:latest
<span class="hljs-attr">    name:</span> pod
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">      protocol:</span> TCP
</code></pre>
<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x66F4;&#x65B0;&#x547D;&#x4EE4;&#x4E86;&#xFF1A;kubectl apply -f pod-nginx.yaml</p>
<h2 id="44-deployment">4.4 Deployment</h2>
<p>&#x5728;kubernetes&#x4E2D;&#xFF0C;Pod&#x662F;&#x6700;&#x5C0F;&#x7684;&#x63A7;&#x5236;&#x5355;&#x5143;&#xFF0C;&#x4F46;&#x662F;kubernetes&#x5F88;&#x5C11;&#x76F4;&#x63A5;&#x63A7;&#x5236;Pod&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x901A;&#x8FC7;Pod&#x63A7;&#x5236;&#x5668;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002;Pod&#x63A7;&#x5236;&#x5668;&#x7528;&#x4E8E;pod&#x7684;&#x7BA1;&#x7406;&#xFF0C;&#x786E;&#x4FDD;pod&#x8D44;&#x6E90;&#x7B26;&#x5408;&#x9884;&#x671F;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5F53;pod&#x7684;&#x8D44;&#x6E90;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x65F6;&#xFF0C;&#x4F1A;&#x5C1D;&#x8BD5;&#x8FDB;&#x884C;&#x91CD;&#x542F;&#x6216;&#x91CD;&#x5EFA;pod&#x3002;</p>
<p>&#x5728;kubernetes&#x4E2D;Pod&#x63A7;&#x5236;&#x5668;&#x7684;&#x79CD;&#x7C7B;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x672C;&#x7AE0;&#x8282;&#x53EA;&#x4ECB;&#x7ECD;&#x4E00;&#x79CD;&#xFF1A;Deployment&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200408193950807.png" alt="image-20200408193950807"></p>
<p><strong>&#x547D;&#x4EE4;&#x64CD;&#x4F5C;</strong></p>
<pre><code class="lang-shell"># &#x547D;&#x4EE4;&#x683C;&#x5F0F;: kubectl create deployment &#x540D;&#x79F0;  [&#x53C2;&#x6570;] 
# --image  &#x6307;&#x5B9A;pod&#x7684;&#x955C;&#x50CF;
# --port   &#x6307;&#x5B9A;&#x7AEF;&#x53E3;
# --replicas  &#x6307;&#x5B9A;&#x521B;&#x5EFA;pod&#x6570;&#x91CF;
# --namespace  &#x6307;&#x5B9A;namespace
[root@master ~]# kubectl create deploy nginx --image=nginx:latest --port=80 --replicas=3 -n dev
deployment.apps/nginx created

# &#x67E5;&#x770B;&#x521B;&#x5EFA;&#x7684;Pod
[root@master ~]# kubectl get pods -n dev
NAME                     READY   STATUS    RESTARTS   AGE
nginx-5ff7956ff6-6k8cb   1/1     Running   0          19s
nginx-5ff7956ff6-jxfjt   1/1     Running   0          19s
nginx-5ff7956ff6-v6jqw   1/1     Running   0          19s

# &#x67E5;&#x770B;deployment&#x7684;&#x4FE1;&#x606F;
[root@master ~]# kubectl get deploy -n dev
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   3/3     3            3           2m42s

# UP-TO-DATE&#xFF1A;&#x6210;&#x529F;&#x5347;&#x7EA7;&#x7684;&#x526F;&#x672C;&#x6570;&#x91CF;
# AVAILABLE&#xFF1A;&#x53EF;&#x7528;&#x526F;&#x672C;&#x7684;&#x6570;&#x91CF;
[root@master ~]# kubectl get deploy -n dev -o wide
NAME    READY UP-TO-DATE  AVAILABLE   AGE     CONTAINERS   IMAGES              SELECTOR
nginx   3/3     3         3           2m51s   nginx        nginx:latest        run=nginx

# &#x67E5;&#x770B;deployment&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;
[root@master ~]# kubectl describe deploy nginx -n dev
Name:                   nginx
Namespace:              dev
CreationTimestamp:      Wed, 08 May 2021 11:14:14 +0800
Labels:                 run=nginx
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               run=nginx
Replicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  run=nginx
  Containers:
   nginx:
    Image:        nginx:latest
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  &lt;none&gt;
    Mounts:       &lt;none&gt;
  Volumes:        &lt;none&gt;
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  &lt;none&gt;
NewReplicaSet:   nginx-5ff7956ff6 (3/3 replicas created)
Events:
  Type    Reason             Age    From                   Message
  ----    ------             ----   ----                   -------
  Normal  ScalingReplicaSet  5m43s  deployment-controller  Scaled up replicaset nginx-5ff7956ff6 to 3

# &#x5220;&#x9664; 
[root@master ~]# kubectl delete deploy nginx -n dev
deployment.apps &quot;nginx&quot; deleted
</code></pre>
<p><strong>&#x914D;&#x7F6E;&#x64CD;&#x4F5C;</strong></p>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;deploy-nginx.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      run:</span> nginx
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        run:</span> nginx
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - image:</span> nginx:latest
<span class="hljs-attr">        name:</span> nginx
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">          protocol:</span> TCP
</code></pre>
<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664;&#x547D;&#x4EE4;&#x4E86;&#xFF1A;</p>
<p>&#x521B;&#x5EFA;&#xFF1A;kubectl create -f deploy-nginx.yaml</p>
<p>&#x5220;&#x9664;&#xFF1A;kubectl delete -f deploy-nginx.yaml</p>
<h2 id="45-service">4.5 Service</h2>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x8282;&#x8BFE;&#x7684;&#x5B66;&#x4E60;&#xFF0C;&#x5DF2;&#x7ECF;&#x80FD;&#x591F;&#x5229;&#x7528;Deployment&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x7EC4;Pod&#x6765;&#x63D0;&#x4F9B;&#x5177;&#x6709;&#x9AD8;&#x53EF;&#x7528;&#x6027;&#x7684;&#x670D;&#x52A1;&#x3002;</p>
<p>&#x867D;&#x7136;&#x6BCF;&#x4E2A;Pod&#x90FD;&#x4F1A;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;Pod IP&#xFF0C;&#x7136;&#x800C;&#x5374;&#x5B58;&#x5728;&#x5982;&#x4E0B;&#x4E24;&#x95EE;&#x9898;&#xFF1A;</p>
<ul>
<li>Pod IP &#x4F1A;&#x968F;&#x7740;Pod&#x7684;&#x91CD;&#x5EFA;&#x4EA7;&#x751F;&#x53D8;&#x5316;</li>
<li>Pod IP &#x4EC5;&#x4EC5;&#x662F;&#x96C6;&#x7FA4;&#x5185;&#x53EF;&#x89C1;&#x7684;&#x865A;&#x62DF;IP&#xFF0C;&#x5916;&#x90E8;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;</li>
</ul>
<p>&#x8FD9;&#x6837;&#x5BF9;&#x4E8E;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5E26;&#x6765;&#x4E86;&#x96BE;&#x5EA6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;kubernetes&#x8BBE;&#x8BA1;&#x4E86;Service&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p>Service&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x4E00;&#x7EC4;&#x540C;&#x7C7B;Pod<strong>&#x5BF9;&#x5916;&#x7684;&#x8BBF;&#x95EE;&#x63A5;&#x53E3;</strong>&#x3002;&#x501F;&#x52A9;Service&#xFF0C;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x5730;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x548C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200408194716912.png" alt="image-20200408194716912"></p>
<p><strong>&#x64CD;&#x4F5C;&#x4E00;&#xFF1A;&#x521B;&#x5EFA;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x53EF;&#x8BBF;&#x95EE;&#x7684;Service</strong></p>
<pre><code class="lang-shell"># &#x66B4;&#x9732;Service
[root@master ~]# kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev
service/svc-nginx1 exposed

# &#x67E5;&#x770B;service
[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wide
NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE     SELECTOR
svc-nginx1   ClusterIP   10.109.179.231   &lt;none&gt;        80/TCP    3m51s   run=nginx

# &#x8FD9;&#x91CC;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;CLUSTER-IP&#xFF0C;&#x8FD9;&#x5C31;&#x662F;service&#x7684;IP&#xFF0C;&#x5728;Service&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x662F;&#x4E0D;&#x4F1A;&#x53D8;&#x52A8;&#x7684;
# &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;IP&#x8BBF;&#x95EE;&#x5F53;&#x524D;service&#x5BF9;&#x5E94;&#x7684;POD
[root@master ~]# curl 10.109.179.231:80
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
.......
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><strong>&#x64CD;&#x4F5C;&#x4E8C;&#xFF1A;&#x521B;&#x5EFA;&#x96C6;&#x7FA4;&#x5916;&#x90E8;&#x4E5F;&#x53EF;&#x8BBF;&#x95EE;&#x7684;Service</strong></p>
<pre><code class="lang-shell"># &#x4E0A;&#x9762;&#x521B;&#x5EFA;&#x7684;Service&#x7684;type&#x7C7B;&#x578B;&#x4E3A;ClusterIP&#xFF0C;&#x8FD9;&#x4E2A;ip&#x5730;&#x5740;&#x53EA;&#x7528;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x53EF;&#x8BBF;&#x95EE;
# &#x5982;&#x679C;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x5916;&#x90E8;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7684;Service&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;type&#x4E3A;NodePort
[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev
service/svc-nginx2 exposed

# &#x6B64;&#x65F6;&#x67E5;&#x770B;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x51FA;&#x73B0;&#x4E86;NodePort&#x7C7B;&#x578B;&#x7684;Service&#xFF0C;&#x800C;&#x4E14;&#x6709;&#x4E00;&#x5BF9;Port&#xFF08;80:31928/TC&#xFF09;
[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide
NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR
svc-nginx2    NodePort    10.100.94.0      &lt;none&gt;        80:31928/TCP   9s     run=nginx

# &#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x96C6;&#x7FA4;&#x5916;&#x7684;&#x4E3B;&#x673A;&#x8BBF;&#x95EE; &#x8282;&#x70B9;IP:31928&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4E86;
# &#x4F8B;&#x5982;&#x5728;&#x7684;&#x7535;&#x8111;&#x4E3B;&#x673A;&#x4E0A;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x4E0B;&#x9762;&#x7684;&#x5730;&#x5740;
http://192.168.5.4:31928/
</code></pre>
<p><strong>&#x5220;&#x9664;Service</strong></p>
<pre><code class="lang-shell">[root@master ~]# kubectl delete svc svc-nginx-1 -n dev service &quot;svc-nginx-1&quot; deleted
</code></pre>
<p><strong>&#x914D;&#x7F6E;&#x65B9;&#x5F0F;</strong></p>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;svc-nginx.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> svc-nginx
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  clusterIP:</span> <span class="hljs-number">10.109</span><span class="hljs-number">.179</span><span class="hljs-number">.231</span> <span class="hljs-comment">#&#x56FA;&#x5B9A;svc&#x7684;&#x5185;&#x7F51;ip</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    protocol:</span> TCP
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    run:</span> nginx
<span class="hljs-attr">  type:</span> ClusterIP
</code></pre>
<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664;&#x547D;&#x4EE4;&#x4E86;&#xFF1A;</p>
<p>&#x521B;&#x5EFA;&#xFF1A;kubectl create -f svc-nginx.yaml</p>
<p>&#x5220;&#x9664;&#xFF1A;kubectl delete -f svc-nginx.yaml</p>
<blockquote>
<p><strong>&#x5C0F;&#x7ED3;</strong></p>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x5DF2;&#x7ECF;&#x638C;&#x63E1;&#x4E86;Namespace&#x3001;Pod&#x3001;Deployment&#x3001;Service&#x8D44;&#x6E90;&#x7684;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#xFF0C;&#x6709;&#x4E86;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;kubernetes&#x96C6;&#x7FA4;&#x4E2D;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x7B80;&#x5355;&#x90E8;&#x7F72;&#x548C;&#x8BBF;&#x95EE;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x60F3;&#x8981;&#x66F4;&#x597D;&#x7684;&#x4F7F;&#x7528;kubernetes&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x6DF1;&#x5165;&#x5B66;&#x4E60;&#x8FD9;&#x51E0;&#x79CD;&#x8D44;&#x6E90;&#x7684;&#x7EC6;&#x8282;&#x548C;&#x539F;&#x7406;&#x3002;</p>
</blockquote>
<h1 id="5-pod&#x8BE6;&#x89E3;">5. Pod&#x8BE6;&#x89E3;</h1>
<h2 id="51-pod&#x4ECB;&#x7ECD;">5.1 Pod&#x4ECB;&#x7ECD;</h2>
<h3 id="511-pod&#x7ED3;&#x6784;">5.1.1 Pod&#x7ED3;&#x6784;</h3>
<p><img src="Kubenetes.assets/image-20200407121501907-1626781151898.png" alt="image-20200407121501907"></p>
<p>&#x6BCF;&#x4E2A;Pod&#x4E2D;&#x90FD;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;&#xFF1A;</p>
<ul>
<li><p>&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x6240;&#x5728;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6570;&#x91CF;&#x53EF;&#x591A;&#x53EF;&#x5C11;</p>
</li>
<li><p>Pause&#x5BB9;&#x5668;&#xFF0C;&#x8FD9;&#x662F;&#x6BCF;&#x4E2A;Pod&#x90FD;&#x4F1A;&#x6709;&#x7684;&#x4E00;&#x4E2A;<strong>&#x6839;&#x5BB9;&#x5668;</strong>&#xFF0C;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x6709;&#x4E24;&#x4E2A;&#xFF1A;</p>
<ul>
<li><p>&#x53EF;&#x4EE5;&#x4EE5;&#x5B83;&#x4E3A;&#x4F9D;&#x636E;&#xFF0C;&#x8BC4;&#x4F30;&#x6574;&#x4E2A;Pod&#x7684;&#x5065;&#x5EB7;&#x72B6;&#x6001;</p>
</li>
<li><p>&#x53EF;&#x4EE5;&#x5728;&#x6839;&#x5BB9;&#x5668;&#x4E0A;&#x8BBE;&#x7F6E;Ip&#x5730;&#x5740;&#xFF0C;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x90FD;&#x6B64;Ip&#xFF08;Pod IP&#xFF09;&#xFF0C;&#x4EE5;&#x5B9E;&#x73B0;Pod&#x5185;&#x90E8;&#x7684;&#x7F51;&#x8DEF;&#x901A;&#x4FE1;</p>
<pre><code>&#x8FD9;&#x91CC;&#x662F;Pod&#x5185;&#x90E8;&#x7684;&#x901A;&#x8BAF;&#xFF0C;Pod&#x7684;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x8BAF;&#x91C7;&#x7528;&#x865A;&#x62DF;&#x4E8C;&#x5C42;&#x7F51;&#x7EDC;&#x6280;&#x672F;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x5F53;&#x524D;&#x73AF;&#x5883;&#x7528;&#x7684;&#x662F;Flannel
</code></pre></li>
</ul>
</li>
</ul>
<h3 id="512-pod&#x5B9A;&#x4E49;">5.1.2 Pod&#x5B9A;&#x4E49;</h3>
<p>&#x4E0B;&#x9762;&#x662F;Pod&#x7684;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#xFF1A;</p>
<pre><code class="lang-shell">apiVersion: v1     #&#x5FC5;&#x9009;&#xFF0C;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x4F8B;&#x5982;v1
kind: Pod       &#x3000; #&#x5FC5;&#x9009;&#xFF0C;&#x8D44;&#x6E90;&#x7C7B;&#x578B;&#xFF0C;&#x4F8B;&#x5982; Pod
metadata:       &#x3000; #&#x5FC5;&#x9009;&#xFF0C;&#x5143;&#x6570;&#x636E;
  name: string     #&#x5FC5;&#x9009;&#xFF0C;Pod&#x540D;&#x79F0;
  namespace: string  #Pod&#x6240;&#x5C5E;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;,&#x9ED8;&#x8BA4;&#x4E3A;&quot;default&quot;
  labels:       &#x3000;&#x3000;  #&#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x7B7E;&#x5217;&#x8868;
    - name: string      &#x3000;          
spec:  #&#x5FC5;&#x9009;&#xFF0C;Pod&#x4E2D;&#x5BB9;&#x5668;&#x7684;&#x8BE6;&#x7EC6;&#x5B9A;&#x4E49;
  containers:  #&#x5FC5;&#x9009;&#xFF0C;Pod&#x4E2D;&#x5BB9;&#x5668;&#x5217;&#x8868;
  - name: string   #&#x5FC5;&#x9009;&#xFF0C;&#x5BB9;&#x5668;&#x540D;&#x79F0;
    image: string  #&#x5FC5;&#x9009;&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x955C;&#x50CF;&#x540D;&#x79F0;
    imagePullPolicy: [ Always|Never|IfNotPresent ]  #&#x83B7;&#x53D6;&#x955C;&#x50CF;&#x7684;&#x7B56;&#x7565; 
    command: [string]   #&#x5BB9;&#x5668;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x5217;&#x8868;&#xFF0C;&#x5982;&#x4E0D;&#x6307;&#x5B9A;&#xFF0C;&#x4F7F;&#x7528;&#x6253;&#x5305;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;
    args: [string]      #&#x5BB9;&#x5668;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x53C2;&#x6570;&#x5217;&#x8868;
    workingDir: string  #&#x5BB9;&#x5668;&#x7684;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;
    volumeMounts:       #&#x6302;&#x8F7D;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;&#x5B58;&#x50A8;&#x5377;&#x914D;&#x7F6E;
    - name: string      #&#x5F15;&#x7528;pod&#x5B9A;&#x4E49;&#x7684;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x5377;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x9700;&#x7528;volumes[]&#x90E8;&#x5206;&#x5B9A;&#x4E49;&#x7684;&#x7684;&#x5377;&#x540D;
      mountPath: string #&#x5B58;&#x50A8;&#x5377;&#x5728;&#x5BB9;&#x5668;&#x5185;mount&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5E94;&#x5C11;&#x4E8E;512&#x5B57;&#x7B26;
      readOnly: boolean #&#x662F;&#x5426;&#x4E3A;&#x53EA;&#x8BFB;&#x6A21;&#x5F0F;
    ports: #&#x9700;&#x8981;&#x66B4;&#x9732;&#x7684;&#x7AEF;&#x53E3;&#x5E93;&#x53F7;&#x5217;&#x8868;
    - name: string        #&#x7AEF;&#x53E3;&#x7684;&#x540D;&#x79F0;
      containerPort: int  #&#x5BB9;&#x5668;&#x9700;&#x8981;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#x53F7;
      hostPort: int       #&#x5BB9;&#x5668;&#x6240;&#x5728;&#x4E3B;&#x673A;&#x9700;&#x8981;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0E;Container&#x76F8;&#x540C;
      protocol: string    #&#x7AEF;&#x53E3;&#x534F;&#x8BAE;&#xFF0C;&#x652F;&#x6301;TCP&#x548C;UDP&#xFF0C;&#x9ED8;&#x8BA4;TCP
    env:   #&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x524D;&#x9700;&#x8BBE;&#x7F6E;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5217;&#x8868;
    - name: string  #&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x540D;&#x79F0;
      value: string #&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x503C;
    resources: #&#x8D44;&#x6E90;&#x9650;&#x5236;&#x548C;&#x8BF7;&#x6C42;&#x7684;&#x8BBE;&#x7F6E;
      limits:  #&#x8D44;&#x6E90;&#x9650;&#x5236;&#x7684;&#x8BBE;&#x7F6E;
        cpu: string     #Cpu&#x7684;&#x9650;&#x5236;&#xFF0C;&#x5355;&#x4F4D;&#x4E3A;core&#x6570;&#xFF0C;&#x5C06;&#x7528;&#x4E8E;docker run --cpu-shares&#x53C2;&#x6570;
        memory: string  #&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF0C;&#x5355;&#x4F4D;&#x53EF;&#x4EE5;&#x4E3A;Mib/Gib&#xFF0C;&#x5C06;&#x7528;&#x4E8E;docker run --memory&#x53C2;&#x6570;
      requests: #&#x8D44;&#x6E90;&#x8BF7;&#x6C42;&#x7684;&#x8BBE;&#x7F6E;
        cpu: string    #Cpu&#x8BF7;&#x6C42;&#xFF0C;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x7684;&#x521D;&#x59CB;&#x53EF;&#x7528;&#x6570;&#x91CF;
        memory: string #&#x5185;&#x5B58;&#x8BF7;&#x6C42;,&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x7684;&#x521D;&#x59CB;&#x53EF;&#x7528;&#x6570;&#x91CF;
    lifecycle: #&#x751F;&#x547D;&#x5468;&#x671F;&#x94A9;&#x5B50;
        postStart: #&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#x7ACB;&#x5373;&#x6267;&#x884C;&#x6B64;&#x94A9;&#x5B50;,&#x5982;&#x679C;&#x6267;&#x884C;&#x5931;&#x8D25;,&#x4F1A;&#x6839;&#x636E;&#x91CD;&#x542F;&#x7B56;&#x7565;&#x8FDB;&#x884C;&#x91CD;&#x542F;
        preStop: #&#x5BB9;&#x5668;&#x7EC8;&#x6B62;&#x524D;&#x6267;&#x884C;&#x6B64;&#x94A9;&#x5B50;,&#x65E0;&#x8BBA;&#x7ED3;&#x679C;&#x5982;&#x4F55;,&#x5BB9;&#x5668;&#x90FD;&#x4F1A;&#x7EC8;&#x6B62;
    livenessProbe:  #&#x5BF9;Pod&#x5185;&#x5404;&#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x5F53;&#x63A2;&#x6D4B;&#x65E0;&#x54CD;&#x5E94;&#x51E0;&#x6B21;&#x540E;&#x5C06;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#x8BE5;&#x5BB9;&#x5668;
      exec:       &#x3000; #&#x5BF9;Pod&#x5BB9;&#x5668;&#x5185;&#x68C0;&#x67E5;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;&#x4E3A;exec&#x65B9;&#x5F0F;
        command: [string]  #exec&#x65B9;&#x5F0F;&#x9700;&#x8981;&#x5236;&#x5B9A;&#x7684;&#x547D;&#x4EE4;&#x6216;&#x811A;&#x672C;
      httpGet:       #&#x5BF9;Pod&#x5185;&#x4E2A;&#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x4E3A;HttpGet&#xFF0C;&#x9700;&#x8981;&#x5236;&#x5B9A;Path&#x3001;port
        path: string
        port: number
        host: string
        scheme: string
        HttpHeaders:
        - name: string
          value: string
      tcpSocket:     #&#x5BF9;Pod&#x5185;&#x4E2A;&#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;&#x4E3A;tcpSocket&#x65B9;&#x5F0F;
         port: number
       initialDelaySeconds: 0       #&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x540E;&#x9996;&#x6B21;&#x63A2;&#x6D4B;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;&#x4E3A;&#x79D2;
       timeoutSeconds: 0    &#x3000;&#x3000;    #&#x5BF9;&#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x63A2;&#x6D4B;&#x7B49;&#x5F85;&#x54CD;&#x5E94;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;&#x79D2;&#xFF0C;&#x9ED8;&#x8BA4;1&#x79D2;
       periodSeconds: 0     &#x3000;&#x3000;    #&#x5BF9;&#x5BB9;&#x5668;&#x76D1;&#x63A7;&#x68C0;&#x67E5;&#x7684;&#x5B9A;&#x671F;&#x63A2;&#x6D4B;&#x65F6;&#x95F4;&#x8BBE;&#x7F6E;&#xFF0C;&#x5355;&#x4F4D;&#x79D2;&#xFF0C;&#x9ED8;&#x8BA4;10&#x79D2;&#x4E00;&#x6B21;
       successThreshold: 0
       failureThreshold: 0
       securityContext:
         privileged: false
  restartPolicy: [Always | Never | OnFailure]  #Pod&#x7684;&#x91CD;&#x542F;&#x7B56;&#x7565;
  nodeName: &lt;string&gt; #&#x8BBE;&#x7F6E;NodeName&#x8868;&#x793A;&#x5C06;&#x8BE5;Pod&#x8C03;&#x5EA6;&#x5230;&#x6307;&#x5B9A;&#x5230;&#x540D;&#x79F0;&#x7684;node&#x8282;&#x70B9;&#x4E0A;
  nodeSelector: obeject #&#x8BBE;&#x7F6E;NodeSelector&#x8868;&#x793A;&#x5C06;&#x8BE5;Pod&#x8C03;&#x5EA6;&#x5230;&#x5305;&#x542B;&#x8FD9;&#x4E2A;label&#x7684;node&#x4E0A;
  imagePullSecrets: #Pull&#x955C;&#x50CF;&#x65F6;&#x4F7F;&#x7528;&#x7684;secret&#x540D;&#x79F0;&#xFF0C;&#x4EE5;key&#xFF1A;secretkey&#x683C;&#x5F0F;&#x6307;&#x5B9A;
  - name: string
  hostNetwork: false   #&#x662F;&#x5426;&#x4F7F;&#x7528;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;&#x6A21;&#x5F0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;false&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x8868;&#x793A;&#x4F7F;&#x7528;&#x5BBF;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;
  volumes:   #&#x5728;&#x8BE5;pod&#x4E0A;&#x5B9A;&#x4E49;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x5377;&#x5217;&#x8868;
  - name: string    #&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x5377;&#x540D;&#x79F0; &#xFF08;volumes&#x7C7B;&#x578B;&#x6709;&#x5F88;&#x591A;&#x79CD;&#xFF09;
    emptyDir: {}       #&#x7C7B;&#x578B;&#x4E3A;emtyDir&#x7684;&#x5B58;&#x50A8;&#x5377;&#xFF0C;&#x4E0E;Pod&#x540C;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x76EE;&#x5F55;&#x3002;&#x4E3A;&#x7A7A;&#x503C;
    hostPath: string   #&#x7C7B;&#x578B;&#x4E3A;hostPath&#x7684;&#x5B58;&#x50A8;&#x5377;&#xFF0C;&#x8868;&#x793A;&#x6302;&#x8F7D;Pod&#x6240;&#x5728;&#x5BBF;&#x4E3B;&#x673A;&#x7684;&#x76EE;&#x5F55;
      path: string      &#x3000;&#x3000;        #Pod&#x6240;&#x5728;&#x5BBF;&#x4E3B;&#x673A;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x5C06;&#x88AB;&#x7528;&#x4E8E;&#x540C;&#x671F;&#x4E2D;mount&#x7684;&#x76EE;&#x5F55;
    secret:       &#x3000;&#x3000;&#x3000;#&#x7C7B;&#x578B;&#x4E3A;secret&#x7684;&#x5B58;&#x50A8;&#x5377;&#xFF0C;&#x6302;&#x8F7D;&#x96C6;&#x7FA4;&#x4E0E;&#x5B9A;&#x4E49;&#x7684;secret&#x5BF9;&#x8C61;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x90E8;
      scretname: string  
      items:     
      - key: string
        path: string
    configMap:         #&#x7C7B;&#x578B;&#x4E3A;configMap&#x7684;&#x5B58;&#x50A8;&#x5377;&#xFF0C;&#x6302;&#x8F7D;&#x9884;&#x5B9A;&#x4E49;&#x7684;configMap&#x5BF9;&#x8C61;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x90E8;
      name: string
      items:
      - key: string
        path: string
</code></pre>
<pre><code class="lang-shell">#&#x5C0F;&#x63D0;&#x793A;&#xFF1A;
#   &#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x53EF;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x6765;&#x67E5;&#x770B;&#x6BCF;&#x79CD;&#x8D44;&#x6E90;&#x7684;&#x53EF;&#x914D;&#x7F6E;&#x9879;
#   kubectl explain &#x8D44;&#x6E90;&#x7C7B;&#x578B;         &#x67E5;&#x770B;&#x67D0;&#x79CD;&#x8D44;&#x6E90;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x7684;&#x4E00;&#x7EA7;&#x5C5E;&#x6027;
#   kubectl explain &#x8D44;&#x6E90;&#x7C7B;&#x578B;.&#x5C5E;&#x6027;     &#x67E5;&#x770B;&#x5C5E;&#x6027;&#x7684;&#x5B50;&#x5C5E;&#x6027;
[root@k8s-master01 ~]# kubectl explain pod
KIND:     Pod
VERSION:  v1
FIELDS:
   apiVersion   &lt;string&gt;
   kind &lt;string&gt;
   metadata     &lt;Object&gt;
   spec &lt;Object&gt;
   status       &lt;Object&gt;

[root@k8s-master01 ~]# kubectl explain pod.metadata
KIND:     Pod
VERSION:  v1
RESOURCE: metadata &lt;Object&gt;
FIELDS:
   annotations  &lt;map[string]string&gt;
   clusterName  &lt;string&gt;
   creationTimestamp    &lt;string&gt;
   deletionGracePeriodSeconds   &lt;integer&gt;
   deletionTimestamp    &lt;string&gt;
   finalizers   &lt;[]string&gt;
   generateName &lt;string&gt;
   generation   &lt;integer&gt;
   labels       &lt;map[string]string&gt;
   managedFields        &lt;[]Object&gt;
   name &lt;string&gt;
   namespace    &lt;string&gt;
   ownerReferences      &lt;[]Object&gt;
   resourceVersion      &lt;string&gt;
   selfLink     &lt;string&gt;
   uid  &lt;string&gt;
</code></pre>
<p>&#x5728;kubernetes&#x4E2D;&#x57FA;&#x672C;&#x6240;&#x6709;&#x8D44;&#x6E90;&#x7684;&#x4E00;&#x7EA7;&#x5C5E;&#x6027;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x5305;&#x542B;5&#x90E8;&#x5206;&#xFF1A;</p>
<ul>
<li>apiVersion <string> &#x7248;&#x672C;&#xFF0C;&#x7531;kubernetes&#x5185;&#x90E8;&#x5B9A;&#x4E49;&#xFF0C;&#x7248;&#x672C;&#x53F7;&#x5FC5;&#x987B;&#x53EF;&#x4EE5;&#x7528; kubectl api-versions &#x67E5;&#x8BE2;&#x5230;</string></li>
<li>kind <string> &#x7C7B;&#x578B;&#xFF0C;&#x7531;kubernetes&#x5185;&#x90E8;&#x5B9A;&#x4E49;&#xFF0C;&#x7248;&#x672C;&#x53F7;&#x5FC5;&#x987B;&#x53EF;&#x4EE5;&#x7528; kubectl api-resources &#x67E5;&#x8BE2;&#x5230;</string></li>
<li>metadata <object> &#x5143;&#x6570;&#x636E;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x8D44;&#x6E90;&#x6807;&#x8BC6;&#x548C;&#x8BF4;&#x660E;&#xFF0C;&#x5E38;&#x7528;&#x7684;&#x6709;name&#x3001;namespace&#x3001;labels&#x7B49;</object></li>
<li>spec <object> &#x63CF;&#x8FF0;&#xFF0C;&#x8FD9;&#x662F;&#x914D;&#x7F6E;&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x91CC;&#x9762;&#x662F;&#x5BF9;&#x5404;&#x79CD;&#x8D44;&#x6E90;&#x914D;&#x7F6E;&#x7684;&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;</object></li>
<li>status <object> &#x72B6;&#x6001;&#x4FE1;&#x606F;&#xFF0C;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#xFF0C;&#x7531;kubernetes&#x81EA;&#x52A8;&#x751F;&#x6210;</object></li>
</ul>
<p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x5C5E;&#x6027;&#x4E2D;&#xFF0C;spec&#x662F;&#x63A5;&#x4E0B;&#x6765;&#x7814;&#x7A76;&#x7684;&#x91CD;&#x70B9;&#xFF0C;&#x7EE7;&#x7EED;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5E38;&#x89C1;&#x5B50;&#x5C5E;&#x6027;:</p>
<ul>
<li>containers &lt;[]Object&gt; &#x5BB9;&#x5668;&#x5217;&#x8868;&#xFF0C;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;</li>
<li>nodeName <string> &#x6839;&#x636E;nodeName&#x7684;&#x503C;&#x5C06;pod&#x8C03;&#x5EA6;&#x5230;&#x6307;&#x5B9A;&#x7684;Node&#x8282;&#x70B9;&#x4E0A;</string></li>
<li>nodeSelector <map[]> &#x6839;&#x636E;NodeSelector&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x4FE1;&#x606F;&#x9009;&#x62E9;&#x5C06;&#x8BE5;Pod&#x8C03;&#x5EA6;&#x5230;&#x5305;&#x542B;&#x8FD9;&#x4E9B;label&#x7684;Node &#x4E0A;</map[]></li>
<li>hostNetwork <boolean> &#x662F;&#x5426;&#x4F7F;&#x7528;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;&#x6A21;&#x5F0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;false&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x8868;&#x793A;&#x4F7F;&#x7528;&#x5BBF;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;</boolean></li>
<li>volumes &lt;[]Object&gt; &#x5B58;&#x50A8;&#x5377;&#xFF0C;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;Pod&#x4E0A;&#x9762;&#x6302;&#x5728;&#x7684;&#x5B58;&#x50A8;&#x4FE1;&#x606F;</li>
<li>restartPolicy <string> &#x91CD;&#x542F;&#x7B56;&#x7565;&#xFF0C;&#x8868;&#x793A;Pod&#x5728;&#x9047;&#x5230;&#x6545;&#x969C;&#x7684;&#x65F6;&#x5019;&#x7684;&#x5904;&#x7406;&#x7B56;&#x7565;</string></li>
</ul>
<h2 id="52-pod&#x914D;&#x7F6E;">5.2 Pod&#x914D;&#x7F6E;</h2>
<p>&#x672C;&#x5C0F;&#x8282;&#x4E3B;&#x8981;&#x6765;&#x7814;&#x7A76;<code>pod.spec.containers</code>&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;pod&#x914D;&#x7F6E;&#x4E2D;&#x6700;&#x4E3A;&#x5173;&#x952E;&#x7684;&#x4E00;&#x9879;&#x914D;&#x7F6E;&#x3002;</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl explain pod.spec.containers
KIND:     Pod
VERSION:  v1
RESOURCE: containers &lt;[]Object&gt;   # &#x6570;&#x7EC4;&#xFF0C;&#x4EE3;&#x8868;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x5BB9;&#x5668;
FIELDS:
   name  &lt;string&gt;     # &#x5BB9;&#x5668;&#x540D;&#x79F0;
   image &lt;string&gt;     # &#x5BB9;&#x5668;&#x9700;&#x8981;&#x7684;&#x955C;&#x50CF;&#x5730;&#x5740;
   imagePullPolicy  &lt;string&gt; # &#x955C;&#x50CF;&#x62C9;&#x53D6;&#x7B56;&#x7565; 
   command  &lt;[]string&gt; # &#x5BB9;&#x5668;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x5217;&#x8868;&#xFF0C;&#x5982;&#x4E0D;&#x6307;&#x5B9A;&#xFF0C;&#x4F7F;&#x7528;&#x6253;&#x5305;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;
   args     &lt;[]string&gt; # &#x5BB9;&#x5668;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x9700;&#x8981;&#x7684;&#x53C2;&#x6570;&#x5217;&#x8868;
   env      &lt;[]Object&gt; # &#x5BB9;&#x5668;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x914D;&#x7F6E;
   ports    &lt;[]Object&gt;     # &#x5BB9;&#x5668;&#x9700;&#x8981;&#x66B4;&#x9732;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#x5217;&#x8868;
   resources &lt;Object&gt;      # &#x8D44;&#x6E90;&#x9650;&#x5236;&#x548C;&#x8D44;&#x6E90;&#x8BF7;&#x6C42;&#x7684;&#x8BBE;&#x7F6E;
</code></pre>
<h3 id="521-&#x57FA;&#x672C;&#x914D;&#x7F6E;">5.2.1 &#x57FA;&#x672C;&#x914D;&#x7F6E;</h3>
<p>&#x521B;&#x5EFA;pod-base.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-base
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    user:</span> heima
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
</code></pre>
<p><img src="Kubenetes.assets/image-20210617223823675-1626781695411.png" alt="image-20210617223823675"></p>
<p>&#x4E0A;&#x9762;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x7B80;&#x5355;Pod&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#xFF1A;</p>
<ul>
<li>nginx&#xFF1A;&#x7528;1.17.1&#x7248;&#x672C;&#x7684;nginx&#x955C;&#x50CF;&#x521B;&#x5EFA;&#xFF0C;&#xFF08;nginx&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;web&#x5BB9;&#x5668;&#xFF09;</li>
<li>busybox&#xFF1A;&#x7528;1.30&#x7248;&#x672C;&#x7684;busybox&#x955C;&#x50CF;&#x521B;&#x5EFA;&#xFF0C;&#xFF08;busybox&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x5DE7;&#x7684;linux&#x547D;&#x4EE4;&#x96C6;&#x5408;&#xFF09;</li>
</ul>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 pod]# kubectl apply -f pod-base.yaml
pod/pod-base created

# &#x67E5;&#x770B;Pod&#x72B6;&#x51B5;
# READY 1/2 : &#x8868;&#x793A;&#x5F53;&#x524D;Pod&#x4E2D;&#x6709;2&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5176;&#x4E2D;1&#x4E2A;&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#xFF0C;1&#x4E2A;&#x672A;&#x5C31;&#x7EEA;
# RESTARTS  : &#x91CD;&#x542F;&#x6B21;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;1&#x4E2A;&#x5BB9;&#x5668;&#x6545;&#x969C;&#x4E86;&#xFF0C;Pod&#x4E00;&#x76F4;&#x5728;&#x91CD;&#x542F;&#x8BD5;&#x56FE;&#x6062;&#x590D;&#x5B83;
[root@k8s-master01 pod]# kubectl get pod -n dev
NAME       READY   STATUS    RESTARTS   AGE
pod-base   1/2     Running   4          95s

# &#x53EF;&#x4EE5;&#x901A;&#x8FC7;describe&#x67E5;&#x770B;&#x5185;&#x90E8;&#x7684;&#x8BE6;&#x60C5;
# &#x6B64;&#x65F6;&#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#x8D77;&#x6765;&#x4E86;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684;Pod&#xFF0C;&#x867D;&#x7136;&#x5B83;&#x6682;&#x65F6;&#x6709;&#x95EE;&#x9898;
[root@k8s-master01 pod]# kubectl describe pod pod-base -n dev
</code></pre>
<h3 id="522-&#x955C;&#x50CF;&#x62C9;&#x53D6;">5.2.2 &#x955C;&#x50CF;&#x62C9;&#x53D6;</h3>
<p>&#x521B;&#x5EFA;pod-imagepullpolicy.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-imagepullpolicy
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    imagePullPolicy:</span> Never <span class="hljs-comment"># &#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x955C;&#x50CF;&#x62C9;&#x53D6;&#x7B56;&#x7565;</span>
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
</code></pre>
<p><img src="Kubenetes.assets/image-20210617223923659.png" alt="image-20210617223923659"></p>
<p>imagePullPolicy&#xFF0C;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x955C;&#x50CF;&#x62C9;&#x53D6;&#x7B56;&#x7565;&#xFF0C;kubernetes&#x652F;&#x6301;&#x914D;&#x7F6E;&#x4E09;&#x79CD;&#x62C9;&#x53D6;&#x7B56;&#x7565;&#xFF1A;</p>
<ul>
<li>Always&#xFF1A;&#x603B;&#x662F;&#x4ECE;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x62C9;&#x53D6;&#x955C;&#x50CF;&#xFF08;&#x4E00;&#x76F4;&#x8FDC;&#x7A0B;&#x4E0B;&#x8F7D;&#xFF09;</li>
<li>IfNotPresent&#xFF1A;&#x672C;&#x5730;&#x6709;&#x5219;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x955C;&#x50CF;&#xFF0C;&#x672C;&#x5730;&#x6CA1;&#x6709;&#x5219;&#x4ECE;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x62C9;&#x53D6;&#x955C;&#x50CF;&#xFF08;&#x672C;&#x5730;&#x6709;&#x5C31;&#x672C;&#x5730; &#x672C;&#x5730;&#x6CA1;&#x8FDC;&#x7A0B;&#x4E0B;&#x8F7D;&#xFF09;</li>
<li>Never&#xFF1A;&#x53EA;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x955C;&#x50CF;&#xFF0C;&#x4ECE;&#x4E0D;&#x53BB;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x62C9;&#x53D6;&#xFF0C;&#x672C;&#x5730;&#x6CA1;&#x6709;&#x5C31;&#x62A5;&#x9519; &#xFF08;&#x4E00;&#x76F4;&#x4F7F;&#x7528;&#x672C;&#x5730;&#xFF09;</li>
</ul>
<blockquote>
<p>&#x9ED8;&#x8BA4;&#x503C;&#x8BF4;&#x660E;&#xFF1A;</p>
<p>&#x5982;&#x679C;&#x955C;&#x50CF;tag&#x4E3A;&#x5177;&#x4F53;&#x7248;&#x672C;&#x53F7;&#xFF0C; &#x9ED8;&#x8BA4;&#x7B56;&#x7565;&#x662F;&#xFF1A;IfNotPresent</p>
<p>&#x5982;&#x679C;&#x955C;&#x50CF;tag&#x4E3A;&#xFF1A;latest&#xFF08;&#x6700;&#x7EC8;&#x7248;&#x672C;&#xFF09; &#xFF0C;&#x9ED8;&#x8BA4;&#x7B56;&#x7565;&#x662F;always</p>
</blockquote>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 pod]# kubectl create -f pod-imagepullpolicy.yaml
pod/pod-imagepullpolicy created

# &#x67E5;&#x770B;Pod&#x8BE6;&#x60C5;
# &#x6B64;&#x65F6;&#x660E;&#x663E;&#x53EF;&#x4EE5;&#x770B;&#x5230;nginx&#x955C;&#x50CF;&#x6709;&#x4E00;&#x6B65;Pulling image &quot;nginx:1.17.1&quot;&#x7684;&#x8FC7;&#x7A0B;
[root@k8s-master01 pod]# kubectl describe pod pod-imagepullpolicy -n dev
......
Events:
  Type     Reason     Age               From               Message
  ----     ------     ----              ----               -------
  Normal   Scheduled  &lt;unknown&gt;         default-scheduler  Successfully assigned dev/pod-imagePullPolicy to node1
  Normal   Pulling    32s               kubelet, node1     Pulling image &quot;nginx:1.17.1&quot;
  Normal   Pulled     26s               kubelet, node1     Successfully pulled image &quot;nginx:1.17.1&quot;
  Normal   Created    26s               kubelet, node1     Created container nginx
  Normal   Started    25s               kubelet, node1     Started container nginx
  Normal   Pulled     7s (x3 over 25s)  kubelet, node1     Container image &quot;busybox:1.30&quot; already present on machine
  Normal   Created    7s (x3 over 25s)  kubelet, node1     Created container busybox
  Normal   Started    7s (x3 over 25s)  kubelet, node1     Started container busybox
</code></pre>
<h3 id="523-&#x542F;&#x52A8;&#x547D;&#x4EE4;">5.2.3 &#x542F;&#x52A8;&#x547D;&#x4EE4;</h3>
<p>&#x5728;&#x524D;&#x9762;&#x7684;&#x6848;&#x4F8B;&#x4E2D;&#xFF0C;&#x4E00;&#x76F4;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x6CA1;&#x6709;&#x89E3;&#x51B3;&#xFF0C;&#x5C31;&#x662F;&#x7684;busybox&#x5BB9;&#x5668;&#x4E00;&#x76F4;&#x6CA1;&#x6709;&#x6210;&#x529F;&#x8FD0;&#x884C;&#xFF0C;&#x90A3;&#x4E48;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x539F;&#x56E0;&#x5BFC;&#x81F4;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x6545;&#x969C;&#x5462;&#xFF1F;</p>
<p>&#x539F;&#x6765;busybox&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#xFF0C;&#x800C;&#x662F;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x7C7B;&#x7684;&#x96C6;&#x5408;&#xFF0C;kubernetes&#x96C6;&#x7FA4;&#x542F;&#x52A8;&#x7BA1;&#x7406;&#x540E;&#xFF0C;&#x5B83;&#x4F1A;&#x81EA;&#x52A8;&#x5173;&#x95ED;&#x3002;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x8BA9;&#x5176;&#x4E00;&#x76F4;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x5C31;&#x7528;&#x5230;&#x4E86;command&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x521B;&#x5EFA;pod-command.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-command
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done;&quot;</span>]
</code></pre>
<p><img src="Kubenetes.assets/image-20210617224457945.png" alt="image-20210617224457945"></p>
<p>command&#xFF0C;&#x7528;&#x4E8E;&#x5728;pod&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x3002;</p>
<blockquote>
<p>&#x7A0D;&#x5FAE;&#x89E3;&#x91CA;&#x4E0B;&#x4E0A;&#x9762;&#x547D;&#x4EE4;&#x7684;&#x610F;&#x601D;&#xFF1A;</p>
<p>&quot;/bin/sh&quot;,&quot;-c&quot;, &#x4F7F;&#x7528;sh&#x6267;&#x884C;&#x547D;&#x4EE4;</p>
<p>touch /tmp/hello.txt; &#x521B;&#x5EFA;&#x4E00;&#x4E2A;/tmp/hello.txt &#x6587;&#x4EF6;</p>
<p>while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done; &#x6BCF;&#x9694;3&#x79D2;&#x5411;&#x6587;&#x4EF6;&#x4E2D;&#x5199;&#x5165;&#x5F53;&#x524D;&#x65F6;&#x95F4;</p>
</blockquote>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 pod]# kubectl create  -f pod-command.yaml
pod/pod-command created

# &#x67E5;&#x770B;Pod&#x72B6;&#x6001;
# &#x6B64;&#x65F6;&#x53D1;&#x73B0;&#x4E24;&#x4E2A;pod&#x90FD;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x4E86;
[root@k8s-master01 pod]# kubectl get pods pod-command -n dev
NAME          READY   STATUS   RESTARTS   AGE
pod-command   2/2     Runing   0          2s

# &#x8FDB;&#x5165;pod&#x4E2D;&#x7684;busybox&#x5BB9;&#x5668;&#xFF0C;&#x67E5;&#x770B;&#x6587;&#x4EF6;&#x5185;&#x5BB9;
# &#x8865;&#x5145;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;: kubectl exec  pod&#x540D;&#x79F0; -n &#x547D;&#x540D;&#x7A7A;&#x95F4; -it -c &#x5BB9;&#x5668;&#x540D;&#x79F0; /bin/sh  &#x5728;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x6267;&#x884C;&#x547D;&#x4EE4;
# &#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x5185;&#x90E8;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#x4E86;
# &#x6BD4;&#x5982;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;txt&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;
[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox /bin/sh
/ # tail -f /tmp/hello.txt
14:44:19
14:44:22
14:44:25
</code></pre>
<pre><code>&#x7279;&#x522B;&#x8BF4;&#x660E;&#xFF1A;
    &#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x53D1;&#x73B0;command&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x548C;&#x4F20;&#x9012;&#x53C2;&#x6570;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x91CC;&#x8FD8;&#x8981;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;args&#x9009;&#x9879;&#xFF0C;&#x7528;&#x4E8E;&#x4F20;&#x9012;&#x53C2;&#x6570;&#x5462;?&#x8FD9;&#x5176;&#x5B9E;&#x8DDF;docker&#x6709;&#x70B9;&#x5173;&#x7CFB;&#xFF0C;kubernetes&#x4E2D;&#x7684;command&#x3001;args&#x4E24;&#x9879;&#x5176;&#x5B9E;&#x662F;&#x5B9E;&#x73B0;&#x8986;&#x76D6;Dockerfile&#x4E2D;ENTRYPOINT&#x7684;&#x529F;&#x80FD;&#x3002;
 1 &#x5982;&#x679C;command&#x548C;args&#x5747;&#x6CA1;&#x6709;&#x5199;&#xFF0C;&#x90A3;&#x4E48;&#x7528;Dockerfile&#x7684;&#x914D;&#x7F6E;&#x3002;
 2 &#x5982;&#x679C;command&#x5199;&#x4E86;&#xFF0C;&#x4F46;args&#x6CA1;&#x6709;&#x5199;&#xFF0C;&#x90A3;&#x4E48;Dockerfile&#x9ED8;&#x8BA4;&#x7684;&#x914D;&#x7F6E;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#xFF0C;&#x6267;&#x884C;&#x8F93;&#x5165;&#x7684;command
 3 &#x5982;&#x679C;command&#x6CA1;&#x5199;&#xFF0C;&#x4F46;args&#x5199;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;Dockerfile&#x4E2D;&#x914D;&#x7F6E;&#x7684;ENTRYPOINT&#x7684;&#x547D;&#x4EE4;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#xFF0C;&#x4F7F;&#x7528;&#x5F53;&#x524D;args&#x7684;&#x53C2;&#x6570;
 4 &#x5982;&#x679C;command&#x548C;args&#x90FD;&#x5199;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;Dockerfile&#x7684;&#x914D;&#x7F6E;&#x88AB;&#x5FFD;&#x7565;&#xFF0C;&#x6267;&#x884C;command&#x5E76;&#x8FFD;&#x52A0;&#x4E0A;args&#x53C2;&#x6570;
</code></pre><h3 id="524-&#x73AF;&#x5883;&#x53D8;&#x91CF;">5.2.4 &#x73AF;&#x5883;&#x53D8;&#x91CF;</h3>
<p>&#x521B;&#x5EFA;pod-env.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-env
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;while true;do /bin/echo $(date +%T);sleep 60; done;&quot;</span>]
<span class="hljs-attr">    env:</span> <span class="hljs-comment"># &#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5217;&#x8868;</span>
<span class="hljs-attr">    - name:</span> <span class="hljs-string">&quot;username&quot;</span>
<span class="hljs-attr">      value:</span> <span class="hljs-string">&quot;admin&quot;</span>
<span class="hljs-attr">    - name:</span> <span class="hljs-string">&quot;password&quot;</span>
<span class="hljs-attr">      value:</span> <span class="hljs-string">&quot;123456&quot;</span>
</code></pre>
<p>env&#xFF0C;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x7528;&#x4E8E;&#x5728;pod&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x3002;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f pod-env.yaml
pod/pod-env created

# &#x8FDB;&#x5165;&#x5BB9;&#x5668;&#xFF0C;&#x8F93;&#x51FA;&#x73AF;&#x5883;&#x53D8;&#x91CF;
[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh
/ # echo $username
admin
/ # echo $password
123456
</code></pre>
<p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4E0D;&#x662F;&#x5F88;&#x63A8;&#x8350;&#xFF0C;&#x63A8;&#x8350;&#x5C06;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#x5355;&#x72EC;&#x5B58;&#x50A8;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5C06;&#x5728;&#x540E;&#x9762;&#x4ECB;&#x7ECD;&#x3002;</p>
<h3 id="525-&#x7AEF;&#x53E3;&#x8BBE;&#x7F6E;">5.2.5 &#x7AEF;&#x53E3;&#x8BBE;&#x7F6E;</h3>
<p>&#x672C;&#x5C0F;&#x8282;&#x6765;&#x4ECB;&#x7ECD;&#x5BB9;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x8BBE;&#x7F6E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;containers&#x7684;ports&#x9009;&#x9879;&#x3002;</p>
<p>&#x9996;&#x5148;&#x770B;&#x4E0B;ports&#x652F;&#x6301;&#x7684;&#x5B50;&#x9009;&#x9879;&#xFF1A;</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl explain pod.spec.containers.ports
KIND:     Pod
VERSION:  v1
RESOURCE: ports &lt;[]Object&gt;
FIELDS:
   name         &lt;string&gt;  # &#x7AEF;&#x53E3;&#x540D;&#x79F0;&#xFF0C;&#x5982;&#x679C;&#x6307;&#x5B9A;&#xFF0C;&#x5FC5;&#x987B;&#x4FDD;&#x8BC1;name&#x5728;pod&#x4E2D;&#x662F;&#x552F;&#x4E00;&#x7684;        
   containerPort&lt;integer&gt; # &#x5BB9;&#x5668;&#x8981;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;(0&lt;x&lt;65536)
   hostPort     &lt;integer&gt; # &#x5BB9;&#x5668;&#x8981;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x516C;&#x5F00;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#xFF0C;&#x4E3B;&#x673A;&#x4E0A;&#x53EA;&#x80FD;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E00;&#x4E2A;&#x526F;&#x672C;(&#x4E00;&#x822C;&#x7701;&#x7565;) 
   hostIP       &lt;string&gt;  # &#x8981;&#x5C06;&#x5916;&#x90E8;&#x7AEF;&#x53E3;&#x7ED1;&#x5B9A;&#x5230;&#x7684;&#x4E3B;&#x673A;IP(&#x4E00;&#x822C;&#x7701;&#x7565;)
   protocol     &lt;string&gt;  # &#x7AEF;&#x53E3;&#x534F;&#x8BAE;&#x3002;&#x5FC5;&#x987B;&#x662F;UDP&#x3001;TCP&#x6216;SCTP&#x3002;&#x9ED8;&#x8BA4;&#x4E3A;&#x201C;TCP&#x201D;&#x3002;
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x521B;&#x5EFA;pod-ports.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-ports
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span> <span class="hljs-comment"># &#x8BBE;&#x7F6E;&#x5BB9;&#x5668;&#x66B4;&#x9732;&#x7684;&#x7AEF;&#x53E3;&#x5217;&#x8868;</span>
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">      protocol:</span> TCP
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml
pod/pod-ports created

# &#x67E5;&#x770B;pod
# &#x5728;&#x4E0B;&#x9762;&#x53EF;&#x4EE5;&#x660E;&#x663E;&#x770B;&#x5230;&#x914D;&#x7F6E;&#x4FE1;&#x606F;
[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml
......
spec:
  containers:
  - image: nginx:1.17.1
    imagePullPolicy: IfNotPresent
    name: nginx
    ports:
    - containerPort: 80
      name: nginx-port
      protocol: TCP
......
</code></pre>
<p>&#x8BBF;&#x95EE;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>Podip:containerPort</code></p>
<h3 id="526-&#x8D44;&#x6E90;&#x914D;&#x989D;">5.2.6 &#x8D44;&#x6E90;&#x914D;&#x989D;</h3>
<p>&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x7A0B;&#x5E8F;&#x8981;&#x8FD0;&#x884C;&#xFF0C;&#x80AF;&#x5B9A;&#x662F;&#x8981;&#x5360;&#x7528;&#x4E00;&#x5B9A;&#x8D44;&#x6E90;&#x7684;&#xFF0C;&#x6BD4;&#x5982;cpu&#x548C;&#x5185;&#x5B58;&#x7B49;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5BF9;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x8D44;&#x6E90;&#x505A;&#x9650;&#x5236;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x53EF;&#x80FD;&#x5403;&#x6389;&#x5927;&#x91CF;&#x8D44;&#x6E90;&#xFF0C;&#x5BFC;&#x81F4;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x65E0;&#x6CD5;&#x8FD0;&#x884C;&#x3002;&#x9488;&#x5BF9;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;kubernetes&#x63D0;&#x4F9B;&#x4E86;&#x5BF9;&#x5185;&#x5B58;&#x548C;cpu&#x7684;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x914D;&#x989D;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x79CD;&#x673A;&#x5236;&#x4E3B;&#x8981;&#x901A;&#x8FC7;resources&#x9009;&#x9879;&#x5B9E;&#x73B0;&#xFF0C;&#x4ED6;&#x6709;&#x4E24;&#x4E2A;&#x5B50;&#x9009;&#x9879;&#xFF1A;</p>
<ul>
<li>limits&#xFF1A;&#x7528;&#x4E8E;&#x9650;&#x5236;&#x8FD0;&#x884C;&#x65F6;&#x5BB9;&#x5668;&#x7684;&#x6700;&#x5927;&#x5360;&#x7528;&#x8D44;&#x6E90;&#xFF0C;&#x5F53;&#x5BB9;&#x5668;&#x5360;&#x7528;&#x8D44;&#x6E90;&#x8D85;&#x8FC7;limits&#x65F6;&#x4F1A;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x91CD;&#x542F;</li>
<li>requests &#xFF1A;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x5BB9;&#x5668;&#x9700;&#x8981;&#x7684;&#x6700;&#x5C0F;&#x8D44;&#x6E90;&#xFF0C;&#x5982;&#x679C;&#x73AF;&#x5883;&#x8D44;&#x6E90;&#x4E0D;&#x591F;&#xFF0C;&#x5BB9;&#x5668;&#x5C06;&#x65E0;&#x6CD5;&#x542F;&#x52A8;</li>
</ul>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x4E24;&#x4E2A;&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x8D44;&#x6E90;&#x7684;&#x4E0A;&#x4E0B;&#x9650;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x521B;&#x5EFA;pod-resources.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-resources
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    resources:</span> <span class="hljs-comment"># &#x8D44;&#x6E90;&#x914D;&#x989D;</span>
<span class="hljs-attr">      limits:</span>  <span class="hljs-comment"># &#x9650;&#x5236;&#x8D44;&#x6E90;&#xFF08;&#x4E0A;&#x9650;&#xFF09;</span>
<span class="hljs-attr">        cpu:</span> <span class="hljs-string">&quot;2&quot;</span> <span class="hljs-comment"># CPU&#x9650;&#x5236;&#xFF0C;&#x5355;&#x4F4D;&#x662F;core&#x6570;</span>
<span class="hljs-attr">        memory:</span> <span class="hljs-string">&quot;10Gi&quot;</span> <span class="hljs-comment"># &#x5185;&#x5B58;&#x9650;&#x5236;</span>
<span class="hljs-attr">      requests:</span> <span class="hljs-comment"># &#x8BF7;&#x6C42;&#x8D44;&#x6E90;&#xFF08;&#x4E0B;&#x9650;&#xFF09;</span>
<span class="hljs-attr">        cpu:</span> <span class="hljs-string">&quot;1&quot;</span>  <span class="hljs-comment"># CPU&#x9650;&#x5236;&#xFF0C;&#x5355;&#x4F4D;&#x662F;core&#x6570;</span>
<span class="hljs-attr">        memory:</span> <span class="hljs-string">&quot;10Mi&quot;</span>  <span class="hljs-comment"># &#x5185;&#x5B58;&#x9650;&#x5236;</span>
</code></pre>
<p>&#x5728;&#x8FD9;&#x5BF9;cpu&#x548C;memory&#x7684;&#x5355;&#x4F4D;&#x505A;&#x4E00;&#x4E2A;&#x8BF4;&#x660E;&#xFF1A;</p>
<ul>
<li>cpu&#xFF1A;core&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x4E3A;&#x6574;&#x6570;&#x6216;&#x5C0F;&#x6570;</li>
<li>memory&#xFF1A; &#x5185;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Gi&#x3001;Mi&#x3001;G&#x3001;M&#x7B49;&#x5F62;&#x5F0F;</li>
</ul>
<pre><code class="lang-shell"># &#x8FD0;&#x884C;Pod
[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml
pod/pod-resources created

# &#x67E5;&#x770B;&#x53D1;&#x73B0;pod&#x8FD0;&#x884C;&#x6B63;&#x5E38;
[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev
NAME            READY   STATUS    RESTARTS   AGE  
pod-resources   1/1     Running   0          39s   

# &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x505C;&#x6B62;Pod
[root@k8s-master01 ~]# kubectl delete  -f pod-resources.yaml
pod &quot;pod-resources&quot; deleted

# &#x7F16;&#x8F91;pod&#xFF0C;&#x4FEE;&#x6539;resources.requests.memory&#x7684;&#x503C;&#x4E3A;10Gi
[root@k8s-master01 ~]# vim pod-resources.yaml

# &#x518D;&#x6B21;&#x542F;&#x52A8;pod
[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml
pod/pod-resources created

# &#x67E5;&#x770B;Pod&#x72B6;&#x6001;&#xFF0C;&#x53D1;&#x73B0;Pod&#x542F;&#x52A8;&#x5931;&#x8D25;
[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev -o wide
NAME            READY   STATUS    RESTARTS   AGE          
pod-resources   0/1     Pending   0          20s    

# &#x67E5;&#x770B;pod&#x8BE6;&#x60C5;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x5982;&#x4E0B;&#x63D0;&#x793A;
[root@k8s-master01 ~]# kubectl describe pod pod-resources -n dev
......
Warning  FailedScheduling  35s   default-scheduler  0/3 nodes are available: 1 node(s) had taint {node-role.kubernetes.io/master: }, that the pod didn&apos;t tolerate, 2 Insufficient memory.(&#x5185;&#x5B58;&#x4E0D;&#x8DB3;)
</code></pre>
<h2 id="53-pod&#x751F;&#x547D;&#x5468;&#x671F;">5.3 Pod&#x751F;&#x547D;&#x5468;&#x671F;</h2>
<p>&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x5C06;pod&#x5BF9;&#x8C61;&#x4ECE;&#x521B;&#x5EFA;&#x81F3;&#x7EC8;&#x7684;&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x79F0;&#x4E3A;pod&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4E0B;&#x9762;&#x7684;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<ul>
<li>pod&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;</li>
<li>&#x8FD0;&#x884C;&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;&#xFF08;init container&#xFF09;&#x8FC7;&#x7A0B;</li>
<li>&#x8FD0;&#x884C;&#x4E3B;&#x5BB9;&#x5668;&#xFF08;main container&#xFF09;<ul>
<li>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#x94A9;&#x5B50;&#xFF08;post start&#xFF09;&#x3001;&#x5BB9;&#x5668;&#x7EC8;&#x6B62;&#x524D;&#x94A9;&#x5B50;&#xFF08;pre stop&#xFF09;</li>
<li>&#x5BB9;&#x5668;&#x7684;&#x5B58;&#x6D3B;&#x6027;&#x63A2;&#x6D4B;&#xFF08;liveness probe&#xFF09;&#x3001;&#x5C31;&#x7EEA;&#x6027;&#x63A2;&#x6D4B;&#xFF08;readiness probe&#xFF09;</li>
</ul>
</li>
<li>pod&#x7EC8;&#x6B62;&#x8FC7;&#x7A0B;</li>
</ul>
<p><img src="Kubenetes.assets/image-20200412111402706-1626782188724.png" alt="image-20200412111402706"></p>
<p>&#x5728;&#x6574;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#xFF0C;Pod&#x4F1A;&#x51FA;&#x73B0;5&#x79CD;<strong>&#x72B6;&#x6001;</strong>&#xFF08;<strong>&#x76F8;&#x4F4D;</strong>&#xFF09;&#xFF0C;&#x5206;&#x522B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x6302;&#x8D77;&#xFF08;Pending&#xFF09;&#xFF1A;apiserver&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x4E86;pod&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x5B83;&#x5C1A;&#x672A;&#x88AB;&#x8C03;&#x5EA6;&#x5B8C;&#x6210;&#x6216;&#x8005;&#x4ECD;&#x5904;&#x4E8E;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;</li>
<li>&#x8FD0;&#x884C;&#x4E2D;&#xFF08;Running&#xFF09;&#xFF1A;pod&#x5DF2;&#x7ECF;&#x88AB;&#x8C03;&#x5EA6;&#x81F3;&#x67D0;&#x8282;&#x70B9;&#xFF0C;&#x5E76;&#x4E14;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x90FD;&#x5DF2;&#x7ECF;&#x88AB;kubelet&#x521B;&#x5EFA;&#x5B8C;&#x6210;</li>
<li>&#x6210;&#x529F;&#xFF08;Succeeded&#xFF09;&#xFF1A;pod&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x90FD;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x7EC8;&#x6B62;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x88AB;&#x91CD;&#x542F;</li>
<li>&#x5931;&#x8D25;&#xFF08;Failed&#xFF09;&#xFF1A;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x90FD;&#x5DF2;&#x7ECF;&#x7EC8;&#x6B62;&#xFF0C;&#x4F46;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x7EC8;&#x6B62;&#x5931;&#x8D25;&#xFF0C;&#x5373;&#x5BB9;&#x5668;&#x8FD4;&#x56DE;&#x4E86;&#x975E;0&#x503C;&#x7684;&#x9000;&#x51FA;&#x72B6;&#x6001;</li>
<li>&#x672A;&#x77E5;&#xFF08;Unknown&#xFF09;&#xFF1A;apiserver&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x83B7;&#x53D6;&#x5230;pod&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#xFF0C;&#x901A;&#x5E38;&#x7531;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x5931;&#x8D25;&#x6240;&#x5BFC;&#x81F4;</li>
</ul>
<h3 id="531-&#x521B;&#x5EFA;&#x548C;&#x7EC8;&#x6B62;">5.3.1 &#x521B;&#x5EFA;&#x548C;&#x7EC8;&#x6B62;</h3>
<p><strong>pod&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;</strong></p>
<ol>
<li><p>&#x7528;&#x6237;&#x901A;&#x8FC7;kubectl&#x6216;&#x5176;&#x4ED6;api&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4EA4;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x7684;pod&#x4FE1;&#x606F;&#x7ED9;apiServer</p>
</li>
<li><p>apiServer&#x5F00;&#x59CB;&#x751F;&#x6210;pod&#x5BF9;&#x8C61;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x5C06;&#x4FE1;&#x606F;&#x5B58;&#x5165;etcd&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x786E;&#x8BA4;&#x4FE1;&#x606F;&#x81F3;&#x5BA2;&#x6237;&#x7AEF;</p>
</li>
<li><p>apiServer&#x5F00;&#x59CB;&#x53CD;&#x6620;etcd&#x4E2D;&#x7684;pod&#x5BF9;&#x8C61;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5176;&#x5B83;&#x7EC4;&#x4EF6;&#x4F7F;&#x7528;watch&#x673A;&#x5236;&#x6765;&#x8DDF;&#x8E2A;&#x68C0;&#x67E5;apiServer&#x4E0A;&#x7684;&#x53D8;&#x52A8;</p>
</li>
<li><p>scheduler&#x53D1;&#x73B0;&#x6709;&#x65B0;&#x7684;pod&#x5BF9;&#x8C61;&#x8981;&#x521B;&#x5EFA;&#xFF0C;&#x5F00;&#x59CB;&#x4E3A;Pod&#x5206;&#x914D;&#x4E3B;&#x673A;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x4FE1;&#x606F;&#x66F4;&#x65B0;&#x81F3;apiServer</p>
</li>
<li><p>node&#x8282;&#x70B9;&#x4E0A;&#x7684;kubelet&#x53D1;&#x73B0;&#x6709;pod&#x8C03;&#x5EA6;&#x8FC7;&#x6765;&#xFF0C;&#x5C1D;&#x8BD5;&#x8C03;&#x7528;docker&#x542F;&#x52A8;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x56DE;&#x9001;&#x81F3;apiServer</p>
</li>
<li><p>apiServer&#x5C06;&#x63A5;&#x6536;&#x5230;&#x7684;pod&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x5B58;&#x5165;etcd&#x4E2D;</p>
<p><img src="Kubenetes.assets/image-20200406184656917-1626782168787.png" alt="image-20200406184656917"></p>
</li>
</ol>
<p><strong>pod&#x7684;&#x7EC8;&#x6B62;&#x8FC7;&#x7A0B;</strong></p>
<ol>
<li>&#x7528;&#x6237;&#x5411;apiServer&#x53D1;&#x9001;&#x5220;&#x9664;pod&#x5BF9;&#x8C61;&#x7684;&#x547D;&#x4EE4;</li>
<li>apiServcer&#x4E2D;&#x7684;pod&#x5BF9;&#x8C61;&#x4FE1;&#x606F;&#x4F1A;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x7684;&#x63A8;&#x79FB;&#x800C;&#x66F4;&#x65B0;&#xFF0C;&#x5728;&#x5BBD;&#x9650;&#x671F;&#x5185;&#xFF08;&#x9ED8;&#x8BA4;30s&#xFF09;&#xFF0C;pod&#x88AB;&#x89C6;&#x4E3A;dead</li>
<li>&#x5C06;pod&#x6807;&#x8BB0;&#x4E3A;terminating&#x72B6;&#x6001;</li>
<li>kubelet&#x5728;&#x76D1;&#x63A7;&#x5230;pod&#x5BF9;&#x8C61;&#x8F6C;&#x4E3A;terminating&#x72B6;&#x6001;&#x7684;&#x540C;&#x65F6;&#x542F;&#x52A8;pod&#x5173;&#x95ED;&#x8FC7;&#x7A0B;</li>
<li>&#x7AEF;&#x70B9;&#x63A7;&#x5236;&#x5668;&#x76D1;&#x63A7;&#x5230;pod&#x5BF9;&#x8C61;&#x7684;&#x5173;&#x95ED;&#x884C;&#x4E3A;&#x65F6;&#x5C06;&#x5176;&#x4ECE;&#x6240;&#x6709;&#x5339;&#x914D;&#x5230;&#x6B64;&#x7AEF;&#x70B9;&#x7684;service&#x8D44;&#x6E90;&#x7684;&#x7AEF;&#x70B9;&#x5217;&#x8868;&#x4E2D;&#x79FB;&#x9664;</li>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;pod&#x5BF9;&#x8C61;&#x5B9A;&#x4E49;&#x4E86;preStop&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x5219;&#x5728;&#x5176;&#x6807;&#x8BB0;&#x4E3A;terminating&#x540E;&#x5373;&#x4F1A;&#x4EE5;&#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x542F;&#x52A8;&#x6267;&#x884C;</li>
<li>pod&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#x8FDB;&#x7A0B;&#x6536;&#x5230;&#x505C;&#x6B62;&#x4FE1;&#x53F7;</li>
<li>&#x5BBD;&#x9650;&#x671F;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x82E5;pod&#x4E2D;&#x8FD8;&#x5B58;&#x5728;&#x4ECD;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;pod&#x5BF9;&#x8C61;&#x4F1A;&#x6536;&#x5230;&#x7ACB;&#x5373;&#x7EC8;&#x6B62;&#x7684;&#x4FE1;&#x53F7;</li>
<li>kubelet&#x8BF7;&#x6C42;apiServer&#x5C06;&#x6B64;pod&#x8D44;&#x6E90;&#x7684;&#x5BBD;&#x9650;&#x671F;&#x8BBE;&#x7F6E;&#x4E3A;0&#x4ECE;&#x800C;&#x5B8C;&#x6210;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#xFF0C;&#x6B64;&#x65F6;pod&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x5DF2;&#x4E0D;&#x53EF;&#x89C1;</li>
</ol>
<h3 id="532-&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;">5.3.2 &#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;</h3>
<p>&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;&#x662F;&#x5728;pod&#x7684;&#x4E3B;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x4E4B;&#x524D;&#x8981;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x505A;&#x4E00;&#x4E9B;&#x4E3B;&#x5BB9;&#x5668;&#x7684;&#x524D;&#x7F6E;&#x5DE5;&#x4F5C;&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x4E24;&#x5927;&#x7279;&#x5F81;&#xFF1A;</p>
<ol>
<li>&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;&#x5FC5;&#x987B;&#x8FD0;&#x884C;&#x5B8C;&#x6210;&#x76F4;&#x81F3;&#x7ED3;&#x675F;&#xFF0C;&#x82E5;&#x67D0;&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5931;&#x8D25;&#xFF0C;&#x90A3;&#x4E48;kubernetes&#x9700;&#x8981;&#x91CD;&#x542F;&#x5B83;&#x76F4;&#x5230;&#x6210;&#x529F;&#x5B8C;&#x6210;</li>
<li>&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;&#x5FC5;&#x987B;&#x6309;&#x7167;&#x5B9A;&#x4E49;&#x7684;&#x987A;&#x5E8F;&#x6267;&#x884C;&#xFF0C;&#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x524D;&#x4E00;&#x4E2A;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x4E00;&#x4E2A;&#x624D;&#x80FD;&#x8FD0;&#x884C;</li>
</ol>
<p>&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;&#x6709;&#x5F88;&#x591A;&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;&#xFF0C;&#x4E0B;&#x9762;&#x5217;&#x51FA;&#x7684;&#x662F;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x51E0;&#x4E2A;&#xFF1A;</p>
<ul>
<li>&#x63D0;&#x4F9B;&#x4E3B;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x4E2D;&#x4E0D;&#x5177;&#x5907;&#x7684;&#x5DE5;&#x5177;&#x7A0B;&#x5E8F;&#x6216;&#x81EA;&#x5B9A;&#x4E49;&#x4EE3;&#x7801;</li>
<li>&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;&#x8981;&#x5148;&#x4E8E;&#x5E94;&#x7528;&#x5BB9;&#x5668;&#x4E32;&#x884C;&#x542F;&#x52A8;&#x5E76;&#x8FD0;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x7528;&#x4E8E;&#x5EF6;&#x540E;&#x5E94;&#x7528;&#x5BB9;&#x5668;&#x7684;&#x542F;&#x52A8;&#x76F4;&#x81F3;&#x5176;&#x4F9D;&#x8D56;&#x7684;&#x6761;&#x4EF6;&#x5F97;&#x5230;&#x6EE1;&#x8DB3;</li>
</ul>
<p>&#x63A5;&#x4E0B;&#x6765;&#x505A;&#x4E00;&#x4E2A;&#x6848;&#x4F8B;&#xFF0C;&#x6A21;&#x62DF;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#xFF1A;</p>
<p>&#x5047;&#x8BBE;&#x8981;&#x4EE5;&#x4E3B;&#x5BB9;&#x5668;&#x6765;&#x8FD0;&#x884C;nginx&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x6C42;&#x5728;&#x8FD0;&#x884C;nginx&#x4E4B;&#x524D;&#x5148;&#x8981;&#x80FD;&#x591F;&#x8FDE;&#x63A5;&#x4E0A;mysql&#x548C;redis&#x6240;&#x5728;&#x670D;&#x52A1;&#x5668;</p>
<p>&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E8B;&#x5148;&#x89C4;&#x5B9A;&#x597D;mysql<code>(192.168.5.4)</code>&#x548C;redis<code>(192.168.5.5)</code>&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;</p>
<p>&#x521B;&#x5EFA;pod-initcontainer.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-initcontainer
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> main-container
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span> 
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  initContainers:</span>
<span class="hljs-attr">  - name:</span> test-mysql
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&apos;sh&apos;</span>, <span class="hljs-string">&apos;-c&apos;</span>, <span class="hljs-string">&apos;until ping 192.168.5.14 -c 1 ; do echo waiting for mysql...; sleep 2; done;&apos;</span>]
<span class="hljs-attr">  - name:</span> test-redis
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&apos;sh&apos;</span>, <span class="hljs-string">&apos;-c&apos;</span>, <span class="hljs-string">&apos;until ping 192.168.5.15 -c 1 ; do echo waiting for reids...; sleep 2; done;&apos;</span>]
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f pod-initcontainer.yaml
pod/pod-initcontainer created

# &#x67E5;&#x770B;pod&#x72B6;&#x6001;
# &#x53D1;&#x73B0;pod&#x5361;&#x5728;&#x542F;&#x52A8;&#x7B2C;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x5BB9;&#x5668;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x5BB9;&#x5668;&#x4E0D;&#x4F1A;&#x8FD0;&#x884C;
root@k8s-master01 ~]# kubectl describe pod  pod-initcontainer -n dev
........
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  49s   default-scheduler  Successfully assigned dev/pod-initcontainer to node1
  Normal  Pulled     48s   kubelet, node1     Container image &quot;busybox:1.30&quot; already present on machine
  Normal  Created    48s   kubelet, node1     Created container test-mysql
  Normal  Started    48s   kubelet, node1     Started container test-mysql

# &#x52A8;&#x6001;&#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods pod-initcontainer -n dev -w
NAME                             READY   STATUS     RESTARTS   AGE
pod-initcontainer                0/1     Init:0/2   0          15s
pod-initcontainer                0/1     Init:1/2   0          52s
pod-initcontainer                0/1     Init:1/2   0          53s
pod-initcontainer                0/1     PodInitializing   0          89s
pod-initcontainer                1/1     Running           0          90s

# &#x63A5;&#x4E0B;&#x6765;&#x65B0;&#x5F00;&#x4E00;&#x4E2A;shell&#xFF0C;&#x4E3A;&#x5F53;&#x524D;&#x670D;&#x52A1;&#x5668;&#x65B0;&#x589E;&#x4E24;&#x4E2A;ip&#xFF0C;&#x89C2;&#x5BDF;pod&#x7684;&#x53D8;&#x5316;
[root@k8s-master01 ~]# ifconfig ens33:1 192.168.5.14 netmask 255.255.255.0 up
[root@k8s-master01 ~]# ifconfig ens33:2 192.168.5.15 netmask 255.255.255.0 up
</code></pre>
<h3 id="533-&#x94A9;&#x5B50;&#x51FD;&#x6570;">5.3.3 &#x94A9;&#x5B50;&#x51FD;&#x6570;</h3>
<p>&#x94A9;&#x5B50;&#x51FD;&#x6570;&#x80FD;&#x591F;&#x611F;&#x77E5;&#x81EA;&#x8EAB;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x5E76;&#x5728;&#x76F8;&#x5E94;&#x7684;&#x65F6;&#x523B;&#x5230;&#x6765;&#x65F6;&#x8FD0;&#x884C;&#x7528;&#x6237;&#x6307;&#x5B9A;&#x7684;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x3002;</p>
<p>kubernetes&#x5728;&#x4E3B;&#x5BB9;&#x5668;&#x7684;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#x548C;&#x505C;&#x6B62;&#x4E4B;&#x524D;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x94A9;&#x5B50;&#x51FD;&#x6570;&#xFF1A;</p>
<ul>
<li>post start&#xFF1A;&#x5BB9;&#x5668;&#x521B;&#x5EFA;&#x4E4B;&#x540E;&#x6267;&#x884C;&#xFF0C;&#x5982;&#x679C;&#x5931;&#x8D25;&#x4E86;&#x4F1A;&#x91CD;&#x542F;&#x5BB9;&#x5668;</li>
<li>pre stop &#xFF1A;&#x5BB9;&#x5668;&#x7EC8;&#x6B62;&#x4E4B;&#x524D;&#x6267;&#x884C;&#xFF0C;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x5BB9;&#x5668;&#x5C06;&#x6210;&#x529F;&#x7EC8;&#x6B62;&#xFF0C;&#x5728;&#x5176;&#x5B8C;&#x6210;&#x4E4B;&#x524D;&#x4F1A;&#x963B;&#x585E;&#x5220;&#x9664;&#x5BB9;&#x5668;&#x7684;&#x64CD;&#x4F5C;</li>
</ul>
<p>&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;&#x652F;&#x6301;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x5B9A;&#x4E49;&#x52A8;&#x4F5C;&#xFF1A;</p>
<ul>
<li><p>Exec&#x547D;&#x4EE4;&#xFF1A;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x547D;&#x4EE4;</p>
<pre><code class="lang-yaml">&#x2026;&#x2026;
<span class="hljs-attr">  lifecycle:</span>
<span class="hljs-attr">    postStart:</span> 
<span class="hljs-attr">      exec:</span>
<span class="hljs-attr">        command:</span>
<span class="hljs-bullet">        -</span> cat
<span class="hljs-bullet">        -</span> /tmp/healthy
&#x2026;&#x2026;
</code></pre>
</li>
<li><p>TCPSocket&#xFF1A;&#x5728;&#x5F53;&#x524D;&#x5BB9;&#x5668;&#x5C1D;&#x8BD5;&#x8BBF;&#x95EE;&#x6307;&#x5B9A;&#x7684;socket</p>
<pre><code class="lang-yaml">&#x2026;&#x2026;      
<span class="hljs-attr">  lifecycle:</span>
<span class="hljs-attr">    postStart:</span>
<span class="hljs-attr">      tcpSocket:</span>
<span class="hljs-attr">        port:</span> <span class="hljs-number">8080</span>
&#x2026;&#x2026;
</code></pre>
</li>
<li><p>HTTPGet&#xFF1A;&#x5728;&#x5F53;&#x524D;&#x5BB9;&#x5668;&#x4E2D;&#x5411;&#x67D0;url&#x53D1;&#x8D77;http&#x8BF7;&#x6C42;</p>
<pre><code class="lang-yaml">&#x2026;&#x2026;
<span class="hljs-attr">  lifecycle:</span>
<span class="hljs-attr">    postStart:</span>
<span class="hljs-attr">      httpGet:</span>
<span class="hljs-attr">        path:</span> / <span class="hljs-comment">#URI&#x5730;&#x5740;</span>
<span class="hljs-attr">        port:</span> <span class="hljs-number">80</span> <span class="hljs-comment">#&#x7AEF;&#x53E3;&#x53F7;</span>
<span class="hljs-attr">        host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.5</span><span class="hljs-number">.3</span> <span class="hljs-comment">#&#x4E3B;&#x673A;&#x5730;&#x5740;</span>
<span class="hljs-attr">        scheme:</span> HTTP <span class="hljs-comment">#&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;&#xFF0C;http&#x6216;&#x8005;https</span>
&#x2026;&#x2026;
</code></pre>
</li>
</ul>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x4EE5;exec&#x65B9;&#x5F0F;&#x4E3A;&#x4F8B;&#xFF0C;&#x6F14;&#x793A;&#x4E0B;&#x94A9;&#x5B50;&#x51FD;&#x6570;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x521B;&#x5EFA;pod-hook-exec.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-hook-exec
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> main-container
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    lifecycle:</span>
<span class="hljs-attr">      postStart:</span> 
<span class="hljs-attr">        exec:</span> <span class="hljs-comment"># &#x5728;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#xFF0C;&#x4FEE;&#x6539;&#x6389;nginx&#x7684;&#x9ED8;&#x8BA4;&#x9996;&#x9875;&#x5185;&#x5BB9;</span>
<span class="hljs-attr">          command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo postStart... &gt; /usr/share/nginx/html/index.html&quot;</span>]
<span class="hljs-attr">      preStop:</span>
<span class="hljs-attr">        exec:</span> <span class="hljs-comment"># &#x5728;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x4E4B;&#x524D;&#x505C;&#x6B62;nginx&#x670D;&#x52A1;</span>
<span class="hljs-attr">          command:</span> [<span class="hljs-string">&quot;/usr/sbin/nginx&quot;</span>,<span class="hljs-string">&quot;-s&quot;</span>,<span class="hljs-string">&quot;quit&quot;</span>]
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f pod-hook-exec.yaml
pod/pod-hook-exec created

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods  pod-hook-exec -n dev -o wide
NAME           READY   STATUS     RESTARTS   AGE    IP            NODE    
pod-hook-exec  1/1     Running    0          29s    10.244.2.48   node2   

# &#x8BBF;&#x95EE;pod
[root@k8s-master01 ~]# curl 10.244.2.48
postStart...
</code></pre>
<h3 id="534-&#x5BB9;&#x5668;&#x63A2;&#x6D4B;">5.3.4 &#x5BB9;&#x5668;&#x63A2;&#x6D4B;</h3>
<p>&#x5BB9;&#x5668;&#x63A2;&#x6D4B;&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x5B9E;&#x4F8B;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#xFF0C;&#x662F;&#x4FDD;&#x969C;&#x4E1A;&#x52A1;&#x53EF;&#x7528;&#x6027;&#x7684;&#x4E00;&#x79CD;&#x4F20;&#x7EDF;&#x673A;&#x5236;&#x3002;&#x5982;&#x679C;&#x7ECF;&#x8FC7;&#x63A2;&#x6D4B;&#xFF0C;&#x5B9E;&#x4F8B;&#x7684;&#x72B6;&#x6001;&#x4E0D;&#x7B26;&#x5408;&#x9884;&#x671F;&#xFF0C;&#x90A3;&#x4E48;kubernetes&#x5C31;&#x4F1A;&#x628A;&#x8BE5;&#x95EE;&#x9898;&#x5B9E;&#x4F8B;&quot; &#x6458;&#x9664; &quot;&#xFF0C;&#x4E0D;&#x627F;&#x62C5;&#x4E1A;&#x52A1;&#x6D41;&#x91CF;&#x3002;kubernetes&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x63A2;&#x9488;&#x6765;&#x5B9E;&#x73B0;&#x5BB9;&#x5668;&#x63A2;&#x6D4B;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ul>
<li>liveness probes&#xFF1A;&#x5B58;&#x6D3B;&#x6027;&#x63A2;&#x9488;&#xFF0C;&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x5E94;&#x7528;&#x5B9E;&#x4F8B;&#x5F53;&#x524D;&#x662F;&#x5426;&#x5904;&#x4E8E;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;k8s&#x4F1A;&#x91CD;&#x542F;&#x5BB9;&#x5668;</li>
<li>readiness probes&#xFF1A;&#x5C31;&#x7EEA;&#x6027;&#x63A2;&#x9488;&#xFF0C;&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x5E94;&#x7528;&#x5B9E;&#x4F8B;&#x5F53;&#x524D;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x80FD;&#xFF0C;k8s&#x4E0D;&#x4F1A;&#x8F6C;&#x53D1;&#x6D41;&#x91CF;</li>
</ul>
<blockquote>
<p>livenessProbe &#x51B3;&#x5B9A;&#x662F;&#x5426;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#xFF0C;readinessProbe &#x51B3;&#x5B9A;&#x662F;&#x5426;&#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x7ED9;&#x5BB9;&#x5668;&#x3002;</p>
</blockquote>
<p>&#x4E0A;&#x9762;&#x4E24;&#x79CD;&#x63A2;&#x9488;&#x76EE;&#x524D;&#x5747;&#x652F;&#x6301;&#x4E09;&#x79CD;&#x63A2;&#x6D4B;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ul>
<li><p>Exec&#x547D;&#x4EE4;&#xFF1A;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x547D;&#x4EE4;&#xFF0C;&#x5982;&#x679C;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7684;&#x9000;&#x51FA;&#x7801;&#x4E3A;0&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x7A0B;&#x5E8F;&#x6B63;&#x5E38;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x6B63;&#x5E38;</p>
<pre><code class="lang-yaml">&#x2026;&#x2026;
<span class="hljs-attr">  livenessProbe:</span>
<span class="hljs-attr">    exec:</span>
<span class="hljs-attr">      command:</span>
<span class="hljs-bullet">      -</span> cat
<span class="hljs-bullet">      -</span> /tmp/healthy
&#x2026;&#x2026;
</code></pre>
</li>
<li><p>TCPSocket&#xFF1A;&#x5C06;&#x4F1A;&#x5C1D;&#x8BD5;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x5BB9;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x591F;&#x5EFA;&#x7ACB;&#x8FD9;&#x6761;&#x8FDE;&#x63A5;&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x7A0B;&#x5E8F;&#x6B63;&#x5E38;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x6B63;&#x5E38;</p>
<pre><code class="lang-yaml">&#x2026;&#x2026;      
<span class="hljs-attr">  livenessProbe:</span>
<span class="hljs-attr">    tcpSocket:</span>
<span class="hljs-attr">      port:</span> <span class="hljs-number">8080</span>
&#x2026;&#x2026;
</code></pre>
</li>
<li><p>HTTPGet&#xFF1A;&#x8C03;&#x7528;&#x5BB9;&#x5668;&#x5185;Web&#x5E94;&#x7528;&#x7684;URL&#xFF0C;&#x5982;&#x679C;&#x8FD4;&#x56DE;&#x7684;&#x72B6;&#x6001;&#x7801;&#x5728;200&#x548C;399&#x4E4B;&#x95F4;&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x7A0B;&#x5E8F;&#x6B63;&#x5E38;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x6B63;&#x5E38;</p>
<pre><code class="lang-yaml">&#x2026;&#x2026;
<span class="hljs-attr">  livenessProbe:</span>
<span class="hljs-attr">    httpGet:</span>
<span class="hljs-attr">      path:</span> / <span class="hljs-comment">#URI&#x5730;&#x5740;</span>
<span class="hljs-attr">      port:</span> <span class="hljs-number">80</span> <span class="hljs-comment">#&#x7AEF;&#x53E3;&#x53F7;</span>
<span class="hljs-attr">      host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-comment">#&#x4E3B;&#x673A;&#x5730;&#x5740;</span>
<span class="hljs-attr">      scheme:</span> HTTP <span class="hljs-comment">#&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;&#xFF0C;http&#x6216;&#x8005;https</span>
&#x2026;&#x2026;
</code></pre>
</li>
</ul>
<p>&#x4E0B;&#x9762;&#x4EE5;liveness probes&#x4E3A;&#x4F8B;&#xFF0C;&#x505A;&#x51E0;&#x4E2A;&#x6F14;&#x793A;&#xFF1A;</p>
<p><strong>&#x65B9;&#x5F0F;&#x4E00;&#xFF1A;Exec</strong></p>
<p>&#x521B;&#x5EFA;pod-liveness-exec.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-liveness-exec
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span> 
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    livenessProbe:</span>
<span class="hljs-attr">      exec:</span>
<span class="hljs-attr">        command:</span> [<span class="hljs-string">&quot;/bin/cat&quot;</span>,<span class="hljs-string">&quot;/tmp/hello.txt&quot;</span>] <span class="hljs-comment"># &#x6267;&#x884C;&#x4E00;&#x4E2A;&#x67E5;&#x770B;&#x6587;&#x4EF6;&#x7684;&#x547D;&#x4EE4;</span>
</code></pre>
<p>&#x521B;&#x5EFA;pod&#xFF0C;&#x89C2;&#x5BDF;&#x6548;&#x679C;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f pod-liveness-exec.yaml
pod/pod-liveness-exec created

# &#x67E5;&#x770B;Pod&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl describe pods pod-liveness-exec -n dev
......
  Normal   Created    20s (x2 over 50s)  kubelet, node1     Created container nginx
  Normal   Started    20s (x2 over 50s)  kubelet, node1     Started container nginx
  Normal   Killing    20s                kubelet, node1     Container nginx failed liveness probe, will be restarted
  Warning  Unhealthy  0s (x5 over 40s)   kubelet, node1     Liveness probe failed: cat: can&apos;t open &apos;/tmp/hello11.txt&apos;: No such file or directory

# &#x89C2;&#x5BDF;&#x4E0A;&#x9762;&#x7684;&#x4FE1;&#x606F;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;nginx&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#x5C31;&#x8FDB;&#x884C;&#x4E86;&#x5065;&#x5EB7;&#x68C0;&#x67E5;
# &#x68C0;&#x67E5;&#x5931;&#x8D25;&#x4E4B;&#x540E;&#xFF0C;&#x5BB9;&#x5668;&#x88AB;kill&#x6389;&#xFF0C;&#x7136;&#x540E;&#x5C1D;&#x8BD5;&#x8FDB;&#x884C;&#x91CD;&#x542F;&#xFF08;&#x8FD9;&#x662F;&#x91CD;&#x542F;&#x7B56;&#x7565;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x540E;&#x9762;&#x8BB2;&#x89E3;&#xFF09;
# &#x7A0D;&#x7B49;&#x4E00;&#x4F1A;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x89C2;&#x5BDF;pod&#x4FE1;&#x606F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;RESTARTS&#x4E0D;&#x518D;&#x662F;0&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x76F4;&#x589E;&#x957F;
[root@k8s-master01 ~]# kubectl get pods pod-liveness-exec -n dev
NAME                READY   STATUS             RESTARTS   AGE
pod-liveness-exec   0/1     CrashLoopBackOff   2          3m19s

# &#x5F53;&#x7136;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x6210;&#x4E00;&#x4E2A;&#x5B58;&#x5728;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982;/tmp/hello.txt&#xFF0C;&#x518D;&#x8BD5;&#xFF0C;&#x7ED3;&#x679C;&#x5C31;&#x6B63;&#x5E38;&#x4E86;......
</code></pre>
<p><strong>&#x65B9;&#x5F0F;&#x4E8C;&#xFF1A;TCPSocket</strong></p>
<p>&#x521B;&#x5EFA;pod-liveness-tcpsocket.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-liveness-tcpsocket
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span> 
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    livenessProbe:</span>
<span class="hljs-attr">      tcpSocket:</span>
<span class="hljs-attr">        port:</span> <span class="hljs-number">8080</span> <span class="hljs-comment"># &#x5C1D;&#x8BD5;&#x8BBF;&#x95EE;8080&#x7AEF;&#x53E3;</span>
</code></pre>
<p>&#x521B;&#x5EFA;pod&#xFF0C;&#x89C2;&#x5BDF;&#x6548;&#x679C;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f pod-liveness-tcpsocket.yaml
pod/pod-liveness-tcpsocket created

# &#x67E5;&#x770B;Pod&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl describe pods pod-liveness-tcpsocket -n dev
......
  Normal   Scheduled  31s                            default-scheduler  Successfully assigned dev/pod-liveness-tcpsocket to node2
  Normal   Pulled     &lt;invalid&gt;                      kubelet, node2     Container image &quot;nginx:1.17.1&quot; already present on machine
  Normal   Created    &lt;invalid&gt;                      kubelet, node2     Created container nginx
  Normal   Started    &lt;invalid&gt;                      kubelet, node2     Started container nginx
  Warning  Unhealthy  &lt;invalid&gt; (x2 over &lt;invalid&gt;)  kubelet, node2     Liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused

# &#x89C2;&#x5BDF;&#x4E0A;&#x9762;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x53D1;&#x73B0;&#x5C1D;&#x8BD5;&#x8BBF;&#x95EE;8080&#x7AEF;&#x53E3;,&#x4F46;&#x662F;&#x5931;&#x8D25;&#x4E86;
# &#x7A0D;&#x7B49;&#x4E00;&#x4F1A;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x89C2;&#x5BDF;pod&#x4FE1;&#x606F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;RESTARTS&#x4E0D;&#x518D;&#x662F;0&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x76F4;&#x589E;&#x957F;
[root@k8s-master01 ~]# kubectl get pods pod-liveness-tcpsocket  -n dev
NAME                     READY   STATUS             RESTARTS   AGE
pod-liveness-tcpsocket   0/1     CrashLoopBackOff   2          3m19s

# &#x5F53;&#x7136;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x6210;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x6BD4;&#x5982;80&#xFF0C;&#x518D;&#x8BD5;&#xFF0C;&#x7ED3;&#x679C;&#x5C31;&#x6B63;&#x5E38;&#x4E86;......
</code></pre>
<p><strong>&#x65B9;&#x5F0F;&#x4E09;&#xFF1A;HTTPGet</strong></p>
<p>&#x521B;&#x5EFA;pod-liveness-httpget.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-liveness-httpget
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    livenessProbe:</span>
<span class="hljs-attr">      httpGet:</span>  <span class="hljs-comment"># &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8BBF;&#x95EE;http://127.0.0.1:80/hello  </span>
<span class="hljs-attr">        scheme:</span> HTTP <span class="hljs-comment">#&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;&#xFF0C;http&#x6216;&#x8005;https</span>
<span class="hljs-attr">        port:</span> <span class="hljs-number">80</span> <span class="hljs-comment">#&#x7AEF;&#x53E3;&#x53F7;</span>
<span class="hljs-attr">        path:</span> /hello <span class="hljs-comment">#URI&#x5730;&#x5740;</span>
</code></pre>
<p>&#x521B;&#x5EFA;pod&#xFF0C;&#x89C2;&#x5BDF;&#x6548;&#x679C;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f pod-liveness-httpget.yaml
pod/pod-liveness-httpget created

# &#x67E5;&#x770B;Pod&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl describe pod pod-liveness-httpget -n dev
.......
  Normal   Pulled     6s (x3 over 64s)  kubelet, node1     Container image &quot;nginx:1.17.1&quot; already present on machine
  Normal   Created    6s (x3 over 64s)  kubelet, node1     Created container nginx
  Normal   Started    6s (x3 over 63s)  kubelet, node1     Started container nginx
  Warning  Unhealthy  6s (x6 over 56s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404
  Normal   Killing    6s (x2 over 36s)  kubelet, node1     Container nginx failed liveness probe, will be restarted

# &#x89C2;&#x5BDF;&#x4E0A;&#x9762;&#x4FE1;&#x606F;&#xFF0C;&#x5C1D;&#x8BD5;&#x8BBF;&#x95EE;&#x8DEF;&#x5F84;&#xFF0C;&#x4F46;&#x662F;&#x672A;&#x627E;&#x5230;,&#x51FA;&#x73B0;404&#x9519;&#x8BEF;
# &#x7A0D;&#x7B49;&#x4E00;&#x4F1A;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x89C2;&#x5BDF;pod&#x4FE1;&#x606F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;RESTARTS&#x4E0D;&#x518D;&#x662F;0&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x76F4;&#x589E;&#x957F;
[root@k8s-master01 ~]# kubectl get pod pod-liveness-httpget -n dev
NAME                   READY   STATUS    RESTARTS   AGE
pod-liveness-httpget   1/1     Running   5          3m17s

# &#x5F53;&#x7136;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x6210;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7684;&#x8DEF;&#x5F84;path&#xFF0C;&#x6BD4;&#x5982;/&#xFF0C;&#x518D;&#x8BD5;&#xFF0C;&#x7ED3;&#x679C;&#x5C31;&#x6B63;&#x5E38;&#x4E86;......
</code></pre>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528;liveness Probe&#x6F14;&#x793A;&#x4E86;&#x4E09;&#x79CD;&#x63A2;&#x6D4B;&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;&#x662F;&#x67E5;&#x770B;livenessProbe&#x7684;&#x5B50;&#x5C5E;&#x6027;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x9664;&#x4E86;&#x8FD9;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x4E00;&#x5E76;&#x89E3;&#x91CA;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl explain pod.spec.containers.livenessProbe
FIELDS:
   exec &lt;Object&gt;  
   tcpSocket    &lt;Object&gt;
   httpGet      &lt;Object&gt;
   initialDelaySeconds  &lt;integer&gt;  # &#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#x7B49;&#x5F85;&#x591A;&#x5C11;&#x79D2;&#x6267;&#x884C;&#x7B2C;&#x4E00;&#x6B21;&#x63A2;&#x6D4B;
   timeoutSeconds       &lt;integer&gt;  # &#x63A2;&#x6D4B;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;&#x9ED8;&#x8BA4;1&#x79D2;&#xFF0C;&#x6700;&#x5C0F;1&#x79D2;
   periodSeconds        &lt;integer&gt;  # &#x6267;&#x884C;&#x63A2;&#x6D4B;&#x7684;&#x9891;&#x7387;&#x3002;&#x9ED8;&#x8BA4;&#x662F;10&#x79D2;&#xFF0C;&#x6700;&#x5C0F;1&#x79D2;
   failureThreshold     &lt;integer&gt;  # &#x8FDE;&#x7EED;&#x63A2;&#x6D4B;&#x5931;&#x8D25;&#x591A;&#x5C11;&#x6B21;&#x624D;&#x88AB;&#x8BA4;&#x5B9A;&#x4E3A;&#x5931;&#x8D25;&#x3002;&#x9ED8;&#x8BA4;&#x662F;3&#x3002;&#x6700;&#x5C0F;&#x503C;&#x662F;1
   successThreshold     &lt;integer&gt;  # &#x8FDE;&#x7EED;&#x63A2;&#x6D4B;&#x6210;&#x529F;&#x591A;&#x5C11;&#x6B21;&#x624D;&#x88AB;&#x8BA4;&#x5B9A;&#x4E3A;&#x6210;&#x529F;&#x3002;&#x9ED8;&#x8BA4;&#x662F;1
</code></pre>
<p>&#x4E0B;&#x9762;&#x7A0D;&#x5FAE;&#x914D;&#x7F6E;&#x4E24;&#x4E2A;&#xFF0C;&#x6F14;&#x793A;&#x4E0B;&#x6548;&#x679C;&#x5373;&#x53EF;&#xFF1A;</p>
<pre><code class="lang-yaml">[root@k8s-master01 ~]<span class="hljs-comment"># more pod-liveness-httpget.yaml</span>
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-liveness-httpget
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    livenessProbe:</span>
<span class="hljs-attr">      httpGet:</span>
<span class="hljs-attr">        scheme:</span> HTTP
<span class="hljs-attr">        port:</span> <span class="hljs-number">80</span> 
<span class="hljs-attr">        path:</span> /
<span class="hljs-attr">      initialDelaySeconds:</span> <span class="hljs-number">30</span> <span class="hljs-comment"># &#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;30s&#x5F00;&#x59CB;&#x63A2;&#x6D4B;</span>
<span class="hljs-attr">      timeoutSeconds:</span> <span class="hljs-number">5</span> <span class="hljs-comment"># &#x63A2;&#x6D4B;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x4E3A;5s</span>
</code></pre>
<h3 id="535-&#x91CD;&#x542F;&#x7B56;&#x7565;">5.3.5 &#x91CD;&#x542F;&#x7B56;&#x7565;</h3>
<p>&#x5728;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x4E00;&#x65E6;&#x5BB9;&#x5668;&#x63A2;&#x6D4B;&#x51FA;&#x73B0;&#x4E86;&#x95EE;&#x9898;&#xFF0C;kubernetes&#x5C31;&#x4F1A;&#x5BF9;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x7684;Pod&#x8FDB;&#x884C;&#x91CD;&#x542F;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x662F;&#x7531;pod&#x7684;&#x91CD;&#x542F;&#x7B56;&#x7565;&#x51B3;&#x5B9A;&#x7684;&#xFF0C;pod&#x7684;&#x91CD;&#x542F;&#x7B56;&#x7565;&#x6709; 3 &#x79CD;&#xFF0C;&#x5206;&#x522B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>Always &#xFF1A;&#x5BB9;&#x5668;&#x5931;&#x6548;&#x65F6;&#xFF0C;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#x8BE5;&#x5BB9;&#x5668;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</li>
<li>OnFailure &#xFF1A; &#x5BB9;&#x5668;&#x7EC8;&#x6B62;&#x8FD0;&#x884C;&#x4E14;&#x9000;&#x51FA;&#x7801;&#x4E0D;&#x4E3A;0&#x65F6;&#x91CD;&#x542F;</li>
<li>Never &#xFF1A; &#x4E0D;&#x8BBA;&#x72B6;&#x6001;&#x4E3A;&#x4F55;&#xFF0C;&#x90FD;&#x4E0D;&#x91CD;&#x542F;&#x8BE5;&#x5BB9;&#x5668;</li>
</ul>
<p>&#x91CD;&#x542F;&#x7B56;&#x7565;&#x9002;&#x7528;&#x4E8E;pod&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5BB9;&#x5668;&#xFF0C;&#x9996;&#x6B21;&#x9700;&#x8981;&#x91CD;&#x542F;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5C06;&#x5728;&#x5176;&#x9700;&#x8981;&#x65F6;&#x7ACB;&#x5373;&#x8FDB;&#x884C;&#x91CD;&#x542F;&#xFF0C;&#x968F;&#x540E;&#x518D;&#x6B21;&#x9700;&#x8981;&#x91CD;&#x542F;&#x7684;&#x64CD;&#x4F5C;&#x5C06;&#x7531;kubelet&#x5EF6;&#x8FDF;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#x8FDB;&#x884C;&#xFF0C;&#x4E14;&#x53CD;&#x590D;&#x7684;&#x91CD;&#x542F;&#x64CD;&#x4F5C;&#x7684;&#x5EF6;&#x8FDF;&#x65F6;&#x957F;&#x4EE5;&#x6B64;&#x4E3A;10s&#x3001;20s&#x3001;40s&#x3001;80s&#x3001;160s&#x548C;300s&#xFF0C;300s&#x662F;&#x6700;&#x5927;&#x5EF6;&#x8FDF;&#x65F6;&#x957F;&#x3002;</p>
<p>&#x521B;&#x5EFA;pod-restartpolicy.yaml&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-restartpolicy
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> nginx-port
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    livenessProbe:</span>
<span class="hljs-attr">      httpGet:</span>
<span class="hljs-attr">        scheme:</span> HTTP
<span class="hljs-attr">        port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">        path:</span> /hello
<span class="hljs-attr">  restartPolicy:</span> Never <span class="hljs-comment"># &#x8BBE;&#x7F6E;&#x91CD;&#x542F;&#x7B56;&#x7565;&#x4E3A;Never</span>
</code></pre>
<p>&#x8FD0;&#x884C;Pod&#x6D4B;&#x8BD5;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f pod-restartpolicy.yaml
pod/pod-restartpolicy created

# &#x67E5;&#x770B;Pod&#x8BE6;&#x60C5;&#xFF0C;&#x53D1;&#x73B0;nginx&#x5BB9;&#x5668;&#x5931;&#x8D25;
[root@k8s-master01 ~]# kubectl  describe pods pod-restartpolicy  -n dev
......
  Warning  Unhealthy  15s (x3 over 35s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404
  Normal   Killing    15s                kubelet, node1     Container nginx failed liveness probe

# &#x591A;&#x7B49;&#x4E00;&#x4F1A;&#xFF0C;&#x518D;&#x89C2;&#x5BDF;pod&#x7684;&#x91CD;&#x542F;&#x6B21;&#x6570;&#xFF0C;&#x53D1;&#x73B0;&#x4E00;&#x76F4;&#x662F;0&#xFF0C;&#x5E76;&#x672A;&#x91CD;&#x542F;   
[root@k8s-master01 ~]# kubectl  get pods pod-restartpolicy -n dev
NAME                   READY   STATUS    RESTARTS   AGE
pod-restartpolicy      0/1     Running   0          5min42s
</code></pre>
<h2 id="54-pod&#x8C03;&#x5EA6;">5.4 Pod&#x8C03;&#x5EA6;</h2>
<p>&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E00;&#x4E2A;Pod&#x5728;&#x54EA;&#x4E2A;Node&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x662F;&#x7531;Scheduler&#x7EC4;&#x4EF6;&#x91C7;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x7B97;&#x6CD5;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x662F;&#x4E0D;&#x53D7;&#x4EBA;&#x5DE5;&#x63A7;&#x5236;&#x7684;&#x3002;&#x4F46;&#x662F;&#x5728;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x6EE1;&#x8DB3;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x56E0;&#x4E3A;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x63A7;&#x5236;&#x67D0;&#x4E9B;Pod&#x5230;&#x8FBE;&#x67D0;&#x4E9B;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x505A;&#x5462;&#xFF1F;&#x8FD9;&#x5C31;&#x8981;&#x6C42;&#x4E86;&#x89E3;kubernetes&#x5BF9;Pod&#x7684;&#x8C03;&#x5EA6;&#x89C4;&#x5219;&#xFF0C;kubernetes&#x63D0;&#x4F9B;&#x4E86;&#x56DB;&#x5927;&#x7C7B;&#x8C03;&#x5EA6;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ul>
<li>&#x81EA;&#x52A8;&#x8C03;&#x5EA6;&#xFF1A;&#x8FD0;&#x884C;&#x5728;&#x54EA;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x5B8C;&#x5168;&#x7531;Scheduler&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7B97;&#x6CD5;&#x8BA1;&#x7B97;&#x5F97;&#x51FA;</li>
<li>&#x5B9A;&#x5411;&#x8C03;&#x5EA6;&#xFF1A;NodeName&#x3001;NodeSelector</li>
<li>&#x4EB2;&#x548C;&#x6027;&#x8C03;&#x5EA6;&#xFF1A;NodeAffinity&#x3001;PodAffinity&#x3001;PodAntiAffinity</li>
<li>&#x6C61;&#x70B9;&#xFF08;&#x5BB9;&#x5FCD;&#xFF09;&#x8C03;&#x5EA6;&#xFF1A;Taints&#x3001;Toleration</li>
</ul>
<h3 id="541-&#x5B9A;&#x5411;&#x8C03;&#x5EA6;">5.4.1 &#x5B9A;&#x5411;&#x8C03;&#x5EA6;</h3>
<p>&#x5B9A;&#x5411;&#x8C03;&#x5EA6;&#xFF0C;&#x6307;&#x7684;&#x662F;&#x5229;&#x7528;&#x5728;pod&#x4E0A;&#x58F0;&#x660E;nodeName&#x6216;&#x8005;nodeSelector&#xFF0C;&#x4EE5;&#x6B64;&#x5C06;Pod&#x8C03;&#x5EA6;&#x5230;&#x671F;&#x671B;&#x7684;node&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x8C03;&#x5EA6;&#x662F;&#x5F3A;&#x5236;&#x7684;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x5373;&#x4F7F;&#x8981;&#x8C03;&#x5EA6;&#x7684;&#x76EE;&#x6807;Node&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x4E5F;&#x4F1A;&#x5411;&#x4E0A;&#x9762;&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;pod&#x8FD0;&#x884C;&#x5931;&#x8D25;&#x800C;&#x5DF2;&#x3002;</p>
<p><strong>NodeName</strong></p>
<p>NodeName&#x7528;&#x4E8E;&#x5F3A;&#x5236;&#x7EA6;&#x675F;&#x5C06;Pod&#x8C03;&#x5EA6;&#x5230;&#x6307;&#x5B9A;&#x7684;Name&#x7684;Node&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x76F4;&#x63A5;&#x8DF3;&#x8FC7;Scheduler&#x7684;&#x8C03;&#x5EA6;&#x903B;&#x8F91;&#xFF0C;&#x76F4;&#x63A5;&#x5C06;Pod&#x8C03;&#x5EA6;&#x5230;&#x6307;&#x5B9A;&#x540D;&#x79F0;&#x7684;&#x8282;&#x70B9;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5B9E;&#x9A8C;&#x4E00;&#x4E0B;&#xFF1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;pod-nodename.yaml&#x6587;&#x4EF6;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-nodename
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  nodeName:</span> node1 <span class="hljs-comment"># &#x6307;&#x5B9A;&#x8C03;&#x5EA6;&#x5230;node1&#x8282;&#x70B9;&#x4E0A;</span>
</code></pre>
<pre><code class="lang-shell">#&#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml
pod/pod-nodename created

#&#x67E5;&#x770B;Pod&#x8C03;&#x5EA6;&#x5230;NODE&#x5C5E;&#x6027;&#xFF0C;&#x786E;&#x5B9E;&#x662F;&#x8C03;&#x5EA6;&#x5230;&#x4E86;node1&#x8282;&#x70B9;&#x4E0A;
[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide
NAME           READY   STATUS    RESTARTS   AGE   IP            NODE      ......
pod-nodename   1/1     Running   0          56s   10.244.1.87   node1     ......   

# &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5220;&#x9664;pod&#xFF0C;&#x4FEE;&#x6539;nodeName&#x7684;&#x503C;&#x4E3A;node3&#xFF08;&#x5E76;&#x6CA1;&#x6709;node3&#x8282;&#x70B9;&#xFF09;
[root@k8s-master01 ~]# kubectl delete -f pod-nodename.yaml
pod &quot;pod-nodename&quot; deleted
[root@k8s-master01 ~]# vim pod-nodename.yaml
[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml
pod/pod-nodename created

#&#x518D;&#x6B21;&#x67E5;&#x770B;&#xFF0C;&#x53D1;&#x73B0;&#x5DF2;&#x7ECF;&#x5411;Node3&#x8282;&#x70B9;&#x8C03;&#x5EA6;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4E0D;&#x5B58;&#x5728;node3&#x8282;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;pod&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;
[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide
NAME           READY   STATUS    RESTARTS   AGE   IP       NODE    ......
pod-nodename   0/1     Pending   0          6s    &lt;none&gt;   node3   ......
</code></pre>
<p><strong>NodeSelector</strong></p>
<p>NodeSelector&#x7528;&#x4E8E;&#x5C06;pod&#x8C03;&#x5EA6;&#x5230;&#x6DFB;&#x52A0;&#x4E86;&#x6307;&#x5B9A;&#x6807;&#x7B7E;&#x7684;node&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x5B83;&#x662F;&#x901A;&#x8FC7;kubernetes&#x7684;label-selector&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;pod&#x521B;&#x5EFA;&#x4E4B;&#x524D;&#xFF0C;&#x4F1A;&#x7531;scheduler&#x4F7F;&#x7528;MatchNodeSelector&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x8FDB;&#x884C;label&#x5339;&#x914D;&#xFF0C;&#x627E;&#x51FA;&#x76EE;&#x6807;node&#xFF0C;&#x7136;&#x540E;&#x5C06;pod&#x8C03;&#x5EA6;&#x5230;&#x76EE;&#x6807;&#x8282;&#x70B9;&#xFF0C;&#x8BE5;&#x5339;&#x914D;&#x89C4;&#x5219;&#x662F;&#x5F3A;&#x5236;&#x7EA6;&#x675F;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5B9E;&#x9A8C;&#x4E00;&#x4E0B;&#xFF1A;</p>
<p>1 &#x9996;&#x5148;&#x5206;&#x522B;&#x4E3A;node&#x8282;&#x70B9;&#x6DFB;&#x52A0;&#x6807;&#x7B7E;</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv=pro
node/node2 labeled
[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv=test
node/node2 labeled
</code></pre>
<p>2 &#x521B;&#x5EFA;&#x4E00;&#x4E2A;pod-nodeselector.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x5B83;&#x521B;&#x5EFA;Pod</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-nodeselector
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  nodeSelector:</span> 
<span class="hljs-attr">    nodeenv:</span> pro <span class="hljs-comment"># &#x6307;&#x5B9A;&#x8C03;&#x5EA6;&#x5230;&#x5177;&#x6709;nodeenv=pro&#x6807;&#x7B7E;&#x7684;&#x8282;&#x70B9;&#x4E0A;</span>
</code></pre>
<pre><code class="lang-shell">#&#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml
pod/pod-nodeselector created

#&#x67E5;&#x770B;Pod&#x8C03;&#x5EA6;&#x5230;NODE&#x5C5E;&#x6027;&#xFF0C;&#x786E;&#x5B9E;&#x662F;&#x8C03;&#x5EA6;&#x5230;&#x4E86;node1&#x8282;&#x70B9;&#x4E0A;
[root@k8s-master01 ~]# kubectl get pods pod-nodeselector -n dev -o wide
NAME               READY   STATUS    RESTARTS   AGE     IP          NODE    ......
pod-nodeselector   1/1     Running   0          47s   10.244.1.87   node1   ......

# &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5220;&#x9664;pod&#xFF0C;&#x4FEE;&#x6539;nodeSelector&#x7684;&#x503C;&#x4E3A;nodeenv: xxxx&#xFF08;&#x4E0D;&#x5B58;&#x5728;&#x6253;&#x6709;&#x6B64;&#x6807;&#x7B7E;&#x7684;&#x8282;&#x70B9;&#xFF09;
[root@k8s-master01 ~]# kubectl delete -f pod-nodeselector.yaml
pod &quot;pod-nodeselector&quot; deleted
[root@k8s-master01 ~]# vim pod-nodeselector.yaml
[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml
pod/pod-nodeselector created

#&#x518D;&#x6B21;&#x67E5;&#x770B;&#xFF0C;&#x53D1;&#x73B0;pod&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;,Node&#x7684;&#x503C;&#x4E3A;none
[root@k8s-master01 ~]# kubectl get pods -n dev -o wide
NAME               READY   STATUS    RESTARTS   AGE     IP       NODE    
pod-nodeselector   0/1     Pending   0          2m20s   &lt;none&gt;   &lt;none&gt;

# &#x67E5;&#x770B;&#x8BE6;&#x60C5;,&#x53D1;&#x73B0;node selector&#x5339;&#x914D;&#x5931;&#x8D25;&#x7684;&#x63D0;&#x793A;
[root@k8s-master01 ~]# kubectl describe pods pod-nodeselector -n dev
.......
Events:
  Type     Reason            Age        From               Message
  ----     ------            ----       ----               -------
  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available: 3 node(s) didn&apos;t match node selector.
</code></pre>
<h3 id="542-&#x4EB2;&#x548C;&#x6027;&#x8C03;&#x5EA6;">5.4.2 &#x4EB2;&#x548C;&#x6027;&#x8C03;&#x5EA6;</h3>
<p>&#x4E0A;&#x4E00;&#x8282;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E86;&#x4E24;&#x79CD;&#x5B9A;&#x5411;&#x8C03;&#x5EA6;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;Node&#xFF0C;&#x90A3;&#x4E48;Pod&#x5C06;&#x4E0D;&#x4F1A;&#x88AB;&#x8FD0;&#x884C;&#xFF0C;&#x5373;&#x4F7F;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x8FD8;&#x6709;&#x53EF;&#x7528;Node&#x5217;&#x8868;&#x4E5F;&#x4E0D;&#x884C;&#xFF0C;&#x8FD9;&#x5C31;&#x9650;&#x5236;&#x4E86;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x3002;</p>
<p>&#x57FA;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF0C;kubernetes&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x4EB2;&#x548C;&#x6027;&#x8C03;&#x5EA6;&#xFF08;Affinity&#xFF09;&#x3002;&#x5B83;&#x5728;NodeSelector&#x7684;&#x57FA;&#x7840;&#x4E4B;&#x4E0A;&#x7684;&#x8FDB;&#x884C;&#x4E86;&#x6269;&#x5C55;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x5B9E;&#x73B0;&#x4F18;&#x5148;&#x9009;&#x62E9;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;Node&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8C03;&#x5EA6;&#x5230;&#x4E0D;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x4F7F;&#x8C03;&#x5EA6;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x3002;</p>
<p>Affinity&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x4E09;&#x7C7B;&#xFF1A;</p>
<ul>
<li>nodeAffinity(node&#x4EB2;&#x548C;&#x6027;&#xFF09;: &#x4EE5;node&#x4E3A;&#x76EE;&#x6807;&#xFF0C;&#x89E3;&#x51B3;pod&#x53EF;&#x4EE5;&#x8C03;&#x5EA6;&#x5230;&#x54EA;&#x4E9B;node&#x7684;&#x95EE;&#x9898;</li>
<li>podAffinity(pod&#x4EB2;&#x548C;&#x6027;) : &#x4EE5;pod&#x4E3A;&#x76EE;&#x6807;&#xFF0C;&#x89E3;&#x51B3;pod&#x53EF;&#x4EE5;&#x548C;&#x54EA;&#x4E9B;&#x5DF2;&#x5B58;&#x5728;&#x7684;pod&#x90E8;&#x7F72;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x62D3;&#x6251;&#x57DF;&#x4E2D;&#x7684;&#x95EE;&#x9898;</li>
<li>podAntiAffinity(pod&#x53CD;&#x4EB2;&#x548C;&#x6027;) : &#x4EE5;pod&#x4E3A;&#x76EE;&#x6807;&#xFF0C;&#x89E3;&#x51B3;pod&#x4E0D;&#x80FD;&#x548C;&#x54EA;&#x4E9B;&#x5DF2;&#x5B58;&#x5728;pod&#x90E8;&#x7F72;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x62D3;&#x6251;&#x57DF;&#x4E2D;&#x7684;&#x95EE;&#x9898;</li>
</ul>
<blockquote>
<p>&#x5173;&#x4E8E;&#x4EB2;&#x548C;&#x6027;(&#x53CD;&#x4EB2;&#x548C;&#x6027;)&#x4F7F;&#x7528;&#x573A;&#x666F;&#x7684;&#x8BF4;&#x660E;&#xFF1A;</p>
<p><strong>&#x4EB2;&#x548C;&#x6027;</strong>&#xFF1A;&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x5E94;&#x7528;&#x9891;&#x7E41;&#x4EA4;&#x4E92;&#xFF0C;&#x90A3;&#x5C31;&#x6709;&#x5FC5;&#x8981;&#x5229;&#x7528;&#x4EB2;&#x548C;&#x6027;&#x8BA9;&#x4E24;&#x4E2A;&#x5E94;&#x7528;&#x7684;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x9760;&#x8FD1;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x56E0;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x800C;&#x5E26;&#x6765;&#x7684;&#x6027;&#x80FD;&#x635F;&#x8017;&#x3002;</p>
<p><strong>&#x53CD;&#x4EB2;&#x548C;&#x6027;</strong>&#xFF1A;&#x5F53;&#x5E94;&#x7528;&#x7684;&#x91C7;&#x7528;&#x591A;&#x526F;&#x672C;&#x90E8;&#x7F72;&#x65F6;&#xFF0C;&#x6709;&#x5FC5;&#x8981;&#x91C7;&#x7528;&#x53CD;&#x4EB2;&#x548C;&#x6027;&#x8BA9;&#x5404;&#x4E2A;&#x5E94;&#x7528;&#x5B9E;&#x4F8B;&#x6253;&#x6563;&#x5206;&#x5E03;&#x5728;&#x5404;&#x4E2A;node&#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x670D;&#x52A1;&#x7684;&#x9AD8;&#x53EF;&#x7528;&#x6027;&#x3002;</p>
</blockquote>
<p><strong>NodeAffinity</strong></p>
<p>&#x9996;&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E0B;<code>NodeAffinity</code>&#x7684;&#x53EF;&#x914D;&#x7F6E;&#x9879;&#xFF1A;</p>
<pre><code class="lang-shell">pod.spec.affinity.nodeAffinity
  requiredDuringSchedulingIgnoredDuringExecution  Node&#x8282;&#x70B9;&#x5FC5;&#x987B;&#x6EE1;&#x8DB3;&#x6307;&#x5B9A;&#x7684;&#x6240;&#x6709;&#x89C4;&#x5219;&#x624D;&#x53EF;&#x4EE5;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x786C;&#x9650;&#x5236;
    nodeSelectorTerms  &#x8282;&#x70B9;&#x9009;&#x62E9;&#x5217;&#x8868;
      matchFields   &#x6309;&#x8282;&#x70B9;&#x5B57;&#x6BB5;&#x5217;&#x51FA;&#x7684;&#x8282;&#x70B9;&#x9009;&#x62E9;&#x5668;&#x8981;&#x6C42;&#x5217;&#x8868;
      matchExpressions   &#x6309;&#x8282;&#x70B9;&#x6807;&#x7B7E;&#x5217;&#x51FA;&#x7684;&#x8282;&#x70B9;&#x9009;&#x62E9;&#x5668;&#x8981;&#x6C42;&#x5217;&#x8868;(&#x63A8;&#x8350;)
        key    &#x952E;
        values &#x503C;
        operator &#x5173;&#x7CFB;&#x7B26; &#x652F;&#x6301;Exists, DoesNotExist, In, NotIn, Gt, Lt
  preferredDuringSchedulingIgnoredDuringExecution &#x4F18;&#x5148;&#x8C03;&#x5EA6;&#x5230;&#x6EE1;&#x8DB3;&#x6307;&#x5B9A;&#x7684;&#x89C4;&#x5219;&#x7684;Node&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x8F6F;&#x9650;&#x5236; (&#x503E;&#x5411;)
    preference   &#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x9009;&#x62E9;&#x5668;&#x9879;&#xFF0C;&#x4E0E;&#x76F8;&#x5E94;&#x7684;&#x6743;&#x91CD;&#x76F8;&#x5173;&#x8054;
      matchFields   &#x6309;&#x8282;&#x70B9;&#x5B57;&#x6BB5;&#x5217;&#x51FA;&#x7684;&#x8282;&#x70B9;&#x9009;&#x62E9;&#x5668;&#x8981;&#x6C42;&#x5217;&#x8868;
      matchExpressions   &#x6309;&#x8282;&#x70B9;&#x6807;&#x7B7E;&#x5217;&#x51FA;&#x7684;&#x8282;&#x70B9;&#x9009;&#x62E9;&#x5668;&#x8981;&#x6C42;&#x5217;&#x8868;(&#x63A8;&#x8350;)
        key    &#x952E;
        values &#x503C;
        operator &#x5173;&#x7CFB;&#x7B26; &#x652F;&#x6301;In, NotIn, Exists, DoesNotExist, Gt, Lt
    weight &#x503E;&#x5411;&#x6743;&#x91CD;&#xFF0C;&#x5728;&#x8303;&#x56F4;1-100&#x3002;
</code></pre>
<pre><code class="lang-shell">&#x5173;&#x7CFB;&#x7B26;&#x7684;&#x4F7F;&#x7528;&#x8BF4;&#x660E;:

- matchExpressions:
  - key: nodeenv              # &#x5339;&#x914D;&#x5B58;&#x5728;&#x6807;&#x7B7E;&#x7684;key&#x4E3A;nodeenv&#x7684;&#x8282;&#x70B9;
    operator: Exists
  - key: nodeenv              # &#x5339;&#x914D;&#x6807;&#x7B7E;&#x7684;key&#x4E3A;nodeenv,&#x4E14;value&#x662F;&quot;xxx&quot;&#x6216;&quot;yyy&quot;&#x7684;&#x8282;&#x70B9;
    operator: In
    values: [&quot;xxx&quot;,&quot;yyy&quot;]
  - key: nodeenv              # &#x5339;&#x914D;&#x6807;&#x7B7E;&#x7684;key&#x4E3A;nodeenv,&#x4E14;value&#x5927;&#x4E8E;&quot;xxx&quot;&#x7684;&#x8282;&#x70B9;
    operator: Gt
    values: &quot;xxx&quot;
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#x9996;&#x5148;&#x6F14;&#x793A;&#x4E00;&#x4E0B;<code>requiredDuringSchedulingIgnoredDuringExecution</code> ,</p>
<p>&#x521B;&#x5EFA;pod-nodeaffinity-required.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-nodeaffinity-required
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  affinity:</span>  <span class="hljs-comment">#&#x4EB2;&#x548C;&#x6027;&#x8BBE;&#x7F6E;</span>
<span class="hljs-attr">    nodeAffinity:</span> <span class="hljs-comment">#&#x8BBE;&#x7F6E;node&#x4EB2;&#x548C;&#x6027;</span>
<span class="hljs-attr">      requiredDuringSchedulingIgnoredDuringExecution:</span> <span class="hljs-comment"># &#x786C;&#x9650;&#x5236;</span>
<span class="hljs-attr">        nodeSelectorTerms:</span>
<span class="hljs-attr">        - matchExpressions:</span> <span class="hljs-comment"># &#x5339;&#x914D;env&#x7684;&#x503C;&#x5728;[&quot;xxx&quot;,&quot;yyy&quot;]&#x4E2D;&#x7684;&#x6807;&#x7B7E;</span>
<span class="hljs-attr">          - key:</span> nodeenv
<span class="hljs-attr">            operator:</span> In
<span class="hljs-attr">            values:</span> [<span class="hljs-string">&quot;xxx&quot;</span>,<span class="hljs-string">&quot;yyy&quot;</span>]
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml
pod/pod-nodeaffinity-required created

# &#x67E5;&#x770B;pod&#x72B6;&#x6001; &#xFF08;&#x8FD0;&#x884C;&#x5931;&#x8D25;&#xFF09;
[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide
NAME                        READY   STATUS    RESTARTS   AGE   IP       NODE    ...... 
pod-nodeaffinity-required   0/1     Pending   0          16s   &lt;none&gt;   &lt;none&gt;  ......

# &#x67E5;&#x770B;Pod&#x7684;&#x8BE6;&#x60C5;
# &#x53D1;&#x73B0;&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#xFF0C;&#x63D0;&#x793A;node&#x9009;&#x62E9;&#x5931;&#x8D25;
[root@k8s-master01 ~]# kubectl describe pod pod-nodeaffinity-required -n dev
......
  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available: 3 node(s) didn&apos;t match node selector.
  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available: 3 node(s) didn&apos;t match node selector.

#&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x505C;&#x6B62;pod
[root@k8s-master01 ~]# kubectl delete -f pod-nodeaffinity-required.yaml
pod &quot;pod-nodeaffinity-required&quot; deleted

# &#x4FEE;&#x6539;&#x6587;&#x4EF6;&#xFF0C;&#x5C06;values: [&quot;xxx&quot;,&quot;yyy&quot;]------&gt; [&quot;pro&quot;,&quot;yyy&quot;]
[root@k8s-master01 ~]# vim pod-nodeaffinity-required.yaml

# &#x518D;&#x6B21;&#x542F;&#x52A8;
[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml
pod/pod-nodeaffinity-required created

# &#x6B64;&#x65F6;&#x67E5;&#x770B;&#xFF0C;&#x53D1;&#x73B0;&#x8C03;&#x5EA6;&#x6210;&#x529F;&#xFF0C;&#x5DF2;&#x7ECF;&#x5C06;pod&#x8C03;&#x5EA6;&#x5230;&#x4E86;node1&#x4E0A;
[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide
NAME                        READY   STATUS    RESTARTS   AGE   IP            NODE  ...... 
pod-nodeaffinity-required   1/1     Running   0          11s   10.244.1.89   node1 ......
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#x518D;&#x6F14;&#x793A;&#x4E00;&#x4E0B;<code>requiredDuringSchedulingIgnoredDuringExecution</code> ,</p>
<p>&#x521B;&#x5EFA;pod-nodeaffinity-preferred.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-nodeaffinity-preferred
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  affinity:</span>  <span class="hljs-comment">#&#x4EB2;&#x548C;&#x6027;&#x8BBE;&#x7F6E;</span>
<span class="hljs-attr">    nodeAffinity:</span> <span class="hljs-comment">#&#x8BBE;&#x7F6E;node&#x4EB2;&#x548C;&#x6027;</span>
<span class="hljs-attr">      preferredDuringSchedulingIgnoredDuringExecution:</span> <span class="hljs-comment"># &#x8F6F;&#x9650;&#x5236;</span>
<span class="hljs-attr">      - weight:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">        preference:</span>
<span class="hljs-attr">          matchExpressions:</span> <span class="hljs-comment"># &#x5339;&#x914D;env&#x7684;&#x503C;&#x5728;[&quot;xxx&quot;,&quot;yyy&quot;]&#x4E2D;&#x7684;&#x6807;&#x7B7E;(&#x5F53;&#x524D;&#x73AF;&#x5883;&#x6CA1;&#x6709;)</span>
<span class="hljs-attr">          - key:</span> nodeenv
<span class="hljs-attr">            operator:</span> In
<span class="hljs-attr">            values:</span> [<span class="hljs-string">&quot;xxx&quot;</span>,<span class="hljs-string">&quot;yyy&quot;</span>]
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-preferred.yaml
pod/pod-nodeaffinity-preferred created

# &#x67E5;&#x770B;pod&#x72B6;&#x6001; &#xFF08;&#x8FD0;&#x884C;&#x6210;&#x529F;&#xFF09;
[root@k8s-master01 ~]# kubectl get pod pod-nodeaffinity-preferred -n dev
NAME                         READY   STATUS    RESTARTS   AGE
pod-nodeaffinity-preferred   1/1     Running   0          40s
</code></pre>
<pre><code>NodeAffinity&#x89C4;&#x5219;&#x8BBE;&#x7F6E;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#xFF1A;
    1 &#x5982;&#x679C;&#x540C;&#x65F6;&#x5B9A;&#x4E49;&#x4E86;nodeSelector&#x548C;nodeAffinity&#xFF0C;&#x90A3;&#x4E48;&#x5FC5;&#x987B;&#x4E24;&#x4E2A;&#x6761;&#x4EF6;&#x90FD;&#x5F97;&#x5230;&#x6EE1;&#x8DB3;&#xFF0C;Pod&#x624D;&#x80FD;&#x8FD0;&#x884C;&#x5728;&#x6307;&#x5B9A;&#x7684;Node&#x4E0A;
    2 &#x5982;&#x679C;nodeAffinity&#x6307;&#x5B9A;&#x4E86;&#x591A;&#x4E2A;nodeSelectorTerms&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x9700;&#x8981;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x80FD;&#x591F;&#x5339;&#x914D;&#x6210;&#x529F;&#x5373;&#x53EF;
    3 &#x5982;&#x679C;&#x4E00;&#x4E2A;nodeSelectorTerms&#x4E2D;&#x6709;&#x591A;&#x4E2A;matchExpressions &#xFF0C;&#x5219;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x5FC5;&#x987B;&#x6EE1;&#x8DB3;&#x6240;&#x6709;&#x7684;&#x624D;&#x80FD;&#x5339;&#x914D;&#x6210;&#x529F;
    4 &#x5982;&#x679C;&#x4E00;&#x4E2A;pod&#x6240;&#x5728;&#x7684;Node&#x5728;Pod&#x8FD0;&#x884C;&#x671F;&#x95F4;&#x5176;&#x6807;&#x7B7E;&#x53D1;&#x751F;&#x4E86;&#x6539;&#x53D8;&#xFF0C;&#x4E0D;&#x518D;&#x7B26;&#x5408;&#x8BE5;Pod&#x7684;&#x8282;&#x70B9;&#x4EB2;&#x548C;&#x6027;&#x9700;&#x6C42;&#xFF0C;&#x5219;&#x7CFB;&#x7EDF;&#x5C06;&#x5FFD;&#x7565;&#x6B64;&#x53D8;&#x5316;
</code></pre><p><strong>PodAffinity</strong></p>
<p>PodAffinity&#x4E3B;&#x8981;&#x5B9E;&#x73B0;&#x4EE5;&#x8FD0;&#x884C;&#x7684;Pod&#x4E3A;&#x53C2;&#x7167;&#xFF0C;&#x5B9E;&#x73B0;&#x8BA9;&#x65B0;&#x521B;&#x5EFA;&#x7684;Pod&#x8DDF;&#x53C2;&#x7167;pod&#x5728;&#x4E00;&#x4E2A;&#x533A;&#x57DF;&#x7684;&#x529F;&#x80FD;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E0B;<code>PodAffinity</code>&#x7684;&#x53EF;&#x914D;&#x7F6E;&#x9879;&#xFF1A;</p>
<pre><code class="lang-shell">pod.spec.affinity.podAffinity
  requiredDuringSchedulingIgnoredDuringExecution  &#x786C;&#x9650;&#x5236;
    namespaces       &#x6307;&#x5B9A;&#x53C2;&#x7167;pod&#x7684;namespace
    topologyKey      &#x6307;&#x5B9A;&#x8C03;&#x5EA6;&#x4F5C;&#x7528;&#x57DF;
    labelSelector    &#x6807;&#x7B7E;&#x9009;&#x62E9;&#x5668;
      matchExpressions  &#x6309;&#x8282;&#x70B9;&#x6807;&#x7B7E;&#x5217;&#x51FA;&#x7684;&#x8282;&#x70B9;&#x9009;&#x62E9;&#x5668;&#x8981;&#x6C42;&#x5217;&#x8868;(&#x63A8;&#x8350;)
        key    &#x952E;
        values &#x503C;
        operator &#x5173;&#x7CFB;&#x7B26; &#x652F;&#x6301;In, NotIn, Exists, DoesNotExist.
      matchLabels    &#x6307;&#x591A;&#x4E2A;matchExpressions&#x6620;&#x5C04;&#x7684;&#x5185;&#x5BB9;
  preferredDuringSchedulingIgnoredDuringExecution &#x8F6F;&#x9650;&#x5236;
    podAffinityTerm  &#x9009;&#x9879;
      namespaces      
      topologyKey
      labelSelector
        matchExpressions  
          key    &#x952E;
          values &#x503C;
          operator
        matchLabels 
    weight &#x503E;&#x5411;&#x6743;&#x91CD;&#xFF0C;&#x5728;&#x8303;&#x56F4;1-100
</code></pre>
<pre><code>topologyKey&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x8C03;&#x5EA6;&#x65F6;&#x4F5C;&#x7528;&#x57DF;,&#x4F8B;&#x5982;:
    &#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E3A;kubernetes.io/hostname&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x4EE5;Node&#x8282;&#x70B9;&#x4E3A;&#x533A;&#x5206;&#x8303;&#x56F4;
    &#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E3A;beta.kubernetes.io/os,&#x5219;&#x4EE5;Node&#x8282;&#x70B9;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7C7B;&#x578B;&#x6765;&#x533A;&#x5206;
</code></pre><p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6F14;&#x793A;&#x4E0B;<code>requiredDuringSchedulingIgnoredDuringExecution</code>,</p>
<p>1&#xFF09;&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53C2;&#x7167;Pod&#xFF0C;pod-podaffinity-target.yaml&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-podaffinity-target
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    podenv:</span> pro <span class="hljs-comment">#&#x8BBE;&#x7F6E;&#x6807;&#x7B7E;</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  nodeName:</span> node1 <span class="hljs-comment"># &#x5C06;&#x76EE;&#x6807;pod&#x540D;&#x786E;&#x6307;&#x5B9A;&#x5230;node1&#x4E0A;</span>
</code></pre>
<pre><code class="lang-shell"># &#x542F;&#x52A8;&#x76EE;&#x6807;pod
[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yaml
pod/pod-podaffinity-target created

# &#x67E5;&#x770B;pod&#x72B6;&#x51B5;
[root@k8s-master01 ~]# kubectl get pods  pod-podaffinity-target -n dev
NAME                     READY   STATUS    RESTARTS   AGE
pod-podaffinity-target   1/1     Running   0          4s
</code></pre>
<p>2&#xFF09;&#x521B;&#x5EFA;pod-podaffinity-required.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-podaffinity-required
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  affinity:</span>  <span class="hljs-comment">#&#x4EB2;&#x548C;&#x6027;&#x8BBE;&#x7F6E;</span>
<span class="hljs-attr">    podAffinity:</span> <span class="hljs-comment">#&#x8BBE;&#x7F6E;pod&#x4EB2;&#x548C;&#x6027;</span>
<span class="hljs-attr">      requiredDuringSchedulingIgnoredDuringExecution:</span> <span class="hljs-comment"># &#x786C;&#x9650;&#x5236;</span>
<span class="hljs-attr">      - labelSelector:</span>
<span class="hljs-attr">          matchExpressions:</span> <span class="hljs-comment"># &#x5339;&#x914D;env&#x7684;&#x503C;&#x5728;[&quot;xxx&quot;,&quot;yyy&quot;]&#x4E2D;&#x7684;&#x6807;&#x7B7E;</span>
<span class="hljs-attr">          - key:</span> podenv
<span class="hljs-attr">            operator:</span> In
<span class="hljs-attr">            values:</span> [<span class="hljs-string">&quot;xxx&quot;</span>,<span class="hljs-string">&quot;yyy&quot;</span>]
<span class="hljs-attr">        topologyKey:</span> kubernetes.io/hostname
</code></pre>
<p>&#x4E0A;&#x9762;&#x914D;&#x7F6E;&#x8868;&#x8FBE;&#x7684;&#x610F;&#x601D;&#x662F;&#xFF1A;&#x65B0;Pod&#x5FC5;&#x987B;&#x8981;&#x4E0E;&#x62E5;&#x6709;&#x6807;&#x7B7E;nodeenv=xxx&#x6216;&#x8005;nodeenv=yyy&#x7684;pod&#x5728;&#x540C;&#x4E00;Node&#x4E0A;&#xFF0C;&#x663E;&#x7136;&#x73B0;&#x5728;&#x6CA1;&#x6709;&#x8FD9;&#x6837;pod&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x3002;</p>
<pre><code class="lang-shell"># &#x542F;&#x52A8;pod
[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml
pod/pod-podaffinity-required created

# &#x67E5;&#x770B;pod&#x72B6;&#x6001;&#xFF0C;&#x53D1;&#x73B0;&#x672A;&#x8FD0;&#x884C;
[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev
NAME                       READY   STATUS    RESTARTS   AGE
pod-podaffinity-required   0/1     Pending   0          9s

# &#x67E5;&#x770B;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;
[root@k8s-master01 ~]# kubectl describe pods pod-podaffinity-required  -n dev
......
Events:
  Type     Reason            Age        From               Message
  ----     ------            ----       ----               -------
  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available: 2 node(s) didn&apos;t match pod affinity rules, 1 node(s) had taints that the pod didn&apos;t tolerate.

# &#x63A5;&#x4E0B;&#x6765;&#x4FEE;&#x6539;  values: [&quot;xxx&quot;,&quot;yyy&quot;]-----&gt;values:[&quot;pro&quot;,&quot;yyy&quot;]
# &#x610F;&#x601D;&#x662F;&#xFF1A;&#x65B0;Pod&#x5FC5;&#x987B;&#x8981;&#x4E0E;&#x62E5;&#x6709;&#x6807;&#x7B7E;nodeenv=xxx&#x6216;&#x8005;nodeenv=yyy&#x7684;pod&#x5728;&#x540C;&#x4E00;Node&#x4E0A;
[root@k8s-master01 ~]# vim pod-podaffinity-required.yaml

# &#x7136;&#x540E;&#x91CD;&#x65B0;&#x521B;&#x5EFA;pod&#xFF0C;&#x67E5;&#x770B;&#x6548;&#x679C;
[root@k8s-master01 ~]# kubectl delete -f  pod-podaffinity-required.yaml
pod &quot;pod-podaffinity-required&quot; deleted
[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml
pod/pod-podaffinity-required created

# &#x53D1;&#x73B0;&#x6B64;&#x65F6;Pod&#x8FD0;&#x884C;&#x6B63;&#x5E38;
[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev
NAME                       READY   STATUS    RESTARTS   AGE   LABELS
pod-podaffinity-required   1/1     Running   0          6s    &lt;none&gt;
</code></pre>
<p>&#x5173;&#x4E8E;<code>PodAffinity</code>&#x7684; <code>preferredDuringSchedulingIgnoredDuringExecution</code>&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x6F14;&#x793A;&#x3002;</p>
<p><strong>PodAntiAffinity</strong></p>
<p>PodAntiAffinity&#x4E3B;&#x8981;&#x5B9E;&#x73B0;&#x4EE5;&#x8FD0;&#x884C;&#x7684;Pod&#x4E3A;&#x53C2;&#x7167;&#xFF0C;&#x8BA9;&#x65B0;&#x521B;&#x5EFA;&#x7684;Pod&#x8DDF;&#x53C2;&#x7167;pod&#x4E0D;&#x5728;&#x4E00;&#x4E2A;&#x533A;&#x57DF;&#x4E2D;&#x7684;&#x529F;&#x80FD;&#x3002;</p>
<p>&#x5B83;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;&#x548C;&#x9009;&#x9879;&#x8DDF;PodAffinty&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x505A;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#xFF0C;&#x76F4;&#x63A5;&#x505A;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x3002;</p>
<p>1&#xFF09;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x4E0A;&#x4E2A;&#x6848;&#x4F8B;&#x4E2D;&#x76EE;&#x6807;pod</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels
NAME                     READY   STATUS    RESTARTS   AGE     IP            NODE    LABELS
pod-podaffinity-required 1/1     Running   0          3m29s   10.244.1.38   node1   &lt;none&gt;     
pod-podaffinity-target   1/1     Running   0          9m25s   10.244.1.37   node1   podenv=pro
</code></pre>
<p>2&#xFF09;&#x521B;&#x5EFA;pod-podantiaffinity-required.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-podantiaffinity-required
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  affinity:</span>  <span class="hljs-comment">#&#x4EB2;&#x548C;&#x6027;&#x8BBE;&#x7F6E;</span>
<span class="hljs-attr">    podAntiAffinity:</span> <span class="hljs-comment">#&#x8BBE;&#x7F6E;pod&#x4EB2;&#x548C;&#x6027;</span>
<span class="hljs-attr">      requiredDuringSchedulingIgnoredDuringExecution:</span> <span class="hljs-comment"># &#x786C;&#x9650;&#x5236;</span>
<span class="hljs-attr">      - labelSelector:</span>
<span class="hljs-attr">          matchExpressions:</span> <span class="hljs-comment"># &#x5339;&#x914D;podenv&#x7684;&#x503C;&#x5728;[&quot;pro&quot;]&#x4E2D;&#x7684;&#x6807;&#x7B7E;</span>
<span class="hljs-attr">          - key:</span> podenv
<span class="hljs-attr">            operator:</span> In
<span class="hljs-attr">            values:</span> [<span class="hljs-string">&quot;pro&quot;</span>]
<span class="hljs-attr">        topologyKey:</span> kubernetes.io/hostname
</code></pre>
<p>&#x4E0A;&#x9762;&#x914D;&#x7F6E;&#x8868;&#x8FBE;&#x7684;&#x610F;&#x601D;&#x662F;&#xFF1A;&#x65B0;Pod&#x5FC5;&#x987B;&#x8981;&#x4E0E;&#x62E5;&#x6709;&#x6807;&#x7B7E;nodeenv=pro&#x7684;pod&#x4E0D;&#x5728;&#x540C;&#x4E00;Node&#x4E0A;&#xFF0C;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x3002;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f pod-podantiaffinity-required.yaml
pod/pod-podantiaffinity-required created

# &#x67E5;&#x770B;pod
# &#x53D1;&#x73B0;&#x8C03;&#x5EA6;&#x5230;&#x4E86;node2&#x4E0A;
[root@k8s-master01 ~]# kubectl get pods pod-podantiaffinity-required -n dev -o wide
NAME                           READY   STATUS    RESTARTS   AGE   IP            NODE   .. 
pod-podantiaffinity-required   1/1     Running   0          30s   10.244.1.96   node2  ..
</code></pre>
<h3 id="543-&#x6C61;&#x70B9;&#x548C;&#x5BB9;&#x5FCD;">5.4.3 &#x6C61;&#x70B9;&#x548C;&#x5BB9;&#x5FCD;</h3>
<p><strong>&#x6C61;&#x70B9;&#xFF08;Taints&#xFF09;</strong></p>
<p>&#x524D;&#x9762;&#x7684;&#x8C03;&#x5EA6;&#x65B9;&#x5F0F;&#x90FD;&#x662F;&#x7AD9;&#x5728;Pod&#x7684;&#x89D2;&#x5EA6;&#x4E0A;&#xFF0C;&#x901A;&#x8FC7;&#x5728;Pod&#x4E0A;&#x6DFB;&#x52A0;&#x5C5E;&#x6027;&#xFF0C;&#x6765;&#x786E;&#x5B9A;Pod&#x662F;&#x5426;&#x8981;&#x8C03;&#x5EA6;&#x5230;&#x6307;&#x5B9A;&#x7684;Node&#x4E0A;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x7AD9;&#x5728;Node&#x7684;&#x89D2;&#x5EA6;&#x4E0A;&#xFF0C;&#x901A;&#x8FC7;&#x5728;Node&#x4E0A;&#x6DFB;&#x52A0;<strong>&#x6C61;&#x70B9;</strong>&#x5C5E;&#x6027;&#xFF0C;&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x5141;&#x8BB8;Pod&#x8C03;&#x5EA6;&#x8FC7;&#x6765;&#x3002;</p>
<p>Node&#x88AB;&#x8BBE;&#x7F6E;&#x4E0A;&#x6C61;&#x70B9;&#x4E4B;&#x540E;&#x5C31;&#x548C;Pod&#x4E4B;&#x95F4;&#x5B58;&#x5728;&#x4E86;&#x4E00;&#x79CD;&#x76F8;&#x65A5;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x8FDB;&#x800C;&#x62D2;&#x7EDD;Pod&#x8C03;&#x5EA6;&#x8FDB;&#x6765;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x5C06;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;Pod&#x9A71;&#x9010;&#x51FA;&#x53BB;&#x3002;</p>
<p>&#x6C61;&#x70B9;&#x7684;&#x683C;&#x5F0F;&#x4E3A;&#xFF1A;<code>key=value:effect</code>, key&#x548C;value&#x662F;&#x6C61;&#x70B9;&#x7684;&#x6807;&#x7B7E;&#xFF0C;effect&#x63CF;&#x8FF0;&#x6C61;&#x70B9;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x652F;&#x6301;&#x5982;&#x4E0B;&#x4E09;&#x4E2A;&#x9009;&#x9879;&#xFF1A;</p>
<ul>
<li>PreferNoSchedule&#xFF1A;kubernetes&#x5C06;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x628A;Pod&#x8C03;&#x5EA6;&#x5230;&#x5177;&#x6709;&#x8BE5;&#x6C61;&#x70B9;&#x7684;Node&#x4E0A;&#xFF0C;&#x9664;&#x975E;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x53EF;&#x8C03;&#x5EA6;</li>
<li>NoSchedule&#xFF1A;kubernetes&#x5C06;&#x4E0D;&#x4F1A;&#x628A;Pod&#x8C03;&#x5EA6;&#x5230;&#x5177;&#x6709;&#x8BE5;&#x6C61;&#x70B9;&#x7684;Node&#x4E0A;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5F53;&#x524D;Node&#x4E0A;&#x5DF2;&#x5B58;&#x5728;&#x7684;Pod</li>
<li>NoExecute&#xFF1A;kubernetes&#x5C06;&#x4E0D;&#x4F1A;&#x628A;Pod&#x8C03;&#x5EA6;&#x5230;&#x5177;&#x6709;&#x8BE5;&#x6C61;&#x70B9;&#x7684;Node&#x4E0A;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x5C06;Node&#x4E0A;&#x5DF2;&#x5B58;&#x5728;&#x7684;Pod&#x9A71;&#x79BB;</li>
</ul>
<p><img src="Kubenetes.assets/image-20200605021831545.png" alt="image-20200605021606508"></p>
<p>&#x4F7F;&#x7528;kubectl&#x8BBE;&#x7F6E;&#x548C;&#x53BB;&#x9664;&#x6C61;&#x70B9;&#x7684;&#x547D;&#x4EE4;&#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-shell"># &#x8BBE;&#x7F6E;&#x6C61;&#x70B9;
kubectl taint nodes node1 key=value:effect

# &#x53BB;&#x9664;&#x6C61;&#x70B9;
kubectl taint nodes node1 key:effect-

# &#x53BB;&#x9664;&#x6240;&#x6709;&#x6C61;&#x70B9;
kubectl taint nodes node1 key-
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6F14;&#x793A;&#x4E0B;&#x6C61;&#x70B9;&#x7684;&#x6548;&#x679C;&#xFF1A;</p>
<ol>
<li>&#x51C6;&#x5907;&#x8282;&#x70B9;node1&#xFF08;&#x4E3A;&#x4E86;&#x6F14;&#x793A;&#x6548;&#x679C;&#x66F4;&#x52A0;&#x660E;&#x663E;&#xFF0C;&#x6682;&#x65F6;&#x505C;&#x6B62;node2&#x8282;&#x70B9;&#xFF09;</li>
<li>&#x4E3A;node1&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x6C61;&#x70B9;: <code>tag=heima:PreferNoSchedule</code>&#xFF1B;&#x7136;&#x540E;&#x521B;&#x5EFA;pod1( pod1 &#x53EF;&#x4EE5; )</li>
<li>&#x4FEE;&#x6539;&#x4E3A;node1&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x6C61;&#x70B9;: <code>tag=heima:NoSchedule</code>&#xFF1B;&#x7136;&#x540E;&#x521B;&#x5EFA;pod2( pod1 &#x6B63;&#x5E38; pod2 &#x5931;&#x8D25; )</li>
<li>&#x4FEE;&#x6539;&#x4E3A;node1&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x6C61;&#x70B9;: <code>tag=heima:NoExecute</code>&#xFF1B;&#x7136;&#x540E;&#x521B;&#x5EFA;pod3 ( 3&#x4E2A;pod&#x90FD;&#x5931;&#x8D25; )</li>
</ol>
<pre><code class="lang-shell"># &#x4E3A;node1&#x8BBE;&#x7F6E;&#x6C61;&#x70B9;(PreferNoSchedule)
[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:PreferNoSchedule

# &#x521B;&#x5EFA;pod1
[root@k8s-master01 ~]# kubectl run taint1 --image=nginx:1.17.1 -n dev
[root@k8s-master01 ~]# kubectl get pods -n dev -o wide
NAME                      READY   STATUS    RESTARTS   AGE     IP           NODE   
taint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1    

# &#x4E3A;node1&#x8BBE;&#x7F6E;&#x6C61;&#x70B9;(&#x53D6;&#x6D88;PreferNoSchedule&#xFF0C;&#x8BBE;&#x7F6E;NoSchedule)
[root@k8s-master01 ~]# kubectl taint nodes node1 tag:PreferNoSchedule-
[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoSchedule

# &#x521B;&#x5EFA;pod2
[root@k8s-master01 ~]# kubectl run taint2 --image=nginx:1.17.1 -n dev
[root@k8s-master01 ~]# kubectl get pods taint2 -n dev -o wide
NAME                      READY   STATUS    RESTARTS   AGE     IP            NODE
taint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1 
taint2-544694789-6zmlf    0/1     Pending   0          21s     &lt;none&gt;        &lt;none&gt;   

# &#x4E3A;node1&#x8BBE;&#x7F6E;&#x6C61;&#x70B9;(&#x53D6;&#x6D88;NoSchedule&#xFF0C;&#x8BBE;&#x7F6E;NoExecute)
[root@k8s-master01 ~]# kubectl taint nodes node1 tag:NoSchedule-
[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoExecute

# &#x521B;&#x5EFA;pod3
[root@k8s-master01 ~]# kubectl run taint3 --image=nginx:1.17.1 -n dev
[root@k8s-master01 ~]# kubectl get pods -n dev -o wide
NAME                      READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED 
taint1-7665f7fd85-htkmp   0/1     Pending   0          35s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;    
taint2-544694789-bn7wb    0/1     Pending   0          35s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;     
taint3-6d78dbd749-tktkq   0/1     Pending   0          6s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;
</code></pre>
<pre><code>&#x5C0F;&#x63D0;&#x793A;&#xFF1A;
    &#x4F7F;&#x7528;kubeadm&#x642D;&#x5EFA;&#x7684;&#x96C6;&#x7FA4;&#xFF0C;&#x9ED8;&#x8BA4;&#x5C31;&#x4F1A;&#x7ED9;master&#x8282;&#x70B9;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x6C61;&#x70B9;&#x6807;&#x8BB0;,&#x6240;&#x4EE5;pod&#x5C31;&#x4E0D;&#x4F1A;&#x8C03;&#x5EA6;&#x5230;master&#x8282;&#x70B9;&#x4E0A;.
</code></pre><p><strong>&#x5BB9;&#x5FCD;&#xFF08;Toleration&#xFF09;</strong></p>
<p>&#x4E0A;&#x9762;&#x4ECB;&#x7ECD;&#x4E86;&#x6C61;&#x70B9;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;node&#x4E0A;&#x6DFB;&#x52A0;&#x6C61;&#x70B9;&#x7528;&#x4E8E;&#x62D2;&#x7EDD;pod&#x8C03;&#x5EA6;&#x4E0A;&#x6765;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x5C31;&#x662F;&#x60F3;&#x5C06;&#x4E00;&#x4E2A;pod&#x8C03;&#x5EA6;&#x5230;&#x4E00;&#x4E2A;&#x6709;&#x6C61;&#x70B9;&#x7684;node&#x4E0A;&#x53BB;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x505A;&#x5462;&#xFF1F;&#x8FD9;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#x5230;<strong>&#x5BB9;&#x5FCD;</strong>&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200514095913741.png" alt="image-20200514095913741"></p>
<blockquote>
<p>&#x6C61;&#x70B9;&#x5C31;&#x662F;&#x62D2;&#x7EDD;&#xFF0C;&#x5BB9;&#x5FCD;&#x5C31;&#x662F;&#x5FFD;&#x7565;&#xFF0C;Node&#x901A;&#x8FC7;&#x6C61;&#x70B9;&#x62D2;&#x7EDD;pod&#x8C03;&#x5EA6;&#x4E0A;&#x53BB;&#xFF0C;Pod&#x901A;&#x8FC7;&#x5BB9;&#x5FCD;&#x5FFD;&#x7565;&#x62D2;&#x7EDD;</p>
</blockquote>
<p>&#x4E0B;&#x9762;&#x5148;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x6848;&#x4F8B;&#x770B;&#x4E0B;&#x6548;&#x679C;&#xFF1A;</p>
<ol>
<li>&#x4E0A;&#x4E00;&#x5C0F;&#x8282;&#xFF0C;&#x5DF2;&#x7ECF;&#x5728;node1&#x8282;&#x70B9;&#x4E0A;&#x6253;&#x4E0A;&#x4E86;<code>NoExecute</code>&#x7684;&#x6C61;&#x70B9;&#xFF0C;&#x6B64;&#x65F6;pod&#x662F;&#x8C03;&#x5EA6;&#x4E0D;&#x4E0A;&#x53BB;&#x7684;</li>
<li>&#x672C;&#x5C0F;&#x8282;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7ED9;pod&#x6DFB;&#x52A0;&#x5BB9;&#x5FCD;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5176;&#x8C03;&#x5EA6;&#x4E0A;&#x53BB;</li>
</ol>
<p>&#x521B;&#x5EFA;pod-toleration.yaml,&#x5185;&#x5BB9;&#x5982;&#x4E0B;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-toleration
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  tolerations:</span>      <span class="hljs-comment"># &#x6DFB;&#x52A0;&#x5BB9;&#x5FCD;</span>
<span class="hljs-attr">  - key:</span> <span class="hljs-string">&quot;tag&quot;</span>        <span class="hljs-comment"># &#x8981;&#x5BB9;&#x5FCD;&#x7684;&#x6C61;&#x70B9;&#x7684;key</span>
<span class="hljs-attr">    operator:</span> <span class="hljs-string">&quot;Equal&quot;</span> <span class="hljs-comment"># &#x64CD;&#x4F5C;&#x7B26;</span>
<span class="hljs-attr">    value:</span> <span class="hljs-string">&quot;heima&quot;</span>    <span class="hljs-comment"># &#x5BB9;&#x5FCD;&#x7684;&#x6C61;&#x70B9;&#x7684;value</span>
<span class="hljs-attr">    effect:</span> <span class="hljs-string">&quot;NoExecute&quot;</span>   <span class="hljs-comment"># &#x6DFB;&#x52A0;&#x5BB9;&#x5FCD;&#x7684;&#x89C4;&#x5219;&#xFF0C;&#x8FD9;&#x91CC;&#x5FC5;&#x987B;&#x548C;&#x6807;&#x8BB0;&#x7684;&#x6C61;&#x70B9;&#x89C4;&#x5219;&#x76F8;&#x540C;</span>
</code></pre>
<pre><code class="lang-shell"># &#x6DFB;&#x52A0;&#x5BB9;&#x5FCD;&#x4E4B;&#x524D;&#x7684;pod
[root@k8s-master01 ~]# kubectl get pods -n dev -o wide
NAME             READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED 
pod-toleration   0/1     Pending   0          3s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           

# &#x6DFB;&#x52A0;&#x5BB9;&#x5FCD;&#x4E4B;&#x540E;&#x7684;pod
[root@k8s-master01 ~]# kubectl get pods -n dev -o wide
NAME             READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED
pod-toleration   1/1     Running   0          3s    10.244.1.62   node1   &lt;none&gt;
</code></pre>
<p>&#x4E0B;&#x9762;&#x770B;&#x4E00;&#x4E0B;&#x5BB9;&#x5FCD;&#x7684;&#x8BE6;&#x7EC6;&#x914D;&#x7F6E;:</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl explain pod.spec.tolerations
......
FIELDS:
   key       # &#x5BF9;&#x5E94;&#x7740;&#x8981;&#x5BB9;&#x5FCD;&#x7684;&#x6C61;&#x70B9;&#x7684;&#x952E;&#xFF0C;&#x7A7A;&#x610F;&#x5473;&#x7740;&#x5339;&#x914D;&#x6240;&#x6709;&#x7684;&#x952E;
   value     # &#x5BF9;&#x5E94;&#x7740;&#x8981;&#x5BB9;&#x5FCD;&#x7684;&#x6C61;&#x70B9;&#x7684;&#x503C;
   operator  # key-value&#x7684;&#x8FD0;&#x7B97;&#x7B26;&#xFF0C;&#x652F;&#x6301;Equal&#x548C;Exists&#xFF08;&#x9ED8;&#x8BA4;&#xFF09;
   effect    # &#x5BF9;&#x5E94;&#x6C61;&#x70B9;&#x7684;effect&#xFF0C;&#x7A7A;&#x610F;&#x5473;&#x7740;&#x5339;&#x914D;&#x6240;&#x6709;&#x5F71;&#x54CD;
   tolerationSeconds   # &#x5BB9;&#x5FCD;&#x65F6;&#x95F4;, &#x5F53;effect&#x4E3A;NoExecute&#x65F6;&#x751F;&#x6548;&#xFF0C;&#x8868;&#x793A;pod&#x5728;Node&#x4E0A;&#x7684;&#x505C;&#x7559;&#x65F6;&#x95F4;
</code></pre>
<h1 id="6-pod&#x63A7;&#x5236;&#x5668;&#x8BE6;&#x89E3;">6. Pod&#x63A7;&#x5236;&#x5668;&#x8BE6;&#x89E3;</h1>
<h2 id="61-pod&#x63A7;&#x5236;&#x5668;&#x4ECB;&#x7ECD;">6.1 Pod&#x63A7;&#x5236;&#x5668;&#x4ECB;&#x7ECD;</h2>
<p>Pod&#x662F;kubernetes&#x7684;&#x6700;&#x5C0F;&#x7BA1;&#x7406;&#x5355;&#x5143;&#xFF0C;&#x5728;kubernetes&#x4E2D;&#xFF0C;&#x6309;&#x7167;pod&#x7684;&#x521B;&#x5EFA;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;&#xFF1A;</p>
<ul>
<li>&#x81EA;&#x4E3B;&#x5F0F;pod&#xFF1A;kubernetes&#x76F4;&#x63A5;&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;Pod&#xFF0C;&#x8FD9;&#x79CD;pod&#x5220;&#x9664;&#x540E;&#x5C31;&#x6CA1;&#x6709;&#x4E86;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x91CD;&#x5EFA;</li>
<li>&#x63A7;&#x5236;&#x5668;&#x521B;&#x5EFA;&#x7684;pod&#xFF1A;kubernetes&#x901A;&#x8FC7;&#x63A7;&#x5236;&#x5668;&#x521B;&#x5EFA;&#x7684;pod&#xFF0C;&#x8FD9;&#x79CD;pod&#x5220;&#x9664;&#x4E86;&#x4E4B;&#x540E;&#x8FD8;&#x4F1A;&#x81EA;&#x52A8;&#x91CD;&#x5EFA;</li>
</ul>
<blockquote>
<p><strong><code>&#x4EC0;&#x4E48;&#x662F;Pod&#x63A7;&#x5236;&#x5668;</code></strong></p>
<p>Pod&#x63A7;&#x5236;&#x5668;&#x662F;&#x7BA1;&#x7406;pod&#x7684;&#x4E2D;&#x95F4;&#x5C42;&#xFF0C;&#x4F7F;&#x7528;Pod&#x63A7;&#x5236;&#x5668;&#x4E4B;&#x540E;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x544A;&#x8BC9;Pod&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x60F3;&#x8981;&#x591A;&#x5C11;&#x4E2A;&#x4EC0;&#x4E48;&#x6837;&#x7684;Pod&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x5B83;&#x4F1A;&#x521B;&#x5EFA;&#x51FA;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;Pod&#x5E76;&#x786E;&#x4FDD;&#x6BCF;&#x4E00;&#x4E2A;Pod&#x8D44;&#x6E90;&#x5904;&#x4E8E;&#x7528;&#x6237;&#x671F;&#x671B;&#x7684;&#x76EE;&#x6807;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;Pod&#x8D44;&#x6E90;&#x5728;&#x8FD0;&#x884C;&#x4E2D;&#x51FA;&#x73B0;&#x6545;&#x969C;&#xFF0C;&#x5B83;&#x4F1A;&#x57FA;&#x4E8E;&#x6307;&#x5B9A;&#x7B56;&#x7565;&#x91CD;&#x65B0;&#x7F16;&#x6392;Pod&#x3002;</p>
</blockquote>
<p>&#x5728;kubernetes&#x4E2D;&#xFF0C;&#x6709;&#x5F88;&#x591A;&#x7C7B;&#x578B;&#x7684;pod&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x6BCF;&#x79CD;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x9002;&#x5408;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x6709;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#xFF1A;</p>
<ul>
<li>ReplicationController&#xFF1A;&#x6BD4;&#x8F83;&#x539F;&#x59CB;&#x7684;pod&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x5DF2;&#x7ECF;&#x88AB;&#x5E9F;&#x5F03;&#xFF0C;&#x7531;ReplicaSet&#x66FF;&#x4EE3;</li>
<li>ReplicaSet&#xFF1A;&#x4FDD;&#x8BC1;&#x526F;&#x672C;&#x6570;&#x91CF;&#x4E00;&#x76F4;&#x7EF4;&#x6301;&#x5728;&#x671F;&#x671B;&#x503C;&#xFF0C;&#x5E76;&#x652F;&#x6301;pod&#x6570;&#x91CF;&#x6269;&#x7F29;&#x5BB9;&#xFF0C;&#x955C;&#x50CF;&#x7248;&#x672C;&#x5347;&#x7EA7;</li>
<li>Deployment&#xFF1A;&#x901A;&#x8FC7;&#x63A7;&#x5236;ReplicaSet&#x6765;&#x63A7;&#x5236;Pod&#xFF0C;&#x5E76;&#x652F;&#x6301;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x3001;&#x56DE;&#x9000;&#x7248;&#x672C;</li>
<li>Horizontal Pod Autoscaler&#xFF1A;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x96C6;&#x7FA4;&#x8D1F;&#x8F7D;&#x81EA;&#x52A8;&#x6C34;&#x5E73;&#x8C03;&#x6574;Pod&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5B9E;&#x73B0;&#x524A;&#x5CF0;&#x586B;&#x8C37;</li>
<li>DaemonSet&#xFF1A;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6307;&#x5B9A;Node&#x4E0A;&#x8FD0;&#x884C;&#x4E14;&#x4EC5;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7C7B;&#x7684;&#x4EFB;&#x52A1;</li>
<li>Job&#xFF1A;&#x5B83;&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;pod&#x53EA;&#x8981;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x5C31;&#x7ACB;&#x5373;&#x9000;&#x51FA;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x542F;&#x6216;&#x91CD;&#x5EFA;&#xFF0C;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x6027;&#x4EFB;&#x52A1;</li>
<li>Cronjob&#xFF1A;&#x5B83;&#x521B;&#x5EFA;&#x7684;Pod&#x8D1F;&#x8D23;&#x5468;&#x671F;&#x6027;&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x6301;&#x7EED;&#x540E;&#x53F0;&#x8FD0;&#x884C;</li>
<li>StatefulSet&#xFF1A;&#x7BA1;&#x7406;&#x6709;&#x72B6;&#x6001;&#x5E94;&#x7528;</li>
</ul>
<h2 id="62-replicasetrs">6.2 ReplicaSet(RS)</h2>
<p>ReplicaSet&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;<strong>&#x4FDD;&#x8BC1;&#x4E00;&#x5B9A;&#x6570;&#x91CF;&#x7684;pod&#x6B63;&#x5E38;&#x8FD0;&#x884C;</strong>&#xFF0C;&#x5B83;&#x4F1A;&#x6301;&#x7EED;&#x76D1;&#x542C;&#x8FD9;&#x4E9B;Pod&#x7684;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x4E00;&#x65E6;Pod&#x53D1;&#x751F;&#x6545;&#x969C;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x542F;&#x6216;&#x91CD;&#x5EFA;&#x3002;&#x540C;&#x65F6;&#x5B83;&#x8FD8;&#x652F;&#x6301;&#x5BF9;pod&#x6570;&#x91CF;&#x7684;&#x6269;&#x7F29;&#x5BB9;&#x548C;&#x955C;&#x50CF;&#x7248;&#x672C;&#x7684;&#x5347;&#x964D;&#x7EA7;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200612005334159.png" alt="img"></p>
<p>ReplicaSet&#x7684;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1 <span class="hljs-comment"># &#x7248;&#x672C;&#x53F7;</span>
<span class="hljs-attr">kind:</span> ReplicaSet <span class="hljs-comment"># &#x7C7B;&#x578B;       </span>
<span class="hljs-attr">metadata:</span> <span class="hljs-comment"># &#x5143;&#x6570;&#x636E;</span>
<span class="hljs-attr">  name:</span> <span class="hljs-comment"># rs&#x540D;&#x79F0; </span>
<span class="hljs-attr">  namespace:</span> <span class="hljs-comment"># &#x6240;&#x5C5E;&#x547D;&#x540D;&#x7A7A;&#x95F4; </span>
<span class="hljs-attr">  labels:</span> <span class="hljs-comment">#&#x6807;&#x7B7E;</span>
<span class="hljs-attr">    controller:</span> rs
<span class="hljs-attr">spec:</span> <span class="hljs-comment"># &#x8BE6;&#x60C5;&#x63CF;&#x8FF0;</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># &#x526F;&#x672C;&#x6570;&#x91CF;</span>
<span class="hljs-attr">  selector:</span> <span class="hljs-comment"># &#x9009;&#x62E9;&#x5668;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6307;&#x5B9A;&#x8BE5;&#x63A7;&#x5236;&#x5668;&#x7BA1;&#x7406;&#x54EA;&#x4E9B;pod</span>
<span class="hljs-attr">    matchLabels:</span>      <span class="hljs-comment"># Labels&#x5339;&#x914D;&#x89C4;&#x5219;</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">    matchExpressions:</span> <span class="hljs-comment"># Expressions&#x5339;&#x914D;&#x89C4;&#x5219;</span>
<span class="hljs-bullet">      -</span> {key: app, operator: In, values: [nginx-pod]}
<span class="hljs-attr">  template:</span> <span class="hljs-comment"># &#x6A21;&#x677F;&#xFF0C;&#x5F53;&#x526F;&#x672C;&#x6570;&#x91CF;&#x4E0D;&#x8DB3;&#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x4E0B;&#x9762;&#x7684;&#x6A21;&#x677F;&#x521B;&#x5EFA;pod&#x526F;&#x672C;</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>
</code></pre>
<p>&#x5728;&#x8FD9;&#x91CC;&#x9762;&#xFF0C;&#x9700;&#x8981;&#x65B0;&#x4E86;&#x89E3;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x5C31;&#x662F;<code>spec</code>&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x9009;&#x9879;&#xFF1A;</p>
<ul>
<li><p>replicas&#xFF1A;&#x6307;&#x5B9A;&#x526F;&#x672C;&#x6570;&#x91CF;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5F53;&#x524D;rs&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;pod&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;1</p>
</li>
<li><p>selector&#xFF1A;&#x9009;&#x62E9;&#x5668;&#xFF0C;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5EFA;&#x7ACB;pod&#x63A7;&#x5236;&#x5668;&#x548C;pod&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x8054;&#x5173;&#x7CFB;&#xFF0C;&#x91C7;&#x7528;&#x7684;Label Selector&#x673A;&#x5236;</p>
<p>&#x5728;pod&#x6A21;&#x677F;&#x4E0A;&#x5B9A;&#x4E49;label&#xFF0C;&#x5728;&#x63A7;&#x5236;&#x5668;&#x4E0A;&#x5B9A;&#x4E49;&#x9009;&#x62E9;&#x5668;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8868;&#x660E;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x5668;&#x80FD;&#x7BA1;&#x7406;&#x54EA;&#x4E9B;pod&#x4E86;</p>
</li>
<li><p>template&#xFF1A;&#x6A21;&#x677F;&#xFF0C;&#x5C31;&#x662F;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x5668;&#x521B;&#x5EFA;pod&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6A21;&#x677F;&#x677F;&#xFF0C;&#x91CC;&#x9762;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x524D;&#x4E00;&#x7AE0;&#x5B66;&#x8FC7;&#x7684;pod&#x7684;&#x5B9A;&#x4E49;</p>
</li>
</ul>
<p><strong>&#x521B;&#x5EFA;ReplicaSet</strong></p>
<p>&#x521B;&#x5EFA;pc-replicaset.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> ReplicaSet   
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pc-replicaset
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span> 
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;rs
[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yaml
replicaset.apps/pc-replicaset created

# &#x67E5;&#x770B;rs
# DESIRED:&#x671F;&#x671B;&#x526F;&#x672C;&#x6570;&#x91CF;  
# CURRENT:&#x5F53;&#x524D;&#x526F;&#x672C;&#x6570;&#x91CF;  
# READY:&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x597D;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x526F;&#x672C;&#x6570;&#x91CF;
[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wide
NAME          DESIRED   CURRENT READY AGE   CONTAINERS   IMAGES             SELECTOR
pc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app=nginx-pod

# &#x67E5;&#x770B;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x5668;&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;pod
# &#x8FD9;&#x91CC;&#x53D1;&#x73B0;&#x63A7;&#x5236;&#x5668;&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;pod&#x7684;&#x540D;&#x79F0;&#x662F;&#x5728;&#x63A7;&#x5236;&#x5668;&#x540D;&#x79F0;&#x540E;&#x9762;&#x62FC;&#x63A5;&#x4E86;-xxxxx&#x968F;&#x673A;&#x7801;
[root@k8s-master01 ~]# kubectl get pod -n dev
NAME                          READY   STATUS    RESTARTS   AGE
pc-replicaset-6vmvt   1/1     Running   0          54s
pc-replicaset-fmb8f   1/1     Running   0          54s
pc-replicaset-snrk2   1/1     Running   0          54s
</code></pre>
<p><strong>&#x6269;&#x7F29;&#x5BB9;</strong></p>
<pre><code class="lang-shell"># &#x7F16;&#x8F91;rs&#x7684;&#x526F;&#x672C;&#x6570;&#x91CF;&#xFF0C;&#x4FEE;&#x6539;spec:replicas: 6&#x5373;&#x53EF;
[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev
replicaset.apps/pc-replicaset edited

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods -n dev
NAME                          READY   STATUS    RESTARTS   AGE
pc-replicaset-6vmvt   1/1     Running   0          114m
pc-replicaset-cftnp   1/1     Running   0          10s
pc-replicaset-fjlm6   1/1     Running   0          10s
pc-replicaset-fmb8f   1/1     Running   0          114m
pc-replicaset-s2whj   1/1     Running   0          10s
pc-replicaset-snrk2   1/1     Running   0          114m

# &#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x5B9E;&#x73B0;
# &#x4F7F;&#x7528;scale&#x547D;&#x4EE4;&#x5B9E;&#x73B0;&#x6269;&#x7F29;&#x5BB9;&#xFF0C; &#x540E;&#x9762;--replicas=n&#x76F4;&#x63A5;&#x6307;&#x5B9A;&#x76EE;&#x6807;&#x6570;&#x91CF;&#x5373;&#x53EF;
[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas=2 -n dev
replicaset.apps/pc-replicaset scaled

# &#x547D;&#x4EE4;&#x8FD0;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;&#x7ACB;&#x5373;&#x67E5;&#x770B;&#xFF0C;&#x53D1;&#x73B0;&#x5DF2;&#x7ECF;&#x6709;4&#x4E2A;&#x5F00;&#x59CB;&#x51C6;&#x5907;&#x9000;&#x51FA;&#x4E86;
[root@k8s-master01 ~]# kubectl get pods -n dev
NAME                       READY   STATUS        RESTARTS   AGE
pc-replicaset-6vmvt   0/1     Terminating   0          118m
pc-replicaset-cftnp   0/1     Terminating   0          4m17s
pc-replicaset-fjlm6   0/1     Terminating   0          4m17s
pc-replicaset-fmb8f   1/1     Running       0          118m
pc-replicaset-s2whj   0/1     Terminating   0          4m17s
pc-replicaset-snrk2   1/1     Running       0          118m

#&#x7A0D;&#x7B49;&#x7247;&#x523B;&#xFF0C;&#x5C31;&#x53EA;&#x5269;&#x4E0B;2&#x4E2A;&#x4E86;
[root@k8s-master01 ~]# kubectl get pods -n dev
NAME                       READY   STATUS    RESTARTS   AGE
pc-replicaset-fmb8f   1/1     Running   0          119m
pc-replicaset-snrk2   1/1     Running   0          119m
</code></pre>
<p><strong>&#x955C;&#x50CF;&#x5347;&#x7EA7;</strong></p>
<pre><code class="lang-shell"># &#x7F16;&#x8F91;rs&#x7684;&#x5BB9;&#x5668;&#x955C;&#x50CF; - image: nginx:1.17.2
[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev
replicaset.apps/pc-replicaset edited

# &#x518D;&#x6B21;&#x67E5;&#x770B;&#xFF0C;&#x53D1;&#x73B0;&#x955C;&#x50CF;&#x7248;&#x672C;&#x5DF2;&#x7ECF;&#x53D8;&#x66F4;&#x4E86;
[root@k8s-master01 ~]# kubectl get rs -n dev -o wide
NAME                DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES        ...
pc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...

# &#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x5B8C;&#x6210;&#x8FD9;&#x4E2A;&#x5DE5;&#x4F5C;
# kubectl set image rs rs&#x540D;&#x79F0; &#x5BB9;&#x5668;=&#x955C;&#x50CF;&#x7248;&#x672C; -n namespace
[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev
replicaset.apps/pc-replicaset image updated

# &#x518D;&#x6B21;&#x67E5;&#x770B;&#xFF0C;&#x53D1;&#x73B0;&#x955C;&#x50CF;&#x7248;&#x672C;&#x5DF2;&#x7ECF;&#x53D8;&#x66F4;&#x4E86;
[root@k8s-master01 ~]# kubectl get rs -n dev -o wide
NAME                 DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES            ...
pc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ...
</code></pre>
<p><strong>&#x5220;&#x9664;ReplicaSet</strong></p>
<pre><code class="lang-shell"># &#x4F7F;&#x7528;kubectl delete&#x547D;&#x4EE4;&#x4F1A;&#x5220;&#x9664;&#x6B64;RS&#x4EE5;&#x53CA;&#x5B83;&#x7BA1;&#x7406;&#x7684;Pod
# &#x5728;kubernetes&#x5220;&#x9664;RS&#x524D;&#xFF0C;&#x4F1A;&#x5C06;RS&#x7684;replicasclear&#x8C03;&#x6574;&#x4E3A;0&#xFF0C;&#x7B49;&#x5F85;&#x6240;&#x6709;&#x7684;Pod&#x88AB;&#x5220;&#x9664;&#x540E;&#xFF0C;&#x5728;&#x6267;&#x884C;RS&#x5BF9;&#x8C61;&#x7684;&#x5220;&#x9664;
[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev
replicaset.apps &quot;pc-replicaset&quot; deleted
[root@k8s-master01 ~]# kubectl get pod -n dev -o wide
No resources found in dev namespace.

# &#x5982;&#x679C;&#x5E0C;&#x671B;&#x4EC5;&#x4EC5;&#x5220;&#x9664;RS&#x5BF9;&#x8C61;&#xFF08;&#x4FDD;&#x7559;Pod&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;kubectl delete&#x547D;&#x4EE4;&#x65F6;&#x6DFB;&#x52A0;--cascade=false&#x9009;&#x9879;&#xFF08;&#x4E0D;&#x63A8;&#x8350;&#xFF09;&#x3002;
[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade=false
replicaset.apps &quot;pc-replicaset&quot; deleted
[root@k8s-master01 ~]# kubectl get pods -n dev
NAME                  READY   STATUS    RESTARTS   AGE
pc-replicaset-cl82j   1/1     Running   0          75s
pc-replicaset-dslhb   1/1     Running   0          75s

# &#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;yaml&#x76F4;&#x63A5;&#x5220;&#x9664;(&#x63A8;&#x8350;)
[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yaml
replicaset.apps &quot;pc-replicaset&quot; deleted
</code></pre>
<h2 id="63-deploymentdeploy">6.3 Deployment(Deploy)</h2>
<p>&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x670D;&#x52A1;&#x7F16;&#x6392;&#x7684;&#x95EE;&#x9898;&#xFF0C;kubernetes&#x5728;V1.2&#x7248;&#x672C;&#x5F00;&#x59CB;&#xFF0C;&#x5F15;&#x5165;&#x4E86;Deployment&#x63A7;&#x5236;&#x5668;&#x3002;&#x503C;&#x5F97;&#x4E00;&#x63D0;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x63A7;&#x5236;&#x5668;&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x7BA1;&#x7406;pod&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x7BA1;&#x7406;ReplicaSet&#x6765;&#x7B80;&#x4ECB;&#x7BA1;&#x7406;Pod&#xFF0C;&#x5373;&#xFF1A;Deployment&#x7BA1;&#x7406;ReplicaSet&#xFF0C;ReplicaSet&#x7BA1;&#x7406;Pod&#x3002;&#x6240;&#x4EE5;Deployment&#x6BD4;ReplicaSet&#x529F;&#x80FD;&#x66F4;&#x52A0;&#x5F3A;&#x5927;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200612005524778.png" alt="img"></p>
<p>Deployment&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x6709;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#xFF1A;</p>
<ul>
<li>&#x652F;&#x6301;ReplicaSet&#x7684;&#x6240;&#x6709;&#x529F;&#x80FD;</li>
<li>&#x652F;&#x6301;&#x53D1;&#x5E03;&#x7684;&#x505C;&#x6B62;&#x3001;&#x7EE7;&#x7EED;</li>
<li>&#x652F;&#x6301;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x548C;&#x56DE;&#x6EDA;&#x7248;&#x672C;</li>
</ul>
<p>Deployment&#x7684;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1 <span class="hljs-comment"># &#x7248;&#x672C;&#x53F7;</span>
<span class="hljs-attr">kind:</span> Deployment <span class="hljs-comment"># &#x7C7B;&#x578B;       </span>
<span class="hljs-attr">metadata:</span> <span class="hljs-comment"># &#x5143;&#x6570;&#x636E;</span>
<span class="hljs-attr">  name:</span> <span class="hljs-comment"># rs&#x540D;&#x79F0; </span>
<span class="hljs-attr">  namespace:</span> <span class="hljs-comment"># &#x6240;&#x5C5E;&#x547D;&#x540D;&#x7A7A;&#x95F4; </span>
<span class="hljs-attr">  labels:</span> <span class="hljs-comment">#&#x6807;&#x7B7E;</span>
<span class="hljs-attr">    controller:</span> deploy
<span class="hljs-attr">spec:</span> <span class="hljs-comment"># &#x8BE6;&#x60C5;&#x63CF;&#x8FF0;</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># &#x526F;&#x672C;&#x6570;&#x91CF;</span>
<span class="hljs-attr">  revisionHistoryLimit:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># &#x4FDD;&#x7559;&#x5386;&#x53F2;&#x7248;&#x672C;</span>
<span class="hljs-attr">  paused:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># &#x6682;&#x505C;&#x90E8;&#x7F72;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;false</span>
<span class="hljs-attr">  progressDeadlineSeconds:</span> <span class="hljs-number">600</span> <span class="hljs-comment"># &#x90E8;&#x7F72;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF08;s&#xFF09;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;600</span>
<span class="hljs-attr">  strategy:</span> <span class="hljs-comment"># &#x7B56;&#x7565;</span>
<span class="hljs-attr">    type:</span> RollingUpdate <span class="hljs-comment"># &#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x7B56;&#x7565;</span>
<span class="hljs-attr">    rollingUpdate:</span> <span class="hljs-comment"># &#x6EDA;&#x52A8;&#x66F4;&#x65B0;</span>
<span class="hljs-attr">      maxSurge:</span> <span class="hljs-number">30</span>% <span class="hljs-comment"># &#x6700;&#x5927;&#x989D;&#x5916;&#x53EF;&#x4EE5;&#x5B58;&#x5728;&#x7684;&#x526F;&#x672C;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x4E3A;&#x767E;&#x5206;&#x6BD4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;&#x6574;&#x6570;</span>
<span class="hljs-attr">      maxUnavailable:</span> <span class="hljs-number">30</span>% <span class="hljs-comment"># &#x6700;&#x5927;&#x4E0D;&#x53EF;&#x7528;&#x72B6;&#x6001;&#x7684; Pod &#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x4E3A;&#x767E;&#x5206;&#x6BD4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;&#x6574;&#x6570;</span>
<span class="hljs-attr">  selector:</span> <span class="hljs-comment"># &#x9009;&#x62E9;&#x5668;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6307;&#x5B9A;&#x8BE5;&#x63A7;&#x5236;&#x5668;&#x7BA1;&#x7406;&#x54EA;&#x4E9B;pod</span>
<span class="hljs-attr">    matchLabels:</span>      <span class="hljs-comment"># Labels&#x5339;&#x914D;&#x89C4;&#x5219;</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">    matchExpressions:</span> <span class="hljs-comment"># Expressions&#x5339;&#x914D;&#x89C4;&#x5219;</span>
<span class="hljs-bullet">      -</span> {key: app, operator: In, values: [nginx-pod]}
<span class="hljs-attr">  template:</span> <span class="hljs-comment"># &#x6A21;&#x677F;&#xFF0C;&#x5F53;&#x526F;&#x672C;&#x6570;&#x91CF;&#x4E0D;&#x8DB3;&#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x4E0B;&#x9762;&#x7684;&#x6A21;&#x677F;&#x521B;&#x5EFA;pod&#x526F;&#x672C;</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>
</code></pre>
<p><strong>&#x521B;&#x5EFA;deployment</strong></p>
<p>&#x521B;&#x5EFA;pc-deployment.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment      
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pc-deployment
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span> 
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;deployment
[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record=true
deployment.apps/pc-deployment created

# &#x67E5;&#x770B;deployment
# UP-TO-DATE &#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;pod&#x7684;&#x6570;&#x91CF;
# AVAILABLE  &#x5F53;&#x524D;&#x53EF;&#x7528;&#x7684;pod&#x7684;&#x6570;&#x91CF;
[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
pc-deployment   3/3     3            3           15s

# &#x67E5;&#x770B;rs
# &#x53D1;&#x73B0;rs&#x7684;&#x540D;&#x79F0;&#x662F;&#x5728;&#x539F;&#x6765;deployment&#x7684;&#x540D;&#x5B57;&#x540E;&#x9762;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;10&#x4F4D;&#x6570;&#x7684;&#x968F;&#x673A;&#x4E32;
[root@k8s-master01 ~]# kubectl get rs -n dev
NAME                       DESIRED   CURRENT   READY   AGE
pc-deployment-6696798b78   3         3         3       23s

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods -n dev
NAME                             READY   STATUS    RESTARTS   AGE
pc-deployment-6696798b78-d2c8n   1/1     Running   0          107s
pc-deployment-6696798b78-smpvp   1/1     Running   0          107s
pc-deployment-6696798b78-wvjd8   1/1     Running   0          107s
</code></pre>
<p><strong>&#x6269;&#x7F29;&#x5BB9;</strong></p>
<pre><code class="lang-shell"># &#x53D8;&#x66F4;&#x526F;&#x672C;&#x6570;&#x91CF;&#x4E3A;5&#x4E2A;
[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas=5  -n dev
deployment.apps/pc-deployment scaled

# &#x67E5;&#x770B;deployment
[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
pc-deployment   5/5     5            5           2m

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]#  kubectl get pods -n dev
NAME                             READY   STATUS    RESTARTS   AGE
pc-deployment-6696798b78-d2c8n   1/1     Running   0          4m19s
pc-deployment-6696798b78-jxmdq   1/1     Running   0          94s
pc-deployment-6696798b78-mktqv   1/1     Running   0          93s
pc-deployment-6696798b78-smpvp   1/1     Running   0          4m19s
pc-deployment-6696798b78-wvjd8   1/1     Running   0          4m19s

# &#x7F16;&#x8F91;deployment&#x7684;&#x526F;&#x672C;&#x6570;&#x91CF;&#xFF0C;&#x4FEE;&#x6539;spec:replicas: 4&#x5373;&#x53EF;
[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n dev
deployment.apps/pc-deployment edited

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods -n dev
NAME                             READY   STATUS    RESTARTS   AGE
pc-deployment-6696798b78-d2c8n   1/1     Running   0          5m23s
pc-deployment-6696798b78-jxmdq   1/1     Running   0          2m38s
pc-deployment-6696798b78-smpvp   1/1     Running   0          5m23s
pc-deployment-6696798b78-wvjd8   1/1     Running   0          5m23s
</code></pre>
<p><strong>&#x955C;&#x50CF;&#x66F4;&#x65B0;</strong></p>
<p>deployment&#x652F;&#x6301;&#x4E24;&#x79CD;&#x66F4;&#x65B0;&#x7B56;&#x7565;:<code>&#x91CD;&#x5EFA;&#x66F4;&#x65B0;</code>&#x548C;<code>&#x6EDA;&#x52A8;&#x66F4;&#x65B0;</code>,&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>strategy</code>&#x6307;&#x5B9A;&#x7B56;&#x7565;&#x7C7B;&#x578B;,&#x652F;&#x6301;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;:</p>
<pre><code class="lang-yaml">strategy&#xFF1A;&#x6307;&#x5B9A;&#x65B0;&#x7684;Pod&#x66FF;&#x6362;&#x65E7;&#x7684;Pod&#x7684;&#x7B56;&#x7565;&#xFF0C; &#x652F;&#x6301;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#xFF1A;
  type&#xFF1A;&#x6307;&#x5B9A;&#x7B56;&#x7565;&#x7C7B;&#x578B;&#xFF0C;&#x652F;&#x6301;&#x4E24;&#x79CD;&#x7B56;&#x7565;
    Recreate&#xFF1A;&#x5728;&#x521B;&#x5EFA;&#x51FA;&#x65B0;&#x7684;Pod&#x4E4B;&#x524D;&#x4F1A;&#x5148;&#x6740;&#x6389;&#x6240;&#x6709;&#x5DF2;&#x5B58;&#x5728;&#x7684;Pod
    RollingUpdate&#xFF1A;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#xFF0C;&#x5C31;&#x662F;&#x6740;&#x6B7B;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5C31;&#x542F;&#x52A8;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5728;&#x66F4;&#x65B0;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5B58;&#x5728;&#x4E24;&#x4E2A;&#x7248;&#x672C;Pod
  rollingUpdate&#xFF1A;&#x5F53;type&#x4E3A;RollingUpdate&#x65F6;&#x751F;&#x6548;&#xFF0C;&#x7528;&#x4E8E;&#x4E3A;RollingUpdate&#x8BBE;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x652F;&#x6301;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#xFF1A;
    maxUnavailable&#xFF1A;&#x7528;&#x6765;&#x6307;&#x5B9A;&#x5728;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E0D;&#x53EF;&#x7528;Pod&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<span class="hljs-number">25</span>%&#x3002;
    maxSurge&#xFF1A; &#x7528;&#x6765;&#x6307;&#x5B9A;&#x5728;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x4EE5;&#x8D85;&#x8FC7;&#x671F;&#x671B;&#x7684;Pod&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<span class="hljs-number">25</span>%&#x3002;
</code></pre>
<p>&#x91CD;&#x5EFA;&#x66F4;&#x65B0;</p>
<p>1) &#x7F16;&#x8F91;pc-deployment.yaml,&#x5728;spec&#x8282;&#x70B9;&#x4E0B;&#x6DFB;&#x52A0;&#x66F4;&#x65B0;&#x7B56;&#x7565;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">spec:</span>
<span class="hljs-attr">  strategy:</span> <span class="hljs-comment"># &#x7B56;&#x7565;</span>
<span class="hljs-attr">    type:</span> Recreate <span class="hljs-comment"># &#x91CD;&#x5EFA;&#x66F4;&#x65B0;</span>
</code></pre>
<p>2) &#x521B;&#x5EFA;deploy&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;</p>
<pre><code class="lang-shell"># &#x53D8;&#x66F4;&#x955C;&#x50CF;
[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev
deployment.apps/pc-deployment image updated

# &#x89C2;&#x5BDF;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;
[root@k8s-master01 ~]#  kubectl get pods -n dev -w
NAME                             READY   STATUS    RESTARTS   AGE
pc-deployment-5d89bdfbf9-65qcw   1/1     Running   0          31s
pc-deployment-5d89bdfbf9-w5nzv   1/1     Running   0          31s
pc-deployment-5d89bdfbf9-xpt7w   1/1     Running   0          31s

pc-deployment-5d89bdfbf9-xpt7w   1/1     Terminating   0          41s
pc-deployment-5d89bdfbf9-65qcw   1/1     Terminating   0          41s
pc-deployment-5d89bdfbf9-w5nzv   1/1     Terminating   0          41s

pc-deployment-675d469f8b-grn8z   0/1     Pending       0          0s
pc-deployment-675d469f8b-hbl4v   0/1     Pending       0          0s
pc-deployment-675d469f8b-67nz2   0/1     Pending       0          0s

pc-deployment-675d469f8b-grn8z   0/1     ContainerCreating   0          0s
pc-deployment-675d469f8b-hbl4v   0/1     ContainerCreating   0          0s
pc-deployment-675d469f8b-67nz2   0/1     ContainerCreating   0          0s

pc-deployment-675d469f8b-grn8z   1/1     Running             0          1s
pc-deployment-675d469f8b-67nz2   1/1     Running             0          1s
pc-deployment-675d469f8b-hbl4v   1/1     Running             0          2s
</code></pre>
<p>&#x6EDA;&#x52A8;&#x66F4;&#x65B0;</p>
<p>1) &#x7F16;&#x8F91;pc-deployment.yaml,&#x5728;spec&#x8282;&#x70B9;&#x4E0B;&#x6DFB;&#x52A0;&#x66F4;&#x65B0;&#x7B56;&#x7565;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">spec:</span>
<span class="hljs-attr">  strategy:</span> <span class="hljs-comment"># &#x7B56;&#x7565;</span>
<span class="hljs-attr">    type:</span> RollingUpdate <span class="hljs-comment"># &#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x7B56;&#x7565;</span>
<span class="hljs-attr">    rollingUpdate:</span>
<span class="hljs-attr">      maxSurge:</span> <span class="hljs-number">25</span>% 
<span class="hljs-attr">      maxUnavailable:</span> <span class="hljs-number">25</span>%
</code></pre>
<p>2) &#x521B;&#x5EFA;deploy&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;</p>
<pre><code class="lang-shell"># &#x53D8;&#x66F4;&#x955C;&#x50CF;
[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev 
deployment.apps/pc-deployment image updated

# &#x89C2;&#x5BDF;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;
[root@k8s-master01 ~]# kubectl get pods -n dev -w
NAME                           READY   STATUS    RESTARTS   AGE
pc-deployment-c848d767-8rbzt   1/1     Running   0          31m
pc-deployment-c848d767-h4p68   1/1     Running   0          31m
pc-deployment-c848d767-hlmz4   1/1     Running   0          31m
pc-deployment-c848d767-rrqcn   1/1     Running   0          31m

pc-deployment-966bf7f44-226rx   0/1     Pending             0          0s
pc-deployment-966bf7f44-226rx   0/1     ContainerCreating   0          0s
pc-deployment-966bf7f44-226rx   1/1     Running             0          1s
pc-deployment-c848d767-h4p68    0/1     Terminating         0          34m

pc-deployment-966bf7f44-cnd44   0/1     Pending             0          0s
pc-deployment-966bf7f44-cnd44   0/1     ContainerCreating   0          0s
pc-deployment-966bf7f44-cnd44   1/1     Running             0          2s
pc-deployment-c848d767-hlmz4    0/1     Terminating         0          34m

pc-deployment-966bf7f44-px48p   0/1     Pending             0          0s
pc-deployment-966bf7f44-px48p   0/1     ContainerCreating   0          0s
pc-deployment-966bf7f44-px48p   1/1     Running             0          0s
pc-deployment-c848d767-8rbzt    0/1     Terminating         0          34m

pc-deployment-966bf7f44-dkmqp   0/1     Pending             0          0s
pc-deployment-966bf7f44-dkmqp   0/1     ContainerCreating   0          0s
pc-deployment-966bf7f44-dkmqp   1/1     Running             0          2s
pc-deployment-c848d767-rrqcn    0/1     Terminating         0          34m

# &#x81F3;&#x6B64;&#xFF0C;&#x65B0;&#x7248;&#x672C;&#x7684;pod&#x521B;&#x5EFA;&#x5B8C;&#x6BD5;&#xFF0C;&#x5C31;&#x7248;&#x672C;&#x7684;pod&#x9500;&#x6BC1;&#x5B8C;&#x6BD5;
# &#x4E2D;&#x95F4;&#x8FC7;&#x7A0B;&#x662F;&#x6EDA;&#x52A8;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8FB9;&#x9500;&#x6BC1;&#x8FB9;&#x521B;&#x5EFA;
</code></pre>
<p>&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x7684;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<p><img src="Kubenetes.assets/image-20200416140251491.png" alt="img"></p>
<p>&#x955C;&#x50CF;&#x66F4;&#x65B0;&#x4E2D;rs&#x7684;&#x53D8;&#x5316;</p>
<pre><code class="lang-shell"># &#x67E5;&#x770B;rs,&#x53D1;&#x73B0;&#x539F;&#x6765;&#x7684;rs&#x7684;&#x4F9D;&#x65E7;&#x5B58;&#x5728;&#xFF0C;&#x53EA;&#x662F;pod&#x6570;&#x91CF;&#x53D8;&#x4E3A;&#x4E86;0&#xFF0C;&#x800C;&#x540E;&#x53C8;&#x65B0;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;rs&#xFF0C;pod&#x6570;&#x91CF;&#x4E3A;4
# &#x5176;&#x5B9E;&#x8FD9;&#x5C31;&#x662F;deployment&#x80FD;&#x591F;&#x8FDB;&#x884C;&#x7248;&#x672C;&#x56DE;&#x9000;&#x7684;&#x5965;&#x5999;&#x6240;&#x5728;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;
[root@k8s-master01 ~]# kubectl get rs -n dev
NAME                       DESIRED   CURRENT   READY   AGE
pc-deployment-6696798b78   0         0         0       7m37s
pc-deployment-6696798b11   0         0         0       5m37s
pc-deployment-c848d76789   4         4         4       72s
</code></pre>
<p><strong>&#x7248;&#x672C;&#x56DE;&#x9000;</strong></p>
<p>deployment&#x652F;&#x6301;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x6682;&#x505C;&#x3001;&#x7EE7;&#x7EED;&#x529F;&#x80FD;&#x4EE5;&#x53CA;&#x7248;&#x672C;&#x56DE;&#x9000;&#x7B49;&#x8BF8;&#x591A;&#x529F;&#x80FD;&#xFF0C;&#x4E0B;&#x9762;&#x5177;&#x4F53;&#x6765;&#x770B;.</p>
<p>kubectl rollout&#xFF1A; &#x7248;&#x672C;&#x5347;&#x7EA7;&#x76F8;&#x5173;&#x529F;&#x80FD;&#xFF0C;&#x652F;&#x6301;&#x4E0B;&#x9762;&#x7684;&#x9009;&#x9879;&#xFF1A;</p>
<ul>
<li>status &#x663E;&#x793A;&#x5F53;&#x524D;&#x5347;&#x7EA7;&#x72B6;&#x6001;</li>
<li>history &#x663E;&#x793A; &#x5347;&#x7EA7;&#x5386;&#x53F2;&#x8BB0;&#x5F55;</li>
<li>pause &#x6682;&#x505C;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;</li>
<li>resume &#x7EE7;&#x7EED;&#x5DF2;&#x7ECF;&#x6682;&#x505C;&#x7684;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;</li>
<li>restart &#x91CD;&#x542F;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;</li>
<li>undo &#x56DE;&#x6EDA;&#x5230;&#x4E0A;&#x4E00;&#x7EA7;&#x7248;&#x672C;&#xFF08;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;--to-revision&#x56DE;&#x6EDA;&#x5230;&#x6307;&#x5B9A;&#x7248;&#x672C;&#xFF09;</li>
</ul>
<pre><code class="lang-shell"># &#x67E5;&#x770B;&#x5F53;&#x524D;&#x5347;&#x7EA7;&#x7248;&#x672C;&#x7684;&#x72B6;&#x6001;
[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev
deployment &quot;pc-deployment&quot; successfully rolled out

# &#x67E5;&#x770B;&#x5347;&#x7EA7;&#x5386;&#x53F2;&#x8BB0;&#x5F55;
[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev
deployment.apps/pc-deployment
REVISION  CHANGE-CAUSE
1         kubectl create --filename=pc-deployment.yaml --record=true
2         kubectl create --filename=pc-deployment.yaml --record=true
3         kubectl create --filename=pc-deployment.yaml --record=true
# &#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6709;&#x4E09;&#x6B21;&#x7248;&#x672C;&#x8BB0;&#x5F55;&#xFF0C;&#x8BF4;&#x660E;&#x5B8C;&#x6210;&#x8FC7;&#x4E24;&#x6B21;&#x5347;&#x7EA7;

# &#x7248;&#x672C;&#x56DE;&#x6EDA;
# &#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x4F7F;&#x7528;--to-revision=1&#x56DE;&#x6EDA;&#x5230;&#x4E86;1&#x7248;&#x672C;&#xFF0C; &#x5982;&#x679C;&#x7701;&#x7565;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#xFF0C;&#x5C31;&#x662F;&#x56DE;&#x9000;&#x5230;&#x4E0A;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x5C31;&#x662F;2&#x7248;&#x672C;
[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev
deployment.apps/pc-deployment rolled back

# &#x67E5;&#x770B;&#x53D1;&#x73B0;&#xFF0C;&#x901A;&#x8FC7;nginx&#x955C;&#x50CF;&#x7248;&#x672C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5230;&#x4E86;&#x7B2C;&#x4E00;&#x7248;
[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide
NAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         
pc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   

# &#x67E5;&#x770B;rs&#xFF0C;&#x53D1;&#x73B0;&#x7B2C;&#x4E00;&#x4E2A;rs&#x4E2D;&#x6709;4&#x4E2A;pod&#x8FD0;&#x884C;&#xFF0C;&#x540E;&#x9762;&#x4E24;&#x4E2A;&#x7248;&#x672C;&#x7684;rs&#x4E2D;pod&#x4E3A;&#x8FD0;&#x884C;
# &#x5176;&#x5B9E;deployment&#x4E4B;&#x6240;&#x4EE5;&#x53EF;&#x662F;&#x5B9E;&#x73B0;&#x7248;&#x672C;&#x7684;&#x56DE;&#x6EDA;&#xFF0C;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x8BB0;&#x5F55;&#x4E0B;&#x5386;&#x53F2;rs&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;
# &#x4E00;&#x65E6;&#x60F3;&#x56DE;&#x6EDA;&#x5230;&#x54EA;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x5F53;&#x524D;&#x7248;&#x672C;pod&#x6570;&#x91CF;&#x964D;&#x4E3A;0&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x56DE;&#x6EDA;&#x7248;&#x672C;&#x7684;pod&#x63D0;&#x5347;&#x4E3A;&#x76EE;&#x6807;&#x6570;&#x91CF;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;
[root@k8s-master01 ~]# kubectl get rs -n dev
NAME                       DESIRED   CURRENT   READY   AGE
pc-deployment-6696798b78   4         4         4       78m
pc-deployment-966bf7f44    0         0         0       37m
pc-deployment-c848d767     0         0         0       71m
</code></pre>
<p><strong>&#x91D1;&#x4E1D;&#x96C0;&#x53D1;&#x5E03;</strong></p>
<p>Deployment&#x63A7;&#x5236;&#x5668;&#x652F;&#x6301;&#x63A7;&#x5236;&#x66F4;&#x65B0;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x63A7;&#x5236;&#xFF0C;&#x5982;&#x201C;&#x6682;&#x505C;(pause)&#x201D;&#x6216;&#x201C;&#x7EE7;&#x7EED;(resume)&#x201D;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6709;&#x4E00;&#x6279;&#x65B0;&#x7684;Pod&#x8D44;&#x6E90;&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#x7ACB;&#x5373;&#x6682;&#x505C;&#x66F4;&#x65B0;&#x8FC7;&#x7A0B;&#xFF0C;&#x6B64;&#x65F6;&#xFF0C;&#x4EC5;&#x5B58;&#x5728;&#x4E00;&#x90E8;&#x5206;&#x65B0;&#x7248;&#x672C;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x4E3B;&#x4F53;&#x90E8;&#x5206;&#x8FD8;&#x662F;&#x65E7;&#x7684;&#x7248;&#x672C;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x518D;&#x7B5B;&#x9009;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x7684;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x8DEF;&#x7531;&#x5230;&#x65B0;&#x7248;&#x672C;&#x7684;Pod&#x5E94;&#x7528;&#xFF0C;&#x7EE7;&#x7EED;&#x89C2;&#x5BDF;&#x80FD;&#x5426;&#x7A33;&#x5B9A;&#x5730;&#x6309;&#x671F;&#x671B;&#x7684;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#x3002;&#x786E;&#x5B9A;&#x6CA1;&#x95EE;&#x9898;&#x4E4B;&#x540E;&#x518D;&#x7EE7;&#x7EED;&#x5B8C;&#x6210;&#x4F59;&#x4E0B;&#x7684;Pod&#x8D44;&#x6E90;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#xFF0C;&#x5426;&#x5219;&#x7ACB;&#x5373;&#x56DE;&#x6EDA;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;&#x91D1;&#x4E1D;&#x96C0;&#x53D1;&#x5E03;&#x3002;</p>
<pre><code class="lang-shell"># &#x66F4;&#x65B0;deployment&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5E76;&#x914D;&#x7F6E;&#x6682;&#x505C;deployment
[root@k8s-master01 ~]#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev &amp;&amp; kubectl rollout pause deployment pc-deployment  -n dev
deployment.apps/pc-deployment image updated
deployment.apps/pc-deployment paused

#&#x89C2;&#x5BDF;&#x66F4;&#x65B0;&#x72B6;&#x6001;
[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev&#x3000;
Waiting for deployment &quot;pc-deployment&quot; rollout to finish: 2 out of 4 new replicas have been updated...

# &#x76D1;&#x63A7;&#x66F4;&#x65B0;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5DF2;&#x7ECF;&#x65B0;&#x589E;&#x4E86;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x672A;&#x6309;&#x7167;&#x9884;&#x671F;&#x7684;&#x72B6;&#x6001;&#x53BB;&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x65E7;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x5C31;&#x662F;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x4E86;pause&#x6682;&#x505C;&#x547D;&#x4EE4;

[root@k8s-master01 ~]# kubectl get rs -n dev -o wide
NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         
pc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   
pc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   
pc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   
[root@k8s-master01 ~]# kubectl get pods -n dev
NAME                             READY   STATUS    RESTARTS   AGE
pc-deployment-5d89bdfbf9-rj8sq   1/1     Running   0          7m33s
pc-deployment-5d89bdfbf9-ttwgg   1/1     Running   0          7m35s
pc-deployment-5d89bdfbf9-v4wvc   1/1     Running   0          7m34s
pc-deployment-6c9f56fcfb-996rt   1/1     Running   0          3m31s
pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          3m31s

# &#x786E;&#x4FDD;&#x66F4;&#x65B0;&#x7684;pod&#x6CA1;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x7EE7;&#x7EED;&#x66F4;&#x65B0;
[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev
deployment.apps/pc-deployment resumed

# &#x67E5;&#x770B;&#x6700;&#x540E;&#x7684;&#x66F4;&#x65B0;&#x60C5;&#x51B5;
[root@k8s-master01 ~]# kubectl get rs -n dev -o wide
NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         
pc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   
pc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   
pc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   

[root@k8s-master01 ~]# kubectl get pods -n dev
NAME                             READY   STATUS    RESTARTS   AGE
pc-deployment-6c9f56fcfb-7bfwh   1/1     Running   0          37s
pc-deployment-6c9f56fcfb-996rt   1/1     Running   0          5m27s
pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          5m27s
pc-deployment-6c9f56fcfb-rf84v   1/1     Running   0          37s
</code></pre>
<p><strong>&#x5220;&#x9664;Deployment</strong></p>
<pre><code class="lang-shell"># &#x5220;&#x9664;deployment&#xFF0C;&#x5176;&#x4E0B;&#x7684;rs&#x548C;pod&#x4E5F;&#x5C06;&#x88AB;&#x5220;&#x9664;
[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yaml
deployment.apps &quot;pc-deployment&quot; deleted
</code></pre>
<h2 id="64-horizontal-pod-autoscalerhpa">6.4 Horizontal Pod Autoscaler(HPA)</h2>
<p>&#x5728;&#x524D;&#x9762;&#x7684;&#x8BFE;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x901A;&#x8FC7;&#x624B;&#x5DE5;&#x6267;&#x884C;<code>kubectl scale</code>&#x547D;&#x4EE4;&#x5B9E;&#x73B0;Pod&#x6269;&#x5BB9;&#x6216;&#x7F29;&#x5BB9;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x663E;&#x7136;&#x4E0D;&#x7B26;&#x5408;Kubernetes&#x7684;&#x5B9A;&#x4F4D;&#x76EE;&#x6807;--&#x81EA;&#x52A8;&#x5316;&#x3001;&#x667A;&#x80FD;&#x5316;&#x3002; Kubernetes&#x671F;&#x671B;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x901A;&#x8FC7;&#x76D1;&#x6D4B;Pod&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x5B9E;&#x73B0;pod&#x6570;&#x91CF;&#x7684;&#x81EA;&#x52A8;&#x8C03;&#x6574;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x4EA7;&#x751F;&#x4E86;Horizontal Pod Autoscaler&#xFF08;HPA&#xFF09;&#x8FD9;&#x79CD;&#x63A7;&#x5236;&#x5668;&#x3002;</p>
<p>HPA&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x6BCF;&#x4E2A;Pod&#x5229;&#x7528;&#x7387;&#xFF0C;&#x7136;&#x540E;&#x548C;HPA&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x6307;&#x6807;&#x8FDB;&#x884C;&#x5BF9;&#x6BD4;&#xFF0C;&#x540C;&#x65F6;&#x8BA1;&#x7B97;&#x51FA;&#x9700;&#x8981;&#x4F38;&#x7F29;&#x7684;&#x5177;&#x4F53;&#x503C;&#xFF0C;&#x6700;&#x540E;&#x5B9E;&#x73B0;Pod&#x7684;&#x6570;&#x91CF;&#x7684;&#x8C03;&#x6574;&#x3002;&#x5176;&#x5B9E;HPA&#x4E0E;&#x4E4B;&#x524D;&#x7684;Deployment&#x4E00;&#x6837;&#xFF0C;&#x4E5F;&#x5C5E;&#x4E8E;&#x4E00;&#x79CD;Kubernetes&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x8FFD;&#x8E2A;&#x5206;&#x6790;RC&#x63A7;&#x5236;&#x7684;&#x6240;&#x6709;&#x76EE;&#x6807;Pod&#x7684;&#x8D1F;&#x8F7D;&#x53D8;&#x5316;&#x60C5;&#x51B5;&#xFF0C;&#x6765;&#x786E;&#x5B9A;&#x662F;&#x5426;&#x9700;&#x8981;&#x9488;&#x5BF9;&#x6027;&#x5730;&#x8C03;&#x6574;&#x76EE;&#x6807;Pod&#x7684;&#x526F;&#x672C;&#x6570;&#xFF0C;&#x8FD9;&#x662F;HPA&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200608155858271.png" alt="img"></p>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x505A;&#x4E00;&#x4E2A;&#x5B9E;&#x9A8C;</p>
<p><strong>1 &#x5B89;&#x88C5;metrics-server</strong></p>
<p>metrics-server&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x6536;&#x96C6;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</p>
<pre><code class="lang-shell"># &#x5B89;&#x88C5;git
[root@k8s-master01 ~]# yum install git -y
# &#x83B7;&#x53D6;metrics-server, &#x6CE8;&#x610F;&#x4F7F;&#x7528;&#x7684;&#x7248;&#x672C;
[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server
# &#x4FEE;&#x6539;deployment, &#x6CE8;&#x610F;&#x4FEE;&#x6539;&#x7684;&#x662F;&#x955C;&#x50CF;&#x548C;&#x521D;&#x59CB;&#x5316;&#x53C2;&#x6570;
[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/
[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml
&#x6309;&#x56FE;&#x4E2D;&#x6DFB;&#x52A0;&#x4E0B;&#x9762;&#x9009;&#x9879;
hostNetwork: true
image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6
args:
- --kubelet-insecure-tls
- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP
</code></pre>
<p><img src="Kubenetes.assets/image-20200608163326496.png" alt="image-20200608163326496"></p>
<pre><code class="lang-shell"># &#x5B89;&#x88C5;metrics-server
[root@k8s-master01 1.8+]# kubectl apply -f ./

# &#x67E5;&#x770B;pod&#x8FD0;&#x884C;&#x60C5;&#x51B5;
[root@k8s-master01 1.8+]# kubectl get pod -n kube-system
metrics-server-6b976979db-2xwbj   1/1     Running   0          90s

# &#x4F7F;&#x7528;kubectl top node &#x67E5;&#x770B;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x60C5;&#x51B5;
[root@k8s-master01 1.8+]# kubectl top node
NAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
k8s-master01   289m         14%    1582Mi          54%       
k8s-node01     81m          4%     1195Mi          40%       
k8s-node02     72m          3%     1211Mi          41%  
[root@k8s-master01 1.8+]# kubectl top pod -n kube-system
NAME                              CPU(cores)   MEMORY(bytes)
coredns-6955765f44-7ptsb          3m           9Mi
coredns-6955765f44-vcwr5          3m           8Mi
etcd-master                       14m          145Mi
...
# &#x81F3;&#x6B64;,metrics-server&#x5B89;&#x88C5;&#x5B8C;&#x6210;
</code></pre>
<p><strong>2 &#x51C6;&#x5907;deployment&#x548C;servie</strong></p>
<p>&#x521B;&#x5EFA;pc-hpa-pod.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  strategy:</span> <span class="hljs-comment"># &#x7B56;&#x7565;</span>
<span class="hljs-attr">    type:</span> RollingUpdate <span class="hljs-comment"># &#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x7B56;&#x7565;</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">        resources:</span> <span class="hljs-comment"># &#x8D44;&#x6E90;&#x914D;&#x989D;</span>
<span class="hljs-attr">          limits:</span>  <span class="hljs-comment"># &#x9650;&#x5236;&#x8D44;&#x6E90;&#xFF08;&#x4E0A;&#x9650;&#xFF09;</span>
<span class="hljs-attr">            cpu:</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-comment"># CPU&#x9650;&#x5236;&#xFF0C;&#x5355;&#x4F4D;&#x662F;core&#x6570;</span>
<span class="hljs-attr">          requests:</span> <span class="hljs-comment"># &#x8BF7;&#x6C42;&#x8D44;&#x6E90;&#xFF08;&#x4E0B;&#x9650;&#xFF09;</span>
<span class="hljs-attr">            cpu:</span> <span class="hljs-string">&quot;100m&quot;</span>  <span class="hljs-comment"># CPU&#x9650;&#x5236;&#xFF0C;&#x5355;&#x4F4D;&#x662F;core&#x6570;</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;service
[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=NodePort --port=80 -n dev
</code></pre>
<pre><code class="lang-shell"># &#x67E5;&#x770B;
[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev
NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx   1/1     1            1           47s

NAME                         READY   STATUS    RESTARTS   AGE
pod/nginx-7df9756ccc-bh8dr   1/1     Running   0          47s

NAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/nginx   NodePort   10.101.18.29   &lt;none&gt;        80:31830/TCP   35s
</code></pre>
<p><strong>3 &#x90E8;&#x7F72;HPA</strong></p>
<p>&#x521B;&#x5EFA;pc-hpa.yaml&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> autoscaling/v1
<span class="hljs-attr">kind:</span> HorizontalPodAutoscaler
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pc-hpa
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  minReplicas:</span> <span class="hljs-number">1</span>  <span class="hljs-comment">#&#x6700;&#x5C0F;pod&#x6570;&#x91CF;</span>
<span class="hljs-attr">  maxReplicas:</span> <span class="hljs-number">10</span> <span class="hljs-comment">#&#x6700;&#x5927;pod&#x6570;&#x91CF;</span>
<span class="hljs-attr">  targetCPUUtilizationPercentage:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># CPU&#x4F7F;&#x7528;&#x7387;&#x6307;&#x6807;</span>
<span class="hljs-attr">  scaleTargetRef:</span>   <span class="hljs-comment"># &#x6307;&#x5B9A;&#x8981;&#x63A7;&#x5236;&#x7684;nginx&#x4FE1;&#x606F;</span>
<span class="hljs-attr">    apiVersion:</span> apps/v1
<span class="hljs-attr">    kind:</span> Deployment
<span class="hljs-attr">    name:</span> nginx
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;hpa
[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml
horizontalpodautoscaler.autoscaling/pc-hpa created

# &#x67E5;&#x770B;hpa
    [root@k8s-master01 1.8+]# kubectl get hpa -n dev
NAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
pc-hpa   Deployment/nginx   0%/3%     1         10        1          62s
</code></pre>
<p><strong>4 &#x6D4B;&#x8BD5;</strong></p>
<p>&#x4F7F;&#x7528;&#x538B;&#x6D4B;&#x5DE5;&#x5177;&#x5BF9;service&#x5730;&#x5740;<code>192.168.5.4:31830</code>&#x8FDB;&#x884C;&#x538B;&#x6D4B;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x63A7;&#x5236;&#x53F0;&#x67E5;&#x770B;hpa&#x548C;pod&#x7684;&#x53D8;&#x5316;</p>
<p>hpa&#x53D8;&#x5316;</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl get hpa -n dev -w
NAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE
pc-hpa  Deployment/nginx  0%/3%   1     10     1      4m11s
pc-hpa  Deployment/nginx  0%/3%   1     10     1      5m19s
pc-hpa  Deployment/nginx  22%/3%   1     10     1      6m50s
pc-hpa  Deployment/nginx  22%/3%   1     10     4      7m5s
pc-hpa  Deployment/nginx  22%/3%   1     10     8      7m21s
pc-hpa  Deployment/nginx  6%/3%   1     10     8      7m51s
pc-hpa  Deployment/nginx  0%/3%   1     10     8      9m6s
pc-hpa  Deployment/nginx  0%/3%   1     10     8      13m
pc-hpa  Deployment/nginx  0%/3%   1     10     1      14m
</code></pre>
<p>deployment&#x53D8;&#x5316;</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl get deployment -n dev -w
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   1/1     1            1           11m
nginx   1/4     1            1           13m
nginx   1/4     1            1           13m
nginx   1/4     1            1           13m
nginx   1/4     4            1           13m
nginx   1/8     4            1           14m
nginx   1/8     4            1           14m
nginx   1/8     4            1           14m
nginx   1/8     8            1           14m
nginx   2/8     8            2           14m
nginx   3/8     8            3           14m
nginx   4/8     8            4           14m
nginx   5/8     8            5           14m
nginx   6/8     8            6           14m
nginx   7/8     8            7           14m
nginx   8/8     8            8           15m
nginx   8/1     8            8           20m
nginx   8/1     8            8           20m
nginx   1/1     1            1           20m
</code></pre>
<p>pod&#x53D8;&#x5316;</p>
<pre><code>[root@k8s-master01 ~]# kubectl get pods -n dev -w
NAME                     READY   STATUS    RESTARTS   AGE
nginx-7df9756ccc-bh8dr   1/1     Running   0          11m
nginx-7df9756ccc-cpgrv   0/1     Pending   0          0s
nginx-7df9756ccc-8zhwk   0/1     Pending   0          0s
nginx-7df9756ccc-rr9bn   0/1     Pending   0          0s
nginx-7df9756ccc-cpgrv   0/1     ContainerCreating   0          0s
nginx-7df9756ccc-8zhwk   0/1     ContainerCreating   0          0s
nginx-7df9756ccc-rr9bn   0/1     ContainerCreating   0          0s
nginx-7df9756ccc-m9gsj   0/1     Pending             0          0s
nginx-7df9756ccc-g56qb   0/1     Pending             0          0s
nginx-7df9756ccc-sl9c6   0/1     Pending             0          0s
nginx-7df9756ccc-fgst7   0/1     Pending             0          0s
nginx-7df9756ccc-g56qb   0/1     ContainerCreating   0          0s
nginx-7df9756ccc-m9gsj   0/1     ContainerCreating   0          0s
nginx-7df9756ccc-sl9c6   0/1     ContainerCreating   0          0s
nginx-7df9756ccc-fgst7   0/1     ContainerCreating   0          0s
nginx-7df9756ccc-8zhwk   1/1     Running             0          19s
nginx-7df9756ccc-rr9bn   1/1     Running             0          30s
nginx-7df9756ccc-m9gsj   1/1     Running             0          21s
nginx-7df9756ccc-cpgrv   1/1     Running             0          47s
nginx-7df9756ccc-sl9c6   1/1     Running             0          33s
nginx-7df9756ccc-g56qb   1/1     Running             0          48s
nginx-7df9756ccc-fgst7   1/1     Running             0          66s
nginx-7df9756ccc-fgst7   1/1     Terminating         0          6m50s
nginx-7df9756ccc-8zhwk   1/1     Terminating         0          7m5s
nginx-7df9756ccc-cpgrv   1/1     Terminating         0          7m5s
nginx-7df9756ccc-g56qb   1/1     Terminating         0          6m50s
nginx-7df9756ccc-rr9bn   1/1     Terminating         0          7m5s
nginx-7df9756ccc-m9gsj   1/1     Terminating         0          6m50s
nginx-7df9756ccc-sl9c6   1/1     Terminating         0          6m50s
</code></pre><h2 id="65-daemonsetds">6.5 DaemonSet(DS)</h2>
<p>DaemonSet&#x7C7B;&#x578B;&#x7684;&#x63A7;&#x5236;&#x5668;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x53F0;&#xFF08;&#x6216;&#x6307;&#x5B9A;&#xFF09;&#x8282;&#x70B9;&#x4E0A;&#x90FD;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#x3002;&#x4E00;&#x822C;&#x9002;&#x7528;&#x4E8E;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x3001;&#x8282;&#x70B9;&#x76D1;&#x63A7;&#x7B49;&#x573A;&#x666F;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;Pod&#x63D0;&#x4F9B;&#x7684;&#x529F;&#x80FD;&#x662F;&#x8282;&#x70B9;&#x7EA7;&#x522B;&#x7684;&#xFF08;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x9700;&#x8981;&#x4E14;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x7C7B;Pod&#x5C31;&#x9002;&#x5408;&#x4F7F;&#x7528;DaemonSet&#x7C7B;&#x578B;&#x7684;&#x63A7;&#x5236;&#x5668;&#x521B;&#x5EFA;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200612010223537.png" alt="img"></p>
<p>DaemonSet&#x63A7;&#x5236;&#x5668;&#x7684;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x6BCF;&#x5F53;&#x5411;&#x96C6;&#x7FA4;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7684; Pod &#x526F;&#x672C;&#x4E5F;&#x5C06;&#x6DFB;&#x52A0;&#x5230;&#x8BE5;&#x8282;&#x70B9;&#x4E0A;</li>
<li>&#x5F53;&#x8282;&#x70B9;&#x4ECE;&#x96C6;&#x7FA4;&#x4E2D;&#x79FB;&#x9664;&#x65F6;&#xFF0C;Pod &#x4E5F;&#x5C31;&#x88AB;&#x5783;&#x573E;&#x56DE;&#x6536;&#x4E86;</li>
</ul>
<p>&#x4E0B;&#x9762;&#x5148;&#x6765;&#x770B;&#x4E0B;DaemonSet&#x7684;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#x6587;&#x4EF6;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1 <span class="hljs-comment"># &#x7248;&#x672C;&#x53F7;</span>
<span class="hljs-attr">kind:</span> DaemonSet <span class="hljs-comment"># &#x7C7B;&#x578B;       </span>
<span class="hljs-attr">metadata:</span> <span class="hljs-comment"># &#x5143;&#x6570;&#x636E;</span>
<span class="hljs-attr">  name:</span> <span class="hljs-comment"># rs&#x540D;&#x79F0; </span>
<span class="hljs-attr">  namespace:</span> <span class="hljs-comment"># &#x6240;&#x5C5E;&#x547D;&#x540D;&#x7A7A;&#x95F4; </span>
<span class="hljs-attr">  labels:</span> <span class="hljs-comment">#&#x6807;&#x7B7E;</span>
<span class="hljs-attr">    controller:</span> daemonset
<span class="hljs-attr">spec:</span> <span class="hljs-comment"># &#x8BE6;&#x60C5;&#x63CF;&#x8FF0;</span>
<span class="hljs-attr">  revisionHistoryLimit:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># &#x4FDD;&#x7559;&#x5386;&#x53F2;&#x7248;&#x672C;</span>
<span class="hljs-attr">  updateStrategy:</span> <span class="hljs-comment"># &#x66F4;&#x65B0;&#x7B56;&#x7565;</span>
<span class="hljs-attr">    type:</span> RollingUpdate <span class="hljs-comment"># &#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x7B56;&#x7565;</span>
<span class="hljs-attr">    rollingUpdate:</span> <span class="hljs-comment"># &#x6EDA;&#x52A8;&#x66F4;&#x65B0;</span>
<span class="hljs-attr">      maxUnavailable:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># &#x6700;&#x5927;&#x4E0D;&#x53EF;&#x7528;&#x72B6;&#x6001;&#x7684; Pod &#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x4E3A;&#x767E;&#x5206;&#x6BD4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;&#x6574;&#x6570;</span>
<span class="hljs-attr">  selector:</span> <span class="hljs-comment"># &#x9009;&#x62E9;&#x5668;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6307;&#x5B9A;&#x8BE5;&#x63A7;&#x5236;&#x5668;&#x7BA1;&#x7406;&#x54EA;&#x4E9B;pod</span>
<span class="hljs-attr">    matchLabels:</span>      <span class="hljs-comment"># Labels&#x5339;&#x914D;&#x89C4;&#x5219;</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">    matchExpressions:</span> <span class="hljs-comment"># Expressions&#x5339;&#x914D;&#x89C4;&#x5219;</span>
<span class="hljs-bullet">      -</span> {key: app, operator: In, values: [nginx-pod]}
<span class="hljs-attr">  template:</span> <span class="hljs-comment"># &#x6A21;&#x677F;&#xFF0C;&#x5F53;&#x526F;&#x672C;&#x6570;&#x91CF;&#x4E0D;&#x8DB3;&#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x4E0B;&#x9762;&#x7684;&#x6A21;&#x677F;&#x521B;&#x5EFA;pod&#x526F;&#x672C;</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>
</code></pre>
<p>&#x521B;&#x5EFA;pc-daemonset.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> DaemonSet      
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pc-daemonset
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span> 
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;daemonset
[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml
daemonset.apps/pc-daemonset created

# &#x67E5;&#x770B;daemonset
[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide
NAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         
pc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   

# &#x67E5;&#x770B;pod,&#x53D1;&#x73B0;&#x5728;&#x6BCF;&#x4E2A;Node&#x4E0A;&#x90FD;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;pod
[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide
NAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    
pc-daemonset-9bck8   1/1     Running   0          37s   10.244.1.43   node1     
pc-daemonset-k224w   1/1     Running   0          37s   10.244.2.74   node2      

# &#x5220;&#x9664;daemonset
[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml
daemonset.apps &quot;pc-daemonset&quot; deleted
</code></pre>
<h2 id="66-job">6.6 Job</h2>
<p>Job&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x8D1F;&#x8D23;<strong>&#x6279;&#x91CF;&#x5904;&#x7406;(&#x4E00;&#x6B21;&#x8981;&#x5904;&#x7406;&#x6307;&#x5B9A;&#x6570;&#x91CF;&#x4EFB;&#x52A1;)</strong>&#x77ED;&#x6682;&#x7684;<strong>&#x4E00;&#x6B21;&#x6027;(&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;&#x4EC5;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#x5C31;&#x7ED3;&#x675F;)</strong>&#x4EFB;&#x52A1;&#x3002;Job&#x7279;&#x70B9;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x5F53;Job&#x521B;&#x5EFA;&#x7684;pod&#x6267;&#x884C;&#x6210;&#x529F;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;Job&#x5C06;&#x8BB0;&#x5F55;&#x6210;&#x529F;&#x7ED3;&#x675F;&#x7684;pod&#x6570;&#x91CF;</li>
<li>&#x5F53;&#x6210;&#x529F;&#x7ED3;&#x675F;&#x7684;pod&#x8FBE;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x6570;&#x91CF;&#x65F6;&#xFF0C;Job&#x5C06;&#x5B8C;&#x6210;&#x6267;&#x884C;</li>
</ul>
<p><img src="Kubenetes.assets/image-20200618213054113.png" alt="img"></p>
<p>Job&#x7684;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> batch/v1 <span class="hljs-comment"># &#x7248;&#x672C;&#x53F7;</span>
<span class="hljs-attr">kind:</span> Job <span class="hljs-comment"># &#x7C7B;&#x578B;       </span>
<span class="hljs-attr">metadata:</span> <span class="hljs-comment"># &#x5143;&#x6570;&#x636E;</span>
<span class="hljs-attr">  name:</span> <span class="hljs-comment"># rs&#x540D;&#x79F0; </span>
<span class="hljs-attr">  namespace:</span> <span class="hljs-comment"># &#x6240;&#x5C5E;&#x547D;&#x540D;&#x7A7A;&#x95F4; </span>
<span class="hljs-attr">  labels:</span> <span class="hljs-comment">#&#x6807;&#x7B7E;</span>
<span class="hljs-attr">    controller:</span> job
<span class="hljs-attr">spec:</span> <span class="hljs-comment"># &#x8BE6;&#x60C5;&#x63CF;&#x8FF0;</span>
<span class="hljs-attr">  completions:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># &#x6307;&#x5B9A;job&#x9700;&#x8981;&#x6210;&#x529F;&#x8FD0;&#x884C;Pods&#x7684;&#x6B21;&#x6570;&#x3002;&#x9ED8;&#x8BA4;&#x503C;: 1</span>
<span class="hljs-attr">  parallelism:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># &#x6307;&#x5B9A;job&#x5728;&#x4EFB;&#x4E00;&#x65F6;&#x523B;&#x5E94;&#x8BE5;&#x5E76;&#x53D1;&#x8FD0;&#x884C;Pods&#x7684;&#x6570;&#x91CF;&#x3002;&#x9ED8;&#x8BA4;&#x503C;: 1</span>
<span class="hljs-attr">  activeDeadlineSeconds:</span> <span class="hljs-number">30</span> <span class="hljs-comment"># &#x6307;&#x5B9A;job&#x53EF;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x95F4;&#x671F;&#x9650;&#xFF0C;&#x8D85;&#x8FC7;&#x65F6;&#x95F4;&#x8FD8;&#x672A;&#x7ED3;&#x675F;&#xFF0C;&#x7CFB;&#x7EDF;&#x5C06;&#x4F1A;&#x5C1D;&#x8BD5;&#x8FDB;&#x884C;&#x7EC8;&#x6B62;&#x3002;</span>
<span class="hljs-attr">  backoffLimit:</span> <span class="hljs-number">6</span> <span class="hljs-comment"># &#x6307;&#x5B9A;job&#x5931;&#x8D25;&#x540E;&#x8FDB;&#x884C;&#x91CD;&#x8BD5;&#x7684;&#x6B21;&#x6570;&#x3002;&#x9ED8;&#x8BA4;&#x662F;6</span>
<span class="hljs-attr">  manualSelector:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># &#x662F;&#x5426;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;selector&#x9009;&#x62E9;&#x5668;&#x9009;&#x62E9;pod&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;false</span>
<span class="hljs-attr">  selector:</span> <span class="hljs-comment"># &#x9009;&#x62E9;&#x5668;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6307;&#x5B9A;&#x8BE5;&#x63A7;&#x5236;&#x5668;&#x7BA1;&#x7406;&#x54EA;&#x4E9B;pod</span>
<span class="hljs-attr">    matchLabels:</span>      <span class="hljs-comment"># Labels&#x5339;&#x914D;&#x89C4;&#x5219;</span>
<span class="hljs-attr">      app:</span> counter-pod
<span class="hljs-attr">    matchExpressions:</span> <span class="hljs-comment"># Expressions&#x5339;&#x914D;&#x89C4;&#x5219;</span>
<span class="hljs-bullet">      -</span> {key: app, operator: In, values: [counter-pod]}
<span class="hljs-attr">  template:</span> <span class="hljs-comment"># &#x6A21;&#x677F;&#xFF0C;&#x5F53;&#x526F;&#x672C;&#x6570;&#x91CF;&#x4E0D;&#x8DB3;&#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x4E0B;&#x9762;&#x7684;&#x6A21;&#x677F;&#x521B;&#x5EFA;pod&#x526F;&#x672C;</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> counter-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      restartPolicy:</span> Never <span class="hljs-comment"># &#x91CD;&#x542F;&#x7B56;&#x7565;&#x53EA;&#x80FD;&#x8BBE;&#x7F6E;&#x4E3A;Never&#x6216;&#x8005;OnFailure</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> counter
<span class="hljs-attr">        image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">        command:</span> [<span class="hljs-string">&quot;bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done&quot;</span>]
</code></pre>
<pre><code>&#x5173;&#x4E8E;&#x91CD;&#x542F;&#x7B56;&#x7565;&#x8BBE;&#x7F6E;&#x7684;&#x8BF4;&#x660E;&#xFF1A;
    &#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E3A;OnFailure&#xFF0C;&#x5219;job&#x4F1A;&#x5728;pod&#x51FA;&#x73B0;&#x6545;&#x969C;&#x65F6;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;pod&#xFF0C;failed&#x6B21;&#x6570;&#x4E0D;&#x53D8;
    &#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E3A;Never&#xFF0C;&#x5219;job&#x4F1A;&#x5728;pod&#x51FA;&#x73B0;&#x6545;&#x969C;&#x65F6;&#x521B;&#x5EFA;&#x65B0;&#x7684;pod&#xFF0C;&#x5E76;&#x4E14;&#x6545;&#x969C;pod&#x4E0D;&#x4F1A;&#x6D88;&#x5931;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x91CD;&#x542F;&#xFF0C;failed&#x6B21;&#x6570;&#x52A0;1
    &#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E3A;Always&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x610F;&#x5473;&#x7740;&#x4E00;&#x76F4;&#x91CD;&#x542F;&#xFF0C;&#x610F;&#x5473;&#x7740;job&#x4EFB;&#x52A1;&#x4F1A;&#x91CD;&#x590D;&#x53BB;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x5F53;&#x7136;&#x4E0D;&#x5BF9;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x8BBE;&#x7F6E;&#x4E3A;Always
</code></pre><p>&#x521B;&#x5EFA;pc-job.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> batch/v1
<span class="hljs-attr">kind:</span> Job      
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pc-job
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  manualSelector:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> counter-pod
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> counter-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      restartPolicy:</span> Never
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> counter
<span class="hljs-attr">        image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">        command:</span> [<span class="hljs-string">&quot;bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;</span>]
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;job
[root@k8s-master01 ~]# kubectl create -f pc-job.yaml
job.batch/pc-job created

# &#x67E5;&#x770B;job
[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w
NAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR
pc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod
pc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod

# &#x901A;&#x8FC7;&#x89C2;&#x5BDF;pod&#x72B6;&#x6001;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;pod&#x5728;&#x8FD0;&#x884C;&#x5B8C;&#x6BD5;&#x4EFB;&#x52A1;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x53D8;&#x6210;Completed&#x72B6;&#x6001;
[root@k8s-master01 ~]# kubectl get pods -n dev -w
NAME           READY   STATUS     RESTARTS      AGE
pc-job-rxg96   1/1     Running     0            29s
pc-job-rxg96   0/1     Completed   0            33s

# &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x8C03;&#x6574;&#x4E0B;pod&#x8FD0;&#x884C;&#x7684;&#x603B;&#x6570;&#x91CF;&#x548C;&#x5E76;&#x884C;&#x6570;&#x91CF; &#x5373;&#xFF1A;&#x5728;spec&#x4E0B;&#x8BBE;&#x7F6E;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x9009;&#x9879;
#  completions: 6 # &#x6307;&#x5B9A;job&#x9700;&#x8981;&#x6210;&#x529F;&#x8FD0;&#x884C;Pods&#x7684;&#x6B21;&#x6570;&#x4E3A;6
#  parallelism: 3 # &#x6307;&#x5B9A;job&#x5E76;&#x53D1;&#x8FD0;&#x884C;Pods&#x7684;&#x6570;&#x91CF;&#x4E3A;3
#  &#x7136;&#x540E;&#x91CD;&#x65B0;&#x8FD0;&#x884C;job&#xFF0C;&#x89C2;&#x5BDF;&#x6548;&#x679C;&#xFF0C;&#x6B64;&#x65F6;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;job&#x4F1A;&#x6BCF;&#x6B21;&#x8FD0;&#x884C;3&#x4E2A;pod&#xFF0C;&#x603B;&#x5171;&#x6267;&#x884C;&#x4E86;6&#x4E2A;pod
[root@k8s-master01 ~]# kubectl get pods -n dev -w
NAME           READY   STATUS    RESTARTS   AGE
pc-job-684ft   1/1     Running   0          5s
pc-job-jhj49   1/1     Running   0          5s
pc-job-pfcvh   1/1     Running   0          5s
pc-job-684ft   0/1     Completed   0          11s
pc-job-v7rhr   0/1     Pending     0          0s
pc-job-v7rhr   0/1     Pending     0          0s
pc-job-v7rhr   0/1     ContainerCreating   0          0s
pc-job-jhj49   0/1     Completed           0          11s
pc-job-fhwf7   0/1     Pending             0          0s
pc-job-fhwf7   0/1     Pending             0          0s
pc-job-pfcvh   0/1     Completed           0          11s
pc-job-5vg2j   0/1     Pending             0          0s
pc-job-fhwf7   0/1     ContainerCreating   0          0s
pc-job-5vg2j   0/1     Pending             0          0s
pc-job-5vg2j   0/1     ContainerCreating   0          0s
pc-job-fhwf7   1/1     Running             0          2s
pc-job-v7rhr   1/1     Running             0          2s
pc-job-5vg2j   1/1     Running             0          3s
pc-job-fhwf7   0/1     Completed           0          12s
pc-job-v7rhr   0/1     Completed           0          12s
pc-job-5vg2j   0/1     Completed           0          12s

# &#x5220;&#x9664;job
[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml
job.batch &quot;pc-job&quot; deleted
</code></pre>
<h2 id="67-cronjobcj">6.7 CronJob(CJ)</h2>
<p>CronJob&#x63A7;&#x5236;&#x5668;&#x4EE5;Job&#x63A7;&#x5236;&#x5668;&#x8D44;&#x6E90;&#x4E3A;&#x5176;&#x7BA1;&#x63A7;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x501F;&#x52A9;&#x5B83;&#x7BA1;&#x7406;pod&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#xFF0C;Job&#x63A7;&#x5236;&#x5668;&#x5B9A;&#x4E49;&#x7684;&#x4F5C;&#x4E1A;&#x4EFB;&#x52A1;&#x5728;&#x5176;&#x63A7;&#x5236;&#x5668;&#x8D44;&#x6E90;&#x521B;&#x5EFA;&#x4E4B;&#x540E;&#x4FBF;&#x4F1A;&#x7ACB;&#x5373;&#x6267;&#x884C;&#xFF0C;&#x4F46;CronJob&#x53EF;&#x4EE5;&#x4EE5;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x5468;&#x671F;&#x6027;&#x4EFB;&#x52A1;&#x4F5C;&#x4E1A;&#x8BA1;&#x5212;&#x7684;&#x65B9;&#x5F0F;&#x63A7;&#x5236;&#x5176;&#x8FD0;&#x884C;<strong>&#x65F6;&#x95F4;&#x70B9;</strong>&#x53CA;<strong>&#x91CD;&#x590D;&#x8FD0;&#x884C;</strong>&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;<strong>CronJob&#x53EF;&#x4EE5;&#x5728;&#x7279;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x70B9;(&#x53CD;&#x590D;&#x7684;)&#x53BB;&#x8FD0;&#x884C;job&#x4EFB;&#x52A1;</strong>&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200618213149531.png" alt="img"></p>
<p>CronJob&#x7684;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> batch/v1beta1 <span class="hljs-comment"># &#x7248;&#x672C;&#x53F7;</span>
<span class="hljs-attr">kind:</span> CronJob <span class="hljs-comment"># &#x7C7B;&#x578B;       </span>
<span class="hljs-attr">metadata:</span> <span class="hljs-comment"># &#x5143;&#x6570;&#x636E;</span>
<span class="hljs-attr">  name:</span> <span class="hljs-comment"># rs&#x540D;&#x79F0; </span>
<span class="hljs-attr">  namespace:</span> <span class="hljs-comment"># &#x6240;&#x5C5E;&#x547D;&#x540D;&#x7A7A;&#x95F4; </span>
<span class="hljs-attr">  labels:</span> <span class="hljs-comment">#&#x6807;&#x7B7E;</span>
<span class="hljs-attr">    controller:</span> cronjob
<span class="hljs-attr">spec:</span> <span class="hljs-comment"># &#x8BE6;&#x60C5;&#x63CF;&#x8FF0;</span>
<span class="hljs-attr">  schedule:</span> <span class="hljs-comment"># cron&#x683C;&#x5F0F;&#x7684;&#x4F5C;&#x4E1A;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x70B9;,&#x7528;&#x4E8E;&#x63A7;&#x5236;&#x4EFB;&#x52A1;&#x5728;&#x4EC0;&#x4E48;&#x65F6;&#x95F4;&#x6267;&#x884C;</span>
<span class="hljs-attr">  concurrencyPolicy:</span> <span class="hljs-comment"># &#x5E76;&#x53D1;&#x6267;&#x884C;&#x7B56;&#x7565;&#xFF0C;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x524D;&#x4E00;&#x6B21;&#x4F5C;&#x4E1A;&#x8FD0;&#x884C;&#x5C1A;&#x672A;&#x5B8C;&#x6210;&#x65F6;&#x662F;&#x5426;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x8FD0;&#x884C;&#x540E;&#x4E00;&#x6B21;&#x7684;&#x4F5C;&#x4E1A;</span>
<span class="hljs-attr">  failedJobHistoryLimit:</span> <span class="hljs-comment"># &#x4E3A;&#x5931;&#x8D25;&#x7684;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x4FDD;&#x7559;&#x7684;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;1</span>
<span class="hljs-attr">  successfulJobHistoryLimit:</span> <span class="hljs-comment"># &#x4E3A;&#x6210;&#x529F;&#x7684;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x4FDD;&#x7559;&#x7684;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;3</span>
<span class="hljs-attr">  startingDeadlineSeconds:</span> <span class="hljs-comment"># &#x542F;&#x52A8;&#x4F5C;&#x4E1A;&#x9519;&#x8BEF;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x957F;</span>
<span class="hljs-attr">  jobTemplate:</span> <span class="hljs-comment"># job&#x63A7;&#x5236;&#x5668;&#x6A21;&#x677F;&#xFF0C;&#x7528;&#x4E8E;&#x4E3A;cronjob&#x63A7;&#x5236;&#x5668;&#x751F;&#x6210;job&#x5BF9;&#x8C61;;&#x4E0B;&#x9762;&#x5176;&#x5B9E;&#x5C31;&#x662F;job&#x7684;&#x5B9A;&#x4E49;</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      completions:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">      parallelism:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">      activeDeadlineSeconds:</span> <span class="hljs-number">30</span>
<span class="hljs-attr">      backoffLimit:</span> <span class="hljs-number">6</span>
<span class="hljs-attr">      manualSelector:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">      selector:</span>
<span class="hljs-attr">        matchLabels:</span>
<span class="hljs-attr">          app:</span> counter-pod
<span class="hljs-attr">        matchExpressions:</span> &#x89C4;&#x5219;
<span class="hljs-bullet">          -</span> {key: app, operator: In, values: [counter-pod]}
<span class="hljs-attr">      template:</span>
<span class="hljs-attr">        metadata:</span>
<span class="hljs-attr">          labels:</span>
<span class="hljs-attr">            app:</span> counter-pod
<span class="hljs-attr">        spec:</span>
<span class="hljs-attr">          restartPolicy:</span> Never 
<span class="hljs-attr">          containers:</span>
<span class="hljs-attr">          - name:</span> counter
<span class="hljs-attr">            image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">            command:</span> [<span class="hljs-string">&quot;bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done&quot;</span>]
</code></pre>
<pre><code class="lang-yaml">&#x9700;&#x8981;&#x91CD;&#x70B9;&#x89E3;&#x91CA;&#x7684;&#x51E0;&#x4E2A;&#x9009;&#x9879;&#xFF1A;
<span class="hljs-attr">schedule:</span> cron&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;
    */<span class="hljs-number">1</span>    *      *    *     *
    &lt;&#x5206;&#x949F;&gt; &lt;&#x5C0F;&#x65F6;&gt; &lt;&#x65E5;&gt; &lt;&#x6708;&#x4EFD;&gt; &lt;&#x661F;&#x671F;<span class="hljs-string">&gt;

    &#x5206;&#x949F; &#x503C;&#x4ECE; 0 &#x5230; 59.
    &#x5C0F;&#x65F6; &#x503C;&#x4ECE; 0 &#x5230; 23.
    &#x65E5; &#x503C;&#x4ECE; 1 &#x5230; 31.
    &#x6708; &#x503C;&#x4ECE; 1 &#x5230; 12.
    &#x661F;&#x671F; &#x503C;&#x4ECE; 0 &#x5230; 6, 0 &#x4EE3;&#x8868;&#x661F;&#x671F;&#x65E5;
    &#x591A;&#x4E2A;&#x65F6;&#x95F4;&#x53EF;&#x4EE5;&#x7528;&#x9017;&#x53F7;&#x9694;&#x5F00;&#xFF1B; &#x8303;&#x56F4;&#x53EF;&#x4EE5;&#x7528;&#x8FDE;&#x5B57;&#x7B26;&#x7ED9;&#x51FA;&#xFF1B;*&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x901A;&#x914D;&#x7B26;&#xFF1B; /&#x8868;&#x793A;&#x6BCF;...
</span><span class="hljs-attr">concurrencyPolicy:</span>
<span class="hljs-attr">    Allow:</span>   &#x5141;&#x8BB8;Jobs&#x5E76;&#x53D1;&#x8FD0;&#x884C;(&#x9ED8;&#x8BA4;)
<span class="hljs-attr">    Forbid:</span>  &#x7981;&#x6B62;&#x5E76;&#x53D1;&#x8FD0;&#x884C;&#xFF0C;&#x5982;&#x679C;&#x4E0A;&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x5C1A;&#x672A;&#x5B8C;&#x6210;&#xFF0C;&#x5219;&#x8DF3;&#x8FC7;&#x4E0B;&#x4E00;&#x6B21;&#x8FD0;&#x884C;
<span class="hljs-attr">    Replace:</span> &#x66FF;&#x6362;&#xFF0C;&#x53D6;&#x6D88;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x4F5C;&#x4E1A;&#x5E76;&#x7528;&#x65B0;&#x4F5C;&#x4E1A;&#x66FF;&#x6362;&#x5B83;
</code></pre>
<p>&#x521B;&#x5EFA;pc-cronjob.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> batch/v1beta1
<span class="hljs-attr">kind:</span> CronJob
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pc-cronjob
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    controller:</span> cronjob
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  schedule:</span> <span class="hljs-string">&quot;*/1 * * * *&quot;</span>
<span class="hljs-attr">  jobTemplate:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      template:</span>
<span class="hljs-attr">        spec:</span>
<span class="hljs-attr">          restartPolicy:</span> Never
<span class="hljs-attr">          containers:</span>
<span class="hljs-attr">          - name:</span> counter
<span class="hljs-attr">            image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">            command:</span> [<span class="hljs-string">&quot;bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;</span>]
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;cronjob
[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yaml
cronjob.batch/pc-cronjob created

# &#x67E5;&#x770B;cronjob
[root@k8s-master01 ~]# kubectl get cronjobs -n dev
NAME         SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
pc-cronjob   */1 * * * *   False     0        &lt;none&gt;          6s

# &#x67E5;&#x770B;job
[root@k8s-master01 ~]# kubectl get jobs -n dev
NAME                    COMPLETIONS   DURATION   AGE
pc-cronjob-1592587800   1/1           28s        3m26s
pc-cronjob-1592587860   1/1           28s        2m26s
pc-cronjob-1592587920   1/1           28s        86s

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods -n dev
pc-cronjob-1592587800-x4tsm   0/1     Completed   0          2m24s
pc-cronjob-1592587860-r5gv4   0/1     Completed   0          84s
pc-cronjob-1592587920-9dxxq   1/1     Running     0          24s


# &#x5220;&#x9664;cronjob
[root@k8s-master01 ~]# kubectl  delete -f pc-cronjob.yaml
cronjob.batch &quot;pc-cronjob&quot; deleted
</code></pre>
<h1 id="7-service&#x8BE6;&#x89E3;">7. Service&#x8BE6;&#x89E3;</h1>
<h2 id="71-service&#x4ECB;&#x7ECD;">7.1 Service&#x4ECB;&#x7ECD;</h2>
<p>&#x5728;kubernetes&#x4E2D;&#xFF0C;pod&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x8F7D;&#x4F53;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;pod&#x7684;ip&#x6765;&#x8BBF;&#x95EE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F46;&#x662F;pod&#x7684;ip&#x5730;&#x5740;&#x4E0D;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x8FD9;&#x4E5F;&#x5C31;&#x610F;&#x5473;&#x7740;&#x4E0D;&#x65B9;&#x4FBF;&#x76F4;&#x63A5;&#x91C7;&#x7528;pod&#x7684;ip&#x5BF9;&#x670D;&#x52A1;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;kubernetes&#x63D0;&#x4F9B;&#x4E86;Service&#x8D44;&#x6E90;&#xFF0C;Service&#x4F1A;&#x5BF9;&#x63D0;&#x4F9B;&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x591A;&#x4E2A;pod&#x8FDB;&#x884C;&#x805A;&#x5408;&#xFF0C;&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x5165;&#x53E3;&#x5730;&#x5740;&#x3002;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;Service&#x7684;&#x5165;&#x53E3;&#x5730;&#x5740;&#x5C31;&#x80FD;&#x8BBF;&#x95EE;&#x5230;&#x540E;&#x9762;&#x7684;pod&#x670D;&#x52A1;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200408194716912-1626783758946.png" alt="img"></p>
<p>Service&#x5728;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x771F;&#x6B63;&#x8D77;&#x4F5C;&#x7528;&#x7684;&#x5176;&#x5B9E;&#x662F;kube-proxy&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#xFF0C;&#x6BCF;&#x4E2A;Node&#x8282;&#x70B9;&#x4E0A;&#x90FD;&#x8FD0;&#x884C;&#x7740;&#x4E00;&#x4E2A;kube-proxy&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x3002;&#x5F53;&#x521B;&#x5EFA;Service&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x901A;&#x8FC7;api-server&#x5411;etcd&#x5199;&#x5165;&#x521B;&#x5EFA;&#x7684;service&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x800C;kube-proxy&#x4F1A;&#x57FA;&#x4E8E;&#x76D1;&#x542C;&#x7684;&#x673A;&#x5236;&#x53D1;&#x73B0;&#x8FD9;&#x79CD;Service&#x7684;&#x53D8;&#x52A8;&#xFF0C;&#x7136;&#x540E;<strong>&#x5B83;&#x4F1A;&#x5C06;&#x6700;&#x65B0;&#x7684;Service&#x4FE1;&#x606F;&#x8F6C;&#x6362;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x8BBF;&#x95EE;&#x89C4;&#x5219;</strong>&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200509121254425.png" alt="img"></p>
<pre><code># 10.97.97.97:80 &#x662F;service&#x63D0;&#x4F9B;&#x7684;&#x8BBF;&#x95EE;&#x5165;&#x53E3;
# &#x5F53;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x5165;&#x53E3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x540E;&#x9762;&#x6709;&#x4E09;&#x4E2A;pod&#x7684;&#x670D;&#x52A1;&#x5728;&#x7B49;&#x5F85;&#x8C03;&#x7528;&#xFF0C;
# kube-proxy&#x4F1A;&#x57FA;&#x4E8E;rr&#xFF08;&#x8F6E;&#x8BE2;&#xFF09;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x5C06;&#x8BF7;&#x6C42;&#x5206;&#x53D1;&#x5230;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;pod&#x4E0A;&#x53BB;
# &#x8FD9;&#x4E2A;&#x89C4;&#x5219;&#x4F1A;&#x540C;&#x65F6;&#x5728;&#x96C6;&#x7FA4;&#x5185;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;&#x4E0A;&#x90FD;&#x751F;&#x6210;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8BBF;&#x95EE;&#x90FD;&#x53EF;&#x4EE5;&#x3002;
[root@node1 ~]# ipvsadm -Ln
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  10.97.97.97:80 rr
  -&gt; 10.244.1.39:80               Masq    1      0          0
  -&gt; 10.244.1.40:80               Masq    1      0          0
  -&gt; 10.244.2.33:80               Masq    1      0          0
</code></pre><p>kube-proxy&#x76EE;&#x524D;&#x652F;&#x6301;&#x4E09;&#x79CD;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;:</p>
<p><strong>userspace &#x6A21;&#x5F0F;</strong></p>
<p>userspace&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;kube-proxy&#x4F1A;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;Service&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#xFF0C;&#x53D1;&#x5411;Cluster IP&#x7684;&#x8BF7;&#x6C42;&#x88AB;Iptables&#x89C4;&#x5219;&#x91CD;&#x5B9A;&#x5411;&#x5230;kube-proxy&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#x4E0A;&#xFF0C;kube-proxy&#x6839;&#x636E;LB&#x7B97;&#x6CD5;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;Pod&#x5E76;&#x548C;&#x5176;&#x5EFA;&#x7ACB;&#x94FE;&#x63A5;&#xFF0C;&#x4EE5;&#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;Pod&#x4E0A;&#x3002;  &#x8BE5;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;kube-proxy&#x5145;&#x5F53;&#x4E86;&#x4E00;&#x4E2A;&#x56DB;&#x5C42;&#x8D1F;&#x8D23;&#x5747;&#x8861;&#x5668;&#x7684;&#x89D2;&#x8272;&#x3002;&#x7531;&#x4E8E;kube-proxy&#x8FD0;&#x884C;&#x5728;userspace&#x4E2D;&#xFF0C;&#x5728;&#x8FDB;&#x884C;&#x8F6C;&#x53D1;&#x5904;&#x7406;&#x65F6;&#x4F1A;&#x589E;&#x52A0;&#x5185;&#x6838;&#x548C;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#xFF0C;&#x867D;&#x7136;&#x6BD4;&#x8F83;&#x7A33;&#x5B9A;&#xFF0C;&#x4F46;&#x662F;&#x6548;&#x7387;&#x6BD4;&#x8F83;&#x4F4E;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200509151424280.png" alt="img"></p>
<p><strong>iptables &#x6A21;&#x5F0F;</strong></p>
<p>iptables&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;kube-proxy&#x4E3A;service&#x540E;&#x7AEF;&#x7684;&#x6BCF;&#x4E2A;Pod&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;iptables&#x89C4;&#x5219;&#xFF0C;&#x76F4;&#x63A5;&#x5C06;&#x53D1;&#x5411;Cluster IP&#x7684;&#x8BF7;&#x6C42;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x4E00;&#x4E2A;Pod IP&#x3002;  &#x8BE5;&#x6A21;&#x5F0F;&#x4E0B;kube-proxy&#x4E0D;&#x627F;&#x62C5;&#x56DB;&#x5C42;&#x8D1F;&#x8D23;&#x5747;&#x8861;&#x5668;&#x7684;&#x89D2;&#x8272;&#xFF0C;&#x53EA;&#x8D1F;&#x8D23;&#x521B;&#x5EFA;iptables&#x89C4;&#x5219;&#x3002;&#x8BE5;&#x6A21;&#x5F0F;&#x7684;&#x4F18;&#x70B9;&#x662F;&#x8F83;userspace&#x6A21;&#x5F0F;&#x6548;&#x7387;&#x66F4;&#x9AD8;&#xFF0C;&#x4F46;&#x4E0D;&#x80FD;&#x63D0;&#x4F9B;&#x7075;&#x6D3B;&#x7684;LB&#x7B56;&#x7565;&#xFF0C;&#x5F53;&#x540E;&#x7AEF;Pod&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x4E5F;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x91CD;&#x8BD5;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200509152947714.png" alt="img"></p>
<p><strong>ipvs &#x6A21;&#x5F0F;</strong></p>
<p>ipvs&#x6A21;&#x5F0F;&#x548C;iptables&#x7C7B;&#x4F3C;&#xFF0C;kube-proxy&#x76D1;&#x63A7;Pod&#x7684;&#x53D8;&#x5316;&#x5E76;&#x521B;&#x5EFA;&#x76F8;&#x5E94;&#x7684;ipvs&#x89C4;&#x5219;&#x3002;ipvs&#x76F8;&#x5BF9;iptables&#x8F6C;&#x53D1;&#x6548;&#x7387;&#x66F4;&#x9AD8;&#x3002;&#x9664;&#x6B64;&#x4EE5;&#x5916;&#xFF0C;ipvs&#x652F;&#x6301;&#x66F4;&#x591A;&#x7684;LB&#x7B97;&#x6CD5;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200509153731363.png" alt="img"></p>
<pre><code class="lang-shell"># &#x6B64;&#x6A21;&#x5F0F;&#x5FC5;&#x987B;&#x5B89;&#x88C5;ipvs&#x5185;&#x6838;&#x6A21;&#x5757;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x964D;&#x7EA7;&#x4E3A;iptables
# &#x5F00;&#x542F;ipvs
[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system
# &#x4FEE;&#x6539;mode: &quot;ipvs&quot;
[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system
[root@node1 ~]# ipvsadm -Ln
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  10.97.97.97:80 rr
  -&gt; 10.244.1.39:80               Masq    1      0          0
  -&gt; 10.244.1.40:80               Masq    1      0          0
  -&gt; 10.244.2.33:80               Masq    1      0          0
</code></pre>
<h2 id="72-service&#x7C7B;&#x578B;">7.2 Service&#x7C7B;&#x578B;</h2>
<p>Service&#x7684;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">kind:</span> Service  <span class="hljs-comment"># &#x8D44;&#x6E90;&#x7C7B;&#x578B;</span>
<span class="hljs-attr">apiVersion:</span> v1  <span class="hljs-comment"># &#x8D44;&#x6E90;&#x7248;&#x672C;</span>
<span class="hljs-attr">metadata:</span> <span class="hljs-comment"># &#x5143;&#x6570;&#x636E;</span>
<span class="hljs-attr">  name:</span> service <span class="hljs-comment"># &#x8D44;&#x6E90;&#x540D;&#x79F0;</span>
<span class="hljs-attr">  namespace:</span> dev <span class="hljs-comment"># &#x547D;&#x540D;&#x7A7A;&#x95F4;</span>
<span class="hljs-attr">spec:</span> <span class="hljs-comment"># &#x63CF;&#x8FF0;</span>
<span class="hljs-attr">  selector:</span> <span class="hljs-comment"># &#x6807;&#x7B7E;&#x9009;&#x62E9;&#x5668;&#xFF0C;&#x7528;&#x4E8E;&#x786E;&#x5B9A;&#x5F53;&#x524D;service&#x4EE3;&#x7406;&#x54EA;&#x4E9B;pod</span>
<span class="hljs-attr">    app:</span> nginx
<span class="hljs-attr">  type:</span> <span class="hljs-comment"># Service&#x7C7B;&#x578B;&#xFF0C;&#x6307;&#x5B9A;service&#x7684;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;</span>
<span class="hljs-attr">  clusterIP:</span>  <span class="hljs-comment"># &#x865A;&#x62DF;&#x670D;&#x52A1;&#x7684;ip&#x5730;&#x5740;</span>
<span class="hljs-attr">  sessionAffinity:</span> <span class="hljs-comment"># session&#x4EB2;&#x548C;&#x6027;&#xFF0C;&#x652F;&#x6301;ClientIP&#x3001;None&#x4E24;&#x4E2A;&#x9009;&#x9879;</span>
<span class="hljs-attr">  ports:</span> <span class="hljs-comment"># &#x7AEF;&#x53E3;&#x4FE1;&#x606F;</span>
<span class="hljs-attr">    - protocol:</span> TCP 
<span class="hljs-attr">      port:</span> <span class="hljs-number">3017</span>  <span class="hljs-comment"># service&#x7AEF;&#x53E3;</span>
<span class="hljs-attr">      targetPort:</span> <span class="hljs-number">5003</span> <span class="hljs-comment"># pod&#x7AEF;&#x53E3;</span>
<span class="hljs-attr">      nodePort:</span> <span class="hljs-number">31122</span> <span class="hljs-comment"># &#x4E3B;&#x673A;&#x7AEF;&#x53E3;</span>
</code></pre>
<ul>
<li>ClusterIP&#xFF1A;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x5B83;&#x662F;Kubernetes&#x7CFB;&#x7EDF;&#x81EA;&#x52A8;&#x5206;&#x914D;&#x7684;&#x865A;&#x62DF;IP&#xFF0C;&#x53EA;&#x80FD;&#x5728;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x8BBF;&#x95EE;</li>
<li>NodePort&#xFF1A;&#x5C06;Service&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x7684;Node&#x4E0A;&#x7684;&#x7AEF;&#x53E3;&#x66B4;&#x9732;&#x7ED9;&#x5916;&#x90E8;&#xFF0C;&#x901A;&#x8FC7;&#x6B64;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x96C6;&#x7FA4;&#x5916;&#x90E8;&#x8BBF;&#x95EE;&#x670D;&#x52A1;</li>
<li>LoadBalancer&#xFF1A;&#x4F7F;&#x7528;&#x5916;&#x63A5;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x5B8C;&#x6210;&#x5230;&#x670D;&#x52A1;&#x7684;&#x8D1F;&#x8F7D;&#x5206;&#x53D1;&#xFF0C;&#x6CE8;&#x610F;&#x6B64;&#x6A21;&#x5F0F;&#x9700;&#x8981;&#x5916;&#x90E8;&#x4E91;&#x73AF;&#x5883;&#x652F;&#x6301;</li>
<li>ExternalName&#xFF1A; &#x628A;&#x96C6;&#x7FA4;&#x5916;&#x90E8;&#x7684;&#x670D;&#x52A1;&#x5F15;&#x5165;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;</li>
</ul>
<h2 id="73-service&#x4F7F;&#x7528;">7.3 Service&#x4F7F;&#x7528;</h2>
<h3 id="731-&#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#x51C6;&#x5907;">7.3.1 &#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#x51C6;&#x5907;</h3>
<p>&#x5728;&#x4F7F;&#x7528;service&#x4E4B;&#x524D;&#xFF0C;&#x9996;&#x5148;&#x5229;&#x7528;Deployment&#x521B;&#x5EFA;&#x51FA;3&#x4E2A;pod&#xFF0C;&#x6CE8;&#x610F;&#x8981;&#x4E3A;pod&#x8BBE;&#x7F6E;<code>app=nginx-pod</code>&#x7684;&#x6807;&#x7B7E;</p>
<p>&#x521B;&#x5EFA;deployment.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment      
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pc-deployment
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span> 
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>
</code></pre>
<pre><code class="lang-shell">[root@k8s-master01 ~]# kubectl create -f deployment.yaml
deployment.apps/pc-deployment created

# &#x67E5;&#x770B;pod&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels
NAME                             READY   STATUS     IP            NODE     LABELS
pc-deployment-66cb59b984-8p84h   1/1     Running    10.244.1.39   node1    app=nginx-pod
pc-deployment-66cb59b984-vx8vx   1/1     Running    10.244.2.33   node2    app=nginx-pod
pc-deployment-66cb59b984-wnncx   1/1     Running    10.244.1.40   node1    app=nginx-pod

# &#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x540E;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4FEE;&#x6539;&#x4E0B;&#x4E09;&#x53F0;nginx&#x7684;index.html&#x9875;&#x9762;&#xFF08;&#x4E09;&#x53F0;&#x4FEE;&#x6539;&#x7684;IP&#x5730;&#x5740;&#x4E0D;&#x4E00;&#x81F4;&#xFF09;
# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh
# echo &quot;10.244.1.39&quot; &gt; /usr/share/nginx/html/index.html

#&#x4FEE;&#x6539;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x8BBF;&#x95EE;&#x6D4B;&#x8BD5;
[root@k8s-master01 ~]# curl 10.244.1.39
10.244.1.39
[root@k8s-master01 ~]# curl 10.244.2.33
10.244.2.33
[root@k8s-master01 ~]# curl 10.244.1.40
10.244.1.40
</code></pre>
<h3 id="732-clusterip&#x7C7B;&#x578B;&#x7684;service">7.3.2 ClusterIP&#x7C7B;&#x578B;&#x7684;Service</h3>
<p>&#x521B;&#x5EFA;service-clusterip.yaml&#x6587;&#x4EF6;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> service-clusterip
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> nginx-pod
<span class="hljs-attr">  clusterIP:</span> <span class="hljs-number">10.97</span><span class="hljs-number">.97</span><span class="hljs-number">.97</span> <span class="hljs-comment"># service&#x7684;ip&#x5730;&#x5740;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5199;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;</span>
<span class="hljs-attr">  type:</span> ClusterIP
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - port:</span> <span class="hljs-number">80</span>  <span class="hljs-comment"># Service&#x7AEF;&#x53E3;       </span>
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">80</span> <span class="hljs-comment"># pod&#x7AEF;&#x53E3;</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;service
[root@k8s-master01 ~]# kubectl create -f service-clusterip.yaml
service/service-clusterip created

# &#x67E5;&#x770B;service
[root@k8s-master01 ~]# kubectl get svc -n dev -o wide
NAME                TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE   SELECTOR
service-clusterip   ClusterIP   10.97.97.97   &lt;none&gt;        80/TCP    13s   app=nginx-pod

# &#x67E5;&#x770B;service&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;
# &#x5728;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;Endpoints&#x5217;&#x8868;&#xFF0C;&#x91CC;&#x9762;&#x5C31;&#x662F;&#x5F53;&#x524D;service&#x53EF;&#x4EE5;&#x8D1F;&#x8F7D;&#x5230;&#x7684;&#x670D;&#x52A1;&#x5165;&#x53E3;
[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev
Name:              service-clusterip
Namespace:         dev
Labels:            &lt;none&gt;
Annotations:       &lt;none&gt;
Selector:          app=nginx-pod
Type:              ClusterIP
IP:                10.97.97.97
Port:              &lt;unset&gt;  80/TCP
TargetPort:        80/TCP
Endpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80
Session Affinity:  None
Events:            &lt;none&gt;

# &#x67E5;&#x770B;ipvs&#x7684;&#x6620;&#x5C04;&#x89C4;&#x5219;
[root@k8s-master01 ~]# ipvsadm -Ln
TCP  10.97.97.97:80 rr
  -&gt; 10.244.1.39:80               Masq    1      0          0
  -&gt; 10.244.1.40:80               Masq    1      0          0
  -&gt; 10.244.2.33:80               Masq    1      0          0

# &#x8BBF;&#x95EE;10.97.97.97:80&#x89C2;&#x5BDF;&#x6548;&#x679C;
[root@k8s-master01 ~]# curl 10.97.97.97:80
10.244.2.33
</code></pre>
<p><strong>Endpoint</strong></p>
<p>Endpoint&#x662F;kubernetes&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#xFF0C;&#x5B58;&#x50A8;&#x5728;etcd&#x4E2D;&#xFF0C;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x4E00;&#x4E2A;service&#x5BF9;&#x5E94;&#x7684;&#x6240;&#x6709;pod&#x7684;&#x8BBF;&#x95EE;&#x5730;&#x5740;&#xFF0C;&#x5B83;&#x662F;&#x6839;&#x636E;service&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;selector&#x63CF;&#x8FF0;&#x4EA7;&#x751F;&#x7684;&#x3002;</p>
<p>&#x4E00;&#x4E2A;Service&#x7531;&#x4E00;&#x7EC4;Pod&#x7EC4;&#x6210;&#xFF0C;&#x8FD9;&#x4E9B;Pod&#x901A;&#x8FC7;Endpoints&#x66B4;&#x9732;&#x51FA;&#x6765;&#xFF0C;<strong>Endpoints&#x662F;&#x5B9E;&#x73B0;&#x5B9E;&#x9645;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x70B9;&#x96C6;&#x5408;</strong>&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;service&#x548C;pod&#x4E4B;&#x95F4;&#x7684;&#x8054;&#x7CFB;&#x662F;&#x901A;&#x8FC7;endpoints&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200509191917069.png" alt="image-20200509191917069"></p>
<p><strong>&#x8D1F;&#x8F7D;&#x5206;&#x53D1;&#x7B56;&#x7565;</strong></p>
<p>&#x5BF9;Service&#x7684;&#x8BBF;&#x95EE;&#x88AB;&#x5206;&#x53D1;&#x5230;&#x4E86;&#x540E;&#x7AEF;&#x7684;Pod&#x4E0A;&#x53BB;&#xFF0C;&#x76EE;&#x524D;kubernetes&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x8D1F;&#x8F7D;&#x5206;&#x53D1;&#x7B56;&#x7565;&#xFF1A;</p>
<ul>
<li><p>&#x5982;&#x679C;&#x4E0D;&#x5B9A;&#x4E49;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;kube-proxy&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x6BD4;&#x5982;&#x968F;&#x673A;&#x3001;&#x8F6E;&#x8BE2;</p>
</li>
<li><p>&#x57FA;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x5730;&#x5740;&#x7684;&#x4F1A;&#x8BDD;&#x4FDD;&#x6301;&#x6A21;&#x5F0F;&#xFF0C;&#x5373;&#x6765;&#x81EA;&#x540C;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;&#x7684;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x8F6C;&#x53D1;&#x5230;&#x56FA;&#x5B9A;&#x7684;&#x4E00;&#x4E2A;Pod&#x4E0A;</p>
<p>&#x6B64;&#x6A21;&#x5F0F;&#x53EF;&#x4EE5;&#x4F7F;&#x5728;spec&#x4E2D;&#x6DFB;&#x52A0;<code>sessionAffinity:ClientIP</code>&#x9009;&#x9879;</p>
</li>
</ul>
<pre><code class="lang-shell"># &#x67E5;&#x770B;ipvs&#x7684;&#x6620;&#x5C04;&#x89C4;&#x5219;&#x3010;rr &#x8F6E;&#x8BE2;&#x3011;
[root@k8s-master01 ~]# ipvsadm -Ln
TCP  10.97.97.97:80 rr
  -&gt; 10.244.1.39:80               Masq    1      0          0
  -&gt; 10.244.1.40:80               Masq    1      0          0
  -&gt; 10.244.2.33:80               Masq    1      0          0

# &#x5FAA;&#x73AF;&#x8BBF;&#x95EE;&#x6D4B;&#x8BD5;
[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;
10.244.1.40
10.244.1.39
10.244.2.33
10.244.1.40
10.244.1.39
10.244.2.33

# &#x4FEE;&#x6539;&#x5206;&#x53D1;&#x7B56;&#x7565;----sessionAffinity:ClientIP

# &#x67E5;&#x770B;ipvs&#x89C4;&#x5219;&#x3010;persistent &#x4EE3;&#x8868;&#x6301;&#x4E45;&#x3011;
[root@k8s-master01 ~]# ipvsadm -Ln
TCP  10.97.97.97:80 rr persistent 10800
  -&gt; 10.244.1.39:80               Masq    1      0          0
  -&gt; 10.244.1.40:80               Masq    1      0          0
  -&gt; 10.244.2.33:80               Masq    1      0          0

# &#x5FAA;&#x73AF;&#x8BBF;&#x95EE;&#x6D4B;&#x8BD5;
[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;
10.244.2.33
10.244.2.33
10.244.2.33

# &#x5220;&#x9664;service
[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml
service &quot;service-clusterip&quot; deleted
</code></pre>
<h3 id="733-headliness&#x7C7B;&#x578B;&#x7684;service">7.3.3 HeadLiness&#x7C7B;&#x578B;&#x7684;Service</h3>
<p>&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x80FD;&#x4E0D;&#x60F3;&#x4F7F;&#x7528;Service&#x63D0;&#x4F9B;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x529F;&#x80FD;&#xFF0C;&#x800C;&#x5E0C;&#x671B;&#x81EA;&#x5DF1;&#x6765;&#x63A7;&#x5236;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7B56;&#x7565;&#xFF0C;&#x9488;&#x5BF9;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;kubernetes&#x63D0;&#x4F9B;&#x4E86;HeadLiness Service&#xFF0C;&#x8FD9;&#x7C7B;Service&#x4E0D;&#x4F1A;&#x5206;&#x914D;Cluster IP&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x8BBF;&#x95EE;service&#xFF0C;&#x53EA;&#x80FD;&#x901A;&#x8FC7;service&#x7684;&#x57DF;&#x540D;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x3002;</p>
<p>&#x521B;&#x5EFA;service-headliness.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> service-headliness
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> nginx-pod
<span class="hljs-attr">  clusterIP:</span> None <span class="hljs-comment"># &#x5C06;clusterIP&#x8BBE;&#x7F6E;&#x4E3A;None&#xFF0C;&#x5373;&#x53EF;&#x521B;&#x5EFA;headliness Service</span>
<span class="hljs-attr">  type:</span> ClusterIP
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - port:</span> <span class="hljs-number">80</span>    
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">80</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;service
[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml
service/service-headliness created

# &#x83B7;&#x53D6;service&#xFF0C; &#x53D1;&#x73B0;CLUSTER-IP&#x672A;&#x5206;&#x914D;
[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR
service-headliness   ClusterIP   None         &lt;none&gt;        80/TCP    11s   app=nginx-pod

# &#x67E5;&#x770B;service&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev
Name:              service-headliness
Namespace:         dev
Labels:            &lt;none&gt;
Annotations:       &lt;none&gt;
Selector:          app=nginx-pod
Type:              ClusterIP
IP:                None
Port:              &lt;unset&gt;  80/TCP
TargetPort:        80/TCP
Endpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80
Session Affinity:  None
Events:            &lt;none&gt;

# &#x67E5;&#x770B;&#x57DF;&#x540D;&#x7684;&#x89E3;&#x6790;&#x60C5;&#x51B5;
[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh
/ # cat /etc/resolv.conf
nameserver 10.96.0.10
search dev.svc.cluster.local svc.cluster.local cluster.local

[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local
service-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.40
service-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.39
service-headliness.dev.svc.cluster.local. 30 IN A 10.244.2.33
</code></pre>
<h3 id="734-nodeport&#x7C7B;&#x578B;&#x7684;service">7.3.4 NodePort&#x7C7B;&#x578B;&#x7684;Service</h3>
<p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6837;&#x4F8B;&#x4E2D;&#xFF0C;&#x521B;&#x5EFA;&#x7684;Service&#x7684;ip&#x5730;&#x5740;&#x53EA;&#x6709;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x624D;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF0C;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x5C06;Service&#x66B4;&#x9732;&#x7ED9;&#x96C6;&#x7FA4;&#x5916;&#x90E8;&#x4F7F;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x7C7B;&#x578B;&#x7684;Service&#xFF0C;&#x79F0;&#x4E3A;NodePort&#x7C7B;&#x578B;&#x3002;NodePort&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x5176;&#x5B9E;&#x5C31;&#x662F;<strong>&#x5C06;service&#x7684;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x5230;Node&#x7684;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x4E0A;</strong>&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>NodeIp:NodePort</code>&#x6765;&#x8BBF;&#x95EE;service&#x4E86;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200620175731338.png" alt="img"></p>
<p>&#x521B;&#x5EFA;service-nodeport.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> service-nodeport
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> nginx-pod
<span class="hljs-attr">  type:</span> NodePort <span class="hljs-comment"># service&#x7C7B;&#x578B;</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    nodePort:</span> <span class="hljs-number">30002</span> <span class="hljs-comment"># &#x6307;&#x5B9A;&#x7ED1;&#x5B9A;&#x7684;node&#x7684;&#x7AEF;&#x53E3;(&#x9ED8;&#x8BA4;&#x7684;&#x53D6;&#x503C;&#x8303;&#x56F4;&#x662F;&#xFF1A;30000-32767), &#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A;&#xFF0C;&#x4F1A;&#x9ED8;&#x8BA4;&#x5206;&#x914D;</span>
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">80</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;service
[root@k8s-master01 ~]# kubectl create -f service-nodeport.yaml
service/service-nodeport created

# &#x67E5;&#x770B;service
[root@k8s-master01 ~]# kubectl get svc -n dev -o wide
NAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)       SELECTOR
service-nodeport   NodePort   10.105.64.191   &lt;none&gt;        80:30002/TCP  app=nginx-pod

# &#x63A5;&#x4E0B;&#x6765;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7535;&#x8111;&#x4E3B;&#x673A;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x53BB;&#x8BBF;&#x95EE;&#x96C6;&#x7FA4;&#x4E2D;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;nodeip&#x7684;30002&#x7AEF;&#x53E3;&#xFF0C;&#x5373;&#x53EF;&#x8BBF;&#x95EE;&#x5230;pod
</code></pre>
<h3 id="735-loadbalancer&#x7C7B;&#x578B;&#x7684;service">7.3.5 LoadBalancer&#x7C7B;&#x578B;&#x7684;Service</h3>
<p>LoadBalancer&#x548C;NodePort&#x5F88;&#x76F8;&#x4F3C;&#xFF0C;&#x76EE;&#x7684;&#x90FD;&#x662F;&#x5411;&#x5916;&#x90E8;&#x66B4;&#x9732;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x533A;&#x522B;&#x5728;&#x4E8E;LoadBalancer&#x4F1A;&#x5728;&#x96C6;&#x7FA4;&#x7684;&#x5916;&#x90E8;&#x518D;&#x6765;&#x505A;&#x4E00;&#x4E2A;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x8BBE;&#x5907;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x8BBE;&#x5907;&#x9700;&#x8981;&#x5916;&#x90E8;&#x73AF;&#x5883;&#x652F;&#x6301;&#x7684;&#xFF0C;&#x5916;&#x90E8;&#x670D;&#x52A1;&#x53D1;&#x9001;&#x5230;&#x8FD9;&#x4E2A;&#x8BBE;&#x5907;&#x4E0A;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x4F1A;&#x88AB;&#x8BBE;&#x5907;&#x8D1F;&#x8F7D;&#x4E4B;&#x540E;&#x8F6C;&#x53D1;&#x5230;&#x96C6;&#x7FA4;&#x4E2D;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200510103945494.png" alt="img"></p>
<h3 id="736-externalname&#x7C7B;&#x578B;&#x7684;service">7.3.6 ExternalName&#x7C7B;&#x578B;&#x7684;Service</h3>
<p>ExternalName&#x7C7B;&#x578B;&#x7684;Service&#x7528;&#x4E8E;&#x5F15;&#x5165;&#x96C6;&#x7FA4;&#x5916;&#x90E8;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;<code>externalName</code>&#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x5916;&#x90E8;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x8BBF;&#x95EE;&#x6B64;service&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;&#x5916;&#x90E8;&#x7684;&#x670D;&#x52A1;&#x4E86;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200510113311209.png" alt="img"></p>
<pre><code class="lang-shell">apiVersion: v1
kind: Service
metadata:
  name: service-externalname
  namespace: dev
spec:
  type: ExternalName # service&#x7C7B;&#x578B;
  externalName: www.baidu.com  #&#x6539;&#x6210;ip&#x5730;&#x5740;&#x4E5F;&#x53EF;&#x4EE5;
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;service
[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml
service/service-externalname created

# &#x57DF;&#x540D;&#x89E3;&#x6790;
[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local
service-externalname.dev.svc.cluster.local. 30 IN CNAME www.baidu.com.
www.baidu.com.          30      IN      CNAME   www.a.shifen.com.
www.a.shifen.com.       30      IN      A       39.156.66.18
www.a.shifen.com.       30      IN      A       39.156.66.14
</code></pre>
<h2 id="74-ingress&#x4ECB;&#x7ECD;">7.4 Ingress&#x4ECB;&#x7ECD;</h2>
<p>&#x5728;&#x524D;&#x9762;&#x8BFE;&#x7A0B;&#x4E2D;&#x5DF2;&#x7ECF;&#x63D0;&#x5230;&#xFF0C;Service&#x5BF9;&#x96C6;&#x7FA4;&#x4E4B;&#x5916;&#x66B4;&#x9732;&#x670D;&#x52A1;&#x7684;&#x4E3B;&#x8981;&#x65B9;&#x5F0F;&#x6709;&#x4E24;&#x79CD;&#xFF1A;NotePort&#x548C;LoadBalancer&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x90FD;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x7F3A;&#x70B9;&#xFF1A;</p>
<ul>
<li>NodePort&#x65B9;&#x5F0F;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#x4F1A;&#x5360;&#x7528;&#x5F88;&#x591A;&#x96C6;&#x7FA4;&#x673A;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x53D8;&#x591A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E2A;&#x7F3A;&#x70B9;&#x5C31;&#x6108;&#x53D1;&#x660E;&#x663E;</li>
<li>LB&#x65B9;&#x5F0F;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#x6BCF;&#x4E2A;service&#x9700;&#x8981;&#x4E00;&#x4E2A;LB&#xFF0C;&#x6D6A;&#x8D39;&#x3001;&#x9EBB;&#x70E6;&#xFF0C;&#x5E76;&#x4E14;&#x9700;&#x8981;kubernetes&#x4E4B;&#x5916;&#x8BBE;&#x5907;&#x7684;&#x652F;&#x6301;</li>
</ul>
<p>&#x57FA;&#x4E8E;&#x8FD9;&#x79CD;&#x73B0;&#x72B6;&#xFF0C;kubernetes&#x63D0;&#x4F9B;&#x4E86;Ingress&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#xFF0C;Ingress&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;NodePort&#x6216;&#x8005;&#x4E00;&#x4E2A;LB&#x5C31;&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x66B4;&#x9732;&#x591A;&#x4E2A;Service&#x7684;&#x9700;&#x6C42;&#x3002;&#x5DE5;&#x4F5C;&#x673A;&#x5236;&#x5927;&#x81F4;&#x5982;&#x4E0B;&#x56FE;&#x8868;&#x793A;&#xFF1A;</p>
<p><img src="Kubenetes.assets/image-20200623092808049.png" alt="img"></p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;Ingress&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;7&#x5C42;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#xFF0C;&#x662F;kubernetes&#x5BF9;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x7684;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#xFF0C;&#x5B83;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x7C7B;&#x4F3C;&#x4E8E;Nginx&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x6210;&#x5728;<strong>Ingress&#x91CC;&#x5EFA;&#x7ACB;&#x8BF8;&#x591A;&#x6620;&#x5C04;&#x89C4;&#x5219;&#xFF0C;Ingress Controller&#x901A;&#x8FC7;&#x76D1;&#x542C;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#x89C4;&#x5219;&#x5E76;&#x8F6C;&#x5316;&#x6210;Nginx&#x7684;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x914D;&#x7F6E; , &#x7136;&#x540E;&#x5BF9;&#x5916;&#x90E8;&#x63D0;&#x4F9B;&#x670D;&#x52A1;</strong>&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x6838;&#x5FC3;&#x6982;&#x5FF5;&#xFF1A;</p>
<ul>
<li>ingress&#xFF1A;kubernetes&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x4F5C;&#x7528;&#x662F;&#x5B9A;&#x4E49;&#x8BF7;&#x6C42;&#x5982;&#x4F55;&#x8F6C;&#x53D1;&#x5230;service&#x7684;&#x89C4;&#x5219;</li>
<li>ingress controller&#xFF1A;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x5BF9;ingress&#x5B9A;&#x4E49;&#x7684;&#x89C4;&#x5219;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x6839;&#x636E;&#x914D;&#x7F6E;&#x7684;&#x89C4;&#x5219;&#x6765;&#x5B9E;&#x73B0;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#xFF0C;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x6BD4;&#x5982;Nginx, Contour, Haproxy&#x7B49;&#x7B49;</li>
</ul>
<p>Ingress&#xFF08;&#x4EE5;Nginx&#x4E3A;&#x4F8B;&#xFF09;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x7528;&#x6237;&#x7F16;&#x5199;Ingress&#x89C4;&#x5219;&#xFF0C;&#x8BF4;&#x660E;&#x54EA;&#x4E2A;&#x57DF;&#x540D;&#x5BF9;&#x5E94;kubernetes&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x54EA;&#x4E2A;Service</li>
<li>Ingress&#x63A7;&#x5236;&#x5668;&#x52A8;&#x6001;&#x611F;&#x77E5;Ingress&#x670D;&#x52A1;&#x89C4;&#x5219;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x7136;&#x540E;&#x751F;&#x6210;&#x4E00;&#x6BB5;&#x5BF9;&#x5E94;&#x7684;Nginx&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x914D;&#x7F6E;</li>
<li>Ingress&#x63A7;&#x5236;&#x5668;&#x4F1A;&#x5C06;&#x751F;&#x6210;&#x7684;Nginx&#x914D;&#x7F6E;&#x5199;&#x5165;&#x5230;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x7740;&#x7684;Nginx&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x5E76;&#x52A8;&#x6001;&#x66F4;&#x65B0;</li>
<li>&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#xFF0C;&#x5176;&#x5B9E;&#x771F;&#x6B63;&#x5728;&#x5DE5;&#x4F5C;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x4E2A;Nginx&#x4E86;&#xFF0C;&#x5185;&#x90E8;&#x914D;&#x7F6E;&#x4E86;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x89C4;&#x5219;</li>
</ol>
<p><img src="Kubenetes.assets/image-20200516112704764.png" alt="img"></p>
<h2 id="75-ingress&#x4F7F;&#x7528;">7.5 Ingress&#x4F7F;&#x7528;</h2>
<h3 id="751-&#x73AF;&#x5883;&#x51C6;&#x5907;">7.5.1 &#x73AF;&#x5883;&#x51C6;&#x5907;</h3>
<p><strong>&#x642D;&#x5EFA;ingress&#x73AF;&#x5883;</strong></p>
<pre><code># &#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x5939;
[root@k8s-master01 ~]# mkdir ingress-controller
[root@k8s-master01 ~]# cd ingress-controller/

# &#x83B7;&#x53D6;ingress-nginx&#xFF0C;&#x672C;&#x6B21;&#x6848;&#x4F8B;&#x4F7F;&#x7528;&#x7684;&#x662F;0.30&#x7248;&#x672C;
[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml
[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml

# &#x4FEE;&#x6539;mandatory.yaml&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x4ED3;&#x5E93;
# &#x4FEE;&#x6539;quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0
# &#x4E3A;quay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0
# &#x521B;&#x5EFA;ingress-nginx
[root@k8s-master01 ingress-controller]# kubectl apply -f ./

# &#x67E5;&#x770B;ingress-nginx
[root@k8s-master01 ingress-controller]# kubectl get pod -n ingress-nginx
NAME                                           READY   STATUS    RESTARTS   AGE
pod/nginx-ingress-controller-fbf967dd5-4qpbp   1/1     Running   0          12h

# &#x67E5;&#x770B;service
[root@k8s-master01 ingress-controller]# kubectl get svc -n ingress-nginx
NAME            TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE
ingress-nginx   NodePort   10.98.75.163   &lt;none&gt;        80:32240/TCP,443:31335/TCP   11h
</code></pre><p><strong>&#x51C6;&#x5907;service&#x548C;pod</strong></p>
<p>&#x4E3A;&#x4E86;&#x540E;&#x9762;&#x7684;&#x5B9E;&#x9A8C;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#xFF0C;&#x521B;&#x5EFA;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x7684;&#x6A21;&#x578B;</p>
<p><img src="Kubenetes.assets/image-20200516102419998.png" alt="img"></p>
<p>&#x521B;&#x5EFA;tomcat-nginx.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx-deployment
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx-pod
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>

<span class="hljs-meta">---</span>

<span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> tomcat-deployment
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> tomcat-pod
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> tomcat-pod
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> tomcat
<span class="hljs-attr">        image:</span> tomcat:<span class="hljs-number">8.5</span>-jre10-slim
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">8080</span>

<span class="hljs-meta">---</span>

<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx-service
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> nginx-pod
<span class="hljs-attr">  clusterIP:</span> None
<span class="hljs-attr">  type:</span> ClusterIP
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">80</span>

<span class="hljs-meta">---</span>

<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> tomcat-service
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> tomcat-pod
<span class="hljs-attr">  clusterIP:</span> None
<span class="hljs-attr">  type:</span> ClusterIP
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - port:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">8080</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;
[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml

# &#x67E5;&#x770B;
[root@k8s-master01 ~]# kubectl get svc -n dev
NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE
nginx-service    ClusterIP   None         &lt;none&gt;        80/TCP     48s
tomcat-service   ClusterIP   None         &lt;none&gt;        8080/TCP   48s
</code></pre>
<h3 id="752-http&#x4EE3;&#x7406;">7.5.2 Http&#x4EE3;&#x7406;</h3>
<p>&#x521B;&#x5EFA;ingress-http.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> extensions/v1beta1
<span class="hljs-attr">kind:</span> Ingress
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> ingress-http
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  rules:</span>
<span class="hljs-attr">  - host:</span> nginx.itheima.com
<span class="hljs-attr">    http:</span>
<span class="hljs-attr">      paths:</span>
<span class="hljs-attr">      - path:</span> /
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          serviceName:</span> nginx-service
<span class="hljs-attr">          servicePort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  - host:</span> tomcat.itheima.com
<span class="hljs-attr">    http:</span>
<span class="hljs-attr">      paths:</span>
<span class="hljs-attr">      - path:</span> /
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          serviceName:</span> tomcat-service
<span class="hljs-attr">          servicePort:</span> <span class="hljs-number">8080</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;
[root@k8s-master01 ~]# kubectl create -f ingress-http.yaml
ingress.extensions/ingress-http created

# &#x67E5;&#x770B;
[root@k8s-master01 ~]# kubectl get ing ingress-http -n dev
NAME           HOSTS                                  ADDRESS   PORTS   AGE
ingress-http   nginx.itheima.com,tomcat.itheima.com             80      22s

# &#x67E5;&#x770B;&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl describe ing ingress-http  -n dev
...
Rules:
Host                Path  Backends
----                ----  --------
nginx.itheima.com   / nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)
tomcat.itheima.com  / tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)
...

# &#x63A5;&#x4E0B;&#x6765;,&#x5728;&#x672C;&#x5730;&#x7535;&#x8111;&#x4E0A;&#x914D;&#x7F6E;host&#x6587;&#x4EF6;,&#x89E3;&#x6790;&#x4E0A;&#x9762;&#x7684;&#x4E24;&#x4E2A;&#x57DF;&#x540D;&#x5230;192.168.109.100(master)&#x4E0A;
# &#x7136;&#x540E;,&#x5C31;&#x53EF;&#x4EE5;&#x5206;&#x522B;&#x8BBF;&#x95EE;tomcat.itheima.com:32240  &#x548C;  nginx.itheima.com:32240 &#x67E5;&#x770B;&#x6548;&#x679C;&#x4E86;
</code></pre>
<h3 id="753-https&#x4EE3;&#x7406;">7.5.3 Https&#x4EE3;&#x7406;</h3>
<p>&#x521B;&#x5EFA;&#x8BC1;&#x4E66;</p>
<pre><code class="lang-shell"># &#x751F;&#x6210;&#x8BC1;&#x4E66;
openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj &quot;/C=CN/ST=BJ/L=BJ/O=nginx/CN=itheima.com&quot;

# &#x521B;&#x5EFA;&#x5BC6;&#x94A5;
kubectl create secret tls tls-secret --key tls.key --cert tls.crt
</code></pre>
<p>&#x521B;&#x5EFA;ingress-https.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> extensions/v1beta1
<span class="hljs-attr">kind:</span> Ingress
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> ingress-https
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  tls:</span>
<span class="hljs-attr">    - hosts:</span>
<span class="hljs-bullet">      -</span> nginx.itheima.com
<span class="hljs-bullet">      -</span> tomcat.itheima.com
<span class="hljs-attr">      secretName:</span> tls-secret <span class="hljs-comment"># &#x6307;&#x5B9A;&#x79D8;&#x94A5;</span>
<span class="hljs-attr">  rules:</span>
<span class="hljs-attr">  - host:</span> nginx.itheima.com
<span class="hljs-attr">    http:</span>
<span class="hljs-attr">      paths:</span>
<span class="hljs-attr">      - path:</span> /
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          serviceName:</span> nginx-service
<span class="hljs-attr">          servicePort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  - host:</span> tomcat.itheima.com
<span class="hljs-attr">    http:</span>
<span class="hljs-attr">      paths:</span>
<span class="hljs-attr">      - path:</span> /
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          serviceName:</span> tomcat-service
<span class="hljs-attr">          servicePort:</span> <span class="hljs-number">8080</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;
[root@k8s-master01 ~]# kubectl create -f ingress-https.yaml
ingress.extensions/ingress-https created

# &#x67E5;&#x770B;
[root@k8s-master01 ~]# kubectl get ing ingress-https -n dev
NAME            HOSTS                                  ADDRESS         PORTS     AGE
ingress-https   nginx.itheima.com,tomcat.itheima.com   10.104.184.38   80, 443   2m42s

# &#x67E5;&#x770B;&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev
...
TLS:
  tls-secret terminates nginx.itheima.com,tomcat.itheima.com
Rules:
Host              Path Backends
----              ---- --------
nginx.itheima.com  /  nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)
tomcat.itheima.com /  tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)
...

# &#x4E0B;&#x9762;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;https://nginx.itheima.com:31335 &#x548C; https://tomcat.itheima.com:31335&#x6765;&#x67E5;&#x770B;&#x4E86;
</code></pre>
<h1 id="8-&#x6570;&#x636E;&#x5B58;&#x50A8;">8. &#x6570;&#x636E;&#x5B58;&#x50A8;</h1>
<p>&#x5728;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x63D0;&#x5230;&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x53EF;&#x80FD;&#x5F88;&#x77ED;&#xFF0C;&#x4F1A;&#x88AB;&#x9891;&#x7E41;&#x5730;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x3002;&#x90A3;&#x4E48;&#x5BB9;&#x5668;&#x5728;&#x9500;&#x6BC1;&#x65F6;&#xFF0C;&#x4FDD;&#x5B58;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4E5F;&#x4F1A;&#x88AB;&#x6E05;&#x9664;&#x3002;&#x8FD9;&#x79CD;&#x7ED3;&#x679C;&#x5BF9;&#x7528;&#x6237;&#x6765;&#x8BF4;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x662F;&#x4E0D;&#x4E50;&#x610F;&#x770B;&#x5230;&#x7684;&#x3002;&#x4E3A;&#x4E86;&#x6301;&#x4E45;&#x5316;&#x4FDD;&#x5B58;&#x5BB9;&#x5668;&#x7684;&#x6570;&#x636E;&#xFF0C;kubernetes&#x5F15;&#x5165;&#x4E86;Volume&#x7684;&#x6982;&#x5FF5;&#x3002;</p>
<p>Volume&#x662F;Pod&#x4E2D;&#x80FD;&#x591F;&#x88AB;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x8BBF;&#x95EE;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#xFF0C;&#x5B83;&#x88AB;&#x5B9A;&#x4E49;&#x5728;Pod&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x88AB;&#x4E00;&#x4E2A;Pod&#x91CC;&#x7684;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x6302;&#x8F7D;&#x5230;&#x5177;&#x4F53;&#x7684;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;kubernetes&#x901A;&#x8FC7;Volume&#x5B9E;&#x73B0;&#x540C;&#x4E00;&#x4E2A;Pod&#x4E2D;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x5171;&#x4EAB;&#x4EE5;&#x53CA;&#x6570;&#x636E;&#x7684;&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;&#x3002;Volume&#x7684;&#x751F;&#x547D;&#x5BB9;&#x5668;&#x4E0D;&#x4E0E;Pod&#x4E2D;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x76F8;&#x5173;&#xFF0C;&#x5F53;&#x5BB9;&#x5668;&#x7EC8;&#x6B62;&#x6216;&#x8005;&#x91CD;&#x542F;&#x65F6;&#xFF0C;Volume&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4E5F;&#x4E0D;&#x4F1A;&#x4E22;&#x5931;&#x3002;</p>
<p>kubernetes&#x7684;Volume&#x652F;&#x6301;&#x591A;&#x79CD;&#x7C7B;&#x578B;&#xFF0C;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x7684;&#x6709;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#xFF1A;</p>
<ul>
<li>&#x7B80;&#x5355;&#x5B58;&#x50A8;&#xFF1A;EmptyDir&#x3001;HostPath&#x3001;NFS</li>
<li>&#x9AD8;&#x7EA7;&#x5B58;&#x50A8;&#xFF1A;PV&#x3001;PVC</li>
<li>&#x914D;&#x7F6E;&#x5B58;&#x50A8;&#xFF1A;ConfigMap&#x3001;Secret</li>
</ul>
<h2 id="81-&#x57FA;&#x672C;&#x5B58;&#x50A8;">8.1 &#x57FA;&#x672C;&#x5B58;&#x50A8;</h2>
<h3 id="811-emptydir">8.1.1 EmptyDir</h3>
<p>EmptyDir&#x662F;&#x6700;&#x57FA;&#x7840;&#x7684;Volume&#x7C7B;&#x578B;&#xFF0C;&#x4E00;&#x4E2A;EmptyDir&#x5C31;&#x662F;Host&#x4E0A;&#x7684;&#x4E00;&#x4E2A;&#x7A7A;&#x76EE;&#x5F55;&#x3002;</p>
<p>EmptyDir&#x662F;&#x5728;Pod&#x88AB;&#x5206;&#x914D;&#x5230;Node&#x65F6;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x5B83;&#x7684;&#x521D;&#x59CB;&#x5185;&#x5BB9;&#x4E3A;&#x7A7A;&#xFF0C;&#x5E76;&#x4E14;&#x65E0;&#x987B;&#x6307;&#x5B9A;&#x5BBF;&#x4E3B;&#x673A;&#x4E0A;&#x5BF9;&#x5E94;&#x7684;&#x76EE;&#x5F55;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;kubernetes&#x4F1A;&#x81EA;&#x52A8;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x5F53;Pod&#x9500;&#x6BC1;&#x65F6;&#xFF0C; EmptyDir&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4E5F;&#x4F1A;&#x88AB;&#x6C38;&#x4E45;&#x5220;&#x9664;&#x3002; EmptyDir&#x7528;&#x9014;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x4E34;&#x65F6;&#x7A7A;&#x95F4;&#xFF0C;&#x4F8B;&#x5982;&#x7528;&#x4E8E;&#x67D0;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x6240;&#x9700;&#x7684;&#x4E34;&#x65F6;&#x76EE;&#x5F55;&#xFF0C;&#x4E14;&#x65E0;&#x987B;&#x6C38;&#x4E45;&#x4FDD;&#x7559;</li>
<li>&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x9700;&#x8981;&#x4ECE;&#x53E6;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x7684;&#x76EE;&#x5F55;&#xFF08;&#x591A;&#x5BB9;&#x5668;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#xFF09;</li>
</ul>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x6587;&#x4EF6;&#x5171;&#x4EAB;&#x7684;&#x6848;&#x4F8B;&#x6765;&#x4F7F;&#x7528;&#x4E00;&#x4E0B;EmptyDir&#x3002;</p>
<p>&#x5728;&#x4E00;&#x4E2A;Pod&#x4E2D;&#x51C6;&#x5907;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;nginx&#x548C;busybox&#xFF0C;&#x7136;&#x540E;&#x58F0;&#x660E;&#x4E00;&#x4E2A;Volume&#x5206;&#x522B;&#x6302;&#x5728;&#x5230;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x7136;&#x540E;nginx&#x5BB9;&#x5668;&#x8D1F;&#x8D23;&#x5411;Volume&#x4E2D;&#x5199;&#x65E5;&#x5FD7;&#xFF0C;busybox&#x4E2D;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x5C06;&#x65E5;&#x5FD7;&#x5185;&#x5BB9;&#x8BFB;&#x5230;&#x63A7;&#x5236;&#x53F0;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200413174713773.png" alt="img"></p>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;volume-emptydir.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> volume-emptydir
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    volumeMounts:</span>  <span class="hljs-comment"># &#x5C06;logs-volume&#x6302;&#x5728;&#x5230;nginx&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x76EE;&#x5F55;&#x4E3A; /var/log/nginx</span>
<span class="hljs-attr">    - name:</span> logs-volume
<span class="hljs-attr">      mountPath:</span> /var/log/nginx
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;tail -f /logs/access.log&quot;</span>] <span class="hljs-comment"># &#x521D;&#x59CB;&#x547D;&#x4EE4;&#xFF0C;&#x52A8;&#x6001;&#x8BFB;&#x53D6;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x4E2D;&#x5185;&#x5BB9;</span>
<span class="hljs-attr">    volumeMounts:</span>  <span class="hljs-comment"># &#x5C06;logs-volume &#x6302;&#x5728;&#x5230;busybox&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x76EE;&#x5F55;&#x4E3A; /logs</span>
<span class="hljs-attr">    - name:</span> logs-volume
<span class="hljs-attr">      mountPath:</span> /logs
<span class="hljs-attr">  volumes:</span> <span class="hljs-comment"># &#x58F0;&#x660E;volume&#xFF0C; name&#x4E3A;logs-volume&#xFF0C;&#x7C7B;&#x578B;&#x4E3A;emptyDir</span>
<span class="hljs-attr">  - name:</span> logs-volume
<span class="hljs-attr">    emptyDir:</span> {}
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yaml
pod/volume-emptydir created

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wide
NAME                  READY   STATUS    RESTARTS   AGE      IP       NODE   ...... 
volume-emptydir       2/2     Running   0          97s   10.42.2.9   node1  ......

# &#x901A;&#x8FC7;podIp&#x8BBF;&#x95EE;nginx
[root@k8s-master01 ~]# curl 10.42.2.9
......

# &#x901A;&#x8FC7;kubectl logs&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;
[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox
10.42.1.0 - - [27/Jun/2021:15:08:54 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot;
</code></pre>
<h3 id="812-hostpath">8.1.2 HostPath</h3>
<p>&#x4E0A;&#x8282;&#x8BFE;&#x63D0;&#x5230;&#xFF0C;EmptyDir&#x4E2D;&#x6570;&#x636E;&#x4E0D;&#x4F1A;&#x88AB;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x5B83;&#x4F1A;&#x968F;&#x7740;Pod&#x7684;&#x7ED3;&#x675F;&#x800C;&#x9500;&#x6BC1;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x7B80;&#x5355;&#x7684;&#x5C06;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x5230;&#x4E3B;&#x673A;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;HostPath&#x3002;</p>
<p>HostPath&#x5C31;&#x662F;&#x5C06;Node&#x4E3B;&#x673A;&#x4E2D;&#x4E00;&#x4E2A;&#x5B9E;&#x9645;&#x76EE;&#x5F55;&#x6302;&#x5728;&#x5230;Pod&#x4E2D;&#xFF0C;&#x4EE5;&#x4F9B;&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x5C31;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;Pod&#x9500;&#x6BC1;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x636E;&#x4F9D;&#x636E;&#x53EF;&#x4EE5;&#x5B58;&#x5728;&#x4E8E;Node&#x4E3B;&#x673A;&#x4E0A;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200413214031331.png" alt="img"></p>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;volume-hostpath.yaml&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> volume-hostpath
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> logs-volume
<span class="hljs-attr">      mountPath:</span> /var/log/nginx
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;tail -f /logs/access.log&quot;</span>]
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> logs-volume
<span class="hljs-attr">      mountPath:</span> /logs
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> logs-volume
<span class="hljs-attr">    hostPath:</span> 
<span class="hljs-attr">      path:</span> /root/logs
<span class="hljs-attr">      type:</span> DirectoryOrCreate  <span class="hljs-comment"># &#x76EE;&#x5F55;&#x5B58;&#x5728;&#x5C31;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x5148;&#x521B;&#x5EFA;&#x540E;&#x4F7F;&#x7528;</span>
</code></pre>
<pre><code>&#x5173;&#x4E8E;type&#x7684;&#x503C;&#x7684;&#x4E00;&#x70B9;&#x8BF4;&#x660E;&#xFF1A;
    DirectoryOrCreate &#x76EE;&#x5F55;&#x5B58;&#x5728;&#x5C31;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x5148;&#x521B;&#x5EFA;&#x540E;&#x4F7F;&#x7528;
    Directory   &#x76EE;&#x5F55;&#x5FC5;&#x987B;&#x5B58;&#x5728;
    FileOrCreate  &#x6587;&#x4EF6;&#x5B58;&#x5728;&#x5C31;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x5148;&#x521B;&#x5EFA;&#x540E;&#x4F7F;&#x7528;
    File &#x6587;&#x4EF6;&#x5FC5;&#x987B;&#x5B58;&#x5728; 
    Socket  unix&#x5957;&#x63A5;&#x5B57;&#x5FC5;&#x987B;&#x5B58;&#x5728;
    CharDevice  &#x5B57;&#x7B26;&#x8BBE;&#x5907;&#x5FC5;&#x987B;&#x5B58;&#x5728;
    BlockDevice &#x5757;&#x8BBE;&#x5907;&#x5FC5;&#x987B;&#x5B58;&#x5728;
</code></pre><pre><code class="lang-shell"># &#x521B;&#x5EFA;Pod
[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yaml
pod/volume-hostpath created

# &#x67E5;&#x770B;Pod
[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wide
NAME                  READY   STATUS    RESTARTS   AGE   IP             NODE   ......
pod-volume-hostpath   2/2     Running   0          16s   10.42.2.10     node1  ......

#&#x8BBF;&#x95EE;nginx
[root@k8s-master01 ~]# curl 10.42.2.10

# &#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x53EF;&#x4EE5;&#x53BB;host&#x7684;/root/logs&#x76EE;&#x5F55;&#x4E0B;&#x67E5;&#x770B;&#x5B58;&#x50A8;&#x7684;&#x6587;&#x4EF6;&#x4E86;
###  &#x6CE8;&#x610F;: &#x4E0B;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x5230;Pod&#x6240;&#x5728;&#x7684;&#x8282;&#x70B9;&#x8FD0;&#x884C;&#xFF08;&#x6848;&#x4F8B;&#x4E2D;&#x662F;node1&#xFF09;
[root@node1 ~]# ls /root/logs/
access.log  error.log

# &#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x6B64;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5230;&#x5BB9;&#x5668;&#x4E2D;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7684;
</code></pre>
<h3 id="813-nfs">8.1.3 NFS</h3>
<p>HostPath&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x65E6;Node&#x8282;&#x70B9;&#x6545;&#x969C;&#x4E86;&#xFF0C;Pod&#x5982;&#x679C;&#x8F6C;&#x79FB;&#x5230;&#x4E86;&#x522B;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x53C8;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x51C6;&#x5907;&#x5355;&#x72EC;&#x7684;&#x7F51;&#x7EDC;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#xFF0C;&#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684;&#x7528;NFS&#x3001;CIFS&#x3002;</p>
<p>NFS&#x662F;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#xFF0C;&#x53EF;&#x4EE5;&#x642D;&#x5EFA;&#x4E00;&#x53F0;NFS&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x5C06;Pod&#x4E2D;&#x7684;&#x5B58;&#x50A8;&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x5230;NFS&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x65E0;&#x8BBA;Pod&#x5728;&#x8282;&#x70B9;&#x4E0A;&#x600E;&#x4E48;&#x8F6C;&#x79FB;&#xFF0C;&#x53EA;&#x8981;Node&#x8DDF;NFS&#x7684;&#x5BF9;&#x63A5;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x6570;&#x636E;&#x5C31;&#x53EF;&#x4EE5;&#x6210;&#x529F;&#x8BBF;&#x95EE;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200413215133559.png" alt="img"></p>
<p>1&#xFF09;&#x9996;&#x5148;&#x8981;&#x51C6;&#x5907;nfs&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x662F;master&#x8282;&#x70B9;&#x505A;nfs&#x670D;&#x52A1;&#x5668;</p>
<pre><code class="lang-shell"># &#x5728;nfs&#x4E0A;&#x5B89;&#x88C5;nfs&#x670D;&#x52A1;
[root@nfs ~]# yum install nfs-utils -y

# &#x51C6;&#x5907;&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x76EE;&#x5F55;
[root@nfs ~]# mkdir /root/data/nfs -pv

# &#x5C06;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x4EE5;&#x8BFB;&#x5199;&#x6743;&#x9650;&#x66B4;&#x9732;&#x7ED9;192.168.5.0/24&#x7F51;&#x6BB5;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x4E3B;&#x673A;
[root@nfs ~]# vim /etc/exports
[root@nfs ~]# more /etc/exports
/root/data/nfs     192.168.5.0/24(rw,no_root_squash)

# &#x542F;&#x52A8;nfs&#x670D;&#x52A1;
[root@nfs ~]# systemctl restart nfs
</code></pre>
<p>2&#xFF09;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x8981;&#x5728;&#x7684;&#x6BCF;&#x4E2A;node&#x8282;&#x70B9;&#x4E0A;&#x90FD;&#x5B89;&#x88C5;&#x4E0B;nfs&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;node&#x8282;&#x70B9;&#x53EF;&#x4EE5;&#x9A71;&#x52A8;nfs&#x8BBE;&#x5907;</p>
<pre><code class="lang-shell"># &#x5728;node&#x4E0A;&#x5B89;&#x88C5;nfs&#x670D;&#x52A1;&#xFF0C;&#x6CE8;&#x610F;&#x4E0D;&#x9700;&#x8981;&#x542F;&#x52A8;
[root@k8s-master01 ~]# yum install nfs-utils -y
</code></pre>
<p>3&#xFF09;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7F16;&#x5199;pod&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x521B;&#x5EFA;volume-nfs.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> volume-nfs
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> logs-volume
<span class="hljs-attr">      mountPath:</span> /var/log/nginx
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;tail -f /logs/access.log&quot;</span>] 
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> logs-volume
<span class="hljs-attr">      mountPath:</span> /logs
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> logs-volume
<span class="hljs-attr">    nfs:</span>
<span class="hljs-attr">      server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.5</span><span class="hljs-number">.6</span>  <span class="hljs-comment">#nfs&#x670D;&#x52A1;&#x5668;&#x5730;&#x5740;</span>
<span class="hljs-attr">      path:</span> /root/data/nfs <span class="hljs-comment">#&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;</span>
</code></pre>
<p>4&#xFF09;&#x6700;&#x540E;&#xFF0C;&#x8FD0;&#x884C;&#x4E0B;pod&#xFF0C;&#x89C2;&#x5BDF;&#x7ED3;&#x679C;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f volume-nfs.yaml
pod/volume-nfs created

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods volume-nfs -n dev
NAME                  READY   STATUS    RESTARTS   AGE
volume-nfs        2/2     Running   0          2m9s

# &#x67E5;&#x770B;nfs&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#xFF0C;&#x53D1;&#x73B0;&#x5DF2;&#x7ECF;&#x6709;&#x6587;&#x4EF6;&#x4E86;
[root@k8s-master01 ~]# ls /root/data/
access.log  error.log
</code></pre>
<h2 id="82-&#x9AD8;&#x7EA7;&#x5B58;&#x50A8;">8.2 &#x9AD8;&#x7EA7;&#x5B58;&#x50A8;</h2>
<p>&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x5B66;&#x4E60;&#x4E86;&#x4F7F;&#x7528;NFS&#x63D0;&#x4F9B;&#x5B58;&#x50A8;&#xFF0C;&#x6B64;&#x65F6;&#x5C31;&#x8981;&#x6C42;&#x7528;&#x6237;&#x4F1A;&#x642D;&#x5EFA;NFS&#x7CFB;&#x7EDF;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5728;yaml&#x914D;&#x7F6E;nfs&#x3002;&#x7531;&#x4E8E;kubernetes&#x652F;&#x6301;&#x7684;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x8981;&#x6C42;&#x5BA2;&#x6237;&#x5168;&#x90FD;&#x638C;&#x63E1;&#xFF0C;&#x663E;&#x7136;&#x4E0D;&#x73B0;&#x5B9E;&#x3002;&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x5C4F;&#x853D;&#x5E95;&#x5C42;&#x5B58;&#x50A8;&#x5B9E;&#x73B0;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x65B9;&#x4FBF;&#x7528;&#x6237;&#x4F7F;&#x7528;&#xFF0C; kubernetes&#x5F15;&#x5165;PV&#x548C;PVC&#x4E24;&#x79CD;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x3002;</p>
<p>PV&#xFF08;Persistent Volume&#xFF09;&#x662F;&#x6301;&#x4E45;&#x5316;&#x5377;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x662F;&#x5BF9;&#x5E95;&#x5C42;&#x7684;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x7684;&#x4E00;&#x79CD;&#x62BD;&#x8C61;&#x3002;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;PV&#x7531;kubernetes&#x7BA1;&#x7406;&#x5458;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x5B83;&#x4E0E;&#x5E95;&#x5C42;&#x5177;&#x4F53;&#x7684;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x6280;&#x672F;&#x6709;&#x5173;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x5B8C;&#x6210;&#x4E0E;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x7684;&#x5BF9;&#x63A5;&#x3002;</p>
<p>PVC&#xFF08;Persistent Volume Claim&#xFF09;&#x662F;&#x6301;&#x4E45;&#x5377;&#x58F0;&#x660E;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x662F;&#x7528;&#x6237;&#x5BF9;&#x4E8E;&#x5B58;&#x50A8;&#x9700;&#x6C42;&#x7684;&#x4E00;&#x79CD;&#x58F0;&#x660E;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;PVC&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x7528;&#x6237;&#x5411;kubernetes&#x7CFB;&#x7EDF;&#x53D1;&#x51FA;&#x7684;&#x4E00;&#x79CD;&#x8D44;&#x6E90;&#x9700;&#x6C42;&#x7533;&#x8BF7;&#x3002;</p>
<p><img src="Kubenetes.assets/image-20200514194111567.png" alt="img"></p>
<p>&#x4F7F;&#x7528;&#x4E86;PV&#x548C;PVC&#x4E4B;&#x540E;&#xFF0C;&#x5DE5;&#x4F5C;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x7EC6;&#x5206;&#xFF1A;</p>
<ul>
<li>&#x5B58;&#x50A8;&#xFF1A;&#x5B58;&#x50A8;&#x5DE5;&#x7A0B;&#x5E08;&#x7EF4;&#x62A4;</li>
<li>PV&#xFF1A; kubernetes&#x7BA1;&#x7406;&#x5458;&#x7EF4;&#x62A4;</li>
<li>PVC&#xFF1A;kubernetes&#x7528;&#x6237;&#x7EF4;&#x62A4;</li>
</ul>
<h3 id="821-pv">8.2.1 PV</h3>
<p>PV&#x662F;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#x6587;&#x4EF6;:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1  
<span class="hljs-attr">kind:</span> PersistentVolume
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pv2
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  nfs:</span> <span class="hljs-comment"># &#x5B58;&#x50A8;&#x7C7B;&#x578B;&#xFF0C;&#x4E0E;&#x5E95;&#x5C42;&#x771F;&#x6B63;&#x5B58;&#x50A8;&#x5BF9;&#x5E94;</span>
<span class="hljs-attr">  capacity:</span>  <span class="hljs-comment"># &#x5B58;&#x50A8;&#x80FD;&#x529B;&#xFF0C;&#x76EE;&#x524D;&#x53EA;&#x652F;&#x6301;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x7684;&#x8BBE;&#x7F6E;</span>
<span class="hljs-attr">    storage:</span> <span class="hljs-number">2</span>Gi
<span class="hljs-attr">  accessModes:</span>  <span class="hljs-comment"># &#x8BBF;&#x95EE;&#x6A21;&#x5F0F;</span>
<span class="hljs-attr">  storageClassName:</span> <span class="hljs-comment"># &#x5B58;&#x50A8;&#x7C7B;&#x522B;</span>
<span class="hljs-attr">  persistentVolumeReclaimPolicy:</span> <span class="hljs-comment"># &#x56DE;&#x6536;&#x7B56;&#x7565;</span>
</code></pre>
<p>PV &#x7684;&#x5173;&#x952E;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x8BF4;&#x660E;&#xFF1A;</p>
<ul>
<li><p><strong>&#x5B58;&#x50A8;&#x7C7B;&#x578B;</strong></p>
<p>&#x5E95;&#x5C42;&#x5B9E;&#x9645;&#x5B58;&#x50A8;&#x7684;&#x7C7B;&#x578B;&#xFF0C;kubernetes&#x652F;&#x6301;&#x591A;&#x79CD;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#xFF0C;&#x6BCF;&#x79CD;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x7684;&#x914D;&#x7F6E;&#x90FD;&#x6709;&#x6240;&#x5DEE;&#x5F02;</p>
</li>
<li><p><strong>&#x5B58;&#x50A8;&#x80FD;&#x529B;&#xFF08;capacity&#xFF09;</strong></p>
</li>
</ul>
<p>&#x76EE;&#x524D;&#x53EA;&#x652F;&#x6301;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x7684;&#x8BBE;&#x7F6E;( storage=1Gi )&#xFF0C;&#x4E0D;&#x8FC7;&#x672A;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x52A0;&#x5165;IOPS&#x3001;&#x541E;&#x5410;&#x91CF;&#x7B49;&#x6307;&#x6807;&#x7684;&#x914D;&#x7F6E;</p>
<ul>
<li><p><strong>&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;&#xFF08;accessModes&#xFF09;</strong></p>
<p>&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x7528;&#x6237;&#x5E94;&#x7528;&#x5BF9;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#xFF0C;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x5305;&#x62EC;&#x4E0B;&#x9762;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ul>
<li>ReadWriteOnce&#xFF08;RWO&#xFF09;&#xFF1A;&#x8BFB;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x4F46;&#x662F;&#x53EA;&#x80FD;&#x88AB;&#x5355;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x8F7D;</li>
<li>ReadOnlyMany&#xFF08;ROX&#xFF09;&#xFF1A; &#x53EA;&#x8BFB;&#x6743;&#x9650;&#xFF0C;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x8F7D;</li>
<li>ReadWriteMany&#xFF08;RWX&#xFF09;&#xFF1A;&#x8BFB;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x8F7D;</li>
</ul>
<p><code>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5E95;&#x5C42;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x53EF;&#x80FD;&#x652F;&#x6301;&#x7684;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;&#x4E0D;&#x540C;</code></p>
</li>
<li><p><strong>&#x56DE;&#x6536;&#x7B56;&#x7565;&#xFF08;persistentVolumeReclaimPolicy&#xFF09;</strong></p>
<p>&#x5F53;PV&#x4E0D;&#x518D;&#x88AB;&#x4F7F;&#x7528;&#x4E86;&#x4E4B;&#x540E;&#xFF0C;&#x5BF9;&#x5176;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x3002;&#x76EE;&#x524D;&#x652F;&#x6301;&#x4E09;&#x79CD;&#x7B56;&#x7565;&#xFF1A;</p>
<ul>
<li>Retain &#xFF08;&#x4FDD;&#x7559;&#xFF09; &#x4FDD;&#x7559;&#x6570;&#x636E;&#xFF0C;&#x9700;&#x8981;&#x7BA1;&#x7406;&#x5458;&#x624B;&#x5DE5;&#x6E05;&#x7406;&#x6570;&#x636E;</li>
<li>Recycle&#xFF08;&#x56DE;&#x6536;&#xFF09; &#x6E05;&#x9664; PV &#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6548;&#x679C;&#x76F8;&#x5F53;&#x4E8E;&#x6267;&#x884C; rm -rf /thevolume/*</li>
<li>Delete &#xFF08;&#x5220;&#x9664;&#xFF09; &#x4E0E; PV &#x76F8;&#x8FDE;&#x7684;&#x540E;&#x7AEF;&#x5B58;&#x50A8;&#x5B8C;&#x6210; volume &#x7684;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x5E38;&#x89C1;&#x4E8E;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x7684;&#x5B58;&#x50A8;&#x670D;&#x52A1;</li>
</ul>
<p><code>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5E95;&#x5C42;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x53EF;&#x80FD;&#x652F;&#x6301;&#x7684;&#x56DE;&#x6536;&#x7B56;&#x7565;&#x4E0D;&#x540C;</code></p>
</li>
<li><p><strong>&#x5B58;&#x50A8;&#x7C7B;&#x522B;</strong></p>
<p>PV&#x53EF;&#x4EE5;&#x901A;&#x8FC7;storageClassName&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#x7C7B;&#x522B;</p>
<ul>
<li>&#x5177;&#x6709;&#x7279;&#x5B9A;&#x7C7B;&#x522B;&#x7684;PV&#x53EA;&#x80FD;&#x4E0E;&#x8BF7;&#x6C42;&#x4E86;&#x8BE5;&#x7C7B;&#x522B;&#x7684;PVC&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;</li>
<li>&#x672A;&#x8BBE;&#x5B9A;&#x7C7B;&#x522B;&#x7684;PV&#x5219;&#x53EA;&#x80FD;&#x4E0E;&#x4E0D;&#x8BF7;&#x6C42;&#x4EFB;&#x4F55;&#x7C7B;&#x522B;&#x7684;PVC&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;</li>
</ul>
</li>
<li><p><strong>&#x72B6;&#x6001;&#xFF08;status&#xFF09;</strong></p>
<p>&#x4E00;&#x4E2A; PV &#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5904;&#x4E8E;4&#x4E2D;&#x4E0D;&#x540C;&#x7684;&#x9636;&#x6BB5;&#xFF1A;</p>
<ul>
<li>Available&#xFF08;&#x53EF;&#x7528;&#xFF09;&#xFF1A; &#x8868;&#x793A;&#x53EF;&#x7528;&#x72B6;&#x6001;&#xFF0C;&#x8FD8;&#x672A;&#x88AB;&#x4EFB;&#x4F55; PVC &#x7ED1;&#x5B9A;</li>
<li>Bound&#xFF08;&#x5DF2;&#x7ED1;&#x5B9A;&#xFF09;&#xFF1A; &#x8868;&#x793A; PV &#x5DF2;&#x7ECF;&#x88AB; PVC &#x7ED1;&#x5B9A;</li>
<li>Released&#xFF08;&#x5DF2;&#x91CA;&#x653E;&#xFF09;&#xFF1A; &#x8868;&#x793A; PVC &#x88AB;&#x5220;&#x9664;&#xFF0C;&#x4F46;&#x662F;&#x8D44;&#x6E90;&#x8FD8;&#x672A;&#x88AB;&#x96C6;&#x7FA4;&#x91CD;&#x65B0;&#x58F0;&#x660E;</li>
<li>Failed&#xFF08;&#x5931;&#x8D25;&#xFF09;&#xFF1A; &#x8868;&#x793A;&#x8BE5; PV &#x7684;&#x81EA;&#x52A8;&#x56DE;&#x6536;&#x5931;&#x8D25;</li>
</ul>
</li>
</ul>
<p><strong>&#x5B9E;&#x9A8C;</strong></p>
<p>&#x4F7F;&#x7528;NFS&#x4F5C;&#x4E3A;&#x5B58;&#x50A8;&#xFF0C;&#x6765;&#x6F14;&#x793A;PV&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x521B;&#x5EFA;3&#x4E2A;PV&#xFF0C;&#x5BF9;&#x5E94;NFS&#x4E2D;&#x7684;3&#x4E2A;&#x66B4;&#x9732;&#x7684;&#x8DEF;&#x5F84;&#x3002;</p>
<p>1) &#x51C6;&#x5907;NFS&#x73AF;&#x5883;</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;&#x76EE;&#x5F55;
[root@nfs ~]# mkdir /root/data/{pv1,pv2,pv3} -pv

# &#x66B4;&#x9732;&#x670D;&#x52A1;
[root@nfs ~]# more /etc/exports
/root/data/pv1     192.168.5.0/24(rw,no_root_squash)
/root/data/pv2     192.168.5.0/24(rw,no_root_squash)
/root/data/pv3     192.168.5.0/24(rw,no_root_squash)

# &#x91CD;&#x542F;&#x670D;&#x52A1;
[root@nfs ~]#  systemctl restart nfs
</code></pre>
<p>2) &#x521B;&#x5EFA;pv.yaml</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolume
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span>  pv1
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  capacity:</span> 
<span class="hljs-attr">    storage:</span> <span class="hljs-number">1</span>Gi
<span class="hljs-attr">  accessModes:</span>
<span class="hljs-bullet">  -</span> ReadWriteMany
<span class="hljs-attr">  persistentVolumeReclaimPolicy:</span> Retain
<span class="hljs-attr">  nfs:</span>
<span class="hljs-attr">    path:</span> /root/data/pv1
<span class="hljs-attr">    server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.5</span><span class="hljs-number">.6</span>

<span class="hljs-meta">---</span>

<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolume
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span>  pv2
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  capacity:</span> 
<span class="hljs-attr">    storage:</span> <span class="hljs-number">2</span>Gi
<span class="hljs-attr">  accessModes:</span>
<span class="hljs-bullet">  -</span> ReadWriteMany
<span class="hljs-attr">  persistentVolumeReclaimPolicy:</span> Retain
<span class="hljs-attr">  nfs:</span>
<span class="hljs-attr">    path:</span> /root/data/pv2
<span class="hljs-attr">    server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.5</span><span class="hljs-number">.6</span>

<span class="hljs-meta">---</span>

<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolume
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span>  pv3
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  capacity:</span> 
<span class="hljs-attr">    storage:</span> <span class="hljs-number">3</span>Gi
<span class="hljs-attr">  accessModes:</span>
<span class="hljs-bullet">  -</span> ReadWriteMany
<span class="hljs-attr">  persistentVolumeReclaimPolicy:</span> Retain
<span class="hljs-attr">  nfs:</span>
<span class="hljs-attr">    path:</span> /root/data/pv3
<span class="hljs-attr">    server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.5</span><span class="hljs-number">.6</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA; pv
[root@k8s-master01 ~]# kubectl create -f pv.yaml
persistentvolume/pv1 created
persistentvolume/pv2 created
persistentvolume/pv3 created

# &#x67E5;&#x770B;pv
[root@k8s-master01 ~]# kubectl get pv -o wide
NAME   CAPACITY   ACCESS MODES  RECLAIM POLICY  STATUS      AGE   VOLUMEMODE
pv1    1Gi        RWX            Retain        Available    10s   Filesystem
pv2    2Gi        RWX            Retain        Available    10s   Filesystem
pv3    3Gi        RWX            Retain        Available    9s    Filesystem
</code></pre>
<h3 id="822-pvc">8.2.2 PVC</h3>
<p>PVC&#x662F;&#x8D44;&#x6E90;&#x7684;&#x7533;&#x8BF7;&#xFF0C;&#x7528;&#x6765;&#x58F0;&#x660E;&#x5BF9;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x3001;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;&#x3001;&#x5B58;&#x50A8;&#x7C7B;&#x522B;&#x9700;&#x6C42;&#x4FE1;&#x606F;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x8D44;&#x6E90;&#x6E05;&#x5355;&#x6587;&#x4EF6;:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolumeClaim
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pvc
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  accessModes:</span> <span class="hljs-comment"># &#x8BBF;&#x95EE;&#x6A21;&#x5F0F;</span>
<span class="hljs-attr">  selector:</span> <span class="hljs-comment"># &#x91C7;&#x7528;&#x6807;&#x7B7E;&#x5BF9;PV&#x9009;&#x62E9;</span>
<span class="hljs-attr">  storageClassName:</span> <span class="hljs-comment"># &#x5B58;&#x50A8;&#x7C7B;&#x522B;</span>
<span class="hljs-attr">  resources:</span> <span class="hljs-comment"># &#x8BF7;&#x6C42;&#x7A7A;&#x95F4;</span>
<span class="hljs-attr">    requests:</span>
<span class="hljs-attr">      storage:</span> <span class="hljs-number">5</span>Gi
</code></pre>
<p>PVC &#x7684;&#x5173;&#x952E;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x8BF4;&#x660E;&#xFF1A;</p>
<ul>
<li><strong>&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;&#xFF08;accessModes&#xFF09;</strong></li>
</ul>
<p>&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x7528;&#x6237;&#x5E94;&#x7528;&#x5BF9;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;</p>
<ul>
<li><p><strong>&#x9009;&#x62E9;&#x6761;&#x4EF6;&#xFF08;selector&#xFF09;</strong></p>
<p>&#x901A;&#x8FC7;Label Selector&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x53EF;&#x4F7F;PVC&#x5BF9;&#x4E8E;&#x7CFB;&#x7EDF;&#x4E2D;&#x5DF1;&#x5B58;&#x5728;&#x7684;PV&#x8FDB;&#x884C;&#x7B5B;&#x9009;</p>
</li>
<li><p><strong>&#x5B58;&#x50A8;&#x7C7B;&#x522B;&#xFF08;storageClassName&#xFF09;</strong></p>
<p>PVC&#x5728;&#x5B9A;&#x4E49;&#x65F6;&#x53EF;&#x4EE5;&#x8BBE;&#x5B9A;&#x9700;&#x8981;&#x7684;&#x540E;&#x7AEF;&#x5B58;&#x50A8;&#x7684;&#x7C7B;&#x522B;&#xFF0C;&#x53EA;&#x6709;&#x8BBE;&#x7F6E;&#x4E86;&#x8BE5;class&#x7684;pv&#x624D;&#x80FD;&#x88AB;&#x7CFB;&#x7EDF;&#x9009;&#x51FA;</p>
</li>
<li><p><strong>&#x8D44;&#x6E90;&#x8BF7;&#x6C42;&#xFF08;Resources &#xFF09;</strong></p>
<p>&#x63CF;&#x8FF0;&#x5BF9;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x7684;&#x8BF7;&#x6C42;</p>
</li>
</ul>
<p><strong>&#x5B9E;&#x9A8C;</strong></p>
<p>1) &#x521B;&#x5EFA;pvc.yaml&#xFF0C;&#x7533;&#x8BF7;pv</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolumeClaim
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pvc1
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  accessModes:</span> 
<span class="hljs-bullet">  -</span> ReadWriteMany
<span class="hljs-attr">  resources:</span>
<span class="hljs-attr">    requests:</span>
<span class="hljs-attr">      storage:</span> <span class="hljs-number">1</span>Gi
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolumeClaim
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pvc2
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  accessModes:</span> 
<span class="hljs-bullet">  -</span> ReadWriteMany
<span class="hljs-attr">  resources:</span>
<span class="hljs-attr">    requests:</span>
<span class="hljs-attr">      storage:</span> <span class="hljs-number">1</span>Gi
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolumeClaim
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pvc3
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  accessModes:</span> 
<span class="hljs-bullet">  -</span> ReadWriteMany
<span class="hljs-attr">  resources:</span>
<span class="hljs-attr">    requests:</span>
<span class="hljs-attr">      storage:</span> <span class="hljs-number">1</span>Gi
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pvc
[root@k8s-master01 ~]# kubectl create -f pvc.yaml
persistentvolumeclaim/pvc1 created
persistentvolumeclaim/pvc2 created
persistentvolumeclaim/pvc3 created

# &#x67E5;&#x770B;pvc
[root@k8s-master01 ~]# kubectl get pvc  -n dev -o wide
NAME   STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE
pvc1   Bound    pv1      1Gi        RWX                           15s   Filesystem
pvc2   Bound    pv2      2Gi        RWX                           15s   Filesystem
pvc3   Bound    pv3      3Gi        RWX                           15s   Filesystem

# &#x67E5;&#x770B;pv
[root@k8s-master01 ~]# kubectl get pv -o wide
NAME  CAPACITY ACCESS MODES  RECLAIM POLICY  STATUS    CLAIM       AGE     VOLUMEMODE
pv1    1Gi        RWx        Retain          Bound    dev/pvc1    3h37m    Filesystem
pv2    2Gi        RWX        Retain          Bound    dev/pvc2    3h37m    Filesystem
pv3    3Gi        RWX        Retain          Bound    dev/pvc3    3h37m    Filesystem
</code></pre>
<p>2) &#x521B;&#x5EFA;pods.yaml, &#x4F7F;&#x7528;pv</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod1
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 10; done;&quot;</span>]
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> volume
<span class="hljs-attr">      mountPath:</span> /root/
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">    - name:</span> volume
<span class="hljs-attr">      persistentVolumeClaim:</span>
<span class="hljs-attr">        claimName:</span> pvc1
<span class="hljs-attr">        readOnly:</span> <span class="hljs-literal">false</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod2
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> busybox
<span class="hljs-attr">    image:</span> busybox:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;while true;do echo pod2 &gt;&gt; /root/out.txt; sleep 10; done;&quot;</span>]
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> volume
<span class="hljs-attr">      mountPath:</span> /root/
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">    - name:</span> volume
<span class="hljs-attr">      persistentVolumeClaim:</span>
<span class="hljs-attr">        claimName:</span> pvc2
<span class="hljs-attr">        readOnly:</span> <span class="hljs-literal">false</span>
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f pods.yaml
pod/pod1 created
pod/pod2 created

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pods -n dev -o wide
NAME   READY   STATUS    RESTARTS   AGE   IP            NODE   
pod1   1/1     Running   0          14s   10.244.1.69   node1   
pod2   1/1     Running   0          14s   10.244.1.70   node1  

# &#x67E5;&#x770B;pvc
[root@k8s-master01 ~]# kubectl get pvc -n dev -o wide
NAME   STATUS   VOLUME   CAPACITY   ACCESS MODES      AGE   VOLUMEMODE
pvc1   Bound    pv1      1Gi        RWX               94m   Filesystem
pvc2   Bound    pv2      2Gi        RWX               94m   Filesystem
pvc3   Bound    pv3      3Gi        RWX               94m   Filesystem

# &#x67E5;&#x770B;pv
[root@k8s-master01 ~]# kubectl get pv -n dev -o wide
NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM       AGE     VOLUMEMODE
pv1    1Gi        RWX            Retain           Bound    dev/pvc1    5h11m   Filesystem
pv2    2Gi        RWX            Retain           Bound    dev/pvc2    5h11m   Filesystem
pv3    3Gi        RWX            Retain           Bound    dev/pvc3    5h11m   Filesystem

# &#x67E5;&#x770B;nfs&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x5B58;&#x50A8;
[root@nfs ~]# more /root/data/pv1/out.txt
node1
node1
[root@nfs ~]# more /root/data/pv2/out.txt
node2
node2
</code></pre>
<h3 id="823-&#x751F;&#x547D;&#x5468;&#x671F;">8.2.3 &#x751F;&#x547D;&#x5468;&#x671F;</h3>
<p>PVC&#x548C;PV&#x662F;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x7684;&#xFF0C;PV&#x548C;PVC&#x4E4B;&#x95F4;&#x7684;&#x76F8;&#x4E92;&#x4F5C;&#x7528;&#x9075;&#x5FAA;&#x4EE5;&#x4E0B;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF1A;</p>
<ul>
<li><p><strong>&#x8D44;&#x6E90;&#x4F9B;&#x5E94;</strong>&#xFF1A;&#x7BA1;&#x7406;&#x5458;&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x5E95;&#x5C42;&#x5B58;&#x50A8;&#x548C;PV</p>
</li>
<li><p><strong>&#x8D44;&#x6E90;&#x7ED1;&#x5B9A;</strong>&#xFF1A;&#x7528;&#x6237;&#x521B;&#x5EFA;PVC&#xFF0C;kubernetes&#x8D1F;&#x8D23;&#x6839;&#x636E;PVC&#x7684;&#x58F0;&#x660E;&#x53BB;&#x5BFB;&#x627E;PV&#xFF0C;&#x5E76;&#x7ED1;&#x5B9A;</p>
<p>&#x5728;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x597D;PVC&#x4E4B;&#x540E;&#xFF0C;&#x7CFB;&#x7EDF;&#x5C06;&#x6839;&#x636E;PVC&#x5BF9;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x7684;&#x8BF7;&#x6C42;&#x5728;&#x5DF2;&#x5B58;&#x5728;&#x7684;PV&#x4E2D;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;</p>
<ul>
<li>&#x4E00;&#x65E6;&#x627E;&#x5230;&#xFF0C;&#x5C31;&#x5C06;&#x8BE5;PV&#x4E0E;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;PVC&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x5E94;&#x7528;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;PVC&#x4E86;</li>
<li>&#x5982;&#x679C;&#x627E;&#x4E0D;&#x5230;&#xFF0C;PVC&#x5219;&#x4F1A;&#x65E0;&#x9650;&#x671F;&#x5904;&#x4E8E;Pending&#x72B6;&#x6001;&#xFF0C;&#x76F4;&#x5230;&#x7B49;&#x5230;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x5458;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x7B26;&#x5408;&#x5176;&#x8981;&#x6C42;&#x7684;PV</li>
</ul>
<p>PV&#x4E00;&#x65E6;&#x7ED1;&#x5B9A;&#x5230;&#x67D0;&#x4E2A;PVC&#x4E0A;&#xFF0C;&#x5C31;&#x4F1A;&#x88AB;&#x8FD9;&#x4E2A;PVC&#x72EC;&#x5360;&#xFF0C;&#x4E0D;&#x80FD;&#x518D;&#x4E0E;&#x5176;&#x4ED6;PVC&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x4E86;</p>
</li>
<li><p><strong>&#x8D44;&#x6E90;&#x4F7F;&#x7528;</strong>&#xFF1A;&#x7528;&#x6237;&#x53EF;&#x5728;pod&#x4E2D;&#x50CF;volume&#x4E00;&#x6837;&#x4F7F;&#x7528;pvc</p>
<p>Pod&#x4F7F;&#x7528;Volume&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x5C06;PVC&#x6302;&#x8F7D;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x67D0;&#x4E2A;&#x8DEF;&#x5F84;&#x8FDB;&#x884C;&#x4F7F;&#x7528;&#x3002;</p>
</li>
<li><p><strong>&#x8D44;&#x6E90;&#x91CA;&#x653E;</strong>&#xFF1A;&#x7528;&#x6237;&#x5220;&#x9664;pvc&#x6765;&#x91CA;&#x653E;pv</p>
<p>&#x5F53;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5220;&#x9664;PVC&#xFF0C;&#x4E0E;&#x8BE5;PVC&#x7ED1;&#x5B9A;&#x7684;PV&#x5C06;&#x4F1A;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x201C;&#x5DF2;&#x91CA;&#x653E;&#x201D;&#xFF0C;&#x4F46;&#x8FD8;&#x4E0D;&#x80FD;&#x7ACB;&#x523B;&#x4E0E;&#x5176;&#x4ED6;PVC&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x3002;&#x901A;&#x8FC7;&#x4E4B;&#x524D;PVC&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x8FD8;&#x88AB;&#x7559;&#x5728;&#x5B58;&#x50A8;&#x8BBE;&#x5907;&#x4E0A;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x6E05;&#x9664;&#x4E4B;&#x540E;&#x8BE5;PV&#x624D;&#x80FD;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x3002;</p>
</li>
<li><p><strong>&#x8D44;&#x6E90;&#x56DE;&#x6536;</strong>&#xFF1A;kubernetes&#x6839;&#x636E;pv&#x8BBE;&#x7F6E;&#x7684;&#x56DE;&#x6536;&#x7B56;&#x7565;&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x7684;&#x56DE;&#x6536;</p>
<p>&#x5BF9;&#x4E8E;PV&#xFF0C;&#x7BA1;&#x7406;&#x5458;&#x53EF;&#x4EE5;&#x8BBE;&#x5B9A;&#x56DE;&#x6536;&#x7B56;&#x7565;&#xFF0C;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x4E0E;&#x4E4B;&#x7ED1;&#x5B9A;&#x7684;PVC&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x4E4B;&#x540E;&#x5982;&#x4F55;&#x5904;&#x7406;&#x9057;&#x7559;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#x3002;&#x53EA;&#x6709;PV&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x5B8C;&#x6210;&#x56DE;&#x6536;&#xFF0C;&#x624D;&#x80FD;&#x4F9B;&#x65B0;&#x7684;PVC&#x7ED1;&#x5B9A;&#x548C;&#x4F7F;&#x7528;</p>
</li>
</ul>
<p><img src="Kubenetes.assets/image-20200515002806726.png" alt="img"></p>
<h2 id="83-&#x914D;&#x7F6E;&#x5B58;&#x50A8;">8.3 &#x914D;&#x7F6E;&#x5B58;&#x50A8;</h2>
<h3 id="831-configmap">8.3.1 ConfigMap</h3>
<p>ConfigMap&#x662F;&#x4E00;&#x79CD;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#x7684;&#x5B58;&#x50A8;&#x5377;&#xFF0C;&#x5B83;&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x7684;&#x3002;</p>
<p>&#x521B;&#x5EFA;configmap.yaml&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> ConfigMap
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> configmap
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">data:</span>
<span class="hljs-attr">  info:</span> <span class="hljs-string">|
</span><span class="hljs-attr">    username:</span>admin
<span class="hljs-attr">    password:</span><span class="hljs-number">123456</span>
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x4F7F;&#x7528;&#x6B64;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x521B;&#x5EFA;configmap</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;configmap
[root@k8s-master01 ~]# kubectl create -f configmap.yaml
configmap/configmap created

# &#x67E5;&#x770B;configmap&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl describe cm configmap -n dev
Name:         configmap
Namespace:    dev
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
====
info:
----
username:admin
password:123456

Events:  &lt;none&gt;
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;pod-configmap.yaml&#xFF0C;&#x5C06;&#x4E0A;&#x9762;&#x521B;&#x5EFA;&#x7684;configmap&#x6302;&#x8F7D;&#x8FDB;&#x53BB;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-configmap
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    volumeMounts:</span> <span class="hljs-comment"># &#x5C06;configmap&#x6302;&#x8F7D;&#x5230;&#x76EE;&#x5F55;</span>
<span class="hljs-attr">    - name:</span> config
<span class="hljs-attr">      mountPath:</span> /configmap/config
<span class="hljs-attr">  volumes:</span> <span class="hljs-comment"># &#x5F15;&#x7528;configmap</span>
<span class="hljs-attr">  - name:</span> config
<span class="hljs-attr">    configMap:</span>
<span class="hljs-attr">      name:</span> configmap
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml
pod/pod-configmap created

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev
NAME            READY   STATUS    RESTARTS   AGE
pod-configmap   1/1     Running   0          6s

#&#x8FDB;&#x5165;&#x5BB9;&#x5668;
[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh
# cd /configmap/config/
# ls
info
# more info
username:admin
password:123456

# &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6620;&#x5C04;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#xFF0C;&#x6BCF;&#x4E2A;configmap&#x90FD;&#x6620;&#x5C04;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;
# key---&gt;&#x6587;&#x4EF6;     value----&gt;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5185;&#x5BB9;
# &#x6B64;&#x65F6;&#x5982;&#x679C;&#x66F4;&#x65B0;configmap&#x7684;&#x5185;&#x5BB9;, &#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x503C;&#x4E5F;&#x4F1A;&#x52A8;&#x6001;&#x66F4;&#x65B0;
</code></pre>
<h3 id="832-secret">8.3.2 Secret</h3>
<p>&#x5728;kubernetes&#x4E2D;&#xFF0C;&#x8FD8;&#x5B58;&#x5728;&#x4E00;&#x79CD;&#x548C;ConfigMap&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x79F0;&#x4E3A;Secret&#x5BF9;&#x8C61;&#x3002;&#x5B83;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x654F;&#x611F;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;&#x5BC6;&#x7801;&#x3001;&#x79D8;&#x94A5;&#x3001;&#x8BC1;&#x4E66;&#x7B49;&#x7B49;&#x3002;</p>
<p>1) &#x9996;&#x5148;&#x4F7F;&#x7528;base64&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F16;&#x7801;</p>
<pre><code class="lang-shell">[root@k8s-master01 ~]# echo -n &apos;admin&apos; | base64 #&#x51C6;&#x5907;username
YWRtaW4=
[root@k8s-master01 ~]# echo -n &apos;123456&apos; | base64 #&#x51C6;&#x5907;password
MTIzNDU2
</code></pre>
<p>2) &#x63A5;&#x4E0B;&#x6765;&#x7F16;&#x5199;secret.yaml&#xFF0C;&#x5E76;&#x521B;&#x5EFA;Secret</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Secret
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> secret
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">type:</span> Opaque
<span class="hljs-attr">data:</span>
<span class="hljs-attr">  username:</span> YWRtaW4=
<span class="hljs-attr">  password:</span> MTIzNDU2
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;secret
[root@k8s-master01 ~]# kubectl create -f secret.yaml
secret/secret created

# &#x67E5;&#x770B;secret&#x8BE6;&#x60C5;
[root@k8s-master01 ~]# kubectl describe secret secret -n dev
Name:         secret
Namespace:    dev
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Type:  Opaque
Data
====
password:  6 bytes
username:  5 bytes
</code></pre>
<p>3) &#x521B;&#x5EFA;pod-secret.yaml&#xFF0C;&#x5C06;&#x4E0A;&#x9762;&#x521B;&#x5EFA;&#x7684;secret&#x6302;&#x8F7D;&#x8FDB;&#x53BB;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> pod-secret
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.1</span>
<span class="hljs-attr">    volumeMounts:</span> <span class="hljs-comment"># &#x5C06;secret&#x6302;&#x8F7D;&#x5230;&#x76EE;&#x5F55;</span>
<span class="hljs-attr">    - name:</span> config
<span class="hljs-attr">      mountPath:</span> /secret/config
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> config
<span class="hljs-attr">    secret:</span>
<span class="hljs-attr">      secretName:</span> secret
</code></pre>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;pod
[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml
pod/pod-secret created

# &#x67E5;&#x770B;pod
[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev
NAME            READY   STATUS    RESTARTS   AGE
pod-secret      1/1     Running   0          2m28s

# &#x8FDB;&#x5165;&#x5BB9;&#x5668;&#xFF0C;&#x67E5;&#x770B;secret&#x4FE1;&#x606F;&#xFF0C;&#x53D1;&#x73B0;&#x5DF2;&#x7ECF;&#x81EA;&#x52A8;&#x89E3;&#x7801;&#x4E86;
[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev
/ # ls /secret/config/
password  username
/ # more /secret/config/username
admin
/ # more /secret/config/password
123456
</code></pre>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#x5229;&#x7528;secret&#x5B9E;&#x73B0;&#x4E86;&#x4FE1;&#x606F;&#x7684;&#x7F16;&#x7801;&#x3002;</p>
<h1 id="9-&#x5B89;&#x5168;&#x8BA4;&#x8BC1;">9. &#x5B89;&#x5168;&#x8BA4;&#x8BC1;</h1>
<h2 id="91-&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x6982;&#x8FF0;">9.1 &#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x6982;&#x8FF0;</h2>
<p>Kubernetes&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x96C6;&#x7FA4;&#x7684;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x4FDD;&#x8BC1;&#x96C6;&#x7FA4;&#x7684;&#x5B89;&#x5168;&#x6027;&#x662F;&#x5176;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x6240;&#x8C13;&#x7684;&#x5B89;&#x5168;&#x6027;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4FDD;&#x8BC1;&#x5BF9;Kubernetes&#x7684;&#x5404;&#x79CD;<strong>&#x5BA2;&#x6237;&#x7AEF;</strong>&#x8FDB;&#x884C;<strong>&#x8BA4;&#x8BC1;&#x548C;&#x9274;&#x6743;</strong>&#x64CD;&#x4F5C;&#x3002;</p>
<p><strong>&#x5BA2;&#x6237;&#x7AEF;</strong></p>
<p>&#x5728;Kubernetes&#x96C6;&#x7FA4;&#x4E2D;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x5E38;&#x6709;&#x4E24;&#x7C7B;&#xFF1A;</p>
<ul>
<li><strong>User Account</strong>&#xFF1A;&#x4E00;&#x822C;&#x662F;&#x72EC;&#x7ACB;&#x4E8E;kubernetes&#x4E4B;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x7BA1;&#x7406;&#x7684;&#x7528;&#x6237;&#x8D26;&#x53F7;&#x3002;</li>
<li><strong>Service Account</strong>&#xFF1A;kubernetes&#x7BA1;&#x7406;&#x7684;&#x8D26;&#x53F7;&#xFF0C;&#x7528;&#x4E8E;&#x4E3A;Pod&#x4E2D;&#x7684;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x5728;&#x8BBF;&#x95EE;Kubernetes&#x65F6;&#x63D0;&#x4F9B;&#x8EAB;&#x4EFD;&#x6807;&#x8BC6;&#x3002;</li>
</ul>
<p><img src="Kubenetes.assets/image-20200520102949189.png" alt="img"></p>
<p><strong>&#x8BA4;&#x8BC1;&#x3001;&#x6388;&#x6743;&#x4E0E;&#x51C6;&#x5165;&#x63A7;&#x5236;</strong></p>
<p>ApiServer&#x662F;&#x8BBF;&#x95EE;&#x53CA;&#x7BA1;&#x7406;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x7684;&#x552F;&#x4E00;&#x5165;&#x53E3;&#x3002;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x8BBF;&#x95EE;ApiServer&#xFF0C;&#x90FD;&#x8981;&#x7ECF;&#x8FC7;&#x4E0B;&#x9762;&#x4E09;&#x4E2A;&#x6D41;&#x7A0B;&#xFF1A;</p>
<ul>
<li>Authentication&#xFF08;&#x8BA4;&#x8BC1;&#xFF09;&#xFF1A;&#x8EAB;&#x4EFD;&#x9274;&#x522B;&#xFF0C;&#x53EA;&#x6709;&#x6B63;&#x786E;&#x7684;&#x8D26;&#x53F7;&#x624D;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x8BA4;&#x8BC1;</li>
<li>Authorization&#xFF08;&#x6388;&#x6743;&#xFF09;&#xFF1A; &#x5224;&#x65AD;&#x7528;&#x6237;&#x662F;&#x5426;&#x6709;&#x6743;&#x9650;&#x5BF9;&#x8BBF;&#x95EE;&#x7684;&#x8D44;&#x6E90;&#x6267;&#x884C;&#x7279;&#x5B9A;&#x7684;&#x52A8;&#x4F5C;</li>
<li>Admission Control&#xFF08;&#x51C6;&#x5165;&#x63A7;&#x5236;&#xFF09;&#xFF1A;&#x7528;&#x4E8E;&#x8865;&#x5145;&#x6388;&#x6743;&#x673A;&#x5236;&#x4EE5;&#x5B9E;&#x73B0;&#x66F4;&#x52A0;&#x7CBE;&#x7EC6;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x529F;&#x80FD;&#x3002;</li>
</ul>
<p><img src="Kubenetes.assets/image-20200520103942580.png" alt="img"></p>
<h2 id="92-&#x8BA4;&#x8BC1;&#x7BA1;&#x7406;">9.2 &#x8BA4;&#x8BC1;&#x7BA1;&#x7406;</h2>
<p>Kubernetes&#x96C6;&#x7FA4;&#x5B89;&#x5168;&#x7684;&#x6700;&#x5173;&#x952E;&#x70B9;&#x5728;&#x4E8E;&#x5982;&#x4F55;&#x8BC6;&#x522B;&#x5E76;&#x8BA4;&#x8BC1;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;3&#x79CD;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ul>
<li><p>HTTP Base&#x8BA4;&#x8BC1;&#xFF1A;&#x901A;&#x8FC7;&#x7528;&#x6237;&#x540D;+&#x5BC6;&#x7801;&#x7684;&#x65B9;&#x5F0F;&#x8BA4;&#x8BC1;</p>
<pre><code>    &#x8FD9;&#x79CD;&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#x662F;&#x628A;&#x201C;&#x7528;&#x6237;&#x540D;:&#x5BC6;&#x7801;&#x201D;&#x7528;BASE64&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x540E;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x653E;&#x5728;HTTP&#x8BF7;&#x6C42;&#x4E2D;&#x7684;Header Authorization&#x57DF;&#x91CC;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#x3002;&#x670D;&#x52A1;&#x7AEF;&#x6536;&#x5230;&#x540E;&#x8FDB;&#x884C;&#x89E3;&#x7801;&#xFF0C;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x540D;&#x53CA;&#x5BC6;&#x7801;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x8BA4;&#x8BC1;&#x7684;&#x8FC7;&#x7A0B;&#x3002;
</code></pre></li>
<li><p>HTTP Token&#x8BA4;&#x8BC1;&#xFF1A;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;Token&#x6765;&#x8BC6;&#x522B;&#x5408;&#x6CD5;&#x7528;&#x6237;</p>
<pre><code>    &#x8FD9;&#x79CD;&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#x662F;&#x7528;&#x4E00;&#x4E2A;&#x5F88;&#x957F;&#x7684;&#x96BE;&#x4EE5;&#x88AB;&#x6A21;&#x4EFF;&#x7684;&#x5B57;&#x7B26;&#x4E32;--Token&#x6765;&#x8868;&#x660E;&#x5BA2;&#x6237;&#x8EAB;&#x4EFD;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x3002;&#x6BCF;&#x4E2A;Token&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;API&#x8C03;&#x7528;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x5728;HTTP Header&#x91CC;&#x653E;&#x5165;Token&#xFF0C;API Server&#x63A5;&#x5230;Token&#x540E;&#x4F1A;&#x8DDF;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x4FDD;&#x5B58;&#x7684;token&#x8FDB;&#x884C;&#x6BD4;&#x5BF9;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x8BA4;&#x8BC1;&#x7684;&#x8FC7;&#x7A0B;&#x3002;
</code></pre></li>
<li><p>HTTPS&#x8BC1;&#x4E66;&#x8BA4;&#x8BC1;&#xFF1A;&#x57FA;&#x4E8E;CA&#x6839;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x7684;&#x53CC;&#x5411;&#x6570;&#x5B57;&#x8BC1;&#x4E66;&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;</p>
<pre><code>    &#x8FD9;&#x79CD;&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#x662F;&#x5B89;&#x5168;&#x6027;&#x6700;&#x9AD8;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;&#x662F;&#x540C;&#x65F6;&#x4E5F;&#x662F;&#x64CD;&#x4F5C;&#x8D77;&#x6765;&#x6700;&#x9EBB;&#x70E6;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x3002;
</code></pre></li>
</ul>
<p><img src="Kubenetes.assets/image-20200518211037434.png" alt="img"></p>
<p><strong>HTTPS&#x8BA4;&#x8BC1;&#x5927;&#x4F53;&#x5206;&#x4E3A;3&#x4E2A;&#x8FC7;&#x7A0B;&#xFF1A;</strong></p>
<ol>
<li><p>&#x8BC1;&#x4E66;&#x7533;&#x8BF7;&#x548C;&#x4E0B;&#x53D1;</p>
<pre><code>  HTTPS&#x901A;&#x4FE1;&#x53CC;&#x65B9;&#x7684;&#x670D;&#x52A1;&#x5668;&#x5411;CA&#x673A;&#x6784;&#x7533;&#x8BF7;&#x8BC1;&#x4E66;&#xFF0C;CA&#x673A;&#x6784;&#x4E0B;&#x53D1;&#x6839;&#x8BC1;&#x4E66;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x8BC1;&#x4E66;&#x53CA;&#x79C1;&#x94A5;&#x7ED9;&#x7533;&#x8BF7;&#x8005;
</code></pre></li>
<li><p>&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x53CC;&#x5411;&#x8BA4;&#x8BC1;</p>
<pre><code>  1&gt; &#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x4E0B;&#x53D1;&#x81EA;&#x5DF1;&#x7684;&#x8BC1;&#x4E66;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;
     &#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x8BC1;&#x4E66;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x79C1;&#x94A5;&#x89E3;&#x5BC6;&#x8BC1;&#x4E66;&#xFF0C;&#x5728;&#x8BC1;&#x4E66;&#x4E2D;&#x83B7;&#x5F97;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x516C;&#x94A5;&#xFF0C;
     &#x5BA2;&#x6237;&#x7AEF;&#x5229;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x516C;&#x94A5;&#x8BA4;&#x8BC1;&#x8BC1;&#x4E66;&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x81F4;&#xFF0C;&#x5219;&#x8BA4;&#x53EF;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5668;
  2&gt; &#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x81EA;&#x5DF1;&#x7684;&#x8BC1;&#x4E66;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x8BC1;&#x4E66;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x79C1;&#x94A5;&#x89E3;&#x5BC6;&#x8BC1;&#x4E66;&#xFF0C;
     &#x5728;&#x8BC1;&#x4E66;&#x4E2D;&#x83B7;&#x5F97;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x516C;&#x94A5;&#xFF0C;&#x5E76;&#x7528;&#x8BE5;&#x516C;&#x94A5;&#x8BA4;&#x8BC1;&#x8BC1;&#x4E66;&#x4FE1;&#x606F;&#xFF0C;&#x786E;&#x8BA4;&#x5BA2;&#x6237;&#x7AEF;&#x662F;&#x5426;&#x5408;&#x6CD5;
</code></pre></li>
<li><p>&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x901A;&#x4FE1;</p>
<pre><code>  &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x534F;&#x5546;&#x597D;&#x52A0;&#x5BC6;&#x65B9;&#x6848;&#x540E;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x7684;&#x79D8;&#x94A5;&#x5E76;&#x52A0;&#x5BC6;&#xFF0C;&#x7136;&#x540E;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x3002;
  &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x63A5;&#x6536;&#x8FD9;&#x4E2A;&#x79D8;&#x94A5;&#x540E;&#xFF0C;&#x53CC;&#x65B9;&#x63A5;&#x4E0B;&#x6765;&#x901A;&#x4FE1;&#x7684;&#x6240;&#x6709;&#x5185;&#x5BB9;&#x90FD;&#x901A;&#x8FC7;&#x8BE5;&#x968F;&#x673A;&#x79D8;&#x94A5;&#x52A0;&#x5BC6;
</code></pre></li>
</ol>
<blockquote>
<p>&#x6CE8;&#x610F;: Kubernetes&#x5141;&#x8BB8;&#x540C;&#x65F6;&#x914D;&#x7F6E;&#x591A;&#x79CD;&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#xFF0C;&#x53EA;&#x8981;&#x5176;&#x4E2D;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x65B9;&#x5F0F;&#x8BA4;&#x8BC1;&#x901A;&#x8FC7;&#x5373;&#x53EF;</p>
</blockquote>
<h2 id="93-&#x6388;&#x6743;&#x7BA1;&#x7406;">9.3 &#x6388;&#x6743;&#x7BA1;&#x7406;</h2>
<p>&#x6388;&#x6743;&#x53D1;&#x751F;&#x5728;&#x8BA4;&#x8BC1;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x8BA4;&#x8BC1;&#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x8BF7;&#x6C42;&#x7528;&#x6237;&#x662F;&#x8C01;&#xFF0C; &#x7136;&#x540E;Kubernetes&#x4F1A;&#x6839;&#x636E;&#x4E8B;&#x5148;&#x5B9A;&#x4E49;&#x7684;&#x6388;&#x6743;&#x7B56;&#x7565;&#x6765;&#x51B3;&#x5B9A;&#x7528;&#x6237;&#x662F;&#x5426;&#x6709;&#x6743;&#x9650;&#x8BBF;&#x95EE;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5C31;&#x79F0;&#x4E3A;&#x6388;&#x6743;&#x3002;</p>
<p>&#x6BCF;&#x4E2A;&#x53D1;&#x9001;&#x5230;ApiServer&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x5E26;&#x4E0A;&#x4E86;&#x7528;&#x6237;&#x548C;&#x8D44;&#x6E90;&#x7684;&#x4FE1;&#x606F;&#xFF1A;&#x6BD4;&#x5982;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#x7528;&#x6237;&#x3001;&#x8BF7;&#x6C42;&#x7684;&#x8DEF;&#x5F84;&#x3001;&#x8BF7;&#x6C42;&#x7684;&#x52A8;&#x4F5C;&#x7B49;&#xFF0C;&#x6388;&#x6743;&#x5C31;&#x662F;&#x6839;&#x636E;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x548C;&#x6388;&#x6743;&#x7B56;&#x7565;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;&#x7B26;&#x5408;&#x7B56;&#x7565;&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x6388;&#x6743;&#x901A;&#x8FC7;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x3002;</p>
<p>API Server&#x76EE;&#x524D;&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x6388;&#x6743;&#x7B56;&#x7565;&#xFF1A;</p>
<ul>
<li>AlwaysDeny&#xFF1A;&#x8868;&#x793A;&#x62D2;&#x7EDD;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#xFF0C;&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;</li>
<li>AlwaysAllow&#xFF1A;&#x5141;&#x8BB8;&#x63A5;&#x6536;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x96C6;&#x7FA4;&#x4E0D;&#x9700;&#x8981;&#x6388;&#x6743;&#x6D41;&#x7A0B;&#xFF08;Kubernetes&#x9ED8;&#x8BA4;&#x7684;&#x7B56;&#x7565;&#xFF09;</li>
<li>ABAC&#xFF1A;&#x57FA;&#x4E8E;&#x5C5E;&#x6027;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF0C;&#x8868;&#x793A;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x914D;&#x7F6E;&#x7684;&#x6388;&#x6743;&#x89C4;&#x5219;&#x5BF9;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x5339;&#x914D;&#x548C;&#x63A7;&#x5236;</li>
<li>Webhook&#xFF1A;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5916;&#x90E8;REST&#x670D;&#x52A1;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x6388;&#x6743;</li>
<li>Node&#xFF1A;&#x662F;&#x4E00;&#x79CD;&#x4E13;&#x7528;&#x6A21;&#x5F0F;&#xFF0C;&#x7528;&#x4E8E;&#x5BF9;kubelet&#x53D1;&#x51FA;&#x7684;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#x63A7;&#x5236;</li>
<li>RBAC&#xFF1A;&#x57FA;&#x4E8E;&#x89D2;&#x8272;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF08;kubeadm&#x5B89;&#x88C5;&#x65B9;&#x5F0F;&#x4E0B;&#x7684;&#x9ED8;&#x8BA4;&#x9009;&#x9879;&#xFF09;</li>
</ul>
<p>RBAC(Role-Based Access Control) &#x57FA;&#x4E8E;&#x89D2;&#x8272;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x5728;&#x63CF;&#x8FF0;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;<strong>&#x7ED9;&#x54EA;&#x4E9B;&#x5BF9;&#x8C61;&#x6388;&#x4E88;&#x4E86;&#x54EA;&#x4E9B;&#x6743;&#x9650;</strong></p>
<p>&#x5176;&#x4E2D;&#x6D89;&#x53CA;&#x5230;&#x4E86;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x6982;&#x5FF5;&#xFF1A;</p>
<ul>
<li>&#x5BF9;&#x8C61;&#xFF1A;User&#x3001;Groups&#x3001;ServiceAccount</li>
<li>&#x89D2;&#x8272;&#xFF1A;&#x4EE3;&#x8868;&#x7740;&#x4E00;&#x7EC4;&#x5B9A;&#x4E49;&#x5728;&#x8D44;&#x6E90;&#x4E0A;&#x7684;&#x53EF;&#x64CD;&#x4F5C;&#x52A8;&#x4F5C;(&#x6743;&#x9650;)&#x7684;&#x96C6;&#x5408;</li>
<li>&#x7ED1;&#x5B9A;&#xFF1A;&#x5C06;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x89D2;&#x8272;&#x8DDF;&#x7528;&#x6237;&#x7ED1;&#x5B9A;&#x5728;&#x4E00;&#x8D77;</li>
</ul>
<p><img src="Kubenetes.assets/image-20200519181209566.png" alt="img"></p>
<p>RBAC&#x5F15;&#x5165;&#x4E86;4&#x4E2A;&#x9876;&#x7EA7;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#xFF1A;</p>
<ul>
<li>Role&#x3001;ClusterRole&#xFF1A;&#x89D2;&#x8272;&#xFF0C;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x4E00;&#x7EC4;&#x6743;&#x9650;</li>
<li>RoleBinding&#x3001;ClusterRoleBinding&#xFF1A;&#x89D2;&#x8272;&#x7ED1;&#x5B9A;&#xFF0C;&#x7528;&#x4E8E;&#x5C06;&#x89D2;&#x8272;&#xFF08;&#x6743;&#x9650;&#xFF09;&#x8D4B;&#x4E88;&#x7ED9;&#x5BF9;&#x8C61;</li>
</ul>
<p><strong>Role&#x3001;ClusterRole</strong></p>
<p>&#x4E00;&#x4E2A;&#x89D2;&#x8272;&#x5C31;&#x662F;&#x4E00;&#x7EC4;&#x6743;&#x9650;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x6743;&#x9650;&#x90FD;&#x662F;&#x8BB8;&#x53EF;&#x5F62;&#x5F0F;&#x7684;&#xFF08;&#x767D;&#x540D;&#x5355;&#xFF09;&#x3002;</p>
<pre><code class="lang-yaml"><span class="hljs-comment"># Role&#x53EA;&#x80FD;&#x5BF9;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#x7684;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x6388;&#x6743;&#xFF0C;&#x9700;&#x8981;&#x6307;&#x5B9A;nameapce</span>
<span class="hljs-attr">kind:</span> Role
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">  name:</span> authorization-role
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]  <span class="hljs-comment"># &#x652F;&#x6301;&#x7684;API&#x7EC4;&#x5217;&#x8868;,&quot;&quot; &#x7A7A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8868;&#x793A;&#x6838;&#x5FC3;API&#x7FA4;</span>
<span class="hljs-attr">  resources:</span> [<span class="hljs-string">&quot;pods&quot;</span>] <span class="hljs-comment"># &#x652F;&#x6301;&#x7684;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x5217;&#x8868;</span>
<span class="hljs-attr">  verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>] <span class="hljs-comment"># &#x5141;&#x8BB8;&#x7684;&#x5BF9;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;&#x5217;&#x8868;</span>
</code></pre>
<pre><code class="lang-yaml"><span class="hljs-comment"># ClusterRole&#x53EF;&#x4EE5;&#x5BF9;&#x96C6;&#x7FA4;&#x8303;&#x56F4;&#x5185;&#x8D44;&#x6E90;&#x3001;&#x8DE8;namespaces&#x7684;&#x8303;&#x56F4;&#x8D44;&#x6E90;&#x3001;&#x975E;&#x8D44;&#x6E90;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x6388;&#x6743;</span>
<span class="hljs-attr">kind:</span> ClusterRole
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr"> name:</span> authorization-clusterrole
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]
<span class="hljs-attr">  resources:</span> [<span class="hljs-string">&quot;pods&quot;</span>]
<span class="hljs-attr">  verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>]
</code></pre>
<p>&#x9700;&#x8981;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;rules&#x4E2D;&#x7684;&#x53C2;&#x6570;&#xFF1A;</p>
<ul>
<li><p>apiGroups: &#x652F;&#x6301;&#x7684;API&#x7EC4;&#x5217;&#x8868;</p>
<pre><code>&quot;&quot;,&quot;apps&quot;, &quot;autoscaling&quot;, &quot;batch&quot;
</code></pre></li>
<li><p>resources&#xFF1A;&#x652F;&#x6301;&#x7684;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x5217;&#x8868;</p>
<pre><code>&quot;services&quot;, &quot;endpoints&quot;, &quot;pods&quot;,&quot;secrets&quot;,&quot;configmaps&quot;,&quot;crontabs&quot;,&quot;deployments&quot;,&quot;jobs&quot;,
&quot;nodes&quot;,&quot;rolebindings&quot;,&quot;clusterroles&quot;,&quot;daemonsets&quot;,&quot;replicasets&quot;,&quot;statefulsets&quot;,
&quot;horizontalpodautoscalers&quot;,&quot;replicationcontrollers&quot;,&quot;cronjobs&quot;
</code></pre></li>
<li><p>verbs&#xFF1A;&#x5BF9;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;&#x5217;&#x8868;</p>
<pre><code>&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;, &quot;exec&quot;
</code></pre></li>
</ul>
<p><strong>RoleBinding&#x3001;ClusterRoleBinding</strong></p>
<p>&#x89D2;&#x8272;&#x7ED1;&#x5B9A;&#x7528;&#x6765;&#x628A;&#x4E00;&#x4E2A;&#x89D2;&#x8272;&#x7ED1;&#x5B9A;&#x5230;&#x4E00;&#x4E2A;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x4E0A;&#xFF0C;&#x7ED1;&#x5B9A;&#x76EE;&#x6807;&#x53EF;&#x4EE5;&#x662F;User&#x3001;Group&#x6216;&#x8005;ServiceAccount&#x3002;</p>
<pre><code class="lang-yaml"><span class="hljs-comment"># RoleBinding&#x53EF;&#x4EE5;&#x5C06;&#x540C;&#x4E00;namespace&#x4E2D;&#x7684;subject&#x7ED1;&#x5B9A;&#x5230;&#x67D0;&#x4E2A;Role&#x4E0B;&#xFF0C;&#x5219;&#x6B64;subject&#x5373;&#x5177;&#x6709;&#x8BE5;Role&#x5B9A;&#x4E49;&#x7684;&#x6743;&#x9650;</span>
<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> authorization-role-binding
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> User
<span class="hljs-attr">  name:</span> heima
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  kind:</span> Role
<span class="hljs-attr">  name:</span> authorization-role
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
</code></pre>
<pre><code class="lang-yaml"><span class="hljs-comment"># ClusterRoleBinding&#x5728;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x7EA7;&#x522B;&#x548C;&#x6240;&#x6709;namespaces&#x5C06;&#x7279;&#x5B9A;&#x7684;subject&#x4E0E;ClusterRole&#x7ED1;&#x5B9A;&#xFF0C;&#x6388;&#x4E88;&#x6743;&#x9650;</span>
<span class="hljs-attr">kind:</span> ClusterRoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr"> name:</span> authorization-clusterrole-binding
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> User
<span class="hljs-attr">  name:</span> heima
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  kind:</span> ClusterRole
<span class="hljs-attr">  name:</span> authorization-clusterrole
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
</code></pre>
<p><strong>RoleBinding&#x5F15;&#x7528;ClusterRole&#x8FDB;&#x884C;&#x6388;&#x6743;</strong></p>
<p>RoleBinding&#x53EF;&#x4EE5;&#x5F15;&#x7528;ClusterRole&#xFF0C;&#x5BF9;&#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;ClusterRole&#x5B9A;&#x4E49;&#x7684;&#x8D44;&#x6E90;&#x4E3B;&#x4F53;&#x8FDB;&#x884C;&#x6388;&#x6743;&#x3002;</p>
<pre><code>    &#x4E00;&#x79CD;&#x5F88;&#x5E38;&#x7528;&#x7684;&#x505A;&#x6CD5;&#x5C31;&#x662F;&#xFF0C;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x5458;&#x4E3A;&#x96C6;&#x7FA4;&#x8303;&#x56F4;&#x9884;&#x5B9A;&#x4E49;&#x597D;&#x4E00;&#x7EC4;&#x89D2;&#x8272;&#xFF08;ClusterRole&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x591A;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;ClusterRole&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5927;&#x5E45;&#x63D0;&#x9AD8;&#x6388;&#x6743;&#x7BA1;&#x7406;&#x5DE5;&#x4F5C;&#x6548;&#x7387;&#xFF0C;&#x4E5F;&#x4F7F;&#x5F97;&#x5404;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E0B;&#x7684;&#x57FA;&#x7840;&#x6027;&#x6388;&#x6743;&#x89C4;&#x5219;&#x4E0E;&#x4F7F;&#x7528;&#x4F53;&#x9A8C;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;
</code></pre><pre><code class="lang-yaml"><span class="hljs-comment"># &#x867D;&#x7136;authorization-clusterrole&#x662F;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x89D2;&#x8272;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x4E86;RoleBinding</span>
<span class="hljs-comment"># &#x6240;&#x4EE5;heima&#x53EA;&#x80FD;&#x8BFB;&#x53D6;dev&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x8D44;&#x6E90;</span>
<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> authorization-role-binding-ns
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> User
<span class="hljs-attr">  name:</span> heima
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  kind:</span> ClusterRole
<span class="hljs-attr">  name:</span> authorization-clusterrole
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
</code></pre>
<p><strong>&#x5B9E;&#x6218;&#xFF1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EA;&#x80FD;&#x7BA1;&#x7406;dev&#x7A7A;&#x95F4;&#x4E0B;Pods&#x8D44;&#x6E90;&#x7684;&#x8D26;&#x53F7;</strong></p>
<p>1) &#x521B;&#x5EFA;&#x8D26;&#x53F7;</p>
<pre><code class="lang-shell"># 1) &#x521B;&#x5EFA;&#x8BC1;&#x4E66;
[root@k8s-master01 pki]# cd /etc/kubernetes/pki/
[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)

# 2) &#x7528;apiserver&#x7684;&#x8BC1;&#x4E66;&#x53BB;&#x7B7E;&#x7F72;
# 2-1) &#x7B7E;&#x540D;&#x7533;&#x8BF7;&#xFF0C;&#x7533;&#x8BF7;&#x7684;&#x7528;&#x6237;&#x662F;devman,&#x7EC4;&#x662F;devgroup
[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj &quot;/CN=devman/O=devgroup&quot;     
# 2-2) &#x7B7E;&#x7F72;&#x8BC1;&#x4E66;
[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650

# 3) &#x8BBE;&#x7F6E;&#x96C6;&#x7FA4;&#x3001;&#x7528;&#x6237;&#x3001;&#x4E0A;&#x4E0B;&#x6587;&#x4FE1;&#x606F;
[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443

[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key

[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman

# &#x5207;&#x6362;&#x8D26;&#x6237;&#x5230;devman
[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes
Switched to context &quot;devman@kubernetes&quot;.

# &#x67E5;&#x770B;dev&#x4E0B;pod&#xFF0C;&#x53D1;&#x73B0;&#x6CA1;&#x6709;&#x6743;&#x9650;
[root@k8s-master01 pki]# kubectl get pods -n dev
Error from server (Forbidden): pods is forbidden: User &quot;devman&quot; cannot list resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;dev&quot;

# &#x5207;&#x6362;&#x5230;admin&#x8D26;&#x6237;
[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes
Switched to context &quot;kubernetes-admin@kubernetes&quot;.
</code></pre>
<p>2&#xFF09; &#x521B;&#x5EFA;Role&#x548C;RoleBinding&#xFF0C;&#x4E3A;devman&#x7528;&#x6237;&#x6388;&#x6743;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">kind:</span> Role
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">  name:</span> dev-role
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]
<span class="hljs-attr">  resources:</span> [<span class="hljs-string">&quot;pods&quot;</span>]
<span class="hljs-attr">  verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>]

<span class="hljs-meta">---</span>

<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> authorization-role-binding
<span class="hljs-attr">  namespace:</span> dev
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> User
<span class="hljs-attr">  name:</span> devman
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  kind:</span> Role
<span class="hljs-attr">  name:</span> dev-role
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
</code></pre>
<pre><code class="lang-shell">[root@k8s-master01 pki]# kubectl create -f dev-role.yaml
role.rbac.authorization.k8s.io/dev-role created
rolebinding.rbac.authorization.k8s.io/authorization-role-binding created
</code></pre>
<p>3) &#x5207;&#x6362;&#x8D26;&#x6237;&#xFF0C;&#x518D;&#x6B21;&#x9A8C;&#x8BC1;</p>
<pre><code class="lang-shell"># &#x5207;&#x6362;&#x8D26;&#x6237;&#x5230;devman
[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes
Switched to context &quot;devman@kubernetes&quot;.

# &#x518D;&#x6B21;&#x67E5;&#x770B;
[root@k8s-master01 pki]# kubectl get pods -n dev
NAME                                 READY   STATUS             RESTARTS   AGE
nginx-deployment-66cb59b984-8wp2k    1/1     Running            0          4d1h
nginx-deployment-66cb59b984-dc46j    1/1     Running            0          4d1h
nginx-deployment-66cb59b984-thfck    1/1     Running            0          4d1h

# &#x4E3A;&#x4E86;&#x4E0D;&#x5F71;&#x54CD;&#x540E;&#x9762;&#x7684;&#x5B66;&#x4E60;,&#x5207;&#x56DE;admin&#x8D26;&#x6237;
[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes
Switched to context &quot;kubernetes-admin@kubernetes&quot;.
</code></pre>
<h2 id="94-&#x51C6;&#x5165;&#x63A7;&#x5236;">9.4 &#x51C6;&#x5165;&#x63A7;&#x5236;</h2>
<p>&#x901A;&#x8FC7;&#x4E86;&#x524D;&#x9762;&#x7684;&#x8BA4;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x4E4B;&#x540E;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x7ECF;&#x8FC7;&#x51C6;&#x5165;&#x63A7;&#x5236;&#x5904;&#x7406;&#x901A;&#x8FC7;&#x4E4B;&#x540E;&#xFF0C;apiserver&#x624D;&#x4F1A;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x51C6;&#x5165;&#x63A7;&#x5236;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x914D;&#x7F6E;&#x7684;&#x63A7;&#x5236;&#x5668;&#x5217;&#x8868;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5728;Api-Server&#x4E0A;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x884C;&#x8BBE;&#x7F6E;&#x9009;&#x62E9;&#x6267;&#x884C;&#x54EA;&#x4E9B;&#x51C6;&#x5165;&#x63A7;&#x5236;&#x5668;&#xFF1A;</p>
<pre><code>--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,
                      DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds
</code></pre><p>&#x53EA;&#x6709;&#x5F53;&#x6240;&#x6709;&#x7684;&#x51C6;&#x5165;&#x63A7;&#x5236;&#x5668;&#x90FD;&#x68C0;&#x67E5;&#x901A;&#x8FC7;&#x4E4B;&#x540E;&#xFF0C;apiserver&#x624D;&#x6267;&#x884C;&#x8BE5;&#x8BF7;&#x6C42;&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE;&#x62D2;&#x7EDD;&#x3002;</p>
<p>&#x5F53;&#x524D;&#x53EF;&#x914D;&#x7F6E;&#x7684;Admission Control&#x51C6;&#x5165;&#x63A7;&#x5236;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>AlwaysAdmit&#xFF1A;&#x5141;&#x8BB8;&#x6240;&#x6709;&#x8BF7;&#x6C42;</li>
<li>AlwaysDeny&#xFF1A;&#x7981;&#x6B62;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#xFF0C;&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;</li>
<li>AlwaysPullImages&#xFF1A;&#x5728;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x4E4B;&#x524D;&#x603B;&#x53BB;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;</li>
<li>DenyExecOnPrivileged&#xFF1A;&#x5B83;&#x4F1A;&#x62E6;&#x622A;&#x6240;&#x6709;&#x60F3;&#x5728;Privileged Container&#x4E0A;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x7684;&#x8BF7;&#x6C42;</li>
<li>ImagePolicyWebhook&#xFF1A;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#x5C06;&#x5141;&#x8BB8;&#x540E;&#x7AEF;&#x7684;&#x4E00;&#x4E2A;Webhook&#x7A0B;&#x5E8F;&#x6765;&#x5B8C;&#x6210;admission controller&#x7684;&#x529F;&#x80FD;&#x3002;</li>
<li>Service Account&#xFF1A;&#x5B9E;&#x73B0;ServiceAccount&#x5B9E;&#x73B0;&#x4E86;&#x81EA;&#x52A8;&#x5316;</li>
<li>SecurityContextDeny&#xFF1A;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#x5C06;&#x4F7F;&#x7528;SecurityContext&#x7684;Pod&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x5168;&#x90E8;&#x5931;&#x6548;</li>
<li>ResourceQuota&#xFF1A;&#x7528;&#x4E8E;&#x8D44;&#x6E90;&#x914D;&#x989D;&#x7BA1;&#x7406;&#x76EE;&#x7684;&#xFF0C;&#x89C2;&#x5BDF;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#xFF0C;&#x786E;&#x4FDD;&#x5728;namespace&#x4E0A;&#x7684;&#x914D;&#x989D;&#x4E0D;&#x4F1A;&#x8D85;&#x6807;</li>
<li>LimitRanger&#xFF1A;&#x7528;&#x4E8E;&#x8D44;&#x6E90;&#x9650;&#x5236;&#x7BA1;&#x7406;&#xFF0C;&#x4F5C;&#x7528;&#x4E8E;namespace&#x4E0A;&#xFF0C;&#x786E;&#x4FDD;&#x5BF9;Pod&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x9650;&#x5236;</li>
<li>InitialResources&#xFF1A;&#x4E3A;&#x672A;&#x8BBE;&#x7F6E;&#x8D44;&#x6E90;&#x8BF7;&#x6C42;&#x4E0E;&#x9650;&#x5236;&#x7684;Pod&#xFF0C;&#x6839;&#x636E;&#x5176;&#x955C;&#x50CF;&#x7684;&#x5386;&#x53F2;&#x8D44;&#x6E90;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;</li>
<li>NamespaceLifecycle&#xFF1A;&#x5982;&#x679C;&#x5C1D;&#x8BD5;&#x5728;&#x4E00;&#x4E2A;&#x4E0D;&#x5B58;&#x5728;&#x7684;namespace&#x4E2D;&#x521B;&#x5EFA;&#x8D44;&#x6E90;&#x5BF9;&#x8C61;&#xFF0C;&#x5219;&#x8BE5;&#x521B;&#x5EFA;&#x8BF7;&#x6C42;&#x5C06;&#x88AB;&#x62D2;&#x7EDD;&#x3002;&#x5F53;&#x5220;&#x9664;&#x4E00;&#x4E2A;namespace&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x5C06;&#x4F1A;&#x5220;&#x9664;&#x8BE5;namespace&#x4E2D;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x3002;</li>
<li>DefaultStorageClass&#xFF1A;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x7684;&#x52A8;&#x6001;&#x4F9B;&#x5E94;&#xFF0C;&#x4E3A;&#x672A;&#x6307;&#x5B9A;StorageClass&#x6216;PV&#x7684;PVC&#x5C1D;&#x8BD5;&#x5339;&#x914D;&#x9ED8;&#x8BA4;&#x7684;StorageClass&#xFF0C;&#x5C3D;&#x53EF;&#x80FD;&#x51CF;&#x5C11;&#x7528;&#x6237;&#x5728;&#x7533;&#x8BF7;PVC&#x65F6;&#x6240;&#x9700;&#x4E86;&#x89E3;&#x7684;&#x540E;&#x7AEF;&#x5B58;&#x50A8;&#x7EC6;&#x8282;</li>
<li>DefaultTolerationSeconds&#xFF1A;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#x4E3A;&#x90A3;&#x4E9B;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;forgiveness tolerations&#x5E76;&#x5177;&#x6709;notready:NoExecute&#x548C;unreachable:NoExecute&#x4E24;&#x79CD;taints&#x7684;Pod&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x7684;&#x201C;&#x5BB9;&#x5FCD;&#x201D;&#x65F6;&#x95F4;&#xFF0C;&#x4E3A;5min</li>
<li>PodSecurityPolicy&#xFF1A;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#x7528;&#x4E8E;&#x5728;&#x521B;&#x5EFA;&#x6216;&#x4FEE;&#x6539;Pod&#x65F6;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x6839;&#x636E;Pod&#x7684;security context&#x548C;&#x53EF;&#x7528;&#x7684;PodSecurityPolicy&#x5BF9;Pod&#x7684;&#x5B89;&#x5168;&#x7B56;&#x7565;&#x8FDB;&#x884C;&#x63A7;&#x5236;</li>
</ul>
<h1 id="10-dashboard">10. DashBoard</h1>
<p>&#x4E4B;&#x524D;&#x5728;kubernetes&#x4E2D;&#x5B8C;&#x6210;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;kubectl&#x5B8C;&#x6210;&#x7684;&#x3002;&#x5176;&#x5B9E;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x66F4;&#x4E30;&#x5BCC;&#x7684;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#xFF0C;kubernetes&#x8FD8;&#x5F00;&#x53D1;&#x4E86;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;web&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;&#xFF08;Dashboard&#xFF09;&#x3002;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Dashboard&#x90E8;&#x7F72;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x76D1;&#x63A7;&#x5E94;&#x7528;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x6267;&#x884C;&#x6545;&#x969C;&#x6392;&#x67E5;&#x4EE5;&#x53CA;&#x7BA1;&#x7406;kubernetes&#x4E2D;&#x5404;&#x79CD;&#x8D44;&#x6E90;&#x3002;</p>
<h2 id="101-&#x90E8;&#x7F72;dashboard">10.1 &#x90E8;&#x7F72;Dashboard</h2>
<p>1) &#x4E0B;&#x8F7D;yaml&#xFF0C;&#x5E76;&#x8FD0;&#x884C;Dashboard</p>
<pre><code class="lang-shell"># &#x4E0B;&#x8F7D;yaml
[root@k8s-master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml

# &#x4FEE;&#x6539;kubernetes-dashboard&#x7684;Service&#x7C7B;&#x578B;
kind: Service
apiVersion: v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kubernetes-dashboard
spec:
  type: NodePort  # &#x65B0;&#x589E;
  ports:
    - port: 443
      targetPort: 8443
      nodePort: 30009  # &#x65B0;&#x589E;
  selector:
    k8s-app: kubernetes-dashboard

# &#x90E8;&#x7F72;
[root@k8s-master01 ~]# kubectl create -f recommended.yaml

# &#x67E5;&#x770B;namespace&#x4E0B;&#x7684;kubernetes-dashboard&#x4E0B;&#x7684;&#x8D44;&#x6E90;
[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard
NAME                                            READY   STATUS    RESTARTS   AGE
pod/dashboard-metrics-scraper-c79c65bb7-zwfvw   1/1     Running   0          111s
pod/kubernetes-dashboard-56484d4c5-z95z5        1/1     Running   0          111s

NAME                               TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)         AGE
service/dashboard-metrics-scraper  ClusterIP  10.96.89.218    &lt;none&gt;       8000/TCP        111s
service/kubernetes-dashboard       NodePort   10.104.178.171  &lt;none&gt;       443:30009/TCP   111s
</code></pre>
<p>2&#xFF09;&#x521B;&#x5EFA;&#x8BBF;&#x95EE;&#x8D26;&#x6237;&#xFF0C;&#x83B7;&#x53D6;token</p>
<pre><code class="lang-shell"># &#x521B;&#x5EFA;&#x8D26;&#x53F7;
[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard

# &#x6388;&#x6743;
[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin

# &#x83B7;&#x53D6;&#x8D26;&#x53F7;token
[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin
dashboard-admin-token-xbqhh        kubernetes.io/service-account-token   3      2m35s

[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard
Name:         dashboard-admin-token-xbqhh
Namespace:    kubernetes-dashboard
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: dashboard-admin
              kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039

Type:  kubernetes.io/service-account-token

Data
====
namespace:  20 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImJrYkF4bW5XcDhWcmNGUGJtek5NODFuSXl1aWptMmU2M3o4LTY5a2FKS2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4teGJxaGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTVkODRkODAtYmU3YS00ZDEwLWEyZTAtNjhmOTAyMjJkMDM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.NAl7e8ZfWWdDoPxkqzJzTB46sK9E8iuJYnUI9vnBaY3Jts7T1g1msjsBnbxzQSYgAG--cV0WYxjndzJY_UWCwaGPrQrt_GunxmOK9AUnzURqm55GR2RXIZtjsWVP2EBatsDgHRmuUbQvTFOvdJB4x3nXcYLN2opAaMqg3rnU2rr-A8zCrIuX_eca12wIp_QiuP3SF-tzpdLpsyRfegTJZl6YnSGyaVkC9id-cxZRb307qdCfXPfCHR_2rt5FVfxARgg_C0e3eFHaaYQO7CitxsnIoIXpOFNAR8aUrmopJyODQIPqBWUehb7FhlU1DCduHnIIXVC_UICZ-MKYewBDLw
ca.crt:     1025 bytes
</code></pre>
<p>3&#xFF09;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;Dashboard&#x7684;UI</p>
<p>&#x5728;&#x767B;&#x5F55;&#x9875;&#x9762;&#x4E0A;&#x8F93;&#x5165;&#x4E0A;&#x9762;&#x7684;token</p>
<p><img src="Kubenetes.assets/image-20200520144548997.png" alt="image-20200520144548997"></p>
<p>&#x51FA;&#x73B0;&#x4E0B;&#x9762;&#x7684;&#x9875;&#x9762;&#x4EE3;&#x8868;&#x6210;&#x529F;</p>
<p><img src="Kubenetes.assets/image-20200520144959353.png" alt="image-20200520144959353"></p>
<h2 id="102-&#x4F7F;&#x7528;dashboard">10.2 &#x4F7F;&#x7528;DashBoard</h2>
<p>&#x672C;&#x7AE0;&#x8282;&#x4EE5;Deployment&#x4E3A;&#x4F8B;&#x6F14;&#x793A;DashBoard&#x7684;&#x4F7F;&#x7528;</p>
<p><strong>&#x67E5;&#x770B;</strong></p>
<p>&#x9009;&#x62E9;&#x6307;&#x5B9A;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;<code>dev</code>&#xFF0C;&#x7136;&#x540E;&#x70B9;&#x51FB;<code>Deployments</code>&#xFF0C;&#x67E5;&#x770B;dev&#x7A7A;&#x95F4;&#x4E0B;&#x7684;&#x6240;&#x6709;deployment</p>
<p><img src="Kubenetes.assets/image-20200520154628679.png" alt="img"></p>
<p><strong>&#x6269;&#x7F29;&#x5BB9;</strong></p>
<p>&#x5728;<code>Deployment</code>&#x4E0A;&#x70B9;&#x51FB;<code>&#x89C4;&#x6A21;</code>&#xFF0C;&#x7136;&#x540E;&#x6307;&#x5B9A;<code>&#x76EE;&#x6807;&#x526F;&#x672C;&#x6570;&#x91CF;</code>&#xFF0C;&#x70B9;&#x51FB;&#x786E;&#x5B9A;</p>
<p><img src="Kubenetes.assets/image-20200520162605102.png" alt="img"></p>
<p><strong>&#x7F16;&#x8F91;</strong></p>
<p>&#x5728;<code>Deployment</code>&#x4E0A;&#x70B9;&#x51FB;<code>&#x7F16;&#x8F91;</code>&#xFF0C;&#x7136;&#x540E;&#x4FEE;&#x6539;<code>yaml&#x6587;&#x4EF6;</code>&#xFF0C;&#x70B9;&#x51FB;&#x786E;&#x5B9A;</p>
<p><img src="Kubenetes.assets/image-20200520163253644.png" alt="image-20200520163253644"></p>
<p><strong>&#x67E5;&#x770B;Pod</strong></p>
<p>&#x70B9;&#x51FB;<code>Pods</code>, &#x67E5;&#x770B;pods&#x5217;&#x8868;</p>
<p><img src="Kubenetes.assets/image-20200520163552110.png" alt="img"></p>
<p><strong>&#x64CD;&#x4F5C;Pod</strong></p>
<p>&#x9009;&#x4E2D;&#x67D0;&#x4E2A;Pod&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x5176;&#x6267;&#x884C;&#x65E5;&#x5FD7;&#xFF08;logs&#xFF09;&#x3001;&#x8FDB;&#x5165;&#x6267;&#x884C;&#xFF08;exec&#xFF09;&#x3001;&#x7F16;&#x8F91;&#x3001;&#x5220;&#x9664;&#x64CD;&#x4F5C;</p>
<p><img src="Kubenetes.assets/image-20200520163832827.png" alt="img"></p>
<blockquote>
<p>Dashboard&#x63D0;&#x4F9B;&#x4E86;kubectl&#x7684;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x4E00;&#x4E00;&#x6F14;&#x793A;</p>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../消息队列/mq-7.html" class="navigation navigation-prev " aria-label="Previous page: 消息积压该如何处理">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../深入剖析k8s/k8s.html" class="navigation navigation-next " aria-label="Next page: 深入剖析K8S">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Kubernetes","level":"1.5","depth":1,"next":{"title":"深入剖析K8S","level":"1.6","depth":1,"path":"深入剖析k8s/k8s.md","ref":"深入剖析k8s/k8s.md","articles":[{"title":"k8s调度器","level":"1.6.1","depth":2,"path":"深入剖析k8s/k8s调度.md","ref":"深入剖析k8s/k8s调度.md","articles":[]},{"title":"k8s网络","level":"1.6.2","depth":2,"path":"深入剖析k8s/k8s网络插件.md","ref":"深入剖析k8s/k8s网络插件.md","articles":[]}]},"previous":{"title":"消息积压该如何处理","level":"1.4.7","depth":2,"path":"消息队列/mq-7.md","ref":"消息队列/mq-7.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["-lunr","-search","search-pro","back-to-top-button","expandable-chapters-small","page-toc-button","theme-comscore"],"pluginsConfig":{"search-pro":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"theme-comscore":{},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"back-to-top-button":{},"expandable-chapters-small":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"kubernetes/k8s.md","mtime":"2022-03-23T03:26:32.985Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-04-30T17:01:56.893Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

